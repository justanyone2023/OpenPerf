{"sentences": "Cannot connect to vercel postgres database from wsl", "description": "### Summary\n\nI was learning nextjs through the official documentation. At [this](https://nextjs.org/learn/dashboard-app/setting-up-your-database) section on the tutorial, when I tried to run `npm run seed` it throws me the following error. I tried running the same command by copying the files to windows `C:\\Users\\abhis\\Documents` and from this folder the command runs fine and no issues. what is wrong with running this on wsl?\r\n```\r\nnode:events:496\r\n      throw er; // Unhandled 'error' event\r\n      ^\r\n\r\nAggregateError [ETIMEDOUT]: \r\n    at internalConnectMultiple (node:net:1116:18)\r\n    at internalConnectMultiple (node:net:1184:5)\r\n    at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n    at listOnTimeout (node:internal/timers:575:11)\r\n    at process.processTimers (node:internal/timers:514:7)\r\nEmitted 'error' event on WebSocket instance at:\r\n    at emitErrorAndClose (/home/abishek/nextjs-dashboard/node_modules/ws/lib/websocket.js:1016:13)\r\n    at ClientRequest.<anonymous> (/home/abishek/nextjs-dashboard/node_modules/ws/lib/websocket.js:864:5)\r\n    at ClientRequest.emit (node:events:518:28)\r\n    at TLSSocket.socketErrorListener (node:_http_client:500:9)\r\n    at TLSSocket.emit (node:events:518:28)\r\n    at emitErrorNT (node:internal/streams/destroy:169:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:128:3)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  code: 'ETIMEDOUT',\r\n  [errors]: [\r\n    Error: connect ETIMEDOUT 34.194.100.28:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '34.194.100.28',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:5421:acd1:6284:5a8a:d6e9:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:5421:acd1:6284:5a8a:d6e9',\r\n      port: 443\r\n    },\r\n    Error: connect ETIMEDOUT 44.207.148.149:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '44.207.148.149',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:5454:82a4:8209:20f8:a5c1:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:5454:82a4:8209:20f8:a5c1',\r\n      port: 443\r\n    },\r\n    Error: connect ETIMEDOUT 23.23.229.9:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '23.23.229.9',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:543b:a8aa:14fb:d008:11fe:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:543b:a8aa:14fb:d008:11fe',\r\n      port: 443\r\n    },\r\n    Error: connect ETIMEDOUT 100.26.116.133:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '100.26.116.133',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:544d:621b:957c:81:5e5b:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:544d:621b:957c:81:5e5b',\r\n      port: 443\r\n    },\r\n    Error: connect ETIMEDOUT 44.199.59.172:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '44.199.59.172',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:5419:4ecf:2a7c:cf52:31ae:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:5419:4ecf:2a7c:cf52:31ae',\r\n      port: 443\r\n    },\r\n    Error: connect ETIMEDOUT 52.20.107.131:443\r\n        at createConnectionError (node:net:1646:14)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1705:38)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -110,\r\n      code: 'ETIMEDOUT',\r\n      syscall: 'connect',\r\n      address: '52.20.107.131',\r\n      port: 443\r\n    },\r\n    Error: connect ENETUNREACH 2600:1f18:240c:540b:c14a:4d57:1251:234d:443 - Local (:::0)\r\n        at internalConnectMultiple (node:net:1180:16)\r\n        at Timeout.internalConnectMultipleTimeout (node:net:1710:5)\r\n        at listOnTimeout (node:internal/timers:575:11)\r\n        at process.processTimers (node:internal/timers:514:7) {\r\n      errno: -101,\r\n      code: 'ENETUNREACH',\r\n      syscall: 'connect',\r\n      address: '2600:1f18:240c:540b:c14a:4d57:1251:234d',\r\n      port: 443\r\n    }\r\n  ]\r\n}\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Best way to show loading state when using server action on client", "description": "I am trying to use a server action outside form in a client component. I want to do something once the server action is complete and also have a loading state meanwhile\r\n\r\n```tsx\r\n'use client'\r\nimport { addItem } from '../actions'\r\n \r\nfunction ExampleClientComponent({ id }) {\r\n  const someEvent = () => {\r\n    ...\r\n  }\r\n\r\n  return (\r\n    <button\r\n      onClick={async () => {\r\n        await addItem(id);\r\n        someEvent();\r\n      }}\r\n    >\r\n       Add To Cart\r\n    </button>\r\n  )\r\n}\r\n```\r\n\r\nTo have a loading state in the above case I'll need to create a new state variable for loading, and I can't use `startTransition` here as well because I want to execute the `someEvent` function after the item is added. So I just want to know if there's a better way to handle this, or creating an additional state for loading is the only way to handle this situation right now."}
{"sentences": "Use 'import' with ESM packages instead", "description": "I'm trying to import a library which switched to ESM and am getting this error:\r\n\r\n```\r\nModule not found: ESM packages (remark) need to be imported. Use 'import' to reference the package instead. https://nextjs.org/docs/messages/import-esm-externals\r\n  2 | import path from 'path'\r\n  3 | //import matter from 'gray-matter'\r\n> 4 | import remark from 'remark'\r\n    |                           ^\r\n  5 | import html from 'remark-html'\r\n```\r\nEven though the module is being imported correctly.\r\n\r\nWhen I change it to a name which doesn't exist I get:\r\n\r\n```\r\n./lib/posts.js:4:28\r\nModule not found: Can't resolve 'remarke'\r\n  2 | import path from 'path'\r\n  3 | //import matter from 'gray-matter'\r\n> 4 | import remark from 'remarke'\r\n    |                            ^\r\n  5 | import html from 'remark-html'\r\n```\r\n\r\nSo I know that it is imported.\r\n\r\nI also tried adding this to next.config.js:\r\n\r\n```\r\nexperimental: {\r\n        esmExternals: \"loose\",\r\n    },\r\n```\r\n\r\nBut then I get this error:\r\n\r\n```\r\nTypeError: (0 , _remark).default is not a function\r\n```\r\n\r\nThis has something to do with the switch to ESM module of the remark library.\r\n\r\nDoes anyone know what I can do to get rid of this error?"}
{"sentences": "How to handle database connections with Hot Reloading in API section", "description": "My application creates a new database connection pool with `node-mysql2`. When calling a different API end points a new pool is created. Over time the RDBMS reaches its maximum number of connections (~300). I think this is also related to Hot Reloading and compiling the end points each time they are called. If I stop the dev server and restart, then all the connections are apparently destroyed because I can connect again. In my application's `connection-pool.js` I create a top level variable as null, and either use that variable or assign it the connection pool if null (singleton). However it seems when the file is imported in the various API routes, a new instance of `connection-pool.js` is created instead of reusing the one that was imported elsewhere, or maybe it's just related to compiling the \"page\" each time and leaving the old connection pools hanging out in memory abyss.\r\n\r\nIf there was some hook I could use to clean up my connection pool before this happens then I wouldn't reach my DB's max connection limit. Open to all ideas.\r\n\r\n> event - build page: /api/order/listForUser\r\nwait  - compiling...\r\nevent - compiled successfully\r\nConnection pool was falsey. Created a new connection pool.\r\nReleased connection for reuse.\r\nevent - build page: /order/[orderId]\r\nwait  - compiling...\r\nevent - compiled successfully\r\nevent - build page: /api/order/details\r\nwait  - compiling...\r\nevent - compiled successfully\r\nConnection pool was falsey. Created a new connection pool.\r\nReleased connection for reuse.\r\nReleased connection for reuse."}
{"sentences": "@next/swc-win32-x64-msvc", "description": "I'm getting this error when I run `yarn dev`\r\nI'm using \r\n`win 11 64 bit`\r\n`node v16.13.0`\r\n`yarn v1.22.17`\r\n`next v12.0.3`\r\n\r\nhere are the error logs\r\n```bash\r\ndiphan@diphan MINGW64 ~/outbox (ft-login-EM-1)\r\n$ yarn dev\r\nyarn run v1.22.17\r\n$ next dev\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\nError: The specified module could not be found.\r\n\\\\?\\C:\\Users\\diphan\\outbox\\node_modules\\next\\node_modules\\@next\\swc-win32-x64-msvc\\next-swc.win32-x64-msvc.node\r\n    at Object.Module._extensions..node (node:internal/modules/cjs/loader:1183:18)\r\n    at Module.load (node:internal/modules/cjs/loader:981:32)\r\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\r\n    at Module.require (node:internal/modules/cjs/loader:1005:19)\r\n    at require (node:internal/modules/cjs/helpers:102:18)\r\n    at Object.<anonymous> (C:\\Users\\diphan\\outbox\\node_modules\\next\\dist\\build\\swc\\index.js:29:20)\r\n    at Module._compile (node:internal/modules/cjs/loader:1101:14)\r\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1153:10)\r\n    at Module.load (node:internal/modules/cjs/loader:981:32)\r\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12) {\r\n  code: 'ERR_DLOPEN_FAILED'\r\n}\r\nerror - Failed to load SWC binary, see more info here: https://nextjs.org/docs/messages/failed-loading-swc\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n```\r\n\r\nAny help regarding this error will be appreciated. Thank you"}
{"sentences": "Why is the middleware not working?", "description": "### Summary\n\nI located the middleware file in the root directory and configured it\r\n\r\n<img width=\"1115\" alt=\"Screenshot 2024-05-24 at 13 53 55\" src=\"https://github.com/vercel/next.js/assets/83119980/9998c53d-7446-4b90-9e23-a344a8400ae9\">\r\n\r\nWhy can't I still access protected files if I haven't logged in yet?\r\n\n\n### Additional information\n\n```js\ncode \r\n\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { cookies } from \"next/headers\";\r\nimport { decrypt } from \"@/lib/session\";\r\nimport { cookie_auth } from \"./jwt/cookie_auth\";\r\nimport { protectedRoutes, adminProtectedRoutes } from \"@/routes/routes\";\r\n\r\nexport default async function middleware(req: NextRequest) {\r\n  const path = req.nextUrl.pathname;\r\n  const isProtectedRoute = protectedRoutes.includes(path);\r\n  const isAdminProtectedRoute = adminProtectedRoutes.includes(path);\r\n\r\n  const cookie = cookies().get(cookie_auth)?.value;\r\n  if (!cookie) {\r\n    return;\r\n  }\r\n  const session = await decrypt(cookie);\r\n  if (\r\n    session?.userId &&\r\n    (path.includes(\"/auth/login\") || path.includes(\"/auth/register\"))\r\n  ) {\r\n    return NextResponse.redirect(new URL(\"/\", req.nextUrl));\r\n  }\r\n\r\n  if (isProtectedRoute && !session?.userId) {\r\n    return NextResponse.redirect(new URL(\"/auth/login\", req.nextUrl));\r\n  }\r\n  if (isAdminProtectedRoute && !session?.isAdmin) {\r\n    if (!session?.userId) {\r\n      return NextResponse.redirect(new URL(\"/auth/login\", req.nextUrl));\r\n    }\r\n    if (!session?.isAdmin) {\r\n      return NextResponse.redirect(new URL(\"/unauthorized\", req.nextUrl));\r\n    }\r\n  }\r\n}\r\n\r\n````\r\n\r\nroutes.ts\r\n\r\n\r\n```\r\nexport const protectedRoutes = [\"/checkout\", \"/cart\"];\r\nexport const adminProtectedRoutes = [\r\n  \"/admin/products\",\r\n  \"/admin/products/orders\",\r\n  \"/admin/products/users\",\r\n  \"/admin/products/edit/:id\",\r\n  \"/admin/products/create-product\",\r\n];\r\n\r\n\r\n```\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Is custom server supported with app router? Documentation is missing.", "description": "For the pages router, the custom server documentation can be found below.\r\nhttps://nextjs.org/docs/pages/building-your-application/configuring/custom-server\r\n\r\nThere is no custom server documentation for app router currently. Is that by design? Does that mean custom server not supported with app router going forward?"}
{"sentences": "Invariant: Missing 'next-action' header", "description": "This issue is quite hard to reproduce in a sandbox or an implementation as it quite flaky. But within our current application that have around 30k users daily we get this type of errors around 40 time a day:\r\n\r\n![Screenshot from 2024-04-08 17-37-50](https://github.com/vercel/next.js/assets/30130006/918b4670-bc7c-48d1-8d32-987d513d67db)\r\n\r\nthe error itself is:\r\n\r\n```txt\r\nError: Failed to find Server Action \"null\". This request might be from an older or newer deployment. Original error: Invariant: Missing 'next-action' header.\r\n```\r\n\r\nThat been say, there is an already previously **closed** discussion reporting it (https://github.com/vercel/next.js/discussions/59105) with quite the amount of comments on it where the currently proposed fix didn't work for most of the cases.\r\n\r\nI highly suspect that this issue had to do with how nextjs handle middleware and that sometime receive not correctly formated query that nextjs doesn't handle properly.\r\n\r\n\r\nhere is the extract of my current middleware were you can see i am indeed depending on the `req.headers.get('host')` and i suspect that it is the origin of the crash.\r\n\r\n\r\n```js\r\nimport { Domains } from \"...\"\r\nimport createMiddleware from \"next-intl/middleware\"\r\n\r\nconst intlMiddleware = createMiddleware({\r\n  locales: Domains?.map(({ defaultLocale }) => defaultLocale),\r\n  defaultLocale: \"us\",\r\n  domains: Domains,\r\n  localePrefix: \"never\",\r\n  timeZone: \"Europe/Madrid\"\r\n})\r\n\r\nconst middleware = req => {\r\n  // GET DEFAULT LOCALE\r\n  const host = req.headers.get(\"host\")\r\n  const { defaultLocale = \"us\" } = Domains.find(({ domain }) => domain === host)\r\n  req.cookies.set(\"NEXT_LOCALE\", defaultLocale)\r\n\r\n  // APPLY TRANSLATION MIDDLEWARE\r\n  return intlMiddleware(req)\r\n}\r\n\r\nexport default middleware\r\n\r\nexport const config = {\r\n  matcher: [\"/\", \"/((?!api|_next|_vercel|.*\\\\..*).*)\"]\r\n}\r\n```\r\n\r\nmy infra is the following just in case --> cloudflare CDN --> nginx load balancer --> kubernetes --> docker image of nodejs 20 --> nextjs\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Image size error while running divs in a loop to place the image.. ( I got the individual images fixed in other pages)", "description": "### Summary\n\nThis error I got it fixed in other pages, but this page has multiple images that are going to be placed inside a component... and I am only getting the right size for the first image, while the rest are showing as errors.\r\n\r\nAny idea of how I could fix it?\r\n\r\n![image](https://github.com/vercel/next.js/assets/93617433/4ab0e194-b20e-49d8-9bce-c8a973f18993)\r\n\r\n\r\n^^^  Basically, if I am dealing with just one independent image... I can fix this error by using the `fill` property and giving the parent div a `height`...   If I need to make the div smaller I can add `aspect-ratio` and a JavaScript code to vary the `height`  <---  This allows me to have a responsive single image without sizing errors from the lighthouse..\r\n\r\nHowever, my code doesn't seem to work when I loop through all the divs to give them height, and I end up with just the first image with the proper size, while the other ones have a wrong size error...\r\n\r\nThis is the page:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/video-blog/english/index.js\r\nLine 17 to 43 is the loop to get the divs..\r\n\r\nAn lines 179 to 198 is where the images would go..\r\n\r\n\r\nAnd this would be the associated CSS:\r\n\r\n```\r\n.blog-div-image {\r\n  position: relative;\r\n  aspect-ratio: 1.9047;\r\n  margin: auto;\r\n  max-height: 315px;\r\n}\r\n\r\n#blog-image {\r\n  position: absolute;\r\n  object-fit: contain;\r\n  object-position: center;\r\n}\r\n\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How do I access `VERCEL_ENV` and `VERCEL_URL` environment variables on client side in Next?", "description": "I want to access the `VERCEL_URL` variables and `VERCEL_ENV` variables on the client side to avoid creating additional versions of this manually with the `NEXT_PUBLIC_` prefix. Since those values will not be automatically updated when I change the domain for example.\r\nIs there any way to achieve this?\r\nOr possibly a feature Vercel could have? (like using other `system env variables` as variables in other `env variables` to achieve this)"}
{"sentences": "Auto open browser when run dev", "description": "Is there a way to open a browser when running `next dev`?"}
{"sentences": "Image Tag might need more development?  ... or how can I get rid of this error CLS error?", "description": "### Summary\n\nI have been trying to make errors go away using the Image tag...  the latest error is this one:\r\n\r\n![image](https://github.com/vercel/next.js/assets/93617433/aefd09b2-f52a-4d65-9442-cce2cc48c137)\r\n\r\n\r\nThe code I have is this:\r\n```\r\n <div className=\" row oil-analysis-span\">\r\n            <Image\r\n              fill={true}\r\n              priority={true}\r\n              id=\"oil-analysis2\"\r\n              src=\"/images/oil-analysis2.png\"\r\n              alt=\"oil-analysis\"\r\n              sizes=\"100vw\"\r\n              // width={700}\r\n              // height={400}\r\n            />\r\n          </div>\r\n\r\n\r\n// CSS\r\n.oil-analysis-span {\r\n  padding-left: 2em;\r\n  position: relative;\r\n}\r\n\r\n#oil-analysis2 {\r\n  position: absolute;\r\n  object-fit: contain;\r\n  object-position: left center;\r\n  margin-right: 1em;\r\n  margin-left: 1.5em;\r\n}\r\n\r\n// JavaScritp to automatically change the height of the parent div, so that there are no big empty spaces in the div holding the image.\r\n\r\nuseEffect(() => {\r\n    function setHeight() {\r\n      const screenWidth = window.innerWidth;\r\n      const divHeight = screenWidth * 0.4;\r\n      const theDiv = document.querySelector(\".oil-analysis-span\");\r\n      if (screenWidth <= 1000) {\r\n        theDiv.style.height = `${divHeight}px`;\r\n      } else {\r\n        theDiv.style.height = `400px`;\r\n      }\r\n    }\r\n\r\n    // Call setHeight initially\r\n    setHeight();\r\n\r\n    // Add a listener to resize event\r\n    window.addEventListener(\"resize\", setHeight);\r\n\r\n    // Cleanup function to remove the resize event listener\r\n    return () => {\r\n      window.removeEventListener(\"resize\", setHeight);\r\n    };\r\n  }, []); // Empty dependency array means this effect runs once after initial render\r\n\r\n\r\n\r\n```\r\n\r\n^^^  Now, if I use the `fill` property I must give the parent div a height.. else it doesn't show anything.. <--- should I open that as an issue?\r\n\r\n\r\nIf I want the parent div to be responsive, so it doesn't leave huge blank spaces for smaller screens, then I need to make the height of the parent div responsive as well..\r\n\r\nApparently, the browser doesn't know how much space to allocate to the image, and it leads to layout shifts problems.\r\n\r\nSo, how can I have a responsive image, which doesn't have image size problems, no CLS problems, and no leaving big empty spaces inside the div with the image?\r\n\r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error: Command \"npm run build\" exited with 1", "description": "### Summary\n\nRegarding the \".env\" file, in general, it should not cause build errors. This is used for local environment variables and should not affect building on Vercel.\r\n\r\nLocally, if I run the \"npm run build\" command, everything seems to work, but not on vercel:\r\n\r\nnpm run build\r\n\r\n> build\r\n> next build\r\n\r\n- info Loaded env from C:\\Users\\mocan\\Source\\Repos\\nextjs-blog\\.env\r\n- info Linting and checking validity of types\r\n- info Creating an optimized production build\r\n- info Compiled successfully\r\n- info Collecting page data\r\n- info Generating static pages (5/5)\r\n- info Finalizing page optimization\r\n\r\nRoute (pages)                              Size     First Load JS\r\n┌ ○ /                                      4.19 kB         155 kB\r\n├   └ css/127ec2ac88fd3fb4.css             464 B\r\n├   /_app                                  0 B              87 kB\r\n├ ○ /404                                   182 B          87.2 kB\r\n├ λ /api/auth/[...nextauth]                0 B              87 kB\r\n├ λ /api/ratings                           0 B              87 kB\r\n├ λ /api/user/crud-messages                0 B              87 kB\r\n├ λ /api/user/login                        0 B              87 kB\r\n├ λ /api/user/register                     0 B              87 kB\r\n├ ○ /login                                 1.14 kB         145 kB\r\n├ λ /posts/[id]                            9.02 kB         155 kB\r\n├   └ css/fbad86517a01dfab.css             436 B\r\n├ ○ /register                              1.68 kB         145 kB\r\n├ λ /resume-file                           150 kB          237 kB\r\n├   └ css/b7fe1c3ced7eec1e.css             4.54 kB\r\n└ λ /review-zone                           19.4 kB         170 kB\r\n    └ css/f53237c423389f03.css             4.71 kB\r\n+ First Load JS shared by all              87.3 kB\r\n  ├ chunks/framework-63157d71ad419e09.js   45.2 kB\r\n  ├ chunks/main-c59a42b9e9a6f445.js        29.3 kB\r\n  ├ chunks/pages/_app-51d1d9bf07136815.js  10.4 kB\r\n  ├ chunks/webpack-edba978960cb2961.js     2.01 kB\r\n  └ css/28a4b785560fb0c2.css               249 B\r\n\r\nλ  (Server)  server-side renders at runtime (uses getInitialProps or getServerSideProps)\r\n○  (Static)  automatically rendered as static HTML (uses no initial props)\n\n### Additional information\n\n```js\n[17:23:55.647] Running build in Washington, D.C., USA (East) – iad1 (Hive)\r\n[17:23:55.761] Cloning github.com/GeorgeMocanu23/nextjs-blog (Branch: main, Commit: 8ffd1c3)\r\n[17:23:56.116] Previous build cache not available\r\n[17:23:56.163] Cloning completed: 401.554ms\r\n[17:23:56.412] Running \"vercel build\"\r\n[17:23:56.867] Vercel CLI 32.4.1\r\n[17:23:57.938] Warning: Detected \"engines\": { \"node\": \">=18\" } in your `package.json` that will automatically upgrade when a new major Node.js Version is released. Learn More: http://vercel.link/node-version\r\n[17:23:57.946] Installing dependencies...\r\n[17:24:26.426] \r\n[17:24:26.426] added 347 packages in 28s\r\n[17:24:26.426] \r\n[17:24:26.427] 122 packages are looking for funding\r\n[17:24:26.427]   run `npm fund` for details\r\n[17:24:26.454] Detected Next.js version: 13.4.19\r\n[17:24:26.458] Detected `package-lock.json` generated by npm 7+\r\n[17:24:26.459] Running \"npm run build\"\r\n[17:24:27.257] \r\n[17:24:27.257] > build\r\n[17:24:27.257] > next build\r\n[17:24:27.258] \r\n[17:24:27.791] Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n[17:24:27.792] This information is used to shape Next.js' roadmap and prioritize features.\r\n[17:24:27.792] You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n[17:24:27.792] https://nextjs.org/telemetry\r\n[17:24:27.792] \r\n[17:24:27.881] - info Linting and checking validity of types...\r\n[17:24:28.044] It looks like you're trying to use TypeScript but do not have the required package(s) installed.\r\n[17:24:28.044] \r\n[17:24:28.045] Please install typescript by running:\r\n[17:24:28.045] \r\n[17:24:28.045] \tnpm install --save-dev typescript\r\n[17:24:28.045] \r\n[17:24:28.045] If you are not trying to use TypeScript, please remove the tsconfig.json file from your package root (and any TypeScript files in your pages directory).\r\n[17:24:28.045] \r\n[17:24:28.247] Error: Command \"npm run build\" exited with 1\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Why do I get a \"useForm is not a function\" error when using React Hook forms in a Next JS project?", "description": "### Summary\n\nHello, I encountered a problem when using React Hook Forms in my Next JS project.\r\n\r\nI get an error: Error: (0 , react_hook_form__WEBPACK_IMPORTED_MODULE_1__.useForm) is not a function\r\n![2023-12-11_13-35-26](https://github.com/vercel/next.js/assets/19279983/fdaaaa67-6d7d-4ad8-a9bf-e910c1958c90)\r\n\r\nI can't figure out what the problem is. Why useForm doesn't work?\r\nI have tried to uninstall the node_modules directory. None of these worked.\n\n### Additional information\n\n```js\nCode form - LoginForm.tsx\r\n\r\n\r\nimport type {NextPage} from 'next'\r\nimport { useForm, SubmitHandler } from \"react-hook-form\";\r\nimport styles from './Auth.module.scss';\r\n\r\ninterface IFormInput {\r\n  email: string\r\n  password: string\r\n}\r\n\r\nexport const LoginForm: NextPage = () => {\r\n  const { register, handleSubmit } = useForm<IFormInput>();\r\n  const onSubmit: SubmitHandler<IFormInput> = (data) => console.log(data);\r\n\r\n  return (\r\n    <div className={styles.formBlock}>\r\n      <h1 className={styles.title}>Login</h1>\r\n      <div className={styles.form_container}>\r\n        <form onSubmit={handleSubmit(onSubmit)}>\r\n            <label htmlFor=\"email\">E-mail</label>\r\n            <input type=\"email\" placeholder=\"E-mail\" \r\n              {...register('email', {\r\n                required: \"Email is required.\",\r\n                pattern: {\r\n                  value: /^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$/,\r\n                  message: \"Email must be correctly\"\r\n                }\r\n              })}\r\n            />\r\n            <label htmlFor=\"password\">Password</label>\r\n            <input type=\"password\"  \r\n              {...register('password', {\r\n                required: \"Password is required..\",\r\n              })}\r\n              />\r\n            <input type=\"submit\" />\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How do I change only the static folder path?", "description": "### Summary\n\nI want my project to support multiple routes. So I need to leave the base route blank. My project is running on openshift. Another project is running on the main route. I can redirect to my project with different route routings on Openshift. My project cannot access the /_next/static/chunks folder because another project is running on the main route.\r\nI try the /_next/static/chunks folder to work as if it were under a route I created the folder for. When I change the basePath in the nextconfig file, I cannot support the route I want, but the path of the /_next/static folder changes correctly. On the other hand, when I change the assetPrefix, the /_next/static folder is not moved to where I want it.\r\n\r\nHow do I change the path of the /_next/static folder without changing the basePath?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Image optimizations for background images", "description": "Edit: this is now supported: https://github.com/vercel/next.js/discussions/18357#discussioncomment-662118"}
{"sentences": "Error: 'sharp' is required to be installed in standalone mode for the image optimization to function correctly. Read more at: https://nextjs.org/docs/messages/sharp-missing-in-production", "description": "### Summary\n\nI'm using the [official example](https://github.com/vercel/next.js/blob/canary/examples/with-docker/Dockerfile) for a dockerfile, adding a few things for prisma and I'm still getting issues with sharp. I've seen this issue is quite common and i'm trying to find a fix.\r\n\r\nIf you're confused about the host.docker.internal its because I couldn't get it to connect normally with an existing container. I'm still trying to workout how to wait for postgres server to be available before trying to build as i'm having issues when building static pages and making migrations because I need a connection to postgres when building the static pages and its using prisma commands from server components.\n\n### Additional information\n\n```js\nFROM node:18-alpine AS base\r\n\r\n# Install dependencies only when needed\r\nFROM base AS deps\r\n# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.\r\nRUN apk add --no-cache libc6-compat\r\nWORKDIR /app\r\n\r\n# Install dependencies based on the preferred package manager\r\nCOPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./\r\nRUN \\\r\n  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \\\r\n  elif [ -f package-lock.json ]; then npm ci; \\\r\n  elif [ -f pnpm-lock.yaml ]; then yarn global add pnpm && pnpm i --frozen-lockfile; \\\r\n  else echo \"Lockfile not found.\" && exit 1; \\\r\n  fi\r\n\r\n\r\n# Rebuild the source code only when needed\r\nFROM base AS builder\r\nWORKDIR /app\r\nCOPY --from=deps /app/node_modules ./node_modules\r\nCOPY . .\r\n\r\n# Next.js collects completely anonymous telemetry data about general usage.\r\n# Learn more here: https://nextjs.org/telemetry\r\n# Uncomment the following line in case you want to disable telemetry during the build.\r\n# ENV NEXT_TELEMETRY_DISABLED 1\r\n\r\n#Environments for prisma migrations and static pages.\r\nENV DATABASE_URL \"postgresql://postgres:postgres@host.docker.internal:5432/postgres?schema=public\"\r\nENV RAWG_API_KEY \"33af10ad5812440abf75a35c04492e1a\"\r\n\r\n# Generate Prisma Files\r\nRUN npx prisma generate\r\n\r\n# Make prisma migrations\r\nRUN npx prisma migrate deploy\r\n\r\n\r\nRUN yarn build\r\n\r\n# If using npm comment out above and use below instead\r\n# RUN npm run build\r\n\r\n# Production image, copy all the files and run next\r\nFROM base AS runner\r\nWORKDIR /app\r\n\r\nENV NODE_ENV production\r\n# Uncomment the following line in case you want to disable telemetry during runtime.\r\n# ENV NEXT_TELEMETRY_DISABLED 1\r\n\r\nRUN addgroup --system --gid 1001 nodejs\r\nRUN adduser --system --uid 1001 nextjs\r\n\r\nCOPY --from=builder /app/public ./public\r\n\r\n# Set the correct permission for prerender cache\r\nRUN mkdir .next\r\nRUN chown nextjs:nodejs .next\r\n\r\n# Automatically leverage output traces to reduce image size\r\n# https://nextjs.org/docs/advanced-features/output-file-tracing\r\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\r\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\r\nCOPY --from=builder --chown=nextjs:nodejs /app/prisma ./prisma\r\n\r\nUSER nextjs\r\n\r\nEXPOSE 3000\r\n\r\nENV PORT 3000\r\n# set hostname to localhost\r\nENV HOSTNAME \"0.0.0.0\"\r\n\r\n# server.js is created by next build from the standalone output\r\n# https://nextjs.org/docs/pages/api-reference/next-config-js/output\r\nCMD [\"node\", \"server.js\"]\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Rename /api route ?", "description": "Hello dear community,\r\n\r\nI know this might be a hard no, but hear me out.\r\n\r\nThe situation is my Next.js app sits next to a an other app that's already using `/api` and I cannot change that.\r\nAny way to tell Next.js to use an other route name ?\r\n\r\nIn an act of despair, I tried using a normal page and use getInitialProps to perform my server-side call and output it raw in the render method, but of course it's nasty, not maintainable, has poor performances and is pretty stupid. \r\n\r\nI tried to search on this topic but couldn't find much really.\r\n\r\nThanks a lot :) "}
{"sentences": "Help with webpack config monorepo/workspace with drizzle, node:events build error.", "description": "### Summary\n\nI've got a monorepo set up with database functions in packages/core. I'm not building this package, just importing directly from it, and webpack is complaining about `node:events`. I'm assuming this is because however next.js polyfills/etc things for client side is not triggered outside the workspace with the `next.config.js` I've tried adding some of the dependencies to `transpilePackages` to no avail.\r\n\r\nMy webpack config is currently\r\n\r\n```\r\nwebpack: (config) => {\r\n      config.experiments = { ...config.experiments, topLevelAwait: true }\r\n      config.resolve.fallback = { fs: false, net: false, tls: false }\r\n      return config\r\n    }\r\n```\r\n\r\nWould die for some guidance!\n\n### Additional information\n\n```js\nnode:events\r\nModule build failed: UnhandledSchemeError: Reading from \"node:events\" is not handled by plugins (Unhandled scheme).\r\nWebpack supports \"data:\" and \"file:\" URIs by default.\r\nYou may need an additional plugin to handle \"node:\" URIs.\r\n    at /home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:28:401757\r\n    at Hook.eval [as callAsync] (eval at create (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:13:28858), <anonymous>:6:1)\r\n    at Hook.CALL_ASYNC_DELEGATE [as _callAsync] (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:13:26012)\r\n    at Object.processResource (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:28:401682)\r\n    at processResource (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/loader-runner/LoaderRunner.js:1:5308)\r\n    at iteratePitchingLoaders (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/loader-runner/LoaderRunner.js:1:4667)\r\n    at runLoaders (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/loader-runner/LoaderRunner.js:1:8590)\r\n    at NormalModule._doBuild (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:28:401544)\r\n    at NormalModule.build (/home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:28:403572)\r\n    at /home/dylan/finspotter/next-finspotter/node_modules/.pnpm/next@14.2.3_@babel+core@7.24.5_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/webpack/bundle5.js:28:82055\r\n\r\nImport trace for requested module:\r\nnode:events\r\n../../node_modules/.pnpm/drizzle-orm@0.30.10_@aws-sdk+client-rds-data@3.577.0_aws-crt@1.21.2__@types+react@18.3.2_@typ_ez3ywzp4zvxeu76juwbbeehb6u/node_modules/drizzle-orm/mysql2/session.js\r\n../../node_modules/.pnpm/drizzle-orm@0.30.10_@aws-sdk+client-rds-data@3.577.0_aws-crt@1.21.2__@types+react@18.3.2_@typ_ez3ywzp4zvxeu76juwbbeehb6u/node_modules/drizzle-orm/mysql2/index.js\r\n../core/src/drizzle/index.ts\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How to always hide the defaultLocale?", "description": "In opposite of the thread [[i18n] Prefix for default locale](https://github.com/vercel/next.js/discussions/18419), how can you make sure that the defaultLocale is always stripped from the url?\r\n\r\nIf you have for example three locales `['en', 'fr', 'nl']` and you set 'en' as default locale, NextJS will sometimes strip the locale from the url, and sometimes it doesn't. Having a fake `default` locale seems to be a valid solution for this. But if your (large) site already has hundreds, or maybe thousands, of urls.. how can you prevent the defaultLocale from ever being in the url? This is important because of SEO and all the places that where \"good\" before.\r\n\r\nGetting the defaultLocale in the url is possible for example by having a link on the website (or some referring site) that has the defaultLocale as part of the url. We see quite some hits from Google that come in this way.\r\n\r\nAs a possible solution I tried a redirect in `next.config.js` and I also checked `middleware.js`. Only problem is that you do not have access to the original url (the defaultLocale is always stripped from that version). A redirect from `next.config.js` will give an error (to many redirects).\r\n\r\nI also found a way of using `NextRequestMeta` symbol on the `context.req` object in getServerSideProps but that does not seem like a good solution. Links with `<Link/>` for example will still show the defaultLocale (because it will then client side render):\r\n\r\n```jsx\r\nexport async function getServerSideProps(context) {\r\n  const NextRequestMetaSymbol = Reflect.ownKeys(context.req).find(\r\n    (key) => key.toString() === 'Symbol(NextRequestMeta)',\r\n  );\r\n\r\n  if (\r\n    NextRequestMetaSymbol &&\r\n    context.req[NextRequestMetaSymbol] &&\r\n    context.req[NextRequestMetaSymbol].__nextStrippedLocale\r\n  ) {\r\n    return {\r\n      redirect: { destination: context.req.url, permanent: false },\r\n    };\r\n  }\r\n\r\n  // do more interesting stuff here...\r\n}\r\n```\r\n\r\nI am out of options at this point, curios if anyone has had the same \"problem\" and/or has any ideas on this."}
{"sentences": "Need help with the Image tag.. can't make it work.", "description": "### Summary\r\n\r\nGoing for at least 5 days with image tag problems..  very frustrated... \r\n\r\nAny feedback on this would help a million..\r\n\r\n1. Getting image size error from the lighthouse..  I think Next.js is suppose to present the proper image depending on screen size..\r\n\r\n2.  After updating Next.js... along with a few other dependencies and Bootstrap... now I can't center the image, and the image won't stay inside the divs...\r\n\r\n\r\n^^ I never had a problem on problem number 2, but after updating Next.js, the images go out of line using Bootstrap..\r\n\r\nThe image won't center, or shrink inside the div\r\n\r\n![image](https://github.com/vercel/next.js/assets/93617433/6ff5259d-80eb-4f88-b06d-b1365682b538)\r\n\r\n\r\n^^ code reference for testing:\r\n\r\n     \r\n <div className=\"row\">\r\n        <div className=\"col-md-3 justify-content-center\">\r\n           hello!\r\n          <Carousel />\r\n        </div>\r\n        <div className=\"col-md-9 justify-content-center\">\r\n           hello again!\r\n        </div>\r\n      </div>\r\n\r\n\r\n \r\n\r\nThe component code is this:\r\n\r\n\r\n```\r\nimport React from \"react\";\r\nimport Image from \"next/image\";\r\nimport TuWorld from \"../public/carousel-main/tu-world.png\";\r\nimport Everything from \"../public/carousel-main/carousel-everything.png\";\r\nimport HydraulicMotors from \"../public/carousel-main/carousel-hydraulic-motors.png\";\r\nimport HydraulicPumps from \"../public/carousel-main/carousel-pumps.png\";\r\nimport ValvesManifolds from \"../public/carousel-main/carousel-valves-manifolds.png\";\r\nimport MobileValves from \"../public/carousel-main/mobile-valves.png\";\r\nimport { useEffect } from \"react\";\r\n\r\nconst Carousel = () => {\r\n  useEffect(() => {\r\n    let slideIndex = 0;\r\n    const carouselItems = document.querySelectorAll(\"#carousel-inner\");\r\n    console.log(carouselItems);\r\n    showSlides();\r\n    function showSlides() {\r\n      for (let i = 0; i < carouselItems.length; i++) {\r\n        carouselItems[i].style.display = \"none\";\r\n      }\r\n      slideIndex++;\r\n      if (slideIndex > carouselItems.length) {\r\n        slideIndex = 1;\r\n      }\r\n      carouselItems[slideIndex - 1].style.display = \"flex\";\r\n      setTimeout(showSlides, 5000);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\" tu-world justify-content-center\">\r\n      <div className=\"myslide-item \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={TuWorld}\r\n          alt=\"tu world\"\r\n          width={1710}\r\n          height={315}\r\n          priority={true}\r\n        />\r\n      </div>\r\n      <div className=\"myslide-item  \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={Everything}\r\n          alt=\"Everything Industrial\"\r\n          width={1710}\r\n          height={315}\r\n          priority={false}\r\n        />\r\n      </div>\r\n      <div className=\"myslide-item \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={HydraulicMotors}\r\n          alt=\"Hydraulic Motors\"\r\n          width={1710}\r\n          height={315}\r\n          priority={false}\r\n        />\r\n      </div>\r\n      <div className=\"myslide-item \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={HydraulicPumps}\r\n          alt=\"Hydraulic Pumps\"\r\n          width={1710}\r\n          height={315}\r\n          priority={false}\r\n        />\r\n      </div>\r\n      <div className=\"myslide-item \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={ValvesManifolds}\r\n          alt=\"Hydraulic Manifolds\"\r\n          width={1710}\r\n          height={315}\r\n          priority={false}\r\n        />\r\n      </div>\r\n      <div className=\"myslide-item \">\r\n        <Image\r\n          id=\"carousel-inner\"\r\n          src={MobileValves}\r\n          alt=\"Hydraulic mobile valves\"\r\n          width={1710}\r\n          height={315}\r\n          priority={false}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Carousel;\r\n```\r\n\r\nAnd the related CSS is this:\r\n\r\n```\r\n.tu-world {\r\n  padding-top: 0.2em;\r\n}\r\n\r\n/* .myslide-item {\r\n} */\r\n\r\n#carousel-inner {\r\n  display: none;\r\n  height: auto;\r\n  animation-name: carousel-inner;\r\n  animation-duration: 5s;\r\n}\r\n\r\n@keyframes carousel-inner {\r\n  from {\r\n    opacity: 0.4;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n  }\r\n}\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "sitemap.ts and robots.ts file error when building nextjs project", "description": "I am getting following error when i build the next project \r\n\r\nis there is any solution to it ?\r\n\r\n```\r\nyarn build \r\nyarn run v1.22.21\r\n$ next build\r\n   ▲ Next.js 14.1.3\r\n\r\n   Creating an optimized production build ...\r\nFailed to compile.\r\n\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2F(common)%2Farticle%2Fsitemap%2F%5B__metadata_id__%5D%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5C(common)%5Carticle%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\nModule parse failed: Unexpected token (13:61)\r\nFile was processed with these loaders:\r\n * ./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js\r\nYou may need an additional loader to handle the result of these loaders.\r\n|\r\n|   if (typeof handler !== 'function') {\r\n>     throw new Error('Default export is missing in \"N:\\\\Niket's Drive\\\\@projects\\\\@nikettongare\\\\new-portfolio\\\\platform\\\\src\\\\app\\\\(common)\\\\article\\\\sitemap.ts\"')\r\n|   }\r\n|\r\n\r\nImport trace for requested module:\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2F(common)%2Farticle%2Fsitemap%2F%5B__metadata_id__%5D%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5C(common)%5Carticle%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\n\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2F(common)%2Fprojects%2Fsitemap%2F%5B__metadata_id__%5D%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5C(common)%5Cprojects%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\nModule parse failed: Unexpected token (13:61)\r\nFile was processed with these loaders:\r\n * ./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js\r\nYou may need an additional loader to handle the result of these loaders.\r\n|\r\n|   if (typeof handler !== 'function') {\r\n>     throw new Error('Default export is missing in \"N:\\\\Niket's Drive\\\\@projects\\\\@nikettongare\\\\new-portfolio\\\\platform\\\\src\\\\app\\\\(common)\\\\projects\\\\sitemap.ts\"')\r\n|   }\r\n|\r\n\r\nImport trace for requested module:\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2F(common)%2Fprojects%2Fsitemap%2F%5B__metadata_id__%5D%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5C(common)%5Cprojects%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\n\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2Frobots.txt%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5Crobots.ts&isDynamic=1!?__next_metadata_route__\r\nModule parse failed: Unexpected token (11:61)\r\nFile was processed with these loaders:\r\n * ./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js\r\nYou may need an additional loader to handle the result of these loaders.\r\n|\r\n|   if (typeof handler !== 'function') {\r\n>     throw new Error('Default export is missing in \"N:\\\\Niket's Drive\\\\@projects\\\\@nikettongare\\\\new-portfolio\\\\platform\\\\src\\\\app\\\\robots.ts\"')\r\n|   }\r\n|\r\n\r\nImport trace for requested module:\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2Frobots.txt%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5Crobots.ts&isDynamic=1!?__next_metadata_route__\r\n\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2Fsitemap.xml%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\nModule parse failed: Unexpected token (13:61)\r\nFile was processed with these loaders:\r\n * ./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js\r\nYou may need an additional loader to handle the result of these loaders.\r\n|\r\n|   if (typeof handler !== 'function') {\r\n>     throw new Error('Default export is missing in \"N:\\\\Niket's Drive\\\\@projects\\\\@nikettongare\\\\new-portfolio\\\\platform\\\\src\\\\app\\\\sitemap.ts\"')\r\n|   }\r\n|\r\n\r\nImport trace for requested module:\r\n./node_modules/next/dist/build/webpack/loaders/next-metadata-route-loader.js?page=%2Fsitemap.xml%2Froute&filePath=N%3A%5CNiket's%20Drive%5C%40projects%5C%40nikettongare%5Cnew-portfolio%5Cplatform%5Csrc%5Capp%5Csitemap.ts&isDynamic=1!?__next_metadata_route__\r\n\r\n\r\n> Build failed because of webpack errors\r\nerror Command failed with exit code 1.\r\n```"}
{"sentences": "Can someone help me understand why my site doesn't seem to be using SSR?", "description": "### Summary\n\nI can't fathom why my site isn't using SSG. The deployment logs show that it's SSG, however I can see my console.log in Vercel logs for every request.\r\n\r\nI can also see GQL requests hitting my CMS backend, although there's no requests for these in the Vercel logs.\r\n\r\nI'm using `export dynamic = 'auto'` in my root layout, but the only dynamic functions I'm using are used when nextjs draftMode is enabled. Basically I want to use SSG but opt into some SSR features like queryParams for draft mode requests.\r\n\r\nAm I misunderstanding how SSG works on Vercel? Are pages built multiple times so they can be distributed across the edge network or something?\r\n\r\nIn any case I would have thought the GQL requests would be stored in the data cache\r\n\r\nAny help much appreciated 🙏 \r\n\r\n<img width=\"1268\" alt=\"Screenshot 2024-05-15 at 11 21 27\" src=\"https://github.com/vercel/next.js/assets/72021142/e21b2e42-4b55-4bde-a3d1-ea8c034ec658\">\r\n\r\n<img width=\"1068\" alt=\"Screenshot 2024-05-15 at 11 24 20\" src=\"https://github.com/vercel/next.js/assets/72021142/ffcb120e-8cdf-4b43-ae25-c8d209336604\">\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to create different middleware for route groups?", "description": "### Summary\n\nIn NextJS14, the `middleware` file needs to be placed at the same level as the `app` and `pages` directories to take effect. So how should I configure `middleware` for different routing groups?\r\nThe routing group will not be reflected in the URL. \r\nDo I need to change the middleware file every time I add a new route?\r\n![image](https://github.com/vercel/next.js/assets/48341368/861a957d-cca3-4362-b5a6-e82766c864a7)\r\n\n\n### Additional information\n\n```js\nnext version: 14.1.2\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How to properly setup bundle analyzer?", "description": "### Summary\n\nFrom reference here:\r\nhttps://github.com/vercel/next.js/tree/canary/packages/next-bundle-analyzer?utm_source=lighthouse&utm_medium=devtools\r\n\r\n`npm install @next/bundle-analyzer`\r\n\r\nthen use inside  `next.config.js`\r\n\r\nThe way I have it is:\r\n\r\n```\r\n/** @type {import('next').NextConfig} */\r\n\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n});\r\n\r\n// then my config with a bunch of itmes in the next lines.\r\n\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  productionBrowserSourceMaps: true,\r\n\r\n  compiler: {\r\n    styledComponents: true,\r\n  },\r\n\r\n  async rewrites() {\r\n    return {\r\n      afterFiles: [{ source: \"/:path*\", destination: \"/_404/:path*\" }],\r\n    };\r\n  },\r\n\r\n// then the last line below.\r\n\r\nmodule.exports = withBundleAnalyzer({ nextConfig });\r\n\r\n\r\n```\r\n\r\n^^  This gives me error:\r\n\r\n```\r\n⚠ Invalid next.config.js options detected: \r\n ⚠     Unrecognized key(s) in object: 'nextConfig'\r\n ⚠ See more info here: https://nextjs.org/docs/messages/invalid-next-config\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "cached manifest can't get renewed", "description": "### Summary\n\nI changed some important things in manifest.webmanifest like display from browser to standalone.\r\nbut when it got deployed, i can see change in Source, but in Output still the old one.\r\n\r\n```\r\ncache-control: public, immutable, no-transform, max-age=31536000\r\ncontent-type: application/manifest+json\r\nx-next-cache-tags: _N_T_/layout,_N_T_/manifest.webmanifest/layout,_N_T_/manifest.webmanifest/route,_N_T_/manifest.webmanifest\r\nvary: RSC, Next-Router-State-Tree, Next-Router-Prefetch\r\n```\r\n\r\ni think it's because cached.\r\n\r\nso i made vercel.json, and changed cache details, but it doesn't work.\r\n\r\n```\r\n{\r\n  \"headers\": [\r\n    {\r\n      \"source\": \"/manifest.json\",\r\n      \"headers\": [\r\n        {\r\n          \"key\": \"Cache-Control\",\r\n          \"value\": \"max-age=0, s-maxage=86400\"\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nhow can i erase cached one, and got renewed one.\r\nI appreciate your help, thank you.\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Is there a way to get rid of NextJS image inline styles for better SEO?", "description": "### Summary\n\nNextJS image adds inline styles to the img tag \r\nit can be either `style=\"color:transparent\"` or `style=\"position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent\"` with 'fill' prop \n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "next/image, how to set image width to 100%?", "description": "I tried to define my image like this:\r\n\r\n```js\r\n<Image\r\n  src={props.image.url}\r\n  alt=\"Picture of the author\"\r\n  width={props.image.width}\r\n  height={props.image.height}\r\n  className=\"card__image\"\r\n  />\r\n\r\n<style jsx>{`\r\n  .card__image {\r\n    width: 100%;\r\n  }\r\n`}</style>\r\n```\r\n\r\nBut that won't work. The image is only displayed at full size. What should we do when we wan't a fluid width for the images, to use in a responsive grid etc?"}
{"sentences": "fetch priority error..", "description": "### Summary\r\n\r\nError:\r\n```\r\n\r\n Warning: React does not recognize the `fetchPriority` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `fetchpriority` instead. If you accidentally passed it from a parent component, remove it from the DOM element.\r\n    at img\r\n    at eval (webpack-internal:///./node_modules/next/dist/client/image-component.js:136:11)\r\n    at eval (webpack-internal:///./node_modules/next/dist/client/image-component.js:245:47)\r\n    at span\r\n    at div\r\n    at div\r\n    at div\r\n    at Home\r\n    at div\r\n    at Provider (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\react-redux\\lib\\components\\Provider.js:19:3)\r\n    at MyApp (webpack-internal:///./pages/_app.js:46:18)\r\n    at StyleRegistry (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\styled-jsx\\dist\\index\\index.js:449:36)\r\n    at eU (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\compiled\\next-server\\pages.runtime.dev.js:8:20468)\r\n    at eH (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\compiled\\next-server\\pages.runtime.dev.js:17:1765)\r\n    at eJ (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\compiled\\next-server\\pages.runtime.dev.js:17:3068)\r\n    at div\r\n```\r\n\r\n\r\n^^^\r\nI think this came after updating to the newest Next.js\r\n\r\n\r\nNow my package.json looks like this:\r\n\r\n```\r\n{\r\n  \"name\": \"nextprojectb\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@next/bundle-analyzer\": \"^14.2.3\",\r\n    \"@pinecone-database/pinecone\": \"^1.1.1\",\r\n    \"@reduxjs/toolkit\": \"^1.9.7\",\r\n    \"bootstrap\": \"^5.2.3\",\r\n    \"gsap\": \"^3.11.0\",\r\n    \"next\": \"^14.2.3\",\r\n    \"nodemailer\": \"^6.7.5\",\r\n    \"openai\": \"^4.12.4\",\r\n    \"react\": \"^18.3.1\",\r\n    \"react-bootstrap\": \"^2.10.2\",\r\n    \"react-dom\": \"^18.3.1\",\r\n    \"react-icons\": \"^4.11.0\",\r\n    \"react-redux\": \"^8.1.3\",\r\n    \"sass\": \"^1.53.0\",\r\n    \"sharp\": \"^0.33.3\",\r\n    \"uuid\": \"^9.0.1\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@fullhuman/postcss-purgecss\": \"^6.0.0\",\r\n    \"eslint\": \"8.15.0\",\r\n    \"eslint-config-next\": \"^13.1.1\"\r\n  }\r\n}\r\n```\r\n\r\n^^^  Besides that error now a carousel div is also not covering the entire width of the screen... and I think the priority error is also coming from the same carousel component.\r\n\r\nI haven't done another upload because the carousel is now all out of place..\r\n\r\nWhat would be a good way to fix this? \r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How to deal with large packages.(chunk load error)", "description": "So basically I am using matrix-js-sdk in my project. Now the problem comes with this package is it implicitly add this file (\"matrix_sdk_crypto_wasm_bg.wsm) . I used next bundle analyzer and it shows it's size as 2.8 mb (gzipped). Now next js very rarely (I don't want that behavoir rarely too) throws a timeout chunk load error. because file is 2.8 mb and it take time to download which causes timeout chunk load error. what should I do in this case . Can someone guide me.\r\n![Screenshot from 2024-05-12 23-10-13](https://github.com/vercel/next.js/assets/122437993/1b2da924-5846-4a95-ae3b-28402b3bd874)\r\n"}
{"sentences": "What is the TypeScript type of App Router (useRouter)?", "description": "### Summary\n\nI pass down the App Router to child components and would like (should I?) to declare the specific TypeScript types.\r\n\r\n1. Is this best practice?\r\n2. Where do I find the type?\r\n\r\n`function Products({cart, router}: {cart: Cart, router: any}) {...} `\n\n### Additional information\n\n```js\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function ConfirmOrderPage() {\r\n    const router = useRouter();\r\n    ...\r\n    return (\r\n        <Products cart={cart} router={router} />\r\n    )   \r\n}\r\n\r\nfunction Products({cart, router}: {cart: Cart, router: any}) {...}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Error: You're importing a component that needs useState. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.", "description": "### Summary\r\n\r\nIt should not return this error as in the nextjs docs it is mentioned we can use client component in server component if the client component has the \"use Client\" directive at the top of the file, I'm using \"use Client\" still getting the error when importing it in IncomePage.tsx which is a server component\r\n\r\nusing Next.js (14.2.3)\r\n\r\n### Additional information\r\n\r\n```js\r\n// @/app/ui/dashboard/income-card.tsx\r\n\r\n\"use Client\";\r\n\r\nimport { PlusIcon } from \"@heroicons/react/16/solid\";\r\nimport { useState } from \"react\";\r\n\r\nexport default function IncomeCardWrapper() {\r\n  const [addNewIncome, setAddNewIncome] = useState<boolean>(false);\r\n\r\n  return (\r\n    <>\r\n      {addNewIncome && (\r\n        <div>\r\n          <p>\r\n            Lorem ipsum dolor, sit amet consectetur adipisicing elit. Blanditiis\r\n            ut magnam consequuntur incidunt vel facilis doloribus eos ipsam\r\n            voluptatem pariatur aspernatur, reprehenderit eius aperiam\r\n            provident, quis officia neque obcaecati dolorum!\r\n          </p>\r\n        </div>\r\n      )}\r\n      <div\r\n        onClick={() => setAddNewIncome((prev: boolean) => !prev)}\r\n        className=\"grid aspect-video w-full cursor-pointer place-items-center rounded-xl border-2 border-dark bg-dark/10 p-4 tracking-wide text-dark\"\r\n      >\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <PlusIcon className=\"h-6 w-6\" />\r\n          <p>Add New Income</p>\r\n        </div>\r\n      </div>\r\n      <IncomeCard title=\"Income\" />\r\n      <IncomeCard title=\"Income\" />\r\n    </>\r\n  );\r\n}\r\n\r\nexport function IncomeCard({ title }: { title: string }) {\r\n  return <div title={title} className=\"bg-rose-500 p-4\" />;\r\n}\r\n\r\n\r\n// @/app/dashboard/income/page.tsx here I'm importing the above client component\r\n\r\nimport { addUserInCollection } from \"@/app/lib/firebase/crud/create/incomeHandler\";\r\nimport IncomeCardWrapper from \"@/app/ui/dashboard/income-card\";\r\nimport { lusitana } from \"@/app/ui/fonts\";\r\nimport { IncomeCardsSkeleton } from \"@/app/ui/skeletons\";\r\nimport { Suspense } from \"react\";\r\n\r\nexport default async function IncomePage() {\r\n  // const res = await addUserInCollection(\"user\", \"admin@gmail.com\");\r\n  // console.log(res);\r\n\r\n  return (\r\n    <section className=\"h-full\">\r\n      <h1 className={`${lusitana.className} mb-4 text-xl md:text-2xl`}>\r\n        Welcome to Income Page\r\n      </h1>\r\n      <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n        <Suspense fallback={<IncomeCardsSkeleton />}>\r\n          <IncomeCardWrapper />\r\n        </Suspense>\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n```"}
{"sentences": "\"You're importing a component that needs useEffect\" - ERROR", "description": "### Summary\n\nHi!\r\nIm doing a Next.js project and i cant get past the first error which is: \r\n\r\n-----------------------------------\r\n\r\n./src\\CountriesList.js\r\nReactServerComponentsError:\r\n\r\nYou're importing a component that needs useEffect. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.\r\n\r\nLearn more: https://nextjs.org/docs/getting-started/react-essentials\r\n\r\n╭─[C:\\Users\\simon\\Downloads\\Uppgift3\\labb3\\src\\CountriesList.js:1:1]\r\n 1 │ import React, { useState, useEffect } from 'react';\r\n   ·                           ─────────\r\n 2 │ import fetch from 'isomorphic-unfetch';\r\n 3 │ \r\n 3 │ const CountriesList = () => {\r\n   ╰────\r\n\r\nMaybe one of these should be marked as a client entry with \"use client\":\r\n  ./src\\CountriesList.js\r\n  ./src\\app\\page.js\r\n\r\n----------------------------------\r\n\r\nPlease help! \n\n### Additional information\n\n```js\nMy CountriesList.js code:\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport fetch from 'isomorphic-unfetch';\r\n\r\nconst CountriesList = () => {\r\n  const [countries, setCountries] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const fetchCountries = async () => {\r\n      try {\r\n        const response = await fetch('https://restcountries.com/v3.1/all');\r\n        const data = await response.json();\r\n        setCountries(data);\r\n      } catch (error) {\r\n        console.error('Error fetching countries data:', error);\r\n      }\r\n    };\r\n\r\n    fetchCountries();\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h2>List of Countries</h2>\r\n      <ul>\r\n        {countries.map((country) => (\r\n          <li key={country.cca2}>{country.name.common}</li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CountriesList;\r\n\r\n--------------------------\r\nThe code for page.js:\r\n\r\nimport React from 'react';\r\nimport CountriesList from '@/CountriesList'; // Uppdatera sökvägen här\r\n\r\nconst Home = () => {\r\n  return (\r\n    <div>\r\n      <h1>My Next.js App</h1>\r\n      <CountriesList />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Preserving State with Link Component and searchParams After Page Refresh", "description": "### Summary\n\nI'm implementing a filter using `searchParams` and `Link` component. This code basically works fine. But, when I refresh the browser with the query parameter `/?status=deleted` and then click the home `/` link, the deleted post is rendered. Using `useEffect` and `router.refresh` solves the problem for now, but is there any other solution?\n\n### Additional information\n\n```js\nexport default async function Home({\r\n  searchParams,\r\n}: {\r\n  searchParams: { status: 'active' | 'deleted' | undefined }\r\n}) {\r\n  const status = searchParams.status\r\n\r\n  let posts: FetchedPostListItem[] = []\r\n\r\n  if (status === 'deleted') {\r\n    posts = await getDeletedPosts()\r\n  } else {\r\n    posts = await getPosts()\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <Link href=\"/\">Home</Link>\r\n      <Link href=\"/?status=active\">Active</Link>\r\n      <Link href=\"/?status=deleted\">Deleted</Link>\r\n      <PostList posts={posts} />\r\n    </div>\r\n  )\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "App router with custom server?", "description": "Can we use the app router with a custom server, like we can [with pages](https://nextjs.org/docs/pages/building-your-application/configuring/custom-server)? I'm guessing not, seeing as I can't get it to work and I don't see any mention of it in the docs. Equally I don't see any reference to it not being possible. "}
{"sentences": "NextJS 14.2.3 with sanity is not building the application for production.", "description": "I am using sanity cli and sanity studio. Most of the pages have sanity fetch for page data along with generateMetaData. App is running smoothly in localhost but it's not building. Takes lots of time at `Generating static pages (0/18) [ ]` like 10-15 minutes. Then shows this `Error occurred prerendering page \"/signup\". Read more: https://nextjs.org/docs/messages/prerender-error` for each page. Here is my package json:\r\n```\r\n{\r\n  \"name\": \"SanityApplication\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@apollo/client\": \"^3.10.2\",\r\n    \"@portabletext/react\": \"^3.0.18\",\r\n    \"@reduxjs/toolkit\": \"^2.2.3\",\r\n    \"@sanity/code-input\": \"^4.1.4\",\r\n    \"@sanity/color-input\": \"^3.1.1\",\r\n    \"@sanity/image-url\": \"^1.0.2\",\r\n    \"@sanity/preview-url-secret\": \"^1.6.12\",\r\n    \"@sanity/vision\": \"^3.40.0\",\r\n    \"antd\": \"^5.17.0\",\r\n    \"axios\": \"^1.6.8\",\r\n    \"dayjs\": \"^1.11.11\",\r\n    \"eslint\": \"^8.56.0\",\r\n    \"eslint-config-next\": \"^14.1.0\",\r\n    \"graphql\": \"^16.8.1\",\r\n    \"graphql-tag\": \"^2.12.6\",\r\n    \"html-react-parser\": \"^5.1.10\",\r\n    \"html-truncate\": \"^1.2.2\",\r\n    \"i18next\": \"^23.11.3\",\r\n    \"i18next-browser-languagedetector\": \"^7.2.1\",\r\n    \"i18next-resources-to-backend\": \"^1.2.1\",\r\n    \"js-cookie\": \"^3.0.5\",\r\n    \"jwt-decode\": \"^4.0.0\",\r\n    \"lodash\": \"^4.17.21\",\r\n    \"next\": \"14.2.3\",\r\n    \"next-sanity\": \"^9.0.14\",\r\n    \"nextjs-toploader\": \"^1.6.12\",\r\n    \"node-sass\": \"^9.0.0\",\r\n    \"posthog-js\": \"^1.130.2\",\r\n    \"posthog-node\": \"^4.0.1\",\r\n    \"react\": \"^18\",\r\n    \"react-cookie\": \"^7.1.4\",\r\n    \"react-dom\": \"^18\",\r\n    \"react-feather\": \"^2.0.10\",\r\n    \"react-google-autocomplete\": \"^2.7.3\",\r\n    \"react-i18next\": \"^14.1.1\",\r\n    \"react-phone-input-2\": \"^2.15.1\",\r\n    \"react-redux\": \"^9.1.2\",\r\n    \"react-text-transition\": \"^3.1.0\",\r\n    \"react-toastify\": \"^10.0.5\",\r\n    \"sanity\": \"^3.40.0\",\r\n    \"sanity-plugin-mux-input\": \"^2.3.4\",\r\n    \"styled-components\": \"^6.1.9\",\r\n    \"uid\": \"^2.0.2\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"autoprefixer\": \"^10.4.19\",\r\n    \"eslint-config-airbnb\": \"^19.0.4\",\r\n    \"eslint-config-prettier\": \"^9.1.0\",\r\n    \"eslint-import-resolver-alias\": \"^1.1.2\",\r\n    \"eslint-plugin-import\": \"^2.29.1\",\r\n    \"eslint-plugin-jsx-a11y\": \"^6.8.0\",\r\n    \"eslint-plugin-prettier\": \"^5.1.3\",\r\n    \"eslint-plugin-react\": \"^7.34.1\",\r\n    \"eslint-plugin-react-hooks\": \"^4.6.2\",\r\n    \"postcss\": \"^8.4.38\",\r\n    \"prettier\": \"^3.2.5\",\r\n    \"sass\": \"^1.77.0\",\r\n    \"tailwindcss\": \"^3.4.3\"\r\n  }\r\n}\r\n```\r\n\r\nGenerate meta data:\r\n```\r\nexport const generateMetadata = async () => {\r\n  const homePage = await client.fetch(`*[_type == \"page\" && slug.current == \"home\"][0]`);\r\n  const domainUrl = getPreparedDomainUrl();\r\n\r\n  return {\r\n    title: homePage?.title,\r\n    description: homePage?.description,\r\n    icons: {\r\n      icon: [\r\n        {\r\n          url: '/assets/favicon.ico'\r\n        }\r\n      ]\r\n    },\r\n    alternates: {\r\n      canonical: domainUrl\r\n    }\r\n  };\r\n};\r\n```\r\n\r\nSanity client:\r\n```\r\nconst client = createClient({\r\n  apiVersion,\r\n  dataset,\r\n  projectId,\r\n  token,\r\n  useCdn\r\n})\r\n```"}
{"sentences": "loading/error.tsx ignored for parallel routes", "description": "### Summary\r\n\r\nFrom your docs:\r\n\r\n> Parallel Routing allows you to define independent error and loading states for each route as they're being streamed in independently.\r\n\r\nI have a parallel route setup (`/app/@feature`), and the loading state is not shown. During development or for a built project.\r\n\r\nThe loading.tsx file from the parent page is shown instead if it exists, but never the loading.tsx of the parallel route.\r\n\r\nSounds to me like the docs promise more than there really is :)\r\n\r\nAre there limitations I am not aware of or is that simply not implemented?\r\n\r\n**Edit:**\r\n\r\nSame goes for `error.tsx` files :)"}
{"sentences": "How the hell do I enable Server Actions in my project", "description": "### Summary\r\n\r\nI get the error below telling me to _\"please enable the feature flag in your Next.js config\"_ but I've been googling for an hour now and I have no idea how to do this, any help? \r\n\r\n![image](https://github.com/vercel/next.js/assets/86959368/c14ac93e-2e63-4085-b4e5-6ed0e8940650)\r\n\r\nIt would be very helpful if the docs at https://nextjs.org/docs/app/api-reference/functions/server-actions say something about this\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Nextjs project is very slow to save file in VS Code", "description": "I am building the project with nextjs and antd, in VS Code it is very slow every time I save the file.\r\n\r\nI don't know why this is happening, does anyone know how to fix this?\r\n\r\n<img width=\"1477\" alt=\"image\" src=\"https://user-images.githubusercontent.com/53572196/178110843-676b4dbe-6413-4991-a065-1a4a32d63c3f.png\">\r\n"}
{"sentences": "[dynamic]/[route].js getServerSideProps favicon.ico in params", "description": "Hey again 😅!!\r\n\r\nI have this route inside `pages` it is `[customPage]/index.js` on index.js I'm doing the next:\r\n\r\n```\r\nexport async function getServerSideProps({req, res, params}) {\r\n  console.log(params); // here I'm getting {customPage: 'favicon.ico'}  😕\r\n  const programs_data = await getAllRelatedPages(params.customPage);\r\n  const location = req.headers.host;\r\n  // console.log(`${location}/programas/${programs_data[0].slug}`);\r\n  if(res) {\r\n    res.writeHead(301, {\r\n      Location: `http://${location}/${params.customPage}/${programs_data[0].slug}`\r\n    });\r\n    res.end();\r\n  }\r\n\r\n  return {};\r\n};\r\n```\r\n(It is just a simple redirect to an known page)\r\n\r\nAs you can see in the comment, params.customPage is not what's being passed on the URL(ex: localhost:3000/example).\r\n\r\nthis is my folder structure: \r\n```\r\npages/\r\n-- [customPage]/\r\n---- [slug].js\r\n---- index.js\r\n```"}
{"sentences": "Prevent `generateMetadata()` from destroying TTFB metric", "description": "We use `async generateMetadata()` in our project on some critical frequently visited pages.\r\nSpeed of `fetch()` request used inside `generateMetadata` is slow. It cannot be faster.\r\nCache would help in this situation, but it does not work. This destroys our TTFB metric and initial page load time.\r\nWe use Vercel for production.\r\nBoth `revalidate` property for `fetch()` and `revalidate` property exported from `page.tsx` does not help. \r\nAlso, our api provides `Cache-Control` response header, but NextJS does not save that cache locally for future requests.\r\n\r\nAny suggestion on how to cache the result of `generateMetadata` for a 3 hours?\r\n\r\n\r\nExample of our use case:\r\n```typescript\r\nexport const staticHttpGet = async <D extends HTTPGetInterface>(\r\n\turl: D['url'],\r\n\tparams: D['params'],\r\n\tnext: NextFetchRequestConfig | undefined = undefined\r\n): Promise<D['result']> => {\r\n\tlet path = `https://some_url.com${url}`\r\n\tif (params !== undefined) {\r\n\t\tpath += '?' + toHTTPQueryString(params)\r\n\t}\r\n\treturn fetch(path, {\r\n\t\tmethod: 'GET',\r\n\t\theaders: {\r\n\t\t\tAccept: 'application/json',\r\n\t\t},\r\n\t\tnext,\r\n\t})\r\n\t\t.then(resp => resp.json())\r\n\t\t.then(handleJson)\r\n}\r\n\r\nconst queryFilters = async (params: GetAvailableFilters['params']) => {\r\n\treturn await staticHttpGet<GetAvailableFilters>(\r\n\t\t'/api/available-product-filters',\r\n\t\tparams,\r\n\t\t{\r\n\t\t\trevalidate: 600,\r\n\t\t}\r\n\t)\r\n}\r\nconst queryProducts = async (\r\n\tproductParams: SearchProductFrontEnd['params']\r\n) => {\r\n\treturn await staticHttpGet<SearchProductFrontEnd>(\r\n\t\t'/api/products',\r\n\t\tproductParams,\r\n\t\t{\r\n\t\t\trevalidate: 600,\r\n\t\t}\r\n\t)\r\n}\r\nexport const generateMetadata = async ({\r\n\tparams,\r\n}: {\r\n\tparams: Params\r\n}): Promise<Metadata> => {\r\n\tconst [filters, products] = await Promise.all([\r\n\t\tqueryFilters(getAvailableFilterParams(params)),\r\n\t\tqueryProducts({\r\n\t\t\t...getDefaultParams(params),\r\n\t\t\ttakeCount: 1,\r\n\t\t\tpage: 1,\r\n\t\t}),\r\n\t])\r\n\r\n\treturn {\r\n                title:'....'\r\n\t\t//some stuff based on 'filters' and 'products' variable\r\n\t}\r\n}\r\n```\r\n"}
{"sentences": "Build very slow: 30+ minutes with Vercel and 10+ minutes with Laptop", "description": "When I ran yarn build at my machine and it stopped after I finished collecting page data. When build on Vercel, deployment finished after `38m 37s`. Does anyone know the reason? \r\nI've searched but there doesn't seem to be an answer on this.\r\n\r\nBuild on Mac\r\n<img width=\"500\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/105255382/89314327-793f-4f77-b1e0-1ed57898bcec\">\r\n\r\n\r\nBuild on Vercel\r\n```shell\r\n15:24:36.605 | Running build in Washington, D.C., USA (East) – iad1\r\n15:24:36.734 | Cloning github.com/archisketch-thangly/tripin_cms (Branch: main, Commit: 1be0eac)\r\n15:24:37.349 | Cloning completed: 610.313ms\r\n15:24:45.908 | Restored build cache\r\n15:24:46.007 | Running \"vercel build\"\r\n15:24:46.843 | Vercel CLI 34.1.7\r\n15:24:47.252 | Installing dependencies...\r\n15:24:47.541 | yarn install v1.22.19\r\n15:24:47.596 | warning package-lock.json found. Your project contains lock files generated by tools other than Yarn. It is advised not to mix package managers in order to avoid resolution inconsistencies caused by unsynchronized lock files. To clear this warning, remove package-lock.json.\r\n15:24:47.599 | [1/4] Resolving packages...\r\n15:24:47.922 | [2/4] Fetching packages...\r\n15:24:47.927 | warning Pattern [\"strip-ansi@^6.0.1\"] is trying to unpack in the same destination \"/vercel/.cache/yarn/v6/npm-strip-ansi-cjs-6.0.1-integrity/node_modules/strip-ansi-cjs\" as pattern [\"strip-ansi-cjs@npm:strip-ansi@^6.0.1\"]. This could result in non-deterministic behavior, skipping.\r\n15:24:47.928 | warning Pattern [\"string-width@^4.1.0\"] is trying to unpack in the same destination \"/vercel/.cache/yarn/v6/npm-string-width-cjs-4.2.3-integrity/node_modules/string-width-cjs\" as pattern [\"string-width-cjs@npm:string-width@^4.2.0\"]. This could result in non-deterministic behavior, skipping.\r\n15:24:47.928 | warning Pattern [\"strip-ansi@^6.0.0\"] is trying to unpack in the same destination \"/vercel/.cache/yarn/v6/npm-strip-ansi-cjs-6.0.1-integrity/node_modules/strip-ansi-cjs\" as pattern [\"strip-ansi-cjs@npm:strip-ansi@^6.0.1\"]. This could result in non-deterministic behavior, skipping.\r\n15:25:15.433 | [3/4] Linking dependencies...\r\n15:25:15.434 | warning \" > @ant-design/nextjs-registry@1.0.0\" has unmet peer dependency \"@ant-design/cssinjs@^1.18.2\".\r\n15:25:23.151 | [4/4] Building fresh packages...\r\n15:25:23.351 | Done in 35.81s.\r\n15:25:23.377 | Detected Next.js version: 14.1.4\r\n15:25:23.383 | Running \"yarn run build\"\r\n15:25:23.566 | yarn run v1.22.19\r\n15:25:23.591 | $ next build\r\n15:25:24.292 | ▲ Next.js 14.1.4\r\n15:25:24.293 | - Environments: .env.production\r\n15:25:24.293 |  \r\n15:25:24.366 | Creating an optimized production build ...\r\n15:26:22.447 | ✓ Compiled successfully\r\n15:26:22.448 | Linting and checking validity of types ...\r\n15:26:36.907 | Collecting page data ...\r\n15:44:10.598 | Generating static pages (0/22) ...\r\n15:44:11.351 | Generating static pages (5/22)\r\n15:44:14.106 | Generating static pages (10/22)\r\n15:44:17.368 | Generating static pages (16/22)\r\n15:44:19.836 | ✓ Generating static pages (22/22)\r\n15:44:20.068 | Finalizing page optimization ...\r\n15:44:20.069 | Collecting build traces ...\r\n15:44:21.415 |  \r\n15:44:21.423 | Route (app)                                         Size     First Load JS\r\n15:44:21.423 | ┌ ○ /                                               143 B          84.7 kB\r\n15:44:21.424 | ├ ○ /_not-found                                     0 B                0 B\r\n15:44:21.424 | ├ ○ /admins                                         1.05 kB         339 kB\r\n15:44:21.424 | ├ λ /admins/[adminID]/edit                          681 B           285 kB\r\n15:44:21.424 | ├ ○ /admins/add                                     229 B           278 kB\r\n15:44:21.424 | ├ λ /api/login                                      0 B                0 B\r\n15:44:21.425 | ├ λ /api/logout                                     0 B                0 B\r\n15:44:21.425 | ├ λ /change-password                                137 kB          405 kB\r\n15:44:21.425 | ├ ○ /cuisines                                       2.71 kB         362 kB\r\n15:44:21.425 | ├ λ /cuisines/[cuisineID]/edit                      8.37 kB         789 kB\r\n15:44:21.425 | ├ ○ /cuisines/add                                   7.99 kB         783 kB\r\n15:44:21.425 | ├ ○ /food-tour                                      2.97 kB         362 kB\r\n15:44:21.426 | ├ λ /food-tour/[tourID]/edit                        8.27 kB         787 kB\r\n15:44:21.426 | ├ λ /food-tour/[tourID]/items                       5.78 kB         307 kB\r\n15:44:21.426 | ├ ○ /food-tour/add                                  7.76 kB         780 kB\r\n15:44:21.426 | ├ ○ /login                                          3.55 kB         199 kB\r\n15:44:21.426 | ├ ○ /places                                         2.57 kB         362 kB\r\n15:44:21.426 | ├ λ /places/[placeID]/edit                          1.03 kB         824 kB\r\n15:44:21.426 | ├ λ /places/[placeID]/props                         1.59 kB         349 kB\r\n15:44:21.426 | ├ λ /places/[placeID]/props/[propID]/edit           491 B           799 kB\r\n15:44:21.426 | ├ λ /places/[placeID]/props/add                     436 B           796 kB\r\n15:44:21.426 | ├ ○ /places/add                                     252 B           817 kB\r\n15:44:21.431 | ├ ○ /restaurants                                    3.09 kB         362 kB\r\n15:44:21.431 | ├ λ /restaurants/[restaurantID]/edit                5 kB            778 kB\r\n15:44:21.431 | ├ λ /restaurants/[restaurantID]/menu                1.65 kB         349 kB\r\n15:44:21.431 | ├ λ /restaurants/[restaurantID]/menu/[menuID]/edit  491 B           815 kB\r\n15:44:21.431 | ├ λ /restaurants/[restaurantID]/menu/add            251 B           813 kB\r\n15:44:21.431 | ├ ○ /restaurants/add                                4.41 kB         771 kB\r\n15:44:21.431 | ├ ○ /shop-ar                                        2.23 kB         361 kB\r\n15:44:21.432 | ├ λ /shop-ar/[shop_ar_id]/edit                      5.88 kB         795 kB\r\n15:44:21.432 | ├ ○ /shop-ar/add                                    5.51 kB         788 kB\r\n15:44:21.432 | ├ ○ /users                                          1.15 kB         340 kB\r\n15:44:21.432 | └ λ /users/[userID]                                 4.47 kB         262 kB\r\n15:44:21.432 | + First Load JS shared by all                       84.5 kB\r\n15:44:21.432 | ├ chunks/8069-1bea0de195b2c3b8.js                   29.2 kB\r\n15:44:21.432 | ├ chunks/fd9d1056-ee1d3d36ea0d6c8c.js               53.4 kB\r\n15:44:21.432 | └ other shared chunks (total)                       1.97 kB\r\n15:44:21.433 |  \r\n15:44:21.433 |  \r\n15:44:21.433 | ƒ Middleware                                        19.6 kB\r\n15:44:21.433 |  \r\n15:44:21.433 | ○  (Static)   prerendered as static content\r\n15:44:21.433 | λ  (Dynamic)  server-rendered on demand using Node.js\r\n15:44:21.433 |  \r\n15:44:21.469 | Done in 1137.91s.\r\n15:44:21.595 | Traced Next.js server files in: 29.851ms\r\n\r\n\r\n``` "}
{"sentences": "Error [NextFontError]: Failed to fetch `Inter` from Google Fonts.", "description": "# Error [NextFontError]: Failed to fetch `Inter` from Google Fonts.\r\n\r\n\r\n> why not use locally google fonts?\r\n\r\n![image](https://user-images.githubusercontent.com/7291672/219448724-0962c582-3b92-43a6-80d3-0d6d79caedf0.png)\r\n\r\n```sh\r\n$ yarn dev\r\nyarn run v1.22.19\r\n$ next dev\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\nevent - compiled client and server successfully in 1856 ms (165 modules)\r\nwait  - compiling / (client and server)...\r\nError [NextFontError]: Failed to fetch `Inter` from Google Fonts.\r\n    at nextFontError (/Users/xgqfrms-mm/Documents/github/ChatGPT/chat-gpt/node_modules/@next/font/dist/utils.js:55:17)\r\n    at downloadGoogleFonts (/Users/xgqfrms-mm/Documents/github/ChatGPT/chat-gpt/node_modules/@next/font/dist/google/loader.js:87:39)\r\n    at /Users/xgqfrms-mm/Documents/github/ChatGPT/chat-gpt/node_modules/next/dist/build/webpack/loaders/next-font-loader/index.js:52:99\r\n    at async Span.traceAsyncFn (/Users/xgqfrms-mm/Documents/github/ChatGPT/chat-gpt/node_modules/next/dist/trace/trace.js:79:20)\r\nerror - Failed to download `Inter` from Google Fonts. Using fallback font instead.\r\nevent - compiled client and server successfully in 75.4s (194 modules)\r\nwait  - compiling...\r\nwait  - compiling / (client and server)...\r\nevent - compiled client and server successfully in 75.2s (183 modules)\r\n\r\n\r\n```"}
{"sentences": "favicon not showing on macos safari", "description": "### Summary\n\ni'm following this tutorial: https://youtu.be/cuzw4vL1z5E?t=1179\r\nat the linked time he copies the favicon.ico to app/ directory and it shows the picture in browser tab.\r\non mac, it doesn't work. i googled and found out i need to add apple-icon.png and icon.png, so i did: https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons\r\ni have deleted .next folder and rebuild the app, but it still doesn't show the icon in tab, how can i fix it?\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/stardvst/travel-app"}
{"sentences": "SyntaxError: \"undefined\" is not valid JSON", "description": "### Summary\r\n\r\ni currently create a new nextjs application;\r\n\r\nhere is counter component\r\n```\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\n\r\nexport default function Counter() {\r\n  const [count, setCount] = useState(0);\r\n\r\n  return (\r\n    <div>\r\n      <p>You clicked {count} times</p>\r\n      <button onClick={() => setCount(count + 1)}>Click me</button>\r\n    </div>\r\n  );\r\n}\r\n```\r\nhere is the root page\r\n\r\n```\r\n\"use client\";\r\nimport Image from \"next/image\";\r\nimport { Inter } from \"next/font/google\";\r\nimport Counter from \"../components/Counter\";\r\n\r\nconst inter = Inter({ subsets: [\"latin\"] });\r\n\r\nexport default function Home() {\r\n  return (\r\n    <main className=\"p-3\">\r\n      <Counter/>\r\n    </main>\r\n  );\r\n}\r\n```\r\n\r\ni think problem is that using 'use client'; because if i remove hooks and the 'use client' flag in header component the error will go away.\r\nany body know why is tha? \r\nthanks \r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How to get the project sub-directory path?", "description": "### Summary\n\nIn my Next.js project, I am using Fluent (https://projectfluent.org) for internationalization. Fluent uses `.ftl` files for locales.\r\n\r\nMy project's abstract structure:\r\n```\r\nmy-app/\r\n├─ src/\r\n│  ├─ app/\r\n│  ├─ locales/\r\n│  │  ├─ uk.ftl\r\n│  │  ├─ fr.ftl\r\n│  ├─ file.ts\r\n```\r\n\r\nHow can I get the path to the `locales` directory, from the server-side `file.ts` file?\r\n\r\nI tried to use `process.cwd() + '/src/locales'`, and got the error `[Error]: ENOENT: no such file or directory, scandir '/var/task/src/locales'`. — It didn't work for me..\n\n### Additional information\n\n```js\nIt's important to note that the project is deployed on the Vercel platform.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Error during Deployment", "description": "### Summary\n\nI'm new here, so not sure with proper formatting.\r\n\r\nMy next.js app runs perfectly on local host but during deployment I'm getting the following error. \r\n\r\nI'm not sure how to debug it and also, couldn't link a debugger to it.\r\n\r\nAny help or suggestion would be really useful to me. TIA.\n\n### Additional information\n\n```js\n> Build error occurred\r\nTypeError: Expected a non-empty string\r\n    at picomatch.makeRe (/vercel/path0/node_modules/next/dist/compiled/micromatch/index.js:15:21418)\r\n    at micromatch.makeRe (/vercel/path0/node_modules/next/dist/compiled/micromatch/index.js:15:2615)\r\n    at /vercel/path0/node_modules/next/dist/build/index.js:1720:48\r\n    at Array.map (<anonymous>)\r\n    at /vercel/path0/node_modules/next/dist/build/index.js:1715:135\r\n    at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:79:20)\r\n    at async Object.build [as default] (/vercel/path0/node_modules/next/dist/build/index.js:73:29)\r\nError: Command \"npm run build\" exited with 1\r\nBUILD_UTILS_SPAWN_1: Command \"npm run build\" exited with 1\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Prop did not match. Client: X, Server: Y", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nWhen I use JS to detect screen width, and then render content based on that screen width, the initial render differs on the server vs. client.\r\n\r\nThe result is an error saying **prop `style` did not match. Server: X, Client: Y.**\r\n\r\n**When this happens, my app loads up with the style value from the server, and doesn't refresh using the client side's styles.**\r\n\r\n## To Reproduce\r\n\r\nMinimal reproducible example: https://github.com/nandorojo/next-style-issue\r\n\r\n1. Create a new next project (`npx create-next-app -e with-expo`)\r\n2. Add a dependency `yarn add @react-native-community/hooks`\r\n3. Paste this in `pages/index.tsx`:\r\n\r\n```jsx\r\n// import { useDimensions } from \"@react-native-community/hooks\";\r\n\r\nexport default function App() {\r\n  let breakpoint = 0\r\n\r\n  // 👇 This generates a fake device width.\r\n  const width = Math.round(Math.random() * 1000)\r\n\r\n  // in my real app, I use a dependency:\r\n  // const { width = 0 } = useDimensions().window;\r\n\r\n  if (width > 500) breakpoint = 1\r\n  if (width > 900) breakpoint = 2\r\n\r\n  /*\r\n   * on server: { breakpoint: 0 }\r\n   * on client: { breakpoint: 0, 1, 2 } (unknown until it loads)\r\n   */\r\n  console.log('[pages/index.tsx]', { breakpoint })\r\n\r\n  /* 🚨 Prop `style` did not match.\r\n   * Server: \"background-color:green;min-height:100px\"\r\n   * Client: \"background-color:blue;min-height:200px\r\n   */\r\n  return (\r\n    <div\r\n      style={{\r\n        backgroundColor: ['green', 'blue', 'orange'][breakpoint],\r\n        minHeight: ['100px', '200px', '300px'][breakpoint]\r\n      }}\r\n    >\r\n      {breakpoint}  {/* <- this prints the correct breakpoint... */}\r\n     </div>\r\n  )\r\n}\r\n```\r\n\r\n## Expected behavior\r\n\r\nMy style is generated based on the screen width. Since the style on the client is different from the style generated on the server, I expect the style to rehydrate when the page loads. \r\n\r\nHowever, the style **only** updates when I resize the window + update component state. If I don't resize and update the component state, it stays the same.\r\n\r\n## Screenshots\r\n\r\n<img width=\"1791\" alt=\"Screen Shot 2020-06-22 at 4 46 26 PM\" src=\"https://user-images.githubusercontent.com/13172299/85333662-f91a2600-b4a7-11ea-924e-fb73ba23e64e.png\">\r\n\r\n\r\n## System information\r\n\r\n- OS: macOS\r\n- Browser: Chome, Safari\r\n- Version of Next.js: 9.4.4\r\n- Version of Node.js: 14.2\r\n\r\n## Additional context\r\n\r\nAdd any other context about the problem here.\r\n"}
{"sentences": "How to exclude routes from build?", "description": "### Summary\n\nHere I've described an idea to build multiple apps out of one, for this I simple import service routes from the main app and build a separate service to serve those routes.\r\nhttps://github.com/vercel/next.js/discussions/65303\r\n\r\nNow, I basically need to exclude those routes from the build, or maybe even better to rewrite them, but as I understand those are proxied on the client? Don't get it really=)\r\n\r\nBest solution would be to just exlude them from the build completely, and instead I would probably build router to map those routes to another service based on path somewhere in the infrastructure routing.\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "What is the future for Pages Router?", "description": "Is there an official statement regarding the future of the Pages Router?\r\n\r\nThe docs says this:\r\n> The Pages Router is the original Next.js router, which allowed you to build server-rendered React applications and **continues to be supported for older Next.js applications**. \r\n\r\nThis, to me, hints at a future deprecation notice. But is there an official statement or plan to deprecate it soon, and if so, is there a timeline?\r\n\r\nIt feels like developers are left in sort of a limbo right now: the App Router is not supported by many third party packages and the Pages Router may be deprecated soon. It would be great to get some clarification about the plans for Routing in Next.js in the coming years, so we can prioritize properly."}
{"sentences": "StyleX styles not being applied on first Vercel deployment", "description": "### Summary\n\nHello!\r\n\r\nI am experiencing an interesting issue where on initial production deploy the CSS files for StyleX are not being built properly. Though on re-deploy, they are built properly and the styles are applied. Any insight would be appreciated!\r\n\r\nSome notes\r\n- Able to reproduce this on every deploy\r\n- Takes place for manually triggered deploys as well as automatic deploys\r\n- CSS file output when CSS is not applied correctly\r\n   - `/_next/static/css/290aab9f1ae88124.css 480 B` \r\n   - `/_next/static/css/ba44253b25b56036.css 2.57 kB`\r\n- CSS file output when CSS is applied correctly (on re-deploy)\r\n   - `/_next/static/css/ba44253b25b56036.css 2.57 kB`\r\n   - `/_next/static/css/e0ccbf7f3f4fd65e.css 2.25 kB`\r\n\r\nnext.config.js\r\n```\r\nconst path = require('path');\r\nconst stylexPlugin = require('@stylexjs/nextjs-plugin');\r\n\r\nmodule.exports = stylexPlugin({\r\n  aliases: {\r\n    '@/*': [path.join(__dirname, '*')],\r\n  },\r\n  rootDir: __dirname,\r\n})({});\r\n```\r\n\r\nbabel.config.js\r\n```\r\nconst styleXPlugin = require('@stylexjs/babel-plugin')\r\n\r\nmodule.exports = {\r\n  plugins: [\r\n    [\r\n      styleXPlugin,\r\n      {\r\n        dev: true,\r\n        // Set this to true for snapshot testing\r\n        // default: false\r\n        test: false,\r\n        // Required for CSS variable support\r\n        unstable_moduleResolution: {\r\n          // type: 'commonJS' | 'haste'\r\n          // default: 'commonJS'\r\n          type: 'commonJS',\r\n          // The absolute path to the root directory of your project\r\n          rootDir: __dirname,\r\n        },\r\n      },\r\n    ],\r\n  ],\r\n};\r\n```\r\n\r\n.babelrc.js\r\n```\r\nconst path = require('path');\r\nmodule.exports = {\r\n  presets: ['next/babel'],\r\n  plugins: [\r\n    [\r\n      '@stylexjs/babel-plugin',\r\n      // See all options in the babel plugin configuration docs:\r\n      // https://stylexjs.com/docs/api/configuration/babel-plugin/\r\n      {\r\n        dev: process.env.NODE_ENV === 'development',\r\n        genConditionalClasses: true,\r\n        treeshakeCompensation: true,\r\n        aliases: {\r\n          '@/*': [path.join(__dirname, '*')],\r\n        },\r\n        unstable_moduleResolution: {\r\n          type: 'commonJS',\r\n          rootDir: path.join(__dirname, '../..'),\r\n        },\r\n      },\r\n    ],\r\n  ],\r\n};\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "ECONNREFUSED: Error occurred prerendering page [app router]", "description": "I have a backend in rust running in a different port, and I use nextjs to fetch data from it.\r\n\r\nI have 2 files `client.ts` and `recipes/pages.tsx`, the following are simplified samples:\r\n\r\n```ts\r\n// client.ts\r\nimport 'server-only'\r\n\r\nexport async function getRecipes(): Promise<Recipe[]> {\r\n  const res = await fetch(`${process.env.API_URL}/api/v1/recipes`, {\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  return await res.json();\r\n}\r\n```\r\n\r\n```tsx\r\nimport { getRecipes } from \"@/lib/client\";\r\n\r\n// recipes/pages.tsx\r\nexport default async function ListRecipes() {\r\n  const recipes = await getRecipes();\r\n  \r\n  return (\r\n    <div className=\"sm:mt-8 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 \">\r\n      {recipes.map((recipe) => (\r\n        <SmallRecipe recipe={recipe} key={recipe.recipe_id} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\nWhen running `npm run build` I get the following error:\r\n```\r\n> next build\r\n\r\n   ▲ Next.js 14.0.2\r\n   - Environments: .env\r\n\r\n ✓ Creating an optimized production build    \r\n ✓ Compiled successfully\r\n ✓ Linting and checking validity of types    \r\n ✓ Collecting page data    \r\n   Generating static pages (1/12)  [=   ] \r\nTypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:11372:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {\r\n  cause: Error: connect ECONNREFUSED 0.0.0.0:8081\r\n      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1595:16)\r\n      at TCPConnectWrap.callbackTrampoline (node:internal/async_hooks:130:17) {\r\n    errno: -61,\r\n    code: 'ECONNREFUSED',\r\n    syscall: 'connect',\r\n    address: '0.0.0.0',\r\n    port: 8081\r\n  }\r\n}\r\nError occurred prerendering page \"/recipes\". Read more: https://nextjs.org/docs/messages/prerender-error\r\nTypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:11372:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n```\r\n\r\nI don't understand why it needs the rust backend to build.\r\n\r\n\r\nThanks!"}
{"sentences": "Conditional rendering for permission check", "description": "Hello,\r\n\r\nwhat would be the recommended way to solve the problem, where a subset of users are not allowed to see specific parts of the page but still are allowed to access the page.\r\n\r\nHave found this in the docs: \r\n\r\n[A common pattern in SPAs is to return null in a layout or a top-level component if a user is not authorized. This pattern is not not recommended since Next.js applications have multiple entry points, which will not prevent nested route segments and Server Actions from being accessed.](https://nextjs.org/docs/app/building-your-application/authentication#layouts-and-auth-checks)\r\n\r\nI have a Parent RSC \"PermissionCheck\" not in a layout component but in a page.tsx (i.e. one of its children) for checking, if the user has permission to see the children-component passed into \"PermissionCheck\" or otherwise null gets returned by the PermissionCheck-component.\r\n\r\n```typescript jsx\r\nexport const PermissionCheck = (props) => {\r\n   const hasPermission = ...\r\n   if(!hasPermission) {\r\n      return null\r\n   }\r\n   return props.children;\r\n}\r\n```\r\n\r\n```typescript jsx\r\n// In an RSC somewhere in a page.tsx or one of its children:\r\nconst Page = () => {\r\n  return (\r\n    <div>\r\n      <div>Stuff that all users are allowed to see...</div>\r\n      <PermissionCheck>\r\n        <div>Stuff that only certain users are allowed to see...</div>\r\n      </PermissionCheck>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Page;\r\n```\r\n\r\nIs this a secure way to prevent users to see sensitive components in the new App Router? Or what would be the recommended way? \r\n\r\nIn general, if there is such a PermissionCheck-Component somewhere in the React RSC component tree, would that prevent the user from seeing all components below the PermissionCheck-Component, if the user is missing permission? \r\n\r\nThank you.\r\n"}
{"sentences": "SWR and getserversideprops", "description": "\r\n\r\nGoal: SSR page that also works as a SPA page that responds to a next/link. Is it good practice to use SWR with getsserversideprops (as it was with getinitialprops) or how?"}
{"sentences": "`router.query` returns undefined parameter on first render in Next.js", "description": "When I have the following code and visit `/pages/profile/foo`, the page gets rendered twice and the first time `router.query.user` is `undefined`.\r\n\r\nIn file `/pages/profile/[user].js`\r\n\r\n```jsx\r\nimport { useRouter } from \"next/router\"\r\n\r\nexport default () => {\r\n  const router = useRouter()\r\n  const { user } = router.query\r\n  console.log(user)\r\n\r\n  return <p>User is {user}</p>\r\n}\r\n```\r\n\r\nI will get 2 console logs - first is `undefined`, then the correct `foo`.\r\n\r\nCan anyone explain to me why is this happening?"}
{"sentences": "return notFound() doesn't work in parallel routing", "description": "I'm using next.js 14 with app router. This is my dynamic/paralel routing folder structure.\r\n\r\n\r\n    │   └───admin\r\n    │       ├───form\r\n    │       │   ├───@form\r\n    │       │   │   ├───create\r\n    │       │   │   ├───[id]\r\n    │       │   │   │   └───update\r\n    │       │   │   └───_components\r\n    │       │   ├───@table\r\n    │       │   │   ├───_components\r\n    │       │   │   └───_data\r\n    │       │   ├───create\r\n    │       │   └───[id]\r\n    │       │       └───update\r\n    │       ├───user\r\n    \r\n  This is my /form/[id]/update/page.tsx\r\n    \r\n ```\r\n  import { Locale } from \"@/i18n-config\";\r\n   import { getFormById } from \"@/lib/form\";\r\n   import { getDictionary } from \"@/lib/get-dictionary\";\r\n   import { notFound } from \"next/navigation\";\r\n   import AdminHeader from \"../../../_components/admin-header\";\r\n\r\n   export default async function DiscoveryFormsPageCreate({\r\n     params,\r\n   }: {\r\n     params: { lang: Locale; id: string };\r\n   }) {\r\n     const dict = (await getDictionary(params.lang)).admin.form.update;\r\n     const form = await getFormById(params.id);\r\n\r\n     if (!form) {\r\n       return notFound();\r\n     }\r\n\r\n     return (\r\n       <AdminHeader headline={dict.headline} subheadline={dict.subheadline} />\r\n     );\r\n   }\r\n\r\n```\r\nIt all works as expected, but when i input an id that doesn't exist, it returns this error:\r\n\r\nUnhandled Runtime Error\r\nNotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.\r\n\r\nBut I think it has nothing to do with the /form/@form/[id]/update/page.tsx that has this code:\r\n\r\n```\r\nimport { Locale } from \"@/i18n-config\";\r\nimport { getFormById } from \"@/lib/form\";\r\nimport { getDictionary } from \"@/lib/get-dictionary\";\r\nimport { getAllUsers } from \"@/lib/user\";\r\nimport FormForm from \"../../_components/form\";\r\n\r\nexport default async function DiscoveryFormsPageCreate({\r\n  params,\r\n}: {\r\n  params: { lang: Locale; id: string };\r\n}) {\r\n  const dict = (await getDictionary(params.lang)).admin.form.update;\r\n  const form = await getFormById(params.id);\r\n  const users = (await getAllUsers()).map((item) => ({\r\n    id: item.id,\r\n    email: item.email,\r\n  }));\r\n\r\n  if (!form) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <main className=\"flex flex-col items-start gap-4 p-4 md:gap-8 lg:p-10\">\r\n      <FormForm\r\n        type=\"update\"\r\n        id={params.id}\r\n        formObject={form}\r\n        dict={dict}\r\n        users={users}\r\n      />\r\n    </main>\r\n  );\r\n}\r\n\r\n\r\n\r\n```"}
{"sentences": "With Vercel's free version, for Next.js, how do I know when I have exceeded the allowed traffic for this level?", "description": "### Summary\n\nMy app suddenly stopped working. The app is an NFT marketplace, for curated art NFTs. However, the NFT images, which were once visible in the app, are no longer shown. The error message is \"failed to load metadata\". I'm checking to find out if the issue is due to too much traffic for the free version. With Vercel's free version, for Next.js, how do I know when I have exceeded the allowed traffic for this level?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why is this onClick not doing anything?", "description": "### Summary\n\nThis was working fine...  I don't know what I did, but this button stopped working:\r\n\r\n```\r\n<button\r\n            onClick={() => {\r\n              if (typeof window.allConsentGranted !== \"undefined\") {\r\n                window.allConsentGranted();\r\n              } else {\r\n                console.log(\"allConsentGranted not found in global scope\");\r\n              }\r\n            }}\r\n          >\r\n            Accept All\r\n          </button>{\" \"}\r\n        </Col>\r\n```\r\n\r\n\r\nFull code is this:\r\n```\r\nimport React from \"react\";\r\nimport Script from \"next/script\";\r\nimport Container from \"react-bootstrap/Container\";\r\nimport Row from \"react-bootstrap/Row\";\r\nimport Col from \"react-bootstrap/Col\";\r\nimport { useEffect } from \"react\";\r\n\r\nconst GoogleTags = () => {\r\n  const handleNo = () => {\r\n    document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n    localStorage.setItem(\"theTags2\", \"tagsNotAccepted\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (\r\n      !localStorage.getItem(\"theTags1\") &&\r\n      !localStorage.getItem(\"theTags2\")\r\n    ) {\r\n      setTimeout(() => {\r\n        document.getElementById(\"main-cookies-id\").style.display = \"block\";\r\n      }, 2000);\r\n    } else if (localStorage.getItem(\"theTags1\") === \"tagsAccepted\") {\r\n      window.allConsentGranted();\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <Container md={8} xs={8} id=\"main-cookies-id\" className=\"main-cookies \">\r\n      <Row>\r\n        {\" \"}\r\n        <Script\r\n          id=\"google-tag1\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `      \r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('consent', 'default', {\r\n                'ad_storage': 'denied',\r\n                'ad_user_data': 'denied',\r\n                'ad_personalization': 'denied',\r\n                'analytics_storage': 'denied'\r\n              });`,\r\n          }}\r\n        />\r\n        <Script\r\n          id=\"google-tag3\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `\r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('js', new Date());\r\n              gtag('config', 'G-4RB3V861V1');\r\n            `,\r\n          }}\r\n        />\r\n        <Script\r\n          id=\"check-cookies\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `\r\n    (function() {\r\n      function allConsentGrantedCheck() {\r\n        if (localStorage.getItem(\"theTags1\") === \"tagsAccepted\") {\r\n          gtag('consent', 'update', {\r\n            'ad_user_data': 'granted',\r\n            'ad_personalization': 'granted',\r\n            'ad_storage': 'granted',\r\n            'analytics_storage': 'granted'\r\n          }); \r\n          document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n          console.log(\"tagsAccepted\");\r\n         \r\n        }\r\n        \r\n        if (localStorage.getItem(\"theTags2\") === \"tagsNotAccepted\") {\r\n          document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n         \r\n        }\r\n      }\r\n      \r\n      // Call the function immediately\r\n      allConsentGrantedCheck();\r\n    })();\r\n    `,\r\n          }}\r\n        />\r\n        <Script\r\n          id=\"google-tag4\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `\r\n            function allConsentGranted() {\r\n              gtag('consent', 'update', {\r\n                'ad_user_data': 'granted',\r\n                'ad_personalization': 'granted',\r\n                'ad_storage': 'granted',\r\n                'analytics_storage': 'granted'\r\n              });\r\n              document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n              localStorage.setItem(\"theTags1\", \"tagsAccepted\");\r\n            }`,\r\n          }}\r\n        />\r\n      </Row>\r\n\r\n      <Row>\r\n        <div>\r\n          <h4>Privacy Preferences</h4>\r\n          <p>\r\n            We use cookies and similar methods to recognize visitors and\r\n            remember their preferences.{\" \"}\r\n          </p>\r\n          <p>\r\n            We also use them to measure ad campaign effectiveness, target ads\r\n            and analyze site traffic.\r\n          </p>\r\n          <br />\r\n        </div>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n          <button\r\n            onClick={() => {\r\n              if (typeof window.allConsentGranted !== \"undefined\") {\r\n                window.allConsentGranted();\r\n              } else {\r\n                console.log(\"allConsentGranted not found in global scope\");\r\n              }\r\n            }}\r\n          >\r\n            Accept All\r\n          </button>{\" \"}\r\n        </Col>\r\n        <Col>\r\n          <button onClick={handleNo}>Decline All</button>{\" \"}\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default GoogleTags;\r\n\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Body Limit 1mb using Server Actions, Even though already set body parser", "description": "### Summary\n\nNext JS Version : 13.4.7\r\nExample page that having problem : [File in Github Link](https://github.com/smam-tech/Knowledge-Management-Systems/blob/main/frontend/src/app/settings/page.js)\r\n\r\n### Describe The Bug\r\n### --------------------------------------------\r\nSo i already read this discussion/Issue\r\n#19684 \r\n\r\nI didnt use any Next.JS API I think? I just used Server Actions to handle the communication through Other Apps API. I have alrady tried to put below code everywhere, in next js config, in the file (top,bottom, everywhere) and it keep saying 1mb file limit whenever i want to upload image more than 1mb. It works if the image is less than 1mb.\r\n`export const config = { api: { bodyParser: { sizeLimit: \"25mb\" } } };`\r\n![Screenshot (104)](https://github.com/vercel/next.js/assets/57549163/8ad695e6-cb6f-485e-8c1b-73940a0dc088)\r\n\r\n### How to Reproduce\r\n### --------------------------------------------\r\n1. npm install\r\n2. npm run dev\r\n3. go to localhost:3000/tes then input user administrator and password admin\r\n4. go to localhost:3000/settings then upload image, click upload then click update\r\n![image](https://github.com/vercel/next.js/assets/57549163/c9526d93-d724-471c-99f6-16d7eb178b02)\r\n5. Error will happen, Data wont be pushed\r\n\r\n### Systems Information\r\nServer :\r\nOS : Ubuntu Server 22.04\r\nBrowser : Mozilla & Chrome \r\nLocal : \r\nOS : Windows 11\r\nBrowser : Mozilla & Chrome\r\n\r\n\r\n\r\nP.S. : This is my thesis project with my friend, I am actually a backend guy so i didn't really know much about the HTML and stuff, so i will tag my frontend guy @hfpland\r\nIt would be really helpfull if anyone can tell me where exactly should i put the body parser api config. Thanks!\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/smam-tech/Knowledge-Management-Systems/blob/main/frontend/src/app/settings/page.js"}
{"sentences": "Allow /api routes to be private to the client app", "description": "In [docs](https://nextjs.org/docs/api-routes/introduction) we read : \r\n\r\n> API Routes do not specify CORS headers, meaning they are same-origin only by default. \r\n\r\nand yet if i create POST route for /api/post-route it will be available publicly, so for example i can use tool like https://reqbin.com/ to make a request to the website and next server will pass my request further. \r\n\r\nI saw [example](https://github.com/vercel/next.js/blob/canary/examples/api-routes-cors/pages/api/cors.js) of using CORS but it is not useful - does not work when applying `origin` option setting and the server still passes the request\r\n\r\n- is it possible to 'hide' or 'mask' an /api/route from public view ? and make internal request to server that would be **only** possible from client side app ? (only triggered by a user interacting with the website interface). In such case any other request made-not-from-the-app would land on 404 (even if it's a post request).\r\n\r\n - in order to use cors am i forced to use custom server? How could i make [mentioned example](https://github.com/vercel/next.js/blob/canary/examples/api-routes-cors/pages/api/cors.js) to work? I have tried below code.\r\n\r\n\r\nThanks for help.\r\n\r\n```\r\n// with cors \r\n\r\nimport Cors from 'cors';\r\n\r\nconst cors = initMiddleware(\r\n Cors({\r\n   origin: 'https://website.com',\r\n   methods: ['GET', 'POST', 'OPTIONS'],\r\n  })\r\n);\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n): Promise<any> {\r\n\r\n await cors(req, res);\r\n\r\n  switch (req.method) {\r\n    case 'POST':\r\n      return myapi.post(req, res); // <--- with different origin this still gets called.\r\n    default:\r\n      res.status(400).end('bad');\r\n  }\r\n}\r\n```\r\n\r\n```\r\n\r\nfunction initMiddleware(middleware) {\r\n  return (req, res) =>\r\n    new Promise((resolve, reject) => {\r\n      middleware(req, res, (result) => {\r\n        if (result instanceof Error) {\r\n          return reject(result);\r\n        }\r\n        return resolve(result);\r\n      });\r\n    });\r\n}\r\n```"}
{"sentences": "next/image flicker when switching pages", "description": "I've been a little lost trying to figure out this issue.\r\nhttps://next-lotus-starter.vercel.app/\r\n\r\nSmall starter boilerplate using Chakra UI I've made for myself. When I'm clicking between the Home page and Page 2, the logo on the top left flickers. \r\n\r\nI have a feeling it's something related to next/image and how it serves images dynamically but I'm not sure if there is any real way to solve this.\r\n\r\nAppreciate anyone who takes the time looking into this!"}
{"sentences": "Console.log's not working in Production on Vercel", "description": "I am trying to debug a backend function in my app that is working fine in my lab but doesn't seem to be working in production. In my Vercel Dashboard, I'm not getting any errors or console.log's in my Functions log. According to [this recent blog post](https://vercel.com/knowledge/where-are-vercel-logs), console.log's should show in the Functions log in the Vercel Dashboard. Am I missing some major import or dependency in production that would cause the function to fail spectacularly? I have Node installed globally on my local machine but I don't need to have Node as a dependency in my project for Vercel, do I? \r\n\r\nMy function is below. It fetches an image based on a URL and then tries to upload the image to a Google Cloud Storage bucket. As you can see, I have lots of logging, but none of them show in the Vercel Dashboard.\r\n```\r\nimport axios from 'axios';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { Storage } from '@google-cloud/storage';\r\n\r\nexport default async function handle(req, res) {\r\n  let { featuredImage } = req.body;\r\n\r\n  console.log(featuredImage);\r\n\r\n  // generate file name\r\n  const imageName = uuidv4();\r\n  console.log(imageName);\r\n\r\n  // download featured image\r\n  let downloaded;\r\n  try {\r\n    downloaded = await axios.get(featuredImage, {\r\n      responseType: 'stream'\r\n    });\r\n  } catch (error) {\r\n    console.log(`Error getting image url: ${error}`);\r\n    // return original featuredImage url if unable to fetch the image directly\r\n    res.json(featuredImage);\r\n    return;\r\n  }\r\n\r\n  // check headers for image type\r\n  const fileType = downloaded.headers['content-type'];\r\n  console.log(fileType);\r\n  if (!fileType) {\r\n    console.log('No file type');\r\n    // return empty image since it's likely invalid image format\r\n    res.json('');\r\n    return;\r\n  }\r\n  let imageExt = fileType.split('/')[1];\r\n  console.log(imageExt);\r\n  if (!imageExt) {\r\n    console.log('No file extension');\r\n    // return empty image since it's likely invalid image format\r\n    res.json('');\r\n    return;\r\n  }\r\n\r\n  // check if valid image type\r\n  const supportedImageTypes = [ 'apng', 'avif', 'gif', 'jpg', 'jpeg', 'jfif', 'pjpeg', 'pjp', 'png', 'svg', 'webp' ];\r\n  if (!supportedImageTypes.includes(imageExt)) {\r\n    console.log('Not valid file type');\r\n    // return empty image since it's likely invalid image format\r\n    res.json('');\r\n    return;\r\n  }\r\n\r\n  // if we made it this far, it's a valid image type\r\n  console.log('Valid file type');\r\n\r\n  // get ready to upload stream to GCP Storage\r\n  const storage = new Storage({\r\n    projectId: process.env.PROJECT_ID,\r\n    credentials: {\r\n      client_email: process.env.CLIENT_EMAIL,\r\n      private_key: process.env.PRIVATE_KEY\r\n    }\r\n  });\r\n  const myBucket = storage.bucket(process.env.BUCKET_NAME);\r\n  const file = myBucket.file(`${imageName}.${imageExt}`);\r\n\r\n  // upload to GCP Storage\r\n  const uploaded = () => {\r\n    return new Promise((resolve, reject) => {\r\n      downloaded.data.pipe(file.createWriteStream({ gzip: true })).on('finish', resolve).on('error', reject);\r\n    });\r\n  };\r\n\r\n  try {\r\n    await uploaded();\r\n  } catch (error) {\r\n    console.log(`Error uploading image to GCP Storage: ${error}`);\r\n    // server error of some kind.\r\n    // if we made it this far, the featuredImage url is probably ok so return that\r\n    res.json(featuredImage);\r\n    return;\r\n  }\r\n\r\n  // set new url for image to match new image in GCP Storage\r\n  featuredImage = `https://storage.googleapis.com/my-bucket-365c82f/${imageName}.${imageExt}`;\r\n  res.json(featuredImage);\r\n}\r\n```"}
{"sentences": "500 on Server Action POST", "description": "Anyone know why server action causes 500 on POST only in production?\r\n\r\nI've been trying to use Server Actions, but keep getting \"Failed to load resource: the server responded with a status of 500 ()\" error. I think it's the POST back to the page after server action has run.\r\n\r\nTo troubleshoot, I created a simple example of the code which demonstrates this error.\r\n\r\nsrc/app/test/actions.tsx\r\n```typescript\r\n\"use server\";\r\n\r\nexport async function sayHello() {\r\n  console.log(\"sayHello called\");\r\n  return \"Hello\";\r\n}\r\n````\r\n\r\nsrc/app/test/page.tsx\r\n````typescript\r\n\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { sayHello } from \"./actions\";\r\n\r\nexport default function Page() {\r\n  const [message, SetMessage] = useState(\"goodbye\");\r\n\r\n  useEffect(() => {\r\n    const callSayHello = async () => {\r\n      const mesg = await sayHello();\r\n      SetMessage(mesg);\r\n    };\r\n\r\n    callSayHello();\r\n  });\r\n  return (\r\n    <>\r\n      <p>{message}</p>\r\n    </>\r\n  );\r\n}\r\n````\r\n\r\npackage.json dependencies\r\n```\r\n  \"dependencies\": {\r\n    \"@emotion/cache\": \"^11.11.0\",\r\n    \"@emotion/react\": \"^11.11.1\",\r\n    \"@emotion/styled\": \"^11.11.0\",\r\n    \"@mui/material\": \"^5.15.11\",\r\n    \"debug\": \"^4.3.4\",\r\n    \"next\": \"^14.1.2\",\r\n    \"next-recaptcha-v3\": \"^1.1.5\",\r\n    \"react\": \"^18\",\r\n    \"react-dom\": \"^18\",\r\n    \"react-google-recaptcha\": \"^2.1.0\"\r\n  }\r\n```\r\n\r\nIts a Next 14 app router app, with a custom domain set in Vercel, on the Hobby plan.\r\n\r\nAny help is appreciated.\r\n"}
{"sentences": "Attempted to load @next/swc-win32-ia32-msvc, but an error occurred", "description": "### Summary\n\nv21.6.1 ia32 win32\r\nWindows 10 Home Intel(R) Core(TM) i7-4510U CPU @ 2.00GHz   2.00 GHz\r\nnext: 10.4.0\r\nI have node_modules\\@next\\swc-win32-ia32-msvc\\next-swc.win32-ia32-msvc.node, whether it was downloaded correctly I am not sure how to tell that.\r\n\r\nI followed all the steps noted on: https://nextjs.org/docs/messages/failed-loading-swc \n\n### Additional information\n\n```js\n>npm run dev\r\n\r\n> dev\r\n> next dev\r\n\r\n   ▲ Next.js 14.1.0\r\n   - Local:        http://localhost:3000\r\n\r\n ⚠ Attempted to load @next/swc-win32-ia32-msvc, but an error occurred: A dynamic link library (DLL) initialization routine failed.\r\n\\\\?\\C:\\Users\\TEST\\eclipse-workspace\\REACT\\node_modules\\@next\\swc-win32-ia32-msvc\\next-swc.win32-ia32-msvc.node\r\n ⨯ Failed to load SWC binary for win32/ia32, see more info here: https://nextjs.org/docs/messages/failed-loading-swc\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "(shallow routing) Updating search params causes server component to rerun.", "description": "I have a page that fetches initial data like: \r\n\r\n```tsx\r\nexport default async function PaymentPage() {\r\n   const data = await fetchOrderData();\r\n\r\n   return <PaymentFlow order={data} />\r\n}\r\n```\r\n\r\nNow the problem is that when I update search params in URL to include something like step of current payment flow:\r\n```tsx\r\nrouter.push('/payment-page?step=1')\r\n```\r\nIt causes the `PaymentPage` component to rerun and refetch all the data again. This makes it moving between the steps much slower because of the unnecessary refetching.\r\n\r\n\r\nAny way this can be fixed? In previous versions of nextjs I could use shallow routing, but it's not possible now. \r\n\r\n\"next\": \"13.4.1\",\r\n\r\nrelated discussion https://github.com/vercel/next.js/discussions/48110\r\n"}
{"sentences": "Why is it taking 10s+ for a hot reload for a small change? 😞", "description": "I'm not that much experienced working with Next.js and I'm still learning it. \r\nBut this slow hot reload is making it even more harder for me to build something. \r\nAnd by a small change I mean moving one line up or down. \r\n\r\n### Here's a demo\r\n\r\n![timer](https://user-images.githubusercontent.com/36589645/81881687-70f25800-95ae-11ea-8935-0566b872d671.gif)\r\n\r\nSomebody please help me resolve this issue. This is my [repository](https://github.com/abhagsain/jsmtc/tree/master)\r\n\r\nThank you!\r\n\r\n### Edit (14 May 2020)\r\n\r\nSince my codebase is small I'm moving it to Create React App. I wanted to build a project and learn Next.js but the slow load time is holding me back from getting anything done.\r\nI know it's not good to switch technologies when encountered a bug but I have already wasted 3 days trying to fix it and it's my personal project so it's okay for me 🤷‍♂️\r\n\r\nThank you everyone for your time. \r\n"}
{"sentences": "What would be the proper way to trigger a function in the Next Script?", "description": "### Summary\n\n1.  I made a component to handle Google tags and I placed it on the app.js page\r\n2. I placed one Google tag on the _document.js\r\n3. I am trying to call a function from the example of the Google tags, but apparently I am getting an error because the button doesn't find the function.\r\n\r\nHere is the component code that is in the app.js page\r\n\r\n```\r\nimport React from \"react\";\r\nimport Script from \"next/script\";\r\nimport Container from \"react-bootstrap/Container\";\r\nimport Row from \"react-bootstrap/Row\";\r\nimport Col from \"react-bootstrap/Col\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nconst GoogleTags = () => {\r\n  const [load, setLoad] = useState(true);\r\n\r\n  // const handleYes = () => {\r\n  //   document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n  // };\r\n  const handleNo = () => {\r\n    document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (load) {\r\n      setTimeout(() => {\r\n        document.getElementById(\"main-cookies-id\").style.display = \"block\";\r\n      }, 2000);\r\n    }\r\n    setLoad(false);\r\n  }, [load]);\r\n\r\n  return (\r\n    <Container id=\"main-cookies-id\" className=\"main-cookies\">\r\n      <Row>\r\n        {\" \"}\r\n        <Script\r\n          id=\"google-tag1\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `      \r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('consent', 'default', {\r\n                'ad_storage': 'denied',\r\n                'ad_user_data': 'denied',\r\n                'ad_personalization': 'denied',\r\n                'analytics_storage': 'denied'\r\n              });`,\r\n          }}\r\n        />\r\n        {/* <Script\r\n          id=\"google-tag2\"\r\n          strategy=\"afterInteractive\"\r\n          src=\"https://www.googletagmanager.com/gtag/js?id=G-4RB3V861V1\"\r\n        /> */}\r\n/// ^^^ This tag here is on the _document.js \r\n\r\n        <Script\r\n          id=\"google-tag3\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `\r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('js', new Date());\r\n              gtag('config', 'G-4RB3V861V1');\r\n            `,\r\n          }}\r\n        />\r\n        <Script\r\n          id=\"google-tag4\"\r\n          strategy=\"afterInteractive\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `\r\n            function allConsentGranted() {\r\n              gtag('consent', 'update', {\r\n                'ad_user_data': 'granted',\r\n                'ad_personalization': 'granted',\r\n                'ad_storage': 'granted',\r\n                'analytics_storage': 'granted'\r\n              });\r\n              document.getElementById(\"main-cookies-id\").style.display = \"none\";\r\n            }`,\r\n          }}\r\n        />\r\n      </Row>\r\n      <Row>\r\n        <div>\r\n          <p>do you want cookies? </p>\r\n        </div>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n          <button onClick={allConsentGranted}>Yes</button>{\" \"}\r\n///  ^^  the button can't find the allConsentGrated function that is on the last tag\r\n        </Col>\r\n        <Col>\r\n          <button onClick={handleNo}>No</button>{\" \"}\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default GoogleTags;\r\n\r\n```\r\n\r\nThis is the error:\r\n\r\n```\r\nServer Error\r\nReferenceError: allConsentGranted is not defined\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Using next/router outside of components", "description": "Documentation states that I have to either use `useRouter` or `withRouter` to access router and I can't find a way to use router outside of components. Thing is, that almost all side effects are handled inside state management library and creating additional state and  `useEffect` just for redirecting user to another page (in my case - error page) seem unnecessary. Is there a way to use router outside of components? I tried to `import {Router} from 'next/router'`, but got `TypeError: Router.push is not a function`."}
{"sentences": "should Link prefetch also fetch the page json?", "description": "Link component prefetches by default the page javascript\r\nI noticed that when a page implements getStaticProps or getServerSideProps the json data file is only downloaded when actually visiting the page (after click on the link).\r\nI think it would be nice if the Link component could also prefetch this data file together with the page javascript code. Thoughts?"}
{"sentences": "Why is this div doesn't seem to catch any CSS style?", "description": "### Summary\r\n\r\nI want to create a component that pops up to accept cookies, and I want to put it on the app.js  page\r\n\r\nThe component seems to be coming in, but I can't seem to add any style to it.    What in the world is going on?\r\n\r\nSeems silly to post about it, but I can't find a way around it..\r\n\r\nHere is the code of the component:\r\n\r\n```\r\nimport React from \"react\";\r\nimport Script from \"next/script\";\r\nimport Container from \"react-bootstrap/Container\";\r\nimport Row from \"react-bootstrap/Row\";\r\nimport Col from \"react-bootstrap/Col\";\r\n\r\nconst GoogleTags = () => {\r\n  const handleYes = () => {};\r\n  const handleNo = () => {};\r\n  return (\r\n    <Container id=\"main-cookies-id\" ClassName=\"main-cookies\">\r\n      <Row>\r\n        {\" \"}\r\n        {/* <Script\r\n            id=\"gtag-init1\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: ` \r\n              window.dataLayer = window.dataLayer || [];\r\n              unction gtag(){dataLayer.push(arguments);}\r\n              // Set default consent to 'denied' as a placeholder\r\n              // Determine actual values based on your own requirements\r\n              gtag('consent', 'default', {\r\n              'ad_storage': 'denied',\r\n              'wait_for_update': 500,\r\n              'ad_user_data': 'denied',\r\n              'ad_personalization': 'denied',\r\n              'analytics_storage': 'denied'\r\n              `,\r\n            }}\r\n          />\r\n          <Script\r\n            strategy=\"afterInteractive\"\r\n            src=\"https://www.googletagmanager.com/gtag/js?id=G-4RB3V861V1\"\r\n          />\r\n          <Script\r\n            id=\"gtag-init\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: `\r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('js', new Date());\r\n              gtag('config', 'G-4RB3V861V1');\r\n            `,\r\n            }}\r\n          />\r\n          <Script\r\n            id=\"gtag-function-update\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: `\r\n          function consentGrantedAdStorage () {\r\n            gtag('consent', 'update', {\r\n              'ad_storage': 'granted'\r\n            });\r\n          }`,\r\n            }}\r\n          /> */}\r\n      </Row>\r\n      <Row>\r\n        <div>\r\n          <p>do you want cookies? </p>\r\n        </div>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n          <button onClick={handleYes}>Yes</button>{\" \"}\r\n        </Col>\r\n        <Col>\r\n          <button onClick={handleNo}>No</button>{\" \"}\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default GoogleTags;\r\n\r\n```\r\n\r\nThis is the CSS code:\r\n```\r\n.main-cookies {\r\n  background-color: #555;\r\n  color: black;\r\n  padding: 10px 20px;\r\n  border: 3px solid #f1f1f1;\r\n  cursor: pointer;\r\n  position: fixed;\r\n  bottom: 100px;\r\n  left: 280px;\r\n  width: 500px;\r\n}\r\n\r\n```\r\nAnd at the towards the bottom you will find the component <GoogleTags>\r\n\r\n```\r\nimport { Provider } from \"react-redux\";\r\nimport { store } from \"./../components/chat/store\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.css\";\r\nimport \"../styles/general.css\";\r\nimport \"../styles/pagination.scss\";\r\nimport Head from \"next/head\";\r\nimport GoogleTags from \"../components/google-tags\";\r\nimport MainNav from \"../components/nav-main\";\r\nimport Footer from \"../components/footer\";\r\nimport Script from \"next/script\";\r\nimport ChatContainer from \"../components/chat/chat-container\";\r\nimport Button from \"../components/chat/button\";\r\n\r\n// import Sw from \"../public/sw\";\r\n// import Manifest from \"../public/manifest.json\";\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  // useEffect(() => {\r\n  //   if (\"serviceWorker\" in navigator) {\r\n  //     window.addEventListener(\"load\", function () {\r\n  //       navigator.serviceWorker.register(\"/sw.js\").then(\r\n  //         function (registration) {\r\n  //           console.log(\r\n  //             \"Service Worker registration successful with scope: \",\r\n  //             registration.scope\r\n  //           );\r\n  //         },\r\n  //         function (err) {\r\n  //           console.log(\"Service Worker registration failed: \", err);\r\n  //         }\r\n  //       );\r\n  //     });\r\n  //   }\r\n  // }, []);\r\n\r\n  return (\r\n    <Provider store={store}>\r\n      <div>\r\n        <div>\r\n          <Head>\r\n            <link rel=\"manifest\" href=\"/manifest.json\" />\r\n            <meta name=\"theme-color\" content=\"#016698\" />\r\n\r\n            {/* IOS */}\r\n            <meta name=\"format-detection\" content=\"telephone=no\"></meta>\r\n            <meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"57x57\"\r\n              href=\"/io/icon-57x57.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"60x60\"\r\n              href=\"/io/icon-60x60.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"72x72\"\r\n              href=\"/io/icon-72x72.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"76x76\"\r\n              href=\"/io/icon-76x76.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"114x114\"\r\n              href=\"/io/icon-114x114.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"120x120\"\r\n              href=\"/io/icon-120x120.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"144x144\"\r\n              href=\"/io/icon-144x144.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"152x152\"\r\n              href=\"/io/icon-152x152.png\"\r\n            />\r\n            <link\r\n              rel=\"apple-touch-icon\"\r\n              sizes=\"180x180\"\r\n              href=\"/io/icon-180x180.png\"\r\n            />\r\n            <meta\r\n              name=\"apple-mobile-web-app-title\"\r\n              content=\"Technical Union\"\r\n            ></meta>\r\n            <meta\r\n              name=\"apple-mobile-web-app-status-bar-style\"\r\n              content=\"black\"\r\n            ></meta>\r\n\r\n            {/* ANDROID */}\r\n            <meta name=\"mobile-web-app-capable\" content=\"yes\" />\r\n            <link\r\n              rel=\"icon\"\r\n              type=\"image/png\"\r\n              sizes=\"16x16\"\r\n              href=\"/android/icon-16x16.png\"\r\n            />\r\n            <link\r\n              rel=\"icon\"\r\n              type=\"image/png\"\r\n              sizes=\"32x32\"\r\n              href=\"/android/icon-32x32.png\"\r\n            />\r\n            <link\r\n              rel=\"icon\"\r\n              type=\"image/png\"\r\n              sizes=\"96x96\"\r\n              href=\"/android/icon-96x96.png\"\r\n            />\r\n            <link\r\n              rel=\"icon\"\r\n              type=\"image/png\"\r\n              sizes=\"192x192\"\r\n              href=\"/android/icon-192x192.png\"\r\n            />\r\n          </Head>\r\n        </div>\r\n        <div>\r\n          {/* <Script\r\n            strategy=\"afterInteractive\"\r\n            src=\"https://www.googletagmanager.com/gtag/js?id=UA-36867189-2\"\r\n          /> */}\r\n\r\n          {/* <Script\r\n            id=\"gtag-init\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: `\r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('js', new Date());\r\n              gtag('config', 'UA-36867189-2');\r\n            `,\r\n            }}\r\n          /> */}\r\n          {/* <Script\r\n            async\r\n            src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8682017023658879\"\r\n            crossOrigin=\"anonymous\"\r\n          /> */}\r\n\r\n          {/* <Script\r\n            id=\"gtag-init1\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: ` \r\n              window.dataLayer = window.dataLayer || [];\r\n              unction gtag(){dataLayer.push(arguments);}\r\n              // Set default consent to 'denied' as a placeholder\r\n              // Determine actual values based on your own requirements\r\n              gtag('consent', 'default', {\r\n              'ad_storage': 'denied',\r\n              'ad_user_data': 'denied',\r\n              'ad_personalization': 'denied',\r\n              'analytics_storage': 'denied'\r\n              `,\r\n            }}\r\n          /> */}\r\n\r\n          <Script\r\n            strategy=\"afterInteractive\"\r\n            src=\"https://www.googletagmanager.com/gtag/js?id=G-4RB3V861V1\"\r\n          />\r\n\r\n          <Script\r\n            id=\"gtag-init\"\r\n            strategy=\"afterInteractive\"\r\n            dangerouslySetInnerHTML={{\r\n              __html: `\r\n              window.dataLayer = window.dataLayer || [];\r\n              function gtag(){dataLayer.push(arguments);}\r\n              gtag('js', new Date());\r\n              gtag('config', 'G-4RB3V861V1');\r\n            `,\r\n            }}\r\n          />\r\n          {/* <Script\r\n            async\r\n            src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8682017023658879\"\r\n            crossOrigin=\"anonymous\"\r\n          /> */}\r\n        </div>\r\n        <nav>\r\n          <MainNav />\r\n        </nav>{\" \"}\r\n        <Component {...pageProps} />\r\n        <div>\r\n          <GoogleTags />\r\n          <ChatContainer />\r\n          <Button />\r\n        </div>\r\n        <footer>\r\n          <Footer />\r\n        </footer>\r\n        <script async type=\"module\" src=\"app.js\"></script>\r\n      </div>\r\n    </Provider>\r\n  );\r\n}\r\n\r\nexport default MyApp;\r\n\r\n```\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How to properly build NextJS application?", "description": "### Summary\n\nMy `Dockerfile` usually has this commands to build the NextJS application:\r\n```Dockerfile\r\nnpm install\r\nnpm run build\r\n```\r\n\r\nAnd almost all the time I was ok with that\r\n\r\nBut now I realised, that there's many `devDependencies` which I would like to exclude from my build because I don't need the at all when I build my application in production (because they increase `npm install` time of my application)\r\n\r\nSo I added env:\r\n```Dockerfile\r\nNODE_ENV=\"production\"\r\n```\r\n\r\nAnd now my `npm install` installs only `dependencies` without `devDependencies` and I am glad for that\r\n\r\nBut after that my `npm run build` (which is `next build`) is also got broken, because it runs `ts lint` during building and I get errors kinda like that:\r\n```\r\nCannot resolve @types/..., try to install them using @types/...\r\n```\r\nbecause my `devDependencies` are missing\r\n\r\nWhat should I do in this case?\r\n\r\nI don't want to move `devDependencies` to the `dependencies`, I also don't want to remove `NODE_ENV=\"production\"` from my `Dockerfile`\r\n\r\nWhat's the most common practice for my case?\r\n\r\nThank you\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Using cookies in client-components", "description": "I have a basic web app with login and home pages. I get the user's token after they log in and save it to the cookie store.\r\n\r\nI can get the token from server components and pass it down to the client component. However, I'm looking for a more convenient solution like using hooks or something else.\r\n\r\n```typescript\r\n\"use server\"\r\n\r\nimport {cookies} from 'next/headers'\r\n\r\nexport const getToken = (): string | undefined => {\r\n    return cookies().get('token')?.value;\r\n}\r\n```\r\n\r\nBasically, I want to determine if the user is logged in or not and use this information in my NavBar (client component) to show the Login or Logout button."}
{"sentences": "Am I missing something? App router tutorial strange behavior", "description": "Hi everyone, I'm following the next js dashboard tutorial and my app is behaving in a strange way.\r\n\r\nI have the following folder structure **app/ui/dashboard,** with a **page.tsx** file insinde the **dashboard** folder. I would expect that going to **http://localhost:3001/dashboard** would render the dashboard page component.\r\n\r\nBut it returns me 404. It works though like this http://localhost:3001/ui/dashboard but the **ui** folder does not have any **page.tsx** file.\r\n\r\nAm I doing something wrong?\r\n\r\nThank you!\r\n\r\n![image](https://github.com/vercel/next.js/assets/22237268/a8bc04a7-8cbf-46a2-b9ea-7fa59b0ae0a7)\r\n![image](https://github.com/vercel/next.js/assets/22237268/f80a113b-6241-40a7-a9e5-cffe02f4b3f4)\r\n![image](https://github.com/vercel/next.js/assets/22237268/3bc0583b-333f-4ae3-a5de-bbd060d1f75a)\r\n"}
{"sentences": "Next 14.2.x is showing different build output for functions", "description": "### Summary\n\non Vercel builds dashboard. Previously on 14.1.4:\r\n\r\n![image](https://github.com/vercel/next.js/assets/3803466/a694add9-57a3-44b8-b445-3b3b11e619d3)\r\n\r\nnow on 14.2.1:\r\n\r\n![image](https://github.com/vercel/next.js/assets/3803466/32fe775f-444e-456f-8855-7012a5468208)\r\n\r\nI haven't changed the functions that were on \"Edge Runtime\", so did Vercel builds just changed to no longer differentiate between Edge Runtime and \"Dynamic\"?\r\n\r\nI also see the symbols changed from before λ, ℇ to ƒ for all dynamic fns. So is this missing differentiation a Vercel dashboard issue?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Recently started getting \"Error: aborted\" randomly", "description": "So I randomly started getting the following error\r\n\r\n```shell\r\nThis error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:\r\nError: aborted\r\n    at connResetException (node:internal/errors:692:14)\r\n    at abortIncoming (node:_http_server:602:17)\r\n    at socketOnClose (node:_http_server:596:3)\r\n    at Socket.emit (node:events:539:35)\r\n    at Socket.emit (node:domain:475:12)\r\n    at TCP.<anonymous> (node:net:709:12)\r\nerror - unhandledRejection: Error: aborted\r\n    at connResetException (node:internal/errors:692:14)\r\n    at abortIncoming (node:_http_server:602:17)\r\n    at socketOnClose (node:_http_server:596:3)\r\n    at Socket.emit (node:events:539:35)\r\n    at Socket.emit (node:domain:475:12)\r\n    at TCP.<anonymous> (node:net:709:12) {\r\n  code: 'ECONNRESET'\r\n}\r\n```\r\n\r\nIt happens if I make my browser go from mobile view to desktop view using Chrome's DevTools and sometimes it will happen just refreshing the page. The only `async` code I have is either `getStaticProps` where I call `sanityClient.fetch(someQuery)` but that has never caused this before. I know this doesn't have any code to go off but that is because I have no idea where to even start."}
{"sentences": "Where is the next.js offical website source code?", "description": "### Summary\n\nThe next.js repo only has docs\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Cant find my site on google", "description": "I created a nextjs site. It has a sitemap all of which I can see in my google console. when i go to site:mysite.com I can see all my pages indexed but when I do a search for my site on google, I cant find it. I have meta keyword and meta descriptions and Ive verified my domain with google. Any help?"}
{"sentences": "NextJS v12.2.5 Blank white screen appears when page router loads first", "description": "### Summary\n\nPage rendering is blocked till majority of JS is loaded, this needs to be looked at sooner rather than later, as it has the potential to lead to high bounce rates for places with low internet speeds.\r\nHow to enable for the SSR html to load in the browser without waiting for all the js bundles to be loaded?\r\n\r\nhttps://github.com/vercel/next.js/assets/51259135/f417e31d-cac3-428c-89ab-0f6372514e1f\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "intermittent blank screen issues (parallel routes + interceptor routes)", "description": "### Summary\n\n- When navigating repeatedly between \"/\", \"/content/[id]\" pages, you occasionally encounter a blank screen.\r\n- The issue doesn't occur in the local environment.\r\n- using revalidate when fetching data in the \"/content/[id]\" modal.\r\n- Once the blank screen appears, navigating back only changes the address in the address bar without refreshing the page, and the blank screen persists until you manually refresh the page.\r\n\r\n[blank screen]\r\n<img width=\"1091\" alt=\"blank_page\" src=\"https://github.com/vercel/next.js/assets/81900561/7f4b0e74-d56f-4e45-a39e-e08eed1318b3\">\r\n\r\n[rcs is null, parallelRoutes is {}]\r\n<img width=\"567\" alt=\"rcs_null\" src=\"https://github.com/vercel/next.js/assets/81900561/4f596dcc-e0de-41f9-af7d-b17bca860b79\">\r\n\r\n\r\nWhat should I try?\n\n### Additional information\n\n```js\n> next v14.2.1\r\n> The issue does not occur in the local environment.\r\n> project tree\r\n├─ app\r\n│  │  ├─ @pageModal\r\n│  │  │  ├─ (.)content\r\n│  │  │  │  └─ [id]\r\n│  │  │  │     └─ page.tsx\r\n│  │  │  ├─ (.)video\r\n│  │  │  │  └─ [id]\r\n│  │  │  │     └─ [sid]\r\n│  │  │  │        └─ page.tsx\r\n│  │  │  └─ default.tsx\r\n│  │  ├─ [...not_found]\r\n│  │  │  └─ page.tsx\r\n│  │  ├─ [slug]\r\n│  │  │  └─ route.ts\r\n│  │  ├─ content\r\n│  │  │  └─ [id]\r\n│  │  │     ├─ loading.tsx\r\n│  │  │     └─ page.tsx\r\n│  │  ├─ error.tsx\r\n│  │  ├─ global-error.tsx\r\n│  │  ├─ layout.tsx\r\n│  │  ├─ not-found.tsx\r\n│  │  ├─ page.tsx\r\n│  │  ├─ registry.tsx\r\n│  │  └─ video\r\n│  │     └─ [id]\r\n│  │        └─ [sid]\r\n│  │           └─ page.tsx\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "API is slow when deloy to Vercel", "description": "I deployed this example to Vercel:\r\nhttps://github.com/vercel/next.js/tree/canary/examples/api-routes-rest\r\nThis is deployed URL:\r\nhttps://api-routes-rest-eight.vercel.app/\r\n\r\nScreenshot: \r\n![chrome_2021-03-04_11-11-37](https://user-images.githubusercontent.com/300961/109910621-1f50c080-7cdb-11eb-8163-7ebfd00d329f.png)\r\n\r\nIt seems this API traveled cross 2 regions: `https://api-routes-rest-eight.vercel.app/`\r\n`x-vercel-id: hkg1::sr2qf-1614831060863-502153a26f88`\r\n\r\nDo we have a solution to this problem? "}
{"sentences": "NextJS 14 with NX monorepo and MUI theme -  build fails when exporting middleware from libs", "description": "### Summary\r\n\r\nWhen trying to setup a NX monorepo with NextJS 14 (App Router), I have exported from my libs folder some middleware(s) and then when running the build command I get this error:\r\n```bash\r\n../../node_modules/.pnpm/@mui+utils@5.15.14_@types+react@18.2.33_react@18.2.0/node_modules/@mui/utils/ponyfillGlobal/ponyfillGlobal.js\r\nDynamic Code Evaluation (e. g. 'eval', 'new Function', 'WebAssembly.compile') not allowed in Edge Runtime\r\nLearn More: https://nextjs.org/docs/messages/edge-dynamic-code-evaluation\r\n\r\nImport trace for requested module:\r\n../../node_modules/.pnpm/@mui+utils@5.15.14_@types+react@18.2.33_react@18.2.0/node_modules/@mui/utils/ponyfillGlobal/ponyfillGlobal.js\r\n../../node_modules/.pnpm/@mui+utils@5.15.14_@types+react@18.2.33_react@18.2.0/node_modules/@mui/utils/ponyfillGlobal/index.js\r\n../../node_modules/.pnpm/@mui+utils@5.15.14_@types+react@18.2.33_react@18.2.0/node_modules/@mui/utils/index.js\r\n../../node_modules/.pnpm/@mui+material@5.15.14_@emotion+react@11.11.4_@emotion+styled@11.11.0_@types+react@18.2.33_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/className/index.js\r\n../../node_modules/.pnpm/@mui+material@5.15.14_@emotion+react@11.11.4_@emotion+styled@11.11.0_@types+react@18.2.33_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Box/Box.js\r\n../../node_modules/.pnpm/@mui+material@5.15.14_@emotion+react@11.11.4_@emotion+styled@11.11.0_@types+react@18.2.33_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Box/index.js\r\n__barrel_optimize__?names=Box!=!../../node_modules/.pnpm/@mui+material@5.15.14_@emotion+react@11.11.4_@emotion+styled@11.11.0_@types+react@18.2.33_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/index.js\r\n../../libs/ui/src/lib/client/components/hero/hero.tsx\r\n../../libs/ui/src/lib/client/components/hero/index.ts\r\n../../libs/ui/src/lib/client/components/index.ts\r\n../../libs/ui/src/lib/client/index.ts\r\n../../libs/ui/src/lib/server/providers/nn-app-provider.tsx\r\n../../libs/ui/src/lib/server/providers/index.ts\r\n../../libs/ui/src/lib/server/index.ts\r\n../../libs/ui/src/server.ts\r\n\r\n\r\n> Build failed because of webpack errors\r\nError occurred while trying to run the build command\r\n1\r\n```\r\n\r\nI managed to make this all setup work only when removing the middleware(s) exporting from the libs and moved them to the `apps/my-app` level, but this is not great since I do want to share these between apps in a generic & reusable way.\r\n\r\nI tried to do the suggestions from https://github.com/vercel/next.js/issues/35973#issuecomment-1108957927 but it didn't work, and it seems like also `next.config.js` supports it out of the box with:\r\n```js\r\n  transpilePackages: [\r\n    '@ui/server',\r\n     // also tried with actual paths from the error:\r\n    '../../libs/ui/src/lib/client/components/hero/hero.tsx',\r\n    '../../libs/ui/src/lib/client/components/hero/index.ts',\r\n    '../../libs/ui/src/lib/client/components/index.ts',\r\n    '../../libs/ui/src/lib/client/index.ts',\r\n    '../../libs/ui/src/lib/server/providers/nn-app-provider.tsx',\r\n    '../../libs/ui/src/lib/server/providers/index.ts',\r\n    '../../libs/ui/src/lib/server/index.ts',\r\n    '../../libs/ui/src/server.ts',\r\n  ],\r\n```\r\n\r\nbut this also does not work.\r\n\r\n\r\n\r\n### Additional information\r\n\r\nApp code:\r\n\r\n```ts\r\n// apps/my-app/middleware.ts:\r\n\r\n\r\nimport {\r\n  i18nRouterMiddleware,\r\n  stackMiddlewares,\r\n} from '@ui/server';\r\n\r\nconst middlewares = [i18nRouterMiddleware];\r\nexport default stackMiddlewares(middlewares);\r\n\r\nexport const config = {\r\n  matcher: '/((?!api|static|.*\\\\..*|_next).*)',\r\n};\r\n```\r\nlibs code:\r\n\r\n```ts\r\n// libs/ui/src/lib/server/middlewares/i18n-router.middleware.ts\r\nimport { i18nRouter } from 'next-i18n-router';\r\nimport { NextRequest } from 'next/server';\r\nimport { i18nConfig } from '../configs';\r\nimport { MiddlewareFactory } from './stack-handler';\r\n\r\nexport const i18nRouterMiddleware: MiddlewareFactory = () => {\r\n  return async (request: NextRequest) => {\r\n    return i18nRouter(request, i18nConfig);\r\n  };\r\n};\r\n```\r\n\r\n```ts\r\n// libs/ui/src/lib/server/middlewares/stack-handler.ts\r\n\r\nimport { NextMiddleware, NextResponse } from 'next/server';\r\n\r\nexport type MiddlewareFactory = (middleware: NextMiddleware) => NextMiddleware;\r\n\r\nexport function stackMiddlewares(functions: MiddlewareFactory[] = [], index = 0): NextMiddleware {\r\n  const current = functions[index];\r\n  if (current) {\r\n    const next = stackMiddlewares(functions, index + 1);\r\n    return current(next);\r\n  }\r\n  return () => NextResponse.next();\r\n}\r\n\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "PostCSS transform skipped Unable to find PostCSS config", "description": "### Summary\r\n\r\nI moved my blog to \"next\": \"14.2.0-canary.56\", \r\n\r\nSince then  i get this message in the  terminal with every CSS file in my project named.\r\n\r\nlike this:\r\n\r\n```\r\n>  \r\n⚠ ./src/app/styles/NotFound.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n ⚠ ./src/app/resume/ResumeComponents/WorkExperience/WorkExperience.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/app/resume/ResumeComponents/JobItem/JobItem.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/app/resume/ResumeComponents/TechCards/TechCards.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/app/resume/ResumeComponents/CardItemVariant/CardItemVariant.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/Footer/Footer.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/app/resume/ResumeComponents/CardItem/CartItem.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/MainLayout/MainLayout.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/Spacer/Spacer.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/app/styles/globals.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/Navbar/Navbar.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/Navbar/NavbarGlobalStyles.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\n\r\n ⚠ ./src/components/UiComponents/Navbar/NavbarComponents/Logo/Logo.module.css\r\nPostCSS transform skipped\r\nUnable to find PostCSS config\r\n```\r\n>\r\n\r\n> PostCSS transform skipped\r\nUnable to find PostCSS config\r\n\r\nEven I'm not using any Post-CSS related lib or plugin and I'm not using tailwind also\r\n\r\n**I updated to the latest canary version (14.2.0-canary.60) too, but still gets the same messages in the terminal.**\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n  Platform: linux\r\n  Arch: x64\r\n  Version: #111-Ubuntu SMP Tue Mar 5 20:16:58 UTC 2024\r\n  Available memory (MB): 7857\r\n  Available CPU cores: 4\r\nBinaries:\r\n  Node: 21.7.0\r\n  npm: 10.5.0\r\n  Yarn: 1.22.22\r\n  pnpm: 8.15.6\r\nRelevant Packages:\r\n  next: 14.2.0-canary.60 // Latest available version is detected (14.2.0-canary.60).\r\n  eslint-config-next: 14.1.0\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 5.4.3\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Dynamic Redirects, best way?", "description": "Hey there!\r\n\r\n**I'm wondering what everyone's opinions are on how to properly generate page redirects that are defined outside of Next?**\r\n\r\nFor example, I have data coming from Sanity.io where a client would maintain a list of redirects (with `from`, `to`, and `isPermanent` fields). How can I take that data and generate redirects within NextJS? It's possible that the redirect `from` URL could cross multiple dynamic and static pages defined within Next.\r\n\r\nMy initial solution was to write these redirects to `vercel.json` in my build scripts, but unfortunately, Vercel reads the config file BEFORE build scripts are run so the redirects are never read through.\r\n\r\nI feel this solution would be such a clean solution for setting these up, but with how Vercel deploys projects it seems unlikely this solution will work without a core update from the Vercel team.\r\n\r\n**The goal is to avoid:**\r\n1. hardcoding the redirects in the codebase.\r\n2. Setting up a 3rd-party service to write these on deploy\r\n3. Adding these into each page template via `getStaticProps` (especially when the redirects are \"unknown\")\r\n\r\nThoughts?"}
{"sentences": "Why would the Google lighthouse give me a bad ratio from a picture?", "description": "### Summary\n\nThis error:\r\n![image](https://github.com/vercel/next.js/assets/93617433/8e94efc0-4321-46e4-9966-fc10c471cdd9)\r\n\r\n\r\n^^ This picture above is indeed 700x400 pixels.\r\n\r\nThe code is this:\r\n```\r\n<span>\r\n            <Image\r\n              src=\"/images/maintenance-1.png\"\r\n              id=\"maintenance1\"\r\n              alt=\"maintenance lubrication\"\r\n              width={700}\r\n              height={400}\r\n              priority={true} // {false} | {true}\r\n            />\r\n          </span>\r\n```\r\n\r\nWhy would the Lighthouse be saying I got the wrong aspect ratio showing up? \r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "source map for large first-party JavaScript not working for the config?", "description": "### Summary\n\nGoogle lighthouse error:\r\n![image](https://github.com/vercel/next.js/assets/93617433/b38f664f-85f2-4bbd-91a1-007f7bc1d74a)\r\n\r\nThe code I have:\r\n\r\n```\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  productionBrowserSourceMaps: true,\r\n/// and a bunch of redirects\r\n}\r\n\r\nmodule.exports = nextConfig;\r\n\r\n```\r\n\r\nThe link of the file:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/next.config.js\r\n\r\n\r\nI ran npm run build (working good), then npm run dev and went to check the lighthouse and still gave me an error for the source map.\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Vercel.json's \"includeFiles\" with `pages/api` serverless functions", "description": "Lets say i had two files in the root of my next.js project: `random.txt` and `somedir/random2.txt`. How could I access those inside of a `src/pages/api/function.js` file? Whatever I do I can't seem to get the paths right or even verify that the files are present. I thought something like the below would help:\r\n\r\n```json5\r\n// vercel.json\r\n{\r\n  \"functions\": {\r\n    \"src/pages/api/function.js\": {\r\n      \"includeFiles\": \"somedir/random2.txt\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nBut no luck."}
{"sentences": "How do I get a source map for large first-party JavaScript in Next.js?", "description": "### Summary\n\nI am working on some issues shown from Google Lighthouse.\r\n\r\nOne of the issues is:\r\n```\r\nMissing source maps for large first-party JavaScript\r\nSource maps translate minified code to the original source code. This helps developers debug in production. In addition, Lighthouse is able to provide further insights. Consider deploying source maps to take advantage of these benefits. [Learn more about source maps](https://developer.chrome.com/docs/devtools/javascript/source-maps/?utm_source=lighthouse&utm_medium=devtools).\r\n```\r\n![image](https://github.com/vercel/next.js/assets/93617433/f0b7d621-c788-4503-b97a-b84f1c04bca3)\r\n\r\n\r\n^^ How do I go about to include this in a Next.js project?\r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Console warning: `API handler should not return a value`", "description": "### Summary\r\n\r\nI've recently started receiving `API handler should not return a value, received object.` errors, which (thanks to GitHub's amazing \"search everything everywhere all at once\" feature) I was able to trace back to this bit of code in next.js\r\n\r\nhttps://github.com/vercel/next.js/blob/20d8e93d1e95015621b2cb095e26210af1e8a263/packages/next/src/server/api-utils/node.ts#L590-L600\r\n\r\nI've recently upgraded from `\"next\": \"13.1.4\",` to `\"next\": \"13.3.1\",` so I'm assuming this log is recent-ish (or at least it's the first time I've noticed it).\r\n\r\nEverything I return from API routes is of the TS type `NextApiResponse` or `undefined` as far as I can tell:\r\n```ts\r\nreturn res.status(500).json({ error: \"Error transforming image\" })\r\n//                     ^? (body: any) => void\r\n```\r\n```ts\r\nreturn returnStream.pipe(res)\r\n//                  ^? (res: NextApiResponse) => NextApiResponse\r\n```\r\n```ts\r\nreturn res.end()\r\n//         ^? internal.Writable.end(cb?: (() => void) | undefined): NextApiResponse\r\n```\r\nunless it comes from a 3rd party route like [tRPC](https://trpc.io/) (`createNextApiHandler()`) or [next-auth](https://next-auth.js.org/) (`NextAuth()`).\r\n\r\n\r\n- What should in fact be returned from an API route, if anything? \r\n- Did something change in the specs or was it always an error and just recently started being logged to the console?\r\n- Could the log itself be a little more explicitly saying that it \"comes from Next\"? (because if it wasn't for the GitHub search feature, I would have had a hard time tracing it back to Next)\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "\"Error: The Edge Function \"middleware\" is referencing unsupported modules: crypto\" upon deployment to vercel with next-auth", "description": "Operating System:\r\n  Platform: win32\r\n  Arch: x64\r\n  Version: Windows 10 Pro\r\nBinaries:\r\n  Node: 16.15.1\r\n  npm: 9.4.0\r\n  Yarn: N/A\r\n  pnpm: N/A\r\nRelevant packages:\r\n  next: 13.1.5\r\n  eslint-config-next: 13.0.6\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  next-auth: 4.18.10\r\n  mongodb: 4.13.0\r\n  @auth0/nextjs-auth0: 2.0.1\r\n  @next-auth/mongodb-adapter: 1.1.1\r\n\r\nalso using appDir: True\r\n\r\nI'm using next-auth package to protect routes, but upon deployment to Vercel am getting the error:\r\n\r\nBuild Completed in /vercel/output [40s]\r\nError: The Edge Function \"middleware\" is referencing unsupported modules: crypto, crypto, crypto\r\n\r\nI don't believe crypto is required within the middleware\r\n\r\nmiddlewear.ts\r\n```\r\nexport { default } from \"next-auth/middleware\";\r\n\r\nexport const config = {\r\n    matcher: [\"/admin/:path*\", \"/search/:path*\", \"/dashboard/:path*\"],\r\n};\r\n```\r\n\r\n\r\nAny help is appreciated, I can provide further info just not sure what would be causing this.\r\n\r\n\r\n"}
{"sentences": "How to handle FormData using formidable in Next 13 App Router (beta)", "description": "### Summary\r\n\r\nI have been trying to use fetch to submit `formData` to the Route Handler.\r\n\r\n```\r\n    const f = new FormData();\r\n    f.append(\"name\", data.name);\r\n    const response = await fetch(\"/project/api\", {\r\n      method: \"POST\",\r\n      body: f,\r\n    });\r\n``` \r\n\r\n`/app/project/api/route.ts`\r\n\r\n```\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n};\r\n\r\nexport async function POST(request: NextRequest) {\r\n  const uuid = v4();\r\n\r\n  var form = formidable({});\r\n\r\n  form.parse(request, function (err, fields, files) {\r\n    console.log(\"fields\", fields);\r\n  });\r\n\r\n  return NextResponse.json({ id: uuid });\r\n}\r\n```\r\n\r\nPackages are:\r\n\r\n```\r\n    \"formidable\": \"^2.1.1\",\r\n    \"@types/formidable\": \"^2.0.5\",\r\n    \"next\": \"^13.2.4\",\r\n```\r\n\r\n\r\n### Additional information\r\n\r\n\r\nFew issues I am having right now are:\r\n\r\n1) Typescript is complaining about the type of the request passed to `form.parse`\r\n\r\n```js\r\nArgument of type 'NextRequest' is not assignable to parameter of type 'IncomingMessage'.\r\n  Type 'NextRequest' is missing the following properties from type 'IncomingMessage': aborted, httpVersion, httpVersionMajor, httpVersionMinor, and 48 more.\r\n```\r\n\r\n2) Error when I try to run current code\r\n\r\n```\r\nCritical dependency: the request of a dependency is an expression\r\n\r\nImport trace for requested module:\r\n./node_modules/formidable/src/Formidable.js\r\n./node_modules/formidable/src/index.js\r\n./app/project/api/route.ts\r\nerror - Error: Cannot find module '...\\.next\\server\\app\\project\\api\\plugins\\octetstream.js'\r\n```\r\n\r\nEventually I would like to pass some files that is why I am trying to stick to formData. \r\n\r\nAny suggestion on how to make next/formidable/typescript happy?\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "newbie question, why can't i create a new page?", "description": "### Summary\n\ni ended up using nextjs in a new project of mine, and i've been having a bit of an issue with the creation of new pages.\r\nafter making a new project, i made a new file named ```test.tsx``` and tried to make it appear as a route (by following the docs), this is the test code i used:\r\n```\r\nexport default function Test() {\r\n    return (\r\n      <div>\r\n        <h1>Test Route</h1>\r\n        <p>This is the test route.</p>\r\n      </div>\r\n    );\r\n  }\r\n```\r\nand here is my file structure:\r\n```\r\n./src\r\n├── app\r\n│   ├── globals.css\r\n│   ├── layout.tsx\r\n│   ├── page.css\r\n│   └── page.tsx\r\n└── pages\r\n    └── test.tsx\r\n```\r\n\r\ni expected test to appear on ```localhost:3000/test``` but i just got a 404 message.\n\n### Additional information\n\n```js\ni have no idea what further information could help solve this issue, if any extra information is needed, just ask.\r\n\r\n(also, i didn't make a minimal reproduction since this is just a new project with /pages/test.tsx``` added to it)\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "process.env is undefined in app directory", "description": "### Summary\n\nI am trying to create a contact form with emailjs in the experimental app directory.\r\n\r\nThis is my onSumbit function for the form:\r\n\r\n```tsx\r\nconst onSubmit = (e: FormEvent) => {\r\n    e.preventDefault();\r\n    emailjs\r\n      .sendForm(\r\n        process.env.SERVICE_ID,\r\n        process.env.TEMPLATE_ID,\r\n        form.current || \"\",    // 'form' is a RefObject from useRef for the form.\r\n        process.env.PUBLIC_KEY\r\n      )\r\n      .then(\r\n        (result) => {\r\n          toast(\"Message sent successfully!\");\r\n        },\r\n        (error) => {\r\n          toast(\"Message failed to send.\");\r\n        }\r\n      );\r\n  };\r\n```\r\n\r\nThis is inside the file `app/form.tsx`, this file also contains the UI component of the form.\r\n\r\nI keep getting the error: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.\r\n\r\nThe function seems to work and send emails when I hardcode the keys (which I can't do in production) but stops when due to the above mentioned error with process.env\r\n\r\nHow can I fix this?\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Test next/image src with Jest and react testing library", "description": "### What version of Next.js are you using?\r\n\r\n12.0.4\r\n\r\n### What version of Node.js are you using?\r\n\r\n16.13.1\r\n\r\n### What browser are you using?\r\n\r\n-\r\n\r\n### What operating system are you using?\r\n\r\nWindows (Docker Node.js devcontainer)\r\n\r\n### How are you deploying your application?\r\n\r\n-\r\n\r\n### Describe the Bug\r\n\r\nWhen testing a component that has the `next/image`\r\n\r\n```tsx\r\nimport {FC} from 'react';\r\nimport Img, {ImageProps} from 'next/image';\r\n\r\ntype ImgProps = {\r\n  full?: boolean;\r\n} & ImageProps;\r\n\r\nconst FullImage: FC<ImgProps> = ({full, ...rest}) => {\r\n  let props = {\r\n    ...rest,\r\n  };\r\n  // nice defaults for full img\r\n  if (full) {\r\n    props = {\r\n      objectFit: 'cover',\r\n      layout: 'fill',\r\n      ...props,\r\n    };\r\n  }\r\n  return props.layout == 'fill' ? (\r\n    <div className='relative h-full w-full'>\r\n      <Img {...props} />\r\n    </div>\r\n  ) : (\r\n    <Img {...props} />\r\n  );\r\n};\r\n\r\nexport default FullImage;\r\n```\r\n\r\n```tsx\r\nit('Adds correct src attribute', () => {\r\n  const alt = 'test-image';\r\n  const src = '/img/mock/shoes.png'; // I have tried with a url too\r\n  render(<Image src={src} alt={alt} width={100} height={100} />);\r\n\r\n  const img = screen.getByAltText(alt);\r\n  expect(img.getAttribute('src')).toBe(src);\r\n});\r\n```\r\n\r\nThe received `src` value is always `data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7`, for what I have seen, this value corresponds to the default applied by the [`next/image` component](https://github.com/vercel/next.js/blob/7e055dddbb5c686dcb8f07828a6bc95aa079d512/packages/next/client/image.tsx#L18) \r\n\r\n### Expected Behavior\r\n\r\nI expect the source to be `/__next/image`.. So I can then add a custom loader to prevent the default transformation performed by the `next/image` component.\r\n\r\n### To Reproduce\r\n\r\n1. Add jest tests with next.js config as stated in the next.js docs.\r\n2. Test a component that implements the `next/image` component.\r\n3. Pass any src to the next/image component"}
{"sentences": "How do I get an array of all pages within a certain directory?", "description": "I'm trying to make a static blog with local mdx articles. I'd like to show a navigation component with links to each article, without having to hard-code each link. Is that possible?"}
{"sentences": "ImageError: \"url\" parameter is valid but upstream response is invalid", "description": "### Link to the code that reproduces this issue\n\nhttps://codesandbox.io/p/devbox/mvp-image-error-upstream-response-is-invalid-rfwdwv\n\n### To Reproduce\n\nSimilar issue - https://github.com/vercel/next.js/issues/53715\r\nStill not resolved - you can make sure in that by scrolling down and find comment Nov 9 that this issue still persist in Next 14\r\n\r\nSteps to reproduce:\r\n1. Open [this](https://codesandbox.io/p/devbox/mvp-image-error-upstream-response-is-invalid-rfwdwv) codesandbox\r\n2. See error in console\r\n\r\n![image](https://github.com/vercel/next.js/assets/39565703/69467141-cff6-4975-8ab8-d8de30b9ef7c)\r\n\n\n### Current vs. Expected behavior\n\nI'm expecing no error\r\nI see error\n\n### Provide environment information\n\n```bash\nOperating System:\r\n  Platform: linux\r\n  Arch: x64\r\n  Version: #1 SMP PREEMPT_DYNAMIC Sun Aug  6 20:05:33 UTC 2023\r\nBinaries:\r\n  Node: 20.11.1\r\n  npm: 10.2.4\r\n  Yarn: 1.22.19\r\n  pnpm: 8.15.4\r\nRelevant Packages:\r\n  next: 14.1.4\r\n  eslint-config-next: 14.1.4\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 5.4.3\r\nNext.js Config:\r\n  output: N/A\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nImage optimization (next/image, next/legacy/image)\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext dev (local)\n\n### Additional context\n\nIf you run into similar issue - please vote up"}
{"sentences": "Heroku: Warning: No build cache found. Please configure build caching for faster rebuilds.", "description": "I'm receiving the above mentioned error message when deploying a build to heroku. I've checked the docs at [No Cache Detected](https://github.com/zeit/next.js/blob/master/errors/no-cache.md) but no configuration is available for heroku. \r\n\r\nHow do I resolve this?\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior, please provide code snippets or a repository:\r\n\r\n1. git subtree push --prefix app-name master\r\n\r\n## Expected behavior\r\n\r\nBuilds are currently taking an inordinate amount of time to complete. I expected the deploy to build without errors.\r\n\r\n## System information\r\n\r\n- OS: Windows 10 Pro\r\n- Version of Next.js: 9.3.5\r\n\r\n"}
{"sentences": "Where should I load a sitemap.xml and a robot.txt ... and can I view it?", "description": "So I generated a sitemap from xml-sitempas.com....   good deal, it works with Next...\r\n\r\nNow, where can I load it in the file system?   And can I view it? \r\n\r\nCould this be OK?  and can I view on the browser? \r\n\r\nROOT\r\n| Pages\r\n| Public\r\n  -  Sitemap.xml \r\n  - robot.txt \r\n    \r\n\r\n"}
{"sentences": "How to import SwiperJS module dynamically", "description": "In one of my projects, I am using [SwiperJS](https://swiperjs.com/react). Normally, the structure of importing it is given below:\r\n```\r\nimport { Swiper, SwiperSlide } from 'swiper/react';\r\nimport SwiperCore, { Pagination } from 'swiper/core';\r\n\r\nSwiperCore.use([Pagination]);\r\n\r\nconst MyComponent= (props) => (\r\n<Swiper ...>\r\n  <SwiperSlide>...</SwiperSlide>\r\n  <SwiperSlide>...</SwiperSlide>\r\n  <SwiperSlide>...</SwiperSlide>\r\n</Swiper ...>\r\n```\r\n\r\nNow I want to load this module dynamically. But I couldn't find out the proper way. Any suggestions on that?"}
{"sentences": "How to build about 1M static pages on vercel?", "description": "### Summary\r\n\r\n## Introduction:\r\n\r\nI'm making a doctor's appointment website. I've to build almost 1M pages. I need to create about one million pages for it. The website addresses will look like this:\r\n\r\n```\r\ncountry/city/doctor_specialization/condition\r\n```\r\n\r\nEvery address starts with the country. Each country can have many cities. In each city, there will be about 150 types of doctors (like dentists). And each type of doctor will deal with around 20 to 30 different health issues (like toothaches). So, just for five countries, we'll end up with one million pages.\r\n\r\n## Issue\r\n\r\nDuring development, the website functions properly, but when I deployed it to `Vercel`, the loading time became excessively slow, taking nearly 45 minutes, and eventually, the build failed unexpectedly without providing any specific reason.\r\n\r\n## Inquiry\r\n\r\nGiven that I'm dealing with one million pages, it appears unfeasible to accomplish this using a hobby plan, and it would consume a significant amount of storage. Could you offer some guidance on how to address this situation? My objectives for static site rendering are as follows:\r\n\r\n- Ensuring all pages are SEO-friendly.\r\n- Achieving faster content loading times within 2 seconds.\r\n\r\nIt's important to note that this project is intended for my university Final Year Project (FYP), and I don't necessarily need to achieve 100% perfection; I can settle for less.\r\n\r\n### Additional information\r\n\r\n```js\r\n\"next\": \"14.1.4\"\r\n\"router\": \"app-router\"\r\n```\r\n\r\n\r\n### Example\r\n\r\n```typescript\r\nexport async function generateStaticParams() {\r\n   return (new Array(1000000).fill(' ').map((_,i) => ({ slug: i }))\r\n}\r\n```"}
{"sentences": "handling 404 json after deployment", "description": "**Conditions** \r\n- next.config `target: server`\r\n- `getServerSideProps` return some dynamic data for `/test`\r\n\r\n**1st Release** \r\n- client navigation hits `/_next/data/buildID_1/test.json`\r\n\r\n**2nd Release** \r\n- client navigation hits `/_next/data/buildID_2/test.json`\r\n\r\nAfter the 2nd release, some of the clients may still run the first version, thus they request `/_next/data/buildID_1/test.json` which returns a 404 (I think this doesn't happen on serverless mode as the old lambda is still alive). The result is that the client navigation enforces a page reload and the new version is loaded.\r\n\r\nGiven this scenario, is the end user affected by any issue, except the full page reload? (i.e. any error or inconsistent state) \r\n\r\nIs there any way to handle these 404 responses more gracefully within the next server? For example intercepting these requests and returning an empty response to the client\r\n\r\n"}
{"sentences": "How to run Next Js application build (out) directory in local?", "description": "I have done development of Next Js application and as of now I have done auto deployment using https://vercel.com/\r\n\r\nThings are fine as of now.. But here came the requirement that I need to build the Next Js application and share the build folder with the team for deployment in server.\r\n\r\nThe commands I have followed,\r\n\r\n```npm run build``` &\r\n```npm run export```\r\n\r\nAnd the above one creates the ```out``` directory.. So how to run this out directory in my local machine to check whether the build folder is working as expected before sharing with the team?\r\n\r\nFolder structure of ```out``` directory:\r\n\r\n     -> out\r\n    \r\n          -> _next\r\n                 -> static\r\n                 -> xxxxxxxxxxxxx (some random name)\r\n          -> static\r\n          -> home.png\r\n          -> location.png\r\n\r\n\r\nSo anyone could kindly please help me how can I run this generated build folder (out) to check whether the developed Next Js application works fine in my local machine after which I can share the same built folder to the team?\r\n\r\nWhile using vercel things happen automatically whenever we push the code, it  deploy automatically, but I am not sure how actually deployment happen there.. In other frameworks we used to get the dist folder with index.html which makes easy to understand for deployment.\r\n\r\nI am in the need to confirm that build folder works fine in my local before sharing it with team for deployment. So for that I need to build and run the Next Js app in my local..\r\n"}
{"sentences": "Dsable the API Routes Response Size Limited warning", "description": "Hey guys.\r\n\r\nIs it possible to disable the warning for https://nextjs.org/docs/messages/api-routes-body-size-limit ?\r\n\r\n I am self-hosting my Next.js app and I don't care about the size limit and I also disabled the `bodyParser` from the API (so I can't use `bodyParser: { sizeLimit: \"5mb\" }` because I already have the `bodyParser: false`)."}
{"sentences": "Opening a web page that points to an app hosted on Vercel, downloads a file instead of opening the app", "description": "Hi!\r\n\r\nSomething very weird is going on with my website https://www.beginneritjobs.com.\r\n\r\nWhen I type the address in the browser's search bar or click the link in my social profiles, it initiates a download instead of opening the page.\r\n\r\n![image](https://user-images.githubusercontent.com/3111627/202398059-d36c4e08-b837-4577-93dd-ab1fc951bbcf.png)\r\n\r\nI have no idea what's causing this.\r\n\r\nThe file seems to be a special format that, at first sight, contains some information about my site - not the Google Tag manager that I have installed in <head>\r\n\r\n```\r\nM1:{\"id\":\"6507\",\"name\":\"\",\"chunks\":[\"193:193-3af0fc114aa86630\",\"791:app/skills/[slug]/page-06fc5656888cdf8f\"],\"async\":false}\r\nM2:{\"id\":\"3244\",\"name\":\"\",\"chunks\":[\"193:193-3af0fc114aa86630\",\"185:app/layout-04b89e0984a7f757\"],\"async\":false}\r\nM3:{\"id\":\"4090\",\"name\":\"\",\"chunks\":[\"193:193-3af0fc114aa86630\",\"791:app/skills/[slug]/page-06fc5656888cdf8f\"],\"async\":false}\r\nM4:{\"id\":\"9875\",\"name\":\"default\",\"chunks\":[\"272:webpack-055e237ba82c63fb\",\"17:17-976d5b38d52569cd\",\"744:main-app-5dbe79f35bd947e6\"],\"async\":false}\r\nM5:{\"id\":\"2092\",\"name\":\"default\",\"chunks\":[\"272:webpack-055e237ba82c63fb\",\"17:17-976d5b38d52569cd\",\"744:main-app-5dbe79f35bd947e6\"],\"async\":false}\r\nJ0:[[[\"\",{\"children\":[\"\",{}]},null,null,true],[[],[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cf0b799e0c0cc115.css\",\"precedence\":\"high\"}]],[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{\"children\":[[[\"$\",\"@1\",null,{\"strategy\":\"afterInteractive\",\"async\":true,\"src\":\"https://www.googletagmanager.com/gtag/js?\r\n```\r\n\r\nAny idea what's going on?"}
{"sentences": "Next/Image not found?", "description": "Can I use the Image component from a separate folder? When I use it in the Components folder, it says \"Module not found: Can't resolve 'next/image'\", and I can't figure out if it is the wrong folder, or something else."}
{"sentences": "state resets when transitioning route(page)", "description": "\r\ni recreated the problem in this [CodeSandbox][1]\r\n\r\nhttps://codesandbox.io/s/inspiring-pond-mp134?file=/context/cars-context.js\r\n\r\ni have two routes(pages)\r\n- `/` \r\n- `/car/info`\r\n\r\nand two components\r\n- Header\r\n- CarInput\r\n\r\ni used context to maintain the state and pass it to both the pages.\r\n\r\nwhen im in route `/car/info` and i change the state using input , the updated state gets displayed in Header component of the same route(page).\r\n\r\nBut when i go to `/` route(page) the state is not updated .i inspected using react dev tools and the context doesnt have the updated values . \r\n\r\nEven when i go back to `/car/info` , the updated state is not there too. As soon as i transition to `/` from `/car/info` the state goes back to intialState . \r\n\r\nSteps to recreate the same on sandbox\r\n\r\n 1. click on \"go to add car\"\r\n 2.  enter a car name in the input and click add\r\n 3. click on \"go to home\"\r\n \r\n Now you can see the car you added is not present there .\r\n\r\n\r\nContext Usage Pattern reference : https://kentcdodds.com/blog/how-to-use-react-context-effectively\r\n\r\n\r\n  [1]:https://codesandbox.io/s/inspiring-pond-mp134?file=/context/cars-context.js\r\n "}
{"sentences": "[Next 13] Make Loaders between Pages Transitions", "description": "## Old method\r\nThe old method to create a Loader between page transitions is:\r\n1. Create a File called `Folder.tsx`, and insert some code:\r\n```tsx\r\nimport { useEffect, useState } from 'react';\r\n\r\nconst Loader = () => {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleStart = () => setLoading(true);\r\n    const handleComplete = () => setLoading(false);\r\n\r\n    Router.events.on('routeChangeStart', handleStart);\r\n    Router.events.on('routeChangeComplete', handleComplete);\r\n    Router.events.on('routeChangeError', handleComplete);\r\n\r\n    return () => {\r\n      router.events.off('routeChangeStart', handleStart);\r\n      router.events.off('routeChangeComplete', handleComplete);\r\n      router.events.off('routeChangeError', handleComplete);\r\n    };\r\n  }, []);\r\n\r\n  return loading ? <div>Loading...</div> : null;\r\n};\r\n\r\nexport default Loader;\r\n```  \r\n2. After that, you can put that component inside your `_app.tsx`\r\n\r\nBut I can't figure out how to make this possible using Next 13 because `router.events.on` only runs in a server component\r\n\r\nIs there a new way to do that, our we have new updates on Roadmap?"}
{"sentences": "Handling Authentication with Next.js and Middleware Across Client-Side Navigations", "description": "### Summary\n\nI’m currently working on a course platform that has protected pages (courses and lessons).\r\n\r\nI’ve tried various strategies, but the one I’m currently using is middleware for authentication with HTTP Only Cookies, which works on a fresh page load, but not if using the <Link> Component as this one is pre-fetching and middleware is not running (even if I use the as prop).\r\n\r\nI’m aware that I could do a client-side authentication, but there is the saying, that all client-side auth is basically no protection.\r\n\r\nI’m also aware that I could use the <a> instead of the <Link> tag, but that would make the navigation flow way less smooth and Vercel doesn’t even allow me to build it without explicitly allowing it.\r\n\r\nI’ve been on this for a couple of hours now with various AI, Google and documentation, but I couldn’t find a proper solution that is secure, but also a good user experience.\r\n\r\nI’m wondering if I miss anything.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Text in Link causing hydration error", "description": "### Summary\n\nHello, I having hydration error whenever I put some text in nextjs Link tag, does anyone having this issue as well?\r\nHere is my code:\r\n` <div className=\"pb-3\">\r\n          <label className=\"block text-3xl font-bold mb-2 text-center\">\r\n            Create Exam\r\n          </label>\r\n\r\n          <label className=\"block text-lg mt-2\">Click</label>\r\n          <Link\r\n            suppressHydrationWarning={true}\r\n            download=\"Exam_Format\"\r\n            href={`/Exam_Format_Category.xlsx`}\r\n            target=\"_blank\"\r\n            className=\"text-blue-600 hover:underline cursor-pointer\"\r\n            contextMenu=\"Here\"\r\n            \r\n          >\r\n           Here\r\n          </Link>\r\n          <label className=\"block text-lg mt-2\">\r\n            to download the category format.\r\n          </label>\r\n        </div>`\n\n### Additional information\n\n```js\nJust remove the Here text and it worked normally.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "opengraph-image file url is NOT right, always start with localhost:3000", "description": "### Summary\n\nopengraph-image file's url always start with localhost:3000 after nextjs build, I can not find how to set it's host, need help!\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Fix for viewport height change on Chrome on Android", "description": "@DustinBrett and @icyJoseph, I've noticed your discussion about the viewport height change in issue https://github.com/vercel/next.js/issues/47839\r\n\r\nI've also encountered this issue, with the React-TypeScript Vite template.\r\n\r\nI just wanted to let you know that I found a fix: adding `interactive-widget=resizes-content` to the `viewport` meta tag.\r\n\r\n- This page has the problem: https://zwyx.github.io/chrome-android-clientheight/simple\r\n- This page is fixed: https://zwyx.github.io/chrome-android-clientheight/simple-fixed\r\n\r\nRead more about `interactive-widget` here: https://developer.chrome.com/blog/viewport-resize-behavior\r\n\r\nI still think this is a bug in Chrome, so I reported it. Read more at https://github.com/Zwyx/chrome-android-clientheight"}
{"sentences": "on `next/image`, hostname is not configured under images in your `next.config.js`", "description": "Why hostname error keep showing on the page even though I've implemented **next.config.js** on my  projects with domains on it.\r\n\r\n**The Config file**\r\n```\r\nmodule.exports = {\r\n  images: {\r\n    domains: ['https://image.tmdb.org/', 'https://api.themoviedb.org/'],\r\n  },\r\n};\r\n\r\n```\r\n\r\n// Page\r\n```\r\nimport React from 'react';\r\nimport Image from 'next/image';\r\n\r\nconst BrowseMovie = ({ browseMovie }) => {\r\n  return (\r\n    <div>\r\n      <h1>Movies</h1>\r\n      <div className=\"d-flex\">\r\n        {browseMovie.map((item) => {\r\n          return (\r\n            <div key={item.id} className=\"card-movie\">\r\n              <Image\r\n                src={`https://image.tmdb.org/t/p/w300${item.poster_path}`}\r\n                height={300}\r\n                width={300}\r\n                alt={item.title}\r\n              />\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport async function getStaticProps() {\r\n  const movies = await fetch(\r\n    `https://api.themoviedb.org/3/discover/movie?api_key=******&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=1`\r\n  );\r\n  const data = await movies.json();\r\n\r\n  return {\r\n    props: {\r\n      browseMovie: data.results,\r\n    },\r\n  };\r\n}\r\n\r\nexport default BrowseMovie;\r\n\r\n```\r\n\r\n\r\n"}
{"sentences": "Issue with Displaying Image in Next.js Application Using Image Component", "description": "### Summary\n\nHello fellow developers,\r\n\r\nI've encountered an issue while integrating the Next.js Image component into my application. Despite confirming that the image URL (imageURL) is valid and accessible, the image fails to render on the webpage. Below is the snippet of the code I've used:\r\n\r\n```\r\nimport Image from \"next/image\";\r\n\r\n<Image\r\n  src={imageURL}\r\n  width={48}\r\n  height={48}\r\n  alt=\"logo\"\r\n/>\r\n```\r\n\r\nI'm seeking insights or suggestions on what might be causing this issue. Could it be related to Next.js image optimization features or a potential misconfiguration in my Next.js setup? Any advice or troubleshooting tips would be greatly appreciated.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "In app router, server component, how can I get the current url (similar of window.location)", "description": "Im using App router.\r\nand have a place in my server component where I need to know the requested URL. \r\nIf I was in a client component, I could use window.location.origin.\r\n\r\nGPT offered me to try \r\nimport { useServerRequest } from 'next/navigation';\r\nbut looks like this is not a real thing. \r\nany suggestions? "}
{"sentences": "NextJS Router not mounted in Playwright?", "description": "### Summary\r\n\r\nWe have a NextJS application on the latest (14.1.4) which is using the **pages** method & pulls in a package built by us for handling intercom.\r\n\r\nWhen running the app in dev mode it works fine there are no errors also running playwright locally there are no errors.\r\n\r\nThe issue happens when we run playwright in the CI we are faced with this error:\r\n\r\n![screenshot](https://github.com/vercel/next.js/assets/3974301/c6a71719-4685-405e-bec5-b9a098733c6a)\r\n\r\nWhen I pull the component's code directly into the app and run the CI against it, it works?\r\n\r\nI get the feeling this is something todo with the fact we are using `useRouter` in a separate pacakge?\r\n\r\nit seems to be happening in the Server rendering phase not super sure what's going on here any ideas?\r\n\r\n### Code\r\n\r\nsnippet of the custom _app.tsx file:\r\n\r\n```tsx\r\n// _app.tsx\r\nimport { Intercom } from '@acme/intercom'; \r\n\r\nconst CustomApp = () => (\r\n   <>\r\n     <Intercom />\r\n   </>\r\n)\r\n```\r\n\r\nThe intercom component:\r\n\r\n```tsx\r\nimport { useRouter } from 'next/router';\r\nimport * as Sentry from '@sentry/nextjs';\r\nimport { useEffect, useState } from 'react';\r\nimport { intercomAppId } from './constants';\r\nimport { getCsrfToken } from '@zopauk/nextjs-auth';\r\n\r\ntype IntercomProps = {\r\n  appId?: string;\r\n};\r\n\r\ntype IntercomResponse = {\r\n  user_id?: string;\r\n  user_hash?: string;\r\n};\r\n\r\nexport const Intercom = ({ appId }: IntercomProps) => {\r\n  const { asPath } = useRouter(); // Has an issue here ??\r\n  const [booted, setBooted] = useState(false);\r\n  const [intercomResponse, setIntercomResponse] = useState<IntercomResponse | null>(null);\r\n\r\n  /**\r\n   * Define the default intercom settings\r\n   */\r\n  const defaultSettings: Intercom_.IntercomSettings = {\r\n    app_id: appId || intercomAppId,\r\n    api_base: 'https://api-iam.intercom.io',\r\n    session_duration: 5 * 60 * 1000, // 5 minutes\r\n  };\r\n\r\n  /**\r\n   * Update the Intercom chat widget\r\n   * when the user navigates between pages\r\n   */\r\n  useEffect(() => {\r\n    if (window?.Intercom && booted) {\r\n      window.Intercom('update', {\r\n        ...defaultSettings,\r\n        ...(intercomResponse || {}),\r\n      });\r\n    }\r\n  }, [asPath]);\r\n\r\n  /**\r\n   * Initialize Intercom\r\n   */\r\n  useEffect(() => {\r\n    if (booted || !window.Intercom) {\r\n      return;\r\n    }\r\n\r\n    const controller = new AbortController();\r\n    const signal = controller.signal;\r\n\r\n    getCsrfToken()\r\n      .then((token) =>\r\n        fetch('/api/intercom', {\r\n          signal: signal,\r\n          headers: {\r\n            'content-type': 'application/json;charset=UTF-8',\r\n            'x-csrf-token': token || '',\r\n          },\r\n        }),\r\n      )\r\n      .then((response) => response.json())\r\n      .then((data: IntercomResponse) => {\r\n        setIntercomResponse(data);\r\n        window.Intercom('boot', {\r\n          ...defaultSettings,\r\n          ...(data || {}),\r\n        });\r\n        Sentry.addBreadcrumb({\r\n          category: 'intercom',\r\n          message: 'Intercom booted successfully',\r\n          level: 'info',\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        setIntercomResponse({});\r\n        console.error('Error fetching intercom data', error);\r\n        Sentry.addBreadcrumb({\r\n          category: 'intercom',\r\n          message: 'Intercom api endpoint possibly not implemented',\r\n          level: 'error',\r\n        });\r\n        Sentry.captureException(error);\r\n        window.Intercom('boot', defaultSettings);\r\n      })\r\n      .finally(() => setBooted(true));\r\n\r\n    return () => {\r\n      controller.abort();\r\n      Sentry.addBreadcrumb({\r\n        category: 'intercom',\r\n        message: 'Intercom shutdown successfully',\r\n        level: 'info',\r\n      });\r\n      window.Intercom('shutdown');\r\n      setIntercomResponse(null);\r\n      setBooted(false);\r\n    };\r\n  }, []);\r\n\r\n  return null;\r\n};\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "<Link/> sometime stop working with app router in production", "description": "I am till learning nextjs.\r\nI was hoping to get a bit of insight into a bug I'm experiencing with my nextjs application. Every once and a while all the links on my page seem to stop working.\r\n\r\nIf I hover over the links I can see the expected page in the bottom left of my browser but clicking doesn't navigate to the page and the url doesn't change too. After a refresh or wait a short period of time , the links usually start working again but it definitely a huge hit to usability for the average user.\r\n\r\nHas anyone experienced a similar issue/ have any insight as to what might be causing this to occur?\r\n\r\nAny help is greatly appreciated :)"}
{"sentences": "How to view documentation from previous version", "description": "As far as I can tell there's no version switcher in the documentation. I'm working with an app using Next version 7 and I want to keep changes minimal as a rewrite occurs in a different branch. What's the best way to go back and look at the documentation as it applies to version 7 of Next.js?"}
{"sentences": "Client side navigation not working even on a brand new empty barebones project (App router)", "description": "### Summary\r\n\r\nSince yesterday, client side navigation for all projects under my account have stopped working (for new commits) when deployed to Vercel. **It works fine on the local dev server. It also works fine if running as a production optimised build locally (```npm run build``` and then ```npm run start```)**.\r\n\r\nI've created a sample barebones project below to demonstrate the issue on Vercel. If you click the 'add background colour' button, the background colour is lost between page navigations (on dev the page colour is preserved). You can also observe the behaviour by looking at the network tab in chrome inspector.\r\n\r\nThis issue has affected all projects on my account. I don't know if this is particular to my account or a more general issue with client side routing configuration on Vercel. Given that both the dev and prod builds run fine locally, I have my suspicious there is a configuration issue for my apps on Vercel servers.\r\n\r\n**Steps to Reproduce**\r\nOpen the link and click on the add background color button. Then navigate between routes. If client side navigation was occuring, the background color should remain yellow (works fine when running locally on the dev server). On production however, you can see that a full page refresh occurs and the colour is cleared (you can also see this with dev console open and in the network tab, you can see a full page refresh is occurring when navigating between routes).\r\n\r\n**Git repo here:**\r\nhttps://github.com/romiem/nextjs-nav\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nhttps://nextjs-nav-sable.vercel.app/"}
{"sentences": "Error occurred prerendering page \"/\". Deployment Error on Vercel", "description": "I am trying to deploy my site via Vercel and while generating static pages, it throws the below error in logs\r\n\r\n```\r\ninfo  - Generating static pages (0/6)\r\nError occurred prerendering page \"/\". Read more: https://nextjs.org/docs/messages/prerender-error\r\nError: Minified React error #130; visit https://reactjs.org/docs/error-decoder.html?invariant=130&args[]=undefined&args[]= for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at a.b.render (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.node.production.min.js:45:32)\r\n    at a.b.read (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.node.production.min.js:41:83)\r\n    at Object.exports.renderToString (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.node.production.min.js:52:138)\r\n    at Object.renderPage (/vercel/path0/node_modules/next/dist/server/render.js:686:46)\r\n    at Object.defaultGetInitialProps (/vercel/path0/node_modules/next/dist/server/render.js:316:51)\r\n    at Function.getInitialProps (/vercel/path0/.next/server/pages/_document.js:514:20)\r\n    at Object.loadGetInitialProps (/vercel/path0/node_modules/next/dist/shared/lib/utils.js:69:29)\r\n    at renderDocument (/vercel/path0/node_modules/next/dist/server/render.js:699:48)\r\n    at renderToHTML (/vercel/path0/node_modules/next/dist/server/render.js:774:34)\r\n    at async /vercel/path0/node_modules/next/dist/export/worker.js:273:36\r\ninfo  - Generating static pages (1/6)\r\n[]\r\ninfo  - Generating static pages (2/6)\r\ninfo  - Generating static pages (4/6)\r\ninfo  - Generating static pages (6/6)\r\n> Build error occurred\r\nError: Export encountered errors on following paths:\r\n    /\r\n    at /vercel/path0/node_modules/next/dist/export/index.js:500:19\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:74:20)\r\n    at async /vercel/path0/node_modules/next/dist/build/index.js:987:17\r\n    at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:74:20)\r\n    at async /vercel/path0/node_modules/next/dist/build/index.js:861:13\r\n    at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:74:20)\r\n    at async Object.build [as default] (/vercel/path0/node_modules/next/dist/build/index.js:82:25)\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nError: Command \"yarn run build\" exited with 1\r\n```\r\n\r\nI've tried to fix it by using the Prerender error guide Next.js provided but still wasn't able to fix it.\r\n\r\nMy `pages` directory structure is below\r\n\r\n```\r\n📦pages\r\n ┣ 📂api\r\n ┃ ┣ 📂auth\r\n ┃ ┃ ┗ 📜[...nextauth].js\r\n ┃ ┗ 📜hello.js\r\n ┣ 📂auth\r\n ┃ ┗ 📜signin.js\r\n ┣ 📂[postRoute]\r\n ┃ ┗ 📂[currentPost]\r\n ┃ ┃ ┗ 📜index.js\r\n ┣ 📜dashboard.js\r\n ┣ 📜edit.js\r\n ┣ 📜index.js\r\n ┗ 📜_app.js\r\n```\r\n\r\nAnd this is my `index.js` file\r\n```javascript\r\nimport Head from \"next/head\"\r\nimport Contribution from \"../components/Contribution\"\r\nimport Features from \"../components/Features\"\r\nimport Footer from \"../components/Footer\"\r\nimport Header from \"../components/Header\"\r\nimport Landing from \"../components/Landing\"\r\nimport SubFooter from \"../components/SubFooter\"\r\nimport styles from \"../styles/Home.module.scss\"\r\n\r\nexport default function Home() {\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>Skill Up | Credit Based Learning</title>\r\n        <link rel=\"icon\" href=\"/favicon.ico\" />\r\n      </Head>\r\n      <div className={styles.container}>\r\n        <Header />\r\n        <Landing />\r\n        <hr />\r\n        <Features />\r\n        <Contribution />\r\n        <SubFooter />\r\n        <Footer />\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n```\r\n\r\nAny help would be appreciated!"}
{"sentences": "Does Caching function work if I use Axios Library on Next.js- Next.js14", "description": "### Summary\n\nNext.js Version: 14.x & Using Library: Axios\r\n\r\nI understood when I use fetch (get method) on Next.js, caching function is working.\r\nI wonder caching would work or not if I use Axios.\r\n\r\nThank you for reading my Question \n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "defer -> async of next scripts caused a page speed drop", "description": "We recently upgraded our next.js stack from 9.1.4 to 9.2.2, and everything was looking great until we noticed a meaningful dip in our page speed score and our First Contentful Paint metric. \r\n \r\n![Screen Shot 2020-03-16 at 3 54 43 PM](https://user-images.githubusercontent.com/59754/76796177-45ffa980-67a1-11ea-8bfb-9f0a668c2e30.png)\r\n\r\n![Screen Shot 2020-03-16 at 3 55 19 PM](https://user-images.githubusercontent.com/59754/76796190-4c8e2100-67a1-11ea-9476-f67af98984db.png)\r\n\r\nLast September (represented by the yellow line) we enabled the `deferScripts` experiment with great success and was happy to see `defer`  become the default https://github.com/Timer/next.js/commit/2757826cf75e75ddbcb2d4f57800da2fb0563346 so that we wouldn't need to keep the \"experiment\".  But then the default was switched back to `async` https://github.com/zeit/next.js/pull/10143/commits/32c390a91937698557925270e7734eb20a932546 and since the experiment had been stripped out, we no longer have a means to opt-in to using `defer`.\r\n\r\nAccording to https://github.com/zeit/next.js/pull/10143#issuecomment-578895258 it was after investigations and recommendation of the Chrome team, but I'd love to better understand what that investigation yielded and why `async` is the better alternative, particularly since it has an adverse affect on page speed.\r\n\r\nCould we get the `deferScripts` experiment back?"}
{"sentences": "bodyparser does not work in nextjs 13.3.0", "description": "### Summary\n\nhi. this is my route for sigin. but the body is not parsed and it content is like : { stream: undefined, source: null, length: null }\r\napi/signin/route.ts\r\n```\r\nexport function POST(req, res) {\r\n  console.log(req);\r\n  NextResponse.json({ name:req.body.username });\r\n}\r\n```\r\ni am sure the data is sent correctly with Content-Type:'application/json' header . the problem  is with body parser but i do not know have to fix it.\r\ni already try to export default this code in my route.ts,\r\n```\r\nexport const config = {\r\n  api: {\r\n    bodyParser: true,\r\n  },\r\n};\r\n```\r\n but this does not solve the problem.\r\nany body can help me here?\r\nthanks.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error: Unable to find any supported Python versions.", "description": "### Summary\n\nI'm trying to deploy a Next.js app with a Python (Flask) app for the API. I had a Pipfile defining the Python version as:\r\n\r\n```\r\n[requires]\r\npython_version = \"3.9\"\r\n```\r\n\r\nOnce I uploaded an index.py (it was named app.py before and therefore it was ignored), the deployment started crashing with the message \r\n\r\n`Error: Unable to find any supported Python versions.`\r\n\r\nI already tried:\r\n\r\n - Deleting the Pipfile to force the default Python version.\r\n - Creating a vercel.\r\n -  Renaming index.py to test-index.py trying to ignore the Python part.\r\n\r\nBut since then, I'm experiencing the same issue.\r\n\r\nI deployed the Next.js + Flask example and it worked correctly. I compared both codes and they seem similar except for the Next.js version, 13 vs 14 (the one that I'm using).\r\n\r\nAny idea?\n\n### Additional information\n\n```js\nAttention: Next.js now collects completely anonymous telemetry regarding usage.\r\nThis information is used to shape Next.js' roadmap and prioritize features.\r\nYou can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\nhttps://nextjs.org/telemetry\r\n   ▲ Next.js 14.1.3\r\n   Creating an optimized production build ...\r\n ✓ Compiled successfully\r\n   Linting and checking validity of types ...\r\n   Collecting page data ...\r\n   Generating static pages (0/10) ...\r\n\r\n   Generating static pages (2/10) \r\n\r\n   Generating static pages (4/10) \r\n\r\n   Generating static pages (7/10) \r\n\r\n ✓ Generating static pages (10/10) \r\n   Finalizing page optimization ...\r\n   Collecting build traces ...\r\nRoute (app)                              Size     First Load JS\r\n┌ ○ /                                    292 B          96.4 kB\r\n├ ○ /_not-found                          884 B          85.2 kB\r\n├ ○ /dashboard                           294 B          89.7 kB\r\n├ ○ /dashboard/customers                 142 B          84.5 kB\r\n├ λ /dashboard/invoices                  2.6 kB         98.7 kB\r\n├ λ /dashboard/invoices/[id]/edit        2.32 kB        93.4 kB\r\n├ ○ /dashboard/invoices/create           2.49 kB        93.6 kB\r\n└ ○ /login                               2.4 kB         91.8 kB\r\n+ First Load JS shared by all            84.3 kB\r\n  ├ chunks/226-1b616a692c28ce3f.js       29 kB\r\n  ├ chunks/264cdcf9-80423fecefc79146.js  53.4 kB\r\n  └ other shared chunks (total)          1.94 kB\r\nƒ Middleware                             72.8 kB\r\n○  (Static)   prerendered as static content\r\nλ  (Dynamic)  server-rendered on demand using Node.js\r\nTraced Next.js server files in: 59.07ms\r\nCreated all serverless functions in: 3.548s\r\nCollected static files (public/, static/, .next/static): 5.757ms\r\nError: Unable to find any supported Python versions.\r\nLearn More: http://vercel.link/python-version\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "[SERVER ACTIONS] No digest number on error in production", "description": "### Summary\n\nThere are so many posts related to the best way of displaying the error message on the UI instead of the generated message and digest number, but my case is a bit different. I am totally okay with showing only the digest number on the UI, but there is a problem—the number is absent in server logs but appears on the UI.\r\n\r\n\r\nServer action pretty simple:\r\n```\r\n'use server';\r\nexport async function postPaymentAction() {\r\n  try {\r\n    // @ts-ignore\r\n    await fakeFun(); //<= error here\r\n  } catch (error) {\r\n    throw new Error(error);\r\n  }\r\n}\r\n```\r\n\r\nClient component: \r\n\r\n```\r\n\"use client\";\r\n\r\nimport { postPaymentAction } from \"@/actions/postPayment\";\r\nimport { Button } from \"@shared/components\";\r\nimport { useMutation } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport default function PaymentPage() {\r\n  const { mutate, isPending } = useMutation({\r\n    mutationFn: () => postPaymentAction(),\r\n    onError: (error: Error & { digest?: string }) => {\r\n      toast.error(\"An error occurred on the Server. Error id:\" + error.digest);\r\n    },\r\n  });\r\n\r\n  return (\r\n    <Button intent={\"main\"} onClick={() => mutate()}>\r\n      Pay Now\r\n    </Button>\r\n  );\r\n}\r\n```\r\n\r\nWhat UI shows: \r\n![image](https://github.com/vercel/next.js/assets/5477308/235abd0f-4371-4f40-963a-7530cc29d8bd)\r\n\r\nWhat in server logs: \r\n\r\n```\r\nError: ReferenceError: postPaymentt is not defined\r\n    at a (path-to-project/.next/server/app/payment/[payment_id]/page.js:1:3250)\r\n    at a (path-to-project/.next/server/app/payment/[payment_id]/page.js:1:2333)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async path-to-project/node_modules/next/dist/compiled/next-server/app-page.runtime.prod.js:16:406\r\n    at async rm (path-to-project/node_modules/next/dist/compiled/next-server/app-page.runtime.prod.js:15:6342)\r\n    at async rq (path-to-project/node_modules/next/dist/compiled/next-server/app-page.runtime.prod.js:18:1249)\r\n    at async doRender (path-to-project/node_modules/next/dist/server/base-server.js:1376:30)\r\n    at async cacheEntry.responseCache.get.routeKind (path-to-project/node_modules/next/dist/server/base-server.js:1537:28)\r\n    at async NextNodeServer.renderToResponseWithComponentsImpl (path-to-project/node_modules/next/dist/server/base-server.js:1445:28)\r\n    at async NextNodeServer.renderPageComponent (path-to-project/node_modules/next/dist/server/base-server.js:1842:24)\r\n```\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Can't run tests locally because of swc error", "description": "### Summary\n\nWhen running tests locally i get `invalid type: map, expected a string at line 1`, which is an error thrown by swc when trying to compile the tests files for jest\r\n\r\n```\r\ntest/e2e/app-dir/use-params/use-params.test.ts\r\n  ● Test suite failed to run\r\n\r\n    invalid type: map, expected a boolean at line 1 column 758\r\n\r\n      1403 |         }\r\n      1404 |\r\n    > 1405 |         return bindings.transformSync(\r\n           |                         ^\r\n      1406 |           isModule ? JSON.stringify(src) : src,\r\n      1407 |           isModule,\r\n      1408 |           toBuffer(options)\r\n\r\n      at Object.transformSync (../packages/next/src/build/swc/index.ts:1405:25)\r\n      at transformSync (../packages/next/src/build/swc/index.ts:1522:19)\r\n      at Object.process (../packages/next/src/build/swc/jest-transformer.ts:104:25)\r\n      at ScriptTransformer.transformSource (../node_modules/.pnpm/@jest+transform@29.7.0/node_modules/@jest/transform/build/ScriptTransformer.js:545:31)\r\n      at ScriptTransformer._transformAndBuildScript (../node_modules/.pnpm/@jest+transform@29.7.0/node_modules/@jest/transform/build/ScriptTransformer.js:674:40)\r\n      at ScriptTransformer.transform (../node_modules/.pnpm/@jest+transform@29.7.0/node_modules/@jest/transform/build/ScriptTransformer.js:726:19)\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "bundle-analyzer, The term 'ANALYZE=true' is not recognized as the name of a cmdlet, function, script file, or operable program.", "description": "### What version of Next.js are you using?\n\n10.2\n\n### What version of Node.js are you using?\n\n14.7.1\n\n### What browser are you using?\n\nChrome\n\n### What operating system are you using?\n\nWindows\n\n### How are you deploying your application?\n\nVercel\n\n### Describe the Bug\n\nI'm trying to get the bundle analyzer working with a blog I'm working on.  I'm following the steps listed at the [@next/bundle-analyzer](https://www.npmjs.com/package/@next/bundle-analyzer)\r\n\r\nWhen i run `ANALYZE=true yarn build`\r\n\r\nI get the following error message\r\n\r\nANALYZE=true : The term 'ANALYZE=true' is not recognized as the name of a    \r\ncmdlet, function, script file, or operable program. Check the spelling of    \r\nthe name, or if a path was included, verify that the path is correct and     \r\ntry again.\r\nAt line:1 char:1\r\n+ ANALYZE=true yarn build\r\n+ ~~~~~~~~~~~~\r\n    + CategoryInfo          : ObjectNotFound: (ANALYZE=true:String) [], Com  \r\n   mandNotFoundException\r\n    + FullyQualifiedErrorId : CommandNotFoundException\r\n\r\nThis is most likely a windows config issue as it seemed similar to this  [stack overflow thread](https://stackoverflow.com/questions/35810172/webpack-is-not-recognized-as-a-internal-or-external-command-operable-program-or) which had fixed issues I had with another project and build analyzer.\r\n\r\nIf any windows dev out there has tips would be much appreciated.  Thanks.\n\n### Expected Behavior\n\nThe bundle analyzer should popup.\n\n### To Reproduce\n\nYou install this [project](https://github.com/bayswaterpc/bayswaterpc-superplate-blog) and try running `ANALYZE=true yarn build` on a windows machine, I assume it will be the same"}
{"sentences": "Certain CSS styles not being applied when deployed on Vercel", "description": "### Summary\n\nDear fellow devs,\r\n\r\nI have deployed a Next.js project on Vercel but noticed that some css styles are not being applied, primarily flex related styles.\r\n\r\nFor example,\r\nI have this in my local dev (running 'npm run dev'):\r\n![image](https://github.com/vercel/next.js/assets/86616844/6f770303-9a11-4f8a-821f-37cc6b02c0ce)\r\n\r\nso essentially there is a display: flex and justify-content: space-between for the component\r\n<img width=\"434\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/86616844/3f6c8d34-2d5e-4c82-b56a-ebd82c71a549\">\r\n\r\nbut after deployed (or 'npm run build' and then 'npm run start'):\r\n![image](https://github.com/vercel/next.js/assets/86616844/d5a7c795-f142-4bee-9769-8781754ad0bd)\r\n\r\nthe display: flex is missing when inspected:\r\n![image](https://github.com/vercel/next.js/assets/86616844/71a0914f-6a19-42a7-975a-d8fc77ff60b2)\r\n\r\nWondering if anybody has encountered this before or knows the cause and how it can be solved. You may use this link https://github.com/yijiuntay/memory-game to clone the project and try to reproduce.\r\n\r\nThanks in advance ❤\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/yijiuntay/memory-game"}
{"sentences": "How to handle errors in ServerActions", "description": "### Summary\n\nI'm playing with ServerActions, but I'm having trouble to deal with error on ServerSide. Is there a way to return any value to the client when something goes wrong on the server?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Deployed NextJS app's API returns 404", "description": "Hey everyone,\r\nSo I've been struggling with this for past day and can't figure out why when I try to make a POST request to my API endpoint it keeps on returning 404 when the application is deployed on Vercel - it works perfectly fine locally.\r\nI went through all [checks](https://vercel.com/guides/why-does-my-serverless-function-work-locally-but-not-when-deployed) and sorted them out if there were any on why my Serverless Function might not work and I still get the same issue.\r\n\r\nAny idea why else could this happen?\r\n\r\nFront-end is sending a `Blob` through `FormData` to back-end which then uses `formidable` to parse the file and perform side-effects with it. App is in **Turborepo**."}
{"sentences": "Next 13.4.1 : Images, Js and Css not loading after build. Shows 404 for all", "description": "### Summary\r\n\r\nI'm trying to deploy my next 13 app. I don't see any errors while building. When I try to load the app, only HTML shows up, and it shows 404 error for Js, Css and images(as seen in the network tab).\r\n\r\nIts trying to load from _next folder by default (and this path does not exist)\r\nEg: http://localhost:3000/_next/static/chunks/522-b7eb9fb4e38abfae.js\r\n\r\nAnd images directly\r\nEg: http://localhost:3000/assets/login.png\r\n\r\nUnfortunately I can't post the src code.\r\nI have tried everything. Any help is appreciated.\r\n\r\n### Additional information\r\n\r\n```js\r\nFolder structure\r\n\r\nMy-app\r\n|_ public\r\n  |_ assets/\r\n    |_[all my images]\r\n|_ nodemodules\r\n|_ .next\r\n|_ out\r\n|_ src\r\n  |_ app\r\n|_ Dockerfile\r\n|_ next.config.js\r\n|_ package.json\r\n```\r\n\r\nBelow are the scripts using\r\n\r\nnext.config.js\r\n```\r\nmodule.exports = {\r\n  basePath: \"\",\r\n  output: \"standalone\",\r\n  experimental: {\r\n    appDir: true,\r\n  },\r\n  images: {\r\n    domains: [\r\n      \"localhost\",\r\n      \"localhost:3001\",\r\n      \"my-exapmle-domain.com\",\r\n    ],\r\n  },\r\n};\r\n```\r\n\r\ndockerfile\r\n```\r\n#Using a different image, below is just an example\r\nFROM node:16_alpine-3.16 AS prebuild\r\n\r\nUSER root\r\n\r\nWORKDIR /app\r\n\r\nARG env \r\nENV NODE_ENV=${env}\r\n\r\nRUN apk add --no-cache libc6-compat\r\nRUN apk add --update npm\r\n\r\nCOPY package.json ./\r\nCOPY package-lock.json ./\r\nRUN npm i --legacy-peer-deps\r\n\r\nCOPY . .\r\n\r\nRUN npm run build\r\n\r\n#Using a different image, below is just an example\r\nFROM node:16_alpine-3.16\r\n\r\nUSER root\r\n\r\nWORKDIR /app\r\n\r\nENV NEXT_TELEMETRY_DISABLED 1\r\nENV UID=10101\r\nENV GID=10101\r\n\r\n## create & switch to non-root user\r\nRUN apk add shadow\r\nRUN /usr/sbin/groupadd -g ${GID} docker\r\nRUN /usr/sbin/useradd -s /bin/sh -g ${GID} -u ${UID} limsuinext\r\n\r\nUSER 10101\r\n\r\nCOPY --from=prebuild /app/next.config.js ./\r\nCOPY --from=prebuild /app/package.json ./package.json\r\nCOPY --from=prebuild /app/.next ./.next\r\nCOPY --from=prebuild /app/node_modules ./node_modules\r\nCOPY --from=prebuild /app/public/ ./public\r\n\r\n\r\nCOPY --from=prebuild --chown=10101 /app/.next/standalone ./\r\nCOPY --from=prebuild --chown=10101 /app/.next/static ./.next/static\r\nCOPY --from=prebuild --chown=10101 /app/.next/static ./.next/standalone/static\r\nCOPY --from=prebuild --chown=10101 /app/.next/out ./.next/standalone/out\r\n\r\n\r\n# Fire up node server\r\nENV PORT 3001\r\nEXPOSE 3001\r\n# CMD [\"node\", \".next/standalone/server.js\"]  Old approach\r\nCMD [\"node\", \"server.js\"]\r\n```\r\n\r\npackage.json\r\n```\r\nname: \"my-app\",\r\nversion: \"0.1.0\",\r\nprivate: true,\r\nscripts: {\r\n    \"dev\": \"PORT=3001 npx next dev\",\r\n    \"build\": \"npx next build\",\r\n    \"start\": \"PORT=3001 next start\",\r\n    \"lint\": \"next lint\"\r\n},\r\ndependencies: {...},\r\ndevDependencies: {...}\r\n```\r\n\r\n\r\n\r\n"}
{"sentences": "Get static page nested in dynamic page with Link", "description": "### Summary\r\n\r\nI have trouble finding a way to use Link to go to a static page within a dynamic folder. The idea of this is that you need the ID information to enter the main app, and inside there it is a menu which leads to static informational pages such as \"about\". I have tried a couple of things, but I cannot seem to find a way to make it work.. \r\n\r\nMy folders are as following: \r\n\r\nApp/dictionary/[id]\r\n\r\nWhen I click on one of the menu links, I come to this: \r\n\r\nApp/dictionary/[id]/about\r\n\r\nBut when I click on another one after opening the menu again, I go here: \r\n\r\nApp/dictionary/[id]/about/discord \r\n\r\n...which is not what I want. I need it to replace /about before going to the next one. \r\n\r\nAdditionally I use the current pathname to get it to go to those pages. (Which is essentially causing the problem..) but I cannot fins out how else I would do it with Link and the App Router.. \r\n\r\nPlease someone guide me in the right direction. \r\n\r\n![Screenshot_20240308_174131_Chrome](https://github.com/vercel/next.js/assets/116062049/5be42c5c-bb36-4cdf-8614-99bf5f890fe6)\r\n![Screenshot_20240308_174145_Chrome](https://github.com/vercel/next.js/assets/116062049/9c1d1d26-e8b9-4c0d-ab0f-f5b18ba86f99)\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\n//the menu outside of the app folder: \r\n\r\n'use client'\r\nimport styles from './tapMenu.module.css';\r\nimport { motion } from 'framer-motion';\r\nimport Footer from '../footer/footer';\r\nimport Link from 'next/link';\r\nimport { useRouter, usePathname, useSearchParams  } from 'next/navigation';\r\n\r\nconst menuItems = [\r\n    { name: \"Discord\", link: \"/discord\" },\r\n    { name: \"Guide\", link: \"\" },\r\n    { name: \"About Us\", link: \"/about\" },\r\n]\r\n\r\nexport default function TapMenu({ showMenu }) {\r\n  const router = useRouter()\r\n  const pathname = usePathname()\r\n  const searchParams = useSearchParams()\r\n\r\n\r\n    return (\r\n        <motion.section\r\n            className={styles.menuContainer}\r\n            initial={{ width: 0 }}\r\n            animate={{ width: showMenu ? \"42%\" : \"0%\" , transition: {type: showMenu ? \"spring\" : \"\", delay: showMenu ? \"\" : 0.2}}}>\r\n              <div className={styles.menuGrid}>\r\n                <motion.div\r\n                \r\n                initial={{ opacity: \"0%\" }}\r\n                animate={{ opacity: showMenu ? \"100%\" : \"0%\", transition: {delay: showMenu ? 0.2 : \"\"}}}>\r\n                  <div className={styles.menuItems}>\r\n                  {menuItems.map((item, index) => (\r\n                      <Link key={index} \r\n                        href={{ pathname: pathname + item.link}}\r\n                        prefetch={true}>\r\n                          <h3>{item.name}</h3>\r\n                      </Link>\r\n                  ))}\r\n                  <Link\r\n                    href={\"/menu\"}\r\n                    replace={true}\r\n                    prefetch={true}>\r\n                    <h3>Change Game</h3>\r\n                  </Link>\r\n                  <Link\r\n                    className={styles.randomCardButton}\r\n                    href={\"\"}\r\n                    prefetch={true}>\r\n                    <h2>Show me some Magic!</h2>\r\n                    <div>show a random card</div>\r\n                  </Link>\r\n                  <Link\r\n                    className={styles.privacyPolicy}\r\n                    href={{\r\n                      pathname: pathname + \"/policy\",\r\n                      }}\r\n                    prefetch={true}>\r\n                    <h4>Privacy Policy</h4>\r\n                  </Link>\r\n                </div>\r\n              </motion.div>\r\n                <div className={styles.menuFooter}>\r\n                  <Footer/>\r\n                </div>\r\n            </div>\r\n        </motion.section>\r\n    );\r\n}\r\n\r\n\r\n\r\n//One of the dynamic files that is a child of a layout with the menu in it. \r\n'use client'\r\nimport styles from \"./mainLayout.module.css\"\r\nimport { useEffect, useState } from 'react';\r\nimport { fetchGameList, createNewListToFilter } from \"@/DB/database.js\"\r\nimport Filter from \"@/components/filter/filter\";\r\nimport { usePathname } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport './dictionary.css'\r\n\r\nexport default function Dictionary({ params }) {\r\n  const [list, setList] = useState([]);\r\n  const [filteredItems, setFilteredItems] = useState([]);\r\n  const [selectedFilter, setSelectedFilter] = useState(null);\r\n  const pathname = usePathname()\r\n\r\n  const displayedList = selectedFilter ? filteredItems : list;\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const result = await fetchGameList({slug: params.id});\r\n        setList(result);\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [params.id]);\r\n\r\n  \r\n\r\n  useEffect(() => {\r\n    const filterList = async () => {\r\n      try {\r\n        const result = await createNewListToFilter({ list: list, filter: selectedFilter });\r\n        setFilteredItems(result);\r\n      } catch (error) {\r\n        console.error(\"Error filtering data:\", error);\r\n      }\r\n    };\r\n  \r\n    filterList();\r\n  }, [list, selectedFilter]);\r\n\r\n  const handleFilterChange = (filter) => {\r\n    setSelectedFilter(filter);\r\n  };\r\n\r\n\r\n  const renderItemsByLetter = () => {\r\n    const itemsByLetter = {};\r\n\r\n    displayedList.forEach((item) => {\r\n      const firstLetter = item.name.charAt(0).toUpperCase();\r\n      if (!itemsByLetter[firstLetter]) {\r\n        itemsByLetter[firstLetter] = [];\r\n      }\r\n      itemsByLetter[firstLetter].push(item);\r\n    });\r\n\r\n\r\n    return Object.keys(itemsByLetter).map((letter) => (\r\n      <div key={letter} className={styles.listGroup}>\r\n        <h3 className={styles.sortedLetter}>{letter}</h3>\r\n        {itemsByLetter[letter].map((item) => (\r\n          <div key={item.id} className={styles.list}>\r\n              <Link\r\n                href={`${pathname}/word/${item.id}`}>\r\n                <div className={styles.name}>{item.name}</div>\r\n              </Link>\r\n            <div className={styles.description}>{item.description}</div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    ));\r\n  };\r\n\r\n  return (\r\n    <section>\r\n      <div className={styles.searchBar}>\r\n        <input \r\n          className={styles.inputSearch}\r\n          type=\"search\" \r\n          placeholder=\"SEARCH\" />\r\n        <Filter onFilterChange={handleFilterChange} />\r\n      </div>\r\n\r\n      <div className={styles.content}>\r\n        {renderItemsByLetter()}\r\n      </div>\r\n    </section>\r\n  );\r\n}\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Issue with hosting an app on vercel", "description": "### Summary\n\nAny idea how to get rid of this error?\r\n\r\n![image](https://github.com/vercel/next.js/assets/41730664/3b6363fe-5e6a-4065-8998-098d0dec1f18)\r\n\r\nLocally, everything looks great, hosting on vercel has become complicated\r\n\r\nthanks\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Image component doesn't work with Google profile images urls", "description": "### Summary\r\n\r\nHello, I've been experiencing an issue with this which I could not figure out why... When trying to add Google's profile image storage as a remote pattern it always says it's not configured when using it.\r\n\r\nMy next-config:\r\n\r\n```js\r\n{\r\n  images: {\r\n    remotePatterns: [\r\n      {\r\n         protocol: \"https\",\r\n         hostname: \"*.googleusercontent.com\",\r\n         port: \"\",\r\n         pathname: \"*\",\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nI also tried with `lh3.googleusercontent.com` which is the full address but it still doesn't work. Also, I am worried that if Google for some reason changes this hostname in the future my app will crash.\r\n\r\nAm I doing something wrong or do I have no other option but to use the regular <img> tag?\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How run next.js with node-sharp for docker", "description": "**I have a problem implementing sharp for Dockerfile.** \r\n\r\n**Error: 'sharp' is required to be installed in standalone mode for the image optimization to function correctly**\r\n\r\nNext.js with sharp works fine for local developing:\r\n - next 12.0.1\r\n - sharp 0.30.2\r\n - node 16.xx\r\n - npm 8.xx\r\n - OS - macOS Monterey - 12.2.1, M1 PRO\r\n\r\n**next.config.js**\r\n\r\n    module.exports = {\r\n      experimental: {\r\n        outputStandalone: true,\r\n      },\r\n\r\n}\r\n\r\n**Dockerfile:**\r\n\r\n    FROM node:16-alpine AS deps\r\n    # Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.\r\n    RUN apk add --no-cache libc6-compat\r\n    \r\n    WORKDIR /app\r\n    COPY package.json package-lock.json ./ \r\n    RUN npm ci\r\n    \r\n    # Rebuild the source code only when needed\r\n    FROM node:16-alpine AS builder\r\n    WORKDIR /app\r\n    COPY --from=deps /app/node_modules ./node_modules\r\n    COPY . .\r\n    \r\n    # Next.js collects completely anonymous telemetry data about general usage.\r\n    # Learn more here: https://nextjs.org/telemetry\r\n    # Uncomment the following line in case you want to disable telemetry during the build.\r\n    # ENV NEXT_TELEMETRY_DISABLED 1\r\n    \r\n    RUN npm run build\r\n    \r\n    # Production image, copy all the files and run next\r\n    FROM node:16-alpine AS runner\r\n    WORKDIR /app\r\n    \r\n    ENV NODE_ENV production\r\n    # Uncomment the following line in case you want to disable telemetry during runtime.\r\n    # ENV NEXT_TELEMETRY_DISABLED 1\r\n    \r\n    RUN addgroup --system --gid 1001 nodejs\r\n    RUN adduser --system --uid 1001 nextjs\r\n    \r\n    # You only need to copy next.config.js if you are NOT using the default configuration\r\n    COPY --from=builder /app/public ./public\r\n    COPY --from=builder /app/package.json ./package.json\r\n    COPY --from=builder /app/package.json ./package.json\r\n    COPY --from=builder /app/next.config.js ./\r\n    COPY --from=builder /app/next-i18next.config.js ./\r\n    COPY --from=builder /app/next-sitemap.js ./cd\r\n    COPY --from=builder /app/jsconfig.json ./jsconfig.json\r\n    COPY --from=builder /app/data/ ./data\r\n    COPY --from=builder /app/components/ ./components\r\n    COPY --from=builder /app/utils/ ./utils\r\n    COPY --from=builder /app/assets/ ./assets\r\n    \r\n    # Automatically leverage output traces to reduce image size \r\n    # https://nextjs.org/docs/advanced-features/output-file-tracing\r\n    COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\r\n    COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\r\n    \r\n    USER nextjs\r\n    \r\n    EXPOSE 3000\r\n    \r\n    ENV PORT 3000\r\n    \r\n    CMD [\"node\", \"server.js\"]\r\n\r\n**.env file:**\r\n\r\n    NEXT_SHARP_PATH=/tmp/node_modules/sharp next start\r\n\r\nSharp is installed in package.json\r\n\r\nI checked both Next/Vercel tuts:\r\n- [https://nextjs.org/docs/messages/install-sharp][1]\r\n- [https://nextjs.org/docs/messages/sharp-missing-in-production][2]\r\n\r\n**RUN Docker:** \r\n\r\n    docker build --no-cache . -t website-app && docker run --name website -p 3000:3000 website-app\r\n\r\n\r\n  [1]: https://nextjs.org/docs/messages/install-sharp\r\n  [2]: https://nextjs.org/docs/messages/sharp-missing-in-production"}
{"sentences": "Invariant: incrementalCache missing in unstable_cache", "description": "### Summary\r\n\r\nWhen I try to run this code:\r\n\r\n```ts\r\nimport { unstable_cache } from \"next/cache\";\r\n\r\nimport { getPosts } from \"@/sanity/api\";\r\n\r\nimport ProjectsLayout from \"./ProjectsLayout\";\r\nimport Project from \"./Project/Project\";\r\n\r\nconst getData = unstable_cache(() => getPosts({ labKey: \"STAERLAB\" }), [], {\r\n  tags: [\"posts\"],\r\n});\r\n\r\nconst ProjectsStaerlab = async (\r\n  props: React.HTMLAttributes<HTMLDivElement>\r\n) => {\r\n  const posts = await getData();\r\n\r\n  return (\r\n    <ProjectsLayout {...props}>\r\n      {posts.map((post, index) => {\r\n        return <Project key={index} post={post} variant=\"STAERLAB\" />;\r\n      })}\r\n    </ProjectsLayout>\r\n  );\r\n};\r\n\r\nexport default ProjectsStaerlab;\r\n\r\n```\r\n\r\nI get the following error: `Invariant: incrementalCache missing in unstable_cache`.\r\n\r\nNo clue how to fix this... Is this a bug? I've seen other codebases use `unstable_cache` in the same way I am doing it here, but they are not getting the error.\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n  Platform: darwin\r\n  Arch: x64\r\n  Version: Darwin Kernel Version 21.5.0: Tue Apr 26 21:08:22 PDT 2022; root:xnu-8020.121.3~4/RELEASE_X86_64\r\nBinaries:\r\n  Node: 18.13.0\r\n  npm: 9.6.7\r\n  Yarn: N/A\r\n  pnpm: N/A\r\nRelevant packages:\r\n  next: 13.4.6\r\n  eslint-config-next: 13.4.3\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 5.1.3\r\n```"}
{"sentences": "App router in nextjs doesn't render page.js and layout.js at the same time (only one of those)", "description": "### Summary\r\n\r\nI have a project and I've noticed that at some routes there page.js with layout js doesn't work together.\r\n\r\nHere are project structure and discussed folder: [Link](https://github.com/Username1111111111/SeTTTify/tree/main/app/collection)\r\n\r\nIt's app/collection/[collectionId]/edit and along the way there are dummy page.js and layout.js at different places. \r\n\r\nFor some strange reason they don't work together. If I would remove layout.js file - the page.js file would render. The console and everything doesn't show errors. \r\n\r\nIs it a bug or I completely don't understand some principle of app router? (For example, layout is for sharing components to child components in route, page.js is only for a segment of route in which it placed)\r\n\r\nOr, maybe, there could be only one layout.js at the topmost route /  and it conflicting with those down the route?\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nhttps://github.com/Username1111111111/SeTTTify/tree/main/app/collection"}
{"sentences": "help detecting client disconnections in route handlers", "description": "(very) simplified code follows:\r\n\r\n```\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function GET(request: NextRequest, { params }: { params: { key: string[] } }) {\r\n  // Create a new AbortController for the S3 request\r\n  const s3AbortController = new AbortController();\r\n  request.signal.addEventListener('abort', () => {\r\n    console.log('Client disconnected, aborting the operation.');\r\n    s3AbortController.abort();\r\n  });\r\n\r\n  const getObjectCommand = new GetObjectCommand({ Bucket: BUCKET, Key: s3Path, Range: s3RangedHeaderString });\r\n  const getObjectResponse = await s3Client.send(getObjectCommand, { abortSignal: s3AbortController.signal });\r\n  const getObjectReadStream = getObjectResponse.Body!;\r\n  const getObjectWebStream = getObjectReadStream.transformToWebStream();\r\n  \r\n      return new NextResponse(getObjectWebStream, { headers });\r\n\r\n  ```\r\n  \r\nso this route handler has a big problem, if a client, say a video html5 player, attempts to stream through by making its GET request to this endpoint things works BUT if the client leaves (browser close, tab close, curl closes, everything) the pipe from s3 will still be ongoing.\r\nthis is especially brutal with multiple ranged requests, etc. you get the picture, piping needs to be stopped once client is not interested anymore.\r\nimagine a client asking bytes=0- for a 7GB file and leave just after a couple of seconds. your node server will continue downloading, not sure where it does put the output at this point but it does.\r\n\r\nI tried shaping the env with:\r\n\r\n- signals\r\n- proxy server\r\n- http 1.1\r\n- http 2\r\n\r\nit did not matter, in this env `abort` will never be fired.\r\n\r\ndid some more in depth verifications and indeed:\r\n\r\n```\r\n  const abortSignal = AbortSignal.timeout(4000);\r\n\r\n  const getObjectResponse = await s3Client.send(getObjectCommand, { abortSignal });\r\n```\r\n\r\nthis correctly destroys everything so I think the problem lies in the: `request.signal.addEventListener('abort', () => {`\r\nthat is never going to be called. we only have the `abort` event so I'm not sure how to solve this. make some keepalive check somewhere?\r\n"}
{"sentences": "process.env.VERCEL_URL is undefined", "description": "I'm using `process.env.VERCEL_URL` in an email that I send when the user creates an account.\r\n\r\nIn dev mode on my local machine, it's transformed into `http://localhost:3000/`. But once deployed, it is `undefined`. That's a bit weird."}
{"sentences": "Calling route handler in client component", "description": "Hi Guys! I am using next js 14 app router. In that i am making request to appwrite storage and for this i have my logic in route.ts file \r\nimport { IFetchResponse, IFileData } from \"@/types/types\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function Get(){\r\n        const response = await fetch('https://cloud.appwrite.io/v1/storage/buckets/6/files', {\r\n          headers: {\r\n          'X-Appwrite-Project': 'Id of my project',\r\n          'Content-Type': 'application/json',\r\n          },\r\n         \r\n        })\r\n    \r\n        if (!response.ok) {\r\n            //study about the error.js\r\n            throw new Error('Failed to fetch')\r\n        }\r\n    \r\n        const res:IFetchResponse = await response.json()\r\n        const id:IFileData[] = res.files\r\n        return NextResponse.json({id});\r\n    }\r\ni want to call it in my client compnent using swr\r\n\"use client\"\r\nimport React from 'react'\r\nimport { Carousel } from \"react-responsive-carousel\"\r\nimport { IFetchResponse, IFileData,  } from '@/types/types'\r\nimport Image from 'next/image'\r\n// import Carousel from 'react-elastic-carousel'\r\nimport \"react-responsive-carousel/lib/styles/carousel.min.css\"\r\nimport useSWR from 'swr'\r\n\r\n// \r\nconst Hero = () => {\r\n    const fetcher = (url:string) => {\r\n      fetch(url).then((res) => res)\r\n    }\r\n    const { data, error, isLoading } = useSWR(\r\n    \"/api/hero\",\r\n    fetcher\r\n  );\r\n  if (error) return console.log(\"An error has occurred.\");\r\n  if (isLoading) return console.log(\"Loading...\");\r\n  console.log(\"This is the data\" ,data)\r\n  return (\r\n  \r\n    \r\n    <>\r\n    <Carousel showArrows={true}\r\n            showIndicators={true}\r\n            infiniteLoop={true}\r\n            dynamicHeight={true}\r\n            // autoPlay={true}\r\n            // interval={2000}\r\n            emulateTouch={true}\r\n            showStatus={false}\r\n            stopOnHover={true}\r\n            showThumbs={false}\r\n             > \r\n     \r\n     <div >\r\n       <img src=\"/watch.jpg\" alt='watch' className='h-70 w-screen'/>\r\n     </div>\r\n     <div>\r\n     <img src=\"/doumbell.jpg\" alt='doumbell' className='h-70 w-screen'/>\r\n     </div>\r\n     <div>\r\n     <img src=\"/doumbell.jpg\" alt='doumbell' className='h-70 w-screen'/>\r\n     </div>\r\n    </Carousel> \r\n\r\n</>\r\n\r\n  )\r\n}\r\n\r\nexport default Hero\r\nbut when i logging the data i am getting undefined but it kept loading. Is my  @approach incorrect. Pls suggest me a correct approach.Thanks"}
{"sentences": "Deployment error on latest canary branch with PPR enabled", "description": "### Summary\r\n\r\nI'm on the latest (as of 03/01 12:00 PST) canary release (`14.1.1-canary.82`) and I have an app router project using PPR. I've been deploying updates this past week on release `14.1.1-canary.57` and they've all built successfully. This morning I attempted to deploy on this release again and I got the error \r\n`Error: The experimental.ppr preview feature can only be enabled when using the latest canary version of Next.js. See more info here: https://nextjs.org/docs/messages/ppr-preview`\r\nEven after upgrading (via `npm install next@canary`) to the latest canary release, I've continued to get that message when attempting to run a production build. The error obviously goes away when I turn off PPR.\r\n\r\nIs anyone else experiencing this? I'm also using nx for monorepo management if that makes any difference\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nI wish I could provide a link to the repo but unfortunately it's private at the moment. I'm currently attempting to reproduce it on a clean project"}
{"sentences": "assetlinks.json file on root", "description": "Hi everyone! I really need help on having a json file accessible on the root of my app, without having it return a 404. \r\n\r\nBasically, there's a requirement for our Android app to have a json file accessible in the website.  Example: https://mywebsite.com/.well-known/assetlinks.json.\r\n\r\n\"/.well-known/\" is the directory that sits on the root folder and contains the \"assetlinks.json\" file. \r\n\r\nAny help is much appreciated. Thank you!"}
{"sentences": "How Do I Persist Cache With Docker?", "description": "Hi,\r\n\r\nI'm trying to persist Nextjs cache across rebuilds of my docker container. I have added the line `VOLUME /app/.next/cache` to my Dockerfile but the volume doesn't appear to be being used by Next (The volume has been created). My WORKDIR is /app.\r\n\r\nCould anyone please offer any advice on how to achieve a persistent cache?\r\n\r\nUpdate, I Have also tried with `VOLUME [\"/app/.next/cache\"]`"}
{"sentences": "How do I use onClick with next/image (<Image>)?", "description": "Hello, I'd like to run some javascript rather than navigate to another page upon clicking a next/image, something like this:\r\n\r\n```\r\nimport Image from 'next/image'\r\n\r\nconst Bob = () => {\r\n  return <Image src={'path'} onClick={() => console.log('hi')}/>\r\n}\r\n```\r\n\r\nBut the onClick doesn't seem to work. Is there a way to do this? Couldn't quite figure it out from the documentation here: https://nextjs.org/docs/api-reference/next/image\r\n\r\nThanks!\r\n"}
{"sentences": "revalidatePath not working on the first attempt", "description": "### Summary\n\nHi, I'm working on a note taking app where there's a button. If I click this button, it will call a server action to the server which will use the `revalidatePath` to update the list of notes to the most updated list. \r\n\r\nHowever, I'm facing issues where after hard refreshing the page and clicking on the button to create a new note, the `revalidatePath` doesn't seem to be working. After clicking on it several more times - no luck. However, after I hard refresh the page, a couple of the notes appear (which have been made but not appeared). After this, `revalidatePath` seems to work fine.\r\n\r\n Please refer to the video below :)\r\n\r\nhttps://github.com/vercel/next.js/assets/85291626/38cd9647-b88a-44c4-a176-4f942bb841de\r\n\r\nAnd here's the code:\r\n\r\n```ts\r\n\"use server\"\r\n\r\nimport { db } from \"@/lib/db\";\r\nimport { auth } from \"@clerk/nextjs/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\ninterface CreateNoteProps {\r\n  workspaceId: string\r\n}\r\n\r\nexport const createNote = async ({ workspaceId }: CreateNoteProps) => {\r\n  const { userId } = auth();\r\n\r\n  if (!userId) {\r\n    return {\r\n      error: \"Unauthorized\"\r\n    }\r\n  }\r\n\r\n  let note;\r\n\r\n  try {\r\n    note = db.notes.create({\r\n      data: {\r\n        name: \"Untitled\",\r\n        userId,\r\n        content: \"\",\r\n        workspacesId: workspaceId,\r\n        isArchived: false,\r\n        isDeleted: false,\r\n        isFavorited: false,\r\n        isPublished: false,\r\n      }\r\n    })\r\n  } catch (error) {\r\n    return {\r\n      error: \"Failed to create new note.\"\r\n    }\r\n  }\r\n  revalidatePath(`/workspace/${workspaceId}`)\r\n  return {\r\n    data: note,\r\n    success: true\r\n  }\r\n}\r\n```\r\n\r\nFor this line of code:\r\n\r\n```tsx\r\nrevalidatePath(`/workspace/${workspaceId}`)\r\n```\r\n\r\nI've tried every configuration possible such as...\r\n\r\n```tsx\r\nrevalidatePath(`/workspace/${workspaceId}`, \"layout\")\r\nrevalidatePath(`/workspace/${workspaceId}`, \"page\")\r\nrevalidatePath(`/workspace/${workspaceId}`)\r\nrevalidatePath(\"/\", layout)\r\n// etc\r\n```\r\nThank you for reading :) Any kind of help is welcome.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Redirection from \"example.com/path/\" to \"example.com/path\" with 308 Permanent Redirect status code", "description": "### Summary\r\n\r\nHow to prevent redirecting from any path that contain `/` at the end to the same path without it, with 308 status code then 200 status code like this : \r\n\r\nexample : \r\nredirect : `https://nextjs.org/docs/` **308**\r\nto :            `https://nextjs.org/docs` **200**\r\n\r\n<a href=\"https://ibb.co/S0HmRhX\"><img src=\"https://i.ibb.co/ftZN4hY/Screenshot-2024-02-25-at-15-18-00-Bulk-URL-HTTP-Status-Code-Header-Redirect-Checker.png\" alt=\"Screenshot-2024-02-25-at-15-18-00-Bulk-URL-HTTP-Status-Code-Header-Redirect-Checker\" border=\"0\"></a>\r\n\r\nand it happen in all routs (dynamic, statics...) \r\n\r\n### Additional information\r\n\r\n```js\r\nmy dependencies :\r\n    \"@vercel/analytics\": \"^1.1.3\",\r\n    \"cheerio\": \"^1.0.0-rc.12\",\r\n    \"html-react-parser\": \"^5.1.1\",\r\n    \"next\": \"14.1.0\",\r\n    \"nextjs-progressloader\": \"^1.1.0\",\r\n    \"react\": \"^18\",\r\n    \"react-dom\": \"^18\",\r\n    \"swiper\": \"^11.0.5\"\r\nnodejs version : 21\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Intl.NumberFormat returning error, server and client side locales misaligned", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nI am trying to format number to locale string by setting explicit locale.\r\nIntl.NumberFormat(\"hr-HR\") returning following error: \r\nWarning: Text content did not match. Server: \"€5,000.00\" Client: \"5.000,00 EUR\"\r\n\r\nUsage:\r\n- [Number.prototype.toLocaleString()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString)\r\n- [Intl.NumberFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat)\r\n\r\n\r\n## To Reproduce\r\nUse following component: \r\n\r\neur-to-hrk.tsx\r\n``` ts\r\ninterface EurToHrkProps {\r\n  price: number;\r\n}\r\n\r\nconst EurToHrk = ({ price }: EurToHrkProps) => {\r\n  return (\r\n    <>\r\n      {new Intl.NumberFormat(\"hr-HR\", { style: \"currency\", currency: \"EUR\" }).format(price)}\r\n      ~\r\n      {new Intl.NumberFormat(\"hr-HR\", { style: \"currency\", currency: \"HRK\" }).format(price * 7.52)}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default EurToHrk;\r\n```\r\n\r\nindex.tsx\r\n``` ts\r\nconst Home = () => {\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>Home</title>\r\n        <link rel=\"icon\" href=\"/favicon.ico\" />\r\n      </Head>\r\n      <EurToHrk price={5000}  />\r\n    </>\r\n  );\r\n};\r\n```\r\n\r\n## Expected behavior\r\n\r\nServer and client side to be aligned as explicit locale was passed.\r\n\r\n\r\n## System information\r\n\r\n- OS: Windows\r\n- Browser: Chrome\r\n- Version of Next.js: 9.5.5\r\n- Version of Node.js: v12.16.2\r\n"}
{"sentences": "Metadata and GraphQL", "description": "Hey,\r\n\r\nThe project I'm working on uses `GraphQL` for data fetching. The team is in the process of migrating from `pages` to `app`.\r\n\r\nCurrently, data is generated on the server for all our records meta and passed via GraphQL. Here is an example:\r\n\r\n```graphql\r\nquery PostPage($id: ID) {\r\n  post(id: $id) {\r\n     metadata {\r\n       title\r\n       description\r\n       image\r\n       author\r\n     }\r\n     ...PostPageContentFragment\r\n  }\r\n}\r\n```\r\n\r\n\r\nMy team wants to migrate to the new [Metadata](https://nextjs.org/docs/app/building-your-application/optimizing/metadata) API. \r\n\r\n**However, how can we have a single query in the page component and access the data in `generateMetadata`?**\r\n\r\n*I can do 2 queries, but this seems too wasteful. The other option is to ignore the new Metadata API and use something like `Helm`.*"}
{"sentences": "I didn't encounter any errors on my local build, but when I deployed it on Vercel, I received an error message.", "description": "### Summary\r\n\r\nI am currently using Next.js version 14.4 along with Next PWA.\r\n\r\n![Screenshot 2024-02-10 032418](https://github.com/vercel/next.js/assets/102695412/62e57961-2ef0-49e0-9744-ce6cd474fb92)\r\n![Screenshot 2024-02-10 032443](https://github.com/vercel/next.js/assets/102695412/3f929b0e-2cf6-42c6-91ee-876a500f0d34)\r\n"}
{"sentences": "Cannot find package 'drizzle-orm' in Docker Container even though I do npm install in Dockerfile?", "description": "### Summary\n\nI have installed `drizzle-orm` & used anonymous volumes so docker uses `node_modules` following this guide https://michalzalecki.com/docker-compose-node/\r\n\r\nBut for some reason, I don't find `drizzle-orm` in `node_modules` when i do this in Dockerfile:\r\n\r\n```bash\r\nRUN ls -la node_modules\r\n```\r\n\r\nMy `docker-compose.yml` looks like:\r\n\r\n```yml\r\n    volumes:\r\n      - ./data:/data\r\n      - /app/node_modules # Anonymous volume\r\n```\r\n\r\nWhat am I doing wrong?\r\n\r\nI've posted a full question here -> https://stackoverflow.com/q/78031427/6141587\r\n\r\nMy repo -> https://github.com/deadcoder0904/easypanel-nextjs-sqlite (next.js + drizzle + sqlite + docker)\r\n\r\nThe reason I need it is to run database migration when container starts & it cannot run unless it finds the `drizzle-orm` & other dependencies. check my `package.json` script `db:migrate:prod`:\r\n\r\n>     \"db:migrate:prod\": \"node --env-file .env.production ./scripts/drizzle-migrate.mjs\"\r\n\r\n```mjs\r\nimport sqlite from 'better-sqlite3'\r\nimport { drizzle } from 'drizzle-orm/better-sqlite3'\r\nimport { migrate } from 'drizzle-orm/better-sqlite3/migrator'\r\nimport path from 'node:path'\r\nimport { isProduction } from 'std-env'\r\n.\r\n.\r\n.\r\n```\r\n\r\nFull file -> https://github.com/deadcoder0904/easypanel-nextjs-sqlite/blob/main/scripts/drizzle-migrate.mjs\r\n\r\nHow to solve this? Anyone got Next.js + Docker + Drizzle working?\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/deadcoder0904/easypanel-nextjs-sqlite/"}
{"sentences": "where to add google-site-verification file", "description": "Hello friends. I need to add the html file made available by google for property recognition on my SSR website, what are the ways to do this?"}
{"sentences": "Is there any way to upload and serve images in the nextjs application in runtime?", "description": "### Summary\n\nI am developing a web application that includes a feature to upload images to the file system and serve them to the frontend. In the development environment, placing images in the 'public' directory works as expected. However, in the production environment, it is not functioning properly. The documentation recommends using 'Vercel Blob,' or alternatively, I could use Amazon S3. However, I am wondering if there is a way to achieve this without relying on an external service.\r\n\r\nThank you\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "\"npm run dev\" not working", "description": "### Summary\n\nAfter installing next.js 14 on my PC(windows 10) and running \"npm run dev\", i get the following error\r\n\r\n ⚠ Attempted to load @next/swc-win32-ia32-msvc, but an error occurred: A dynamic link library (DLL) initialization routine failed.\r\n\\\\?\\C:\\nextjs boilerplate\\nextjs-boilerplate\\node_modules\\@next\\swc-win32-ia32-msvc\\next-swc.win32-ia32-msvc.node\r\n ⨯ Failed to load SWC binary for win32/ia32, see more info here: https://nextjs.org/docs/messages/failed-loading-swc.\r\n\r\nPlease what do i need to do to fix this issue?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "searchParams.get('partition'); not get 'partition'", "description": "### Summary\r\n\r\nHello, I can't get the value with searchParams.get, is it a bug? Or is there something wrong with the code? ?\r\nplease tell me!\r\nreq.nextURL can be obtained without any problem, but the contents of req.nextUrl.searchParams.get('partition'); will be null.\r\n\r\n\r\napp/api/route.ts\r\n```\r\nexport async function GET(req: NextRequest) {\r\n  // クエリパラメータからpartitionKeyを取得\r\n  const searchParams = req.nextUrl.searchParams;\r\n  const query = searchParams.get('partition');\r\n  console.log(req.nextUrl);\r\n  console.log(query);\r\n  if (!query) {\r\n    return new Response(JSON.stringify({ error: \"partitionKeyが必要です\" }), {\r\n      status: 400,\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n  }\r\n......\r\n```\r\n\r\nfront code\r\n```\r\nexport async function getTexts(partition: string) {\r\n  const baseUrl = 'http://localhost:3000/api';\r\n  const url = new URL(baseUrl);\r\n  url.searchParams.append('partition', 'test');\r\n  \r\n  const res = await fetch(url, {\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n  const data = await res.json();\r\n  console.log(data);\r\n}\r\n```\r\n\r\ncontents of req.nextUrl\r\n```\r\nNextURL {\r\n  [Symbol(NextURLInternal)]: {\r\n    url: URL {\r\n      href: 'http://localhost:3000/api?partition=test',\r\n      origin: 'http://localhost:3000',\r\n      protocol: 'http:',\r\n      username: '',\r\n      password: '',\r\n      host: 'localhost:3000',\r\n      hostname: 'localhost',\r\n      port: '3000',\r\n      pathname: '/api',\r\n      search: '?partition=test',\r\n      searchParams: URLSearchParams { 'partition' => 'test' },\r\n      hash: ''\r\n    },\r\n    options: { headers: [Object], nextConfig: undefined },\r\n    basePath: '',\r\n    domainLocale: undefined,\r\n    defaultLocale: undefined,\r\n    buildId: undefined,\r\n    locale: undefined,\r\n    trailingSlash: false\r\n  }\r\n}\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Next/Head encode URI?", "description": "Hi,\r\n\r\nI'd like to understand why inserting a meta inside a `<Head>` will result in an altered content (encodeURI)?\r\n\r\n```\r\n<Head>\r\n  <meta property=\"og:image\" content=\"https://monsite.com/image?prop1=1&prop2=2\">\r\n</Head>\r\n```\r\n\r\nWill be converted as: (notice the **`&amp;`** before `prop2`)\r\n```\r\n<head>\r\n  <meta property=\"og:image\" content=\"https://monsite.com/image?prop1=1&amp;prop2=2\">\r\n</head>\r\n```\r\n\r\nAnd this will break a netlify redirection (for example)\r\n\r\nSo why is it that way? Is it a bug?\r\n\r\nThanks for you help!"}
{"sentences": "Why I can't process the .env.local?", "description": "I am getting this error here:\r\n\r\n```\r\n if (process.env.NEXT_PUBLIC_MONGODB_URI === \"development\") {\r\nerror - utils\\mongodb.js (10:8) @ eval\r\nError: Please add your Mongo URI to .env.local\r\n   8 | \r\n   9 | if (!process.env.NEXT_PUBLIC_MONGODB_URI) {\r\n> 10 |   throw new Error(\"Please add your Mongo URI to .env.local\");\r\n     |        ^\r\n  11 | }\r\n  12 | \r\n  13 | if (process.env.NEXT_PUBLIC_MONGODB_URI === \"development\") {\r\n```\r\n\r\nThe error reads what it reads because that is what is written to read... but, why isn't the .env being processed?\r\n\r\nThe URI is good.  I connect just fine to my mongo shell, and other apps are working fine with the same string.\r\n\r\n\r\nI am about to give up trying to pull external data....  could I just upload the data in a local json and work from there?\r\n\r\n\r\nThe page that I am trying to put the data in is this one:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/inventory.js\r\n\r\nThe connection is this one:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/utils/mongodb.js\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Custom 404 not-found page not working in Vercel", "description": "### Summary\n\nHello,\r\ni have a strange issue with Nextjs 13 app dir, I place a not-found.tsx file in the app folder and it is working in the localhost, and also in production build in localhost, but as i push to production at vercel i will still see the default 404 page from Vercel, is there something I miss to set up in Vercel or there is something else ?\r\n\r\nRegards\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Image cache issue. Images rendered by next/image disappears/ doesn't load on page refresh.", "description": "### Summary\n\nThis is on dev environment; not tested prod yet\r\n\r\nWhen using ...\r\n\r\nimport Image from 'next/image';\r\n\r\nOn server start, images load fine. I refresh page, image disappears replaced with generic missing image icon and alt tag.\r\nOnly way to fix this is to restart server or delete .next folder.\r\n\r\nWhen using regular <img -- images are populated on page refresh.\r\n\r\nAM I missing a nextjs image config or something?\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/temrb/next-start"}
{"sentences": "How to set Title in client component", "description": "### Summary\n\n> In my project. some of my pages using ssr, such as \"/letter/[mail_id]\". but left doesn't\r\n\r\nProject struct like:\r\n```\r\n.\r\n├── (home)\r\n│   ├── layout.tsx\r\n│   ├── page.tsx\r\n│   ├── support\r\n│   │   └── page.tsx\r\n│   ├── about\r\n│   │   └── page.tsx\r\n├── layout.tsx\r\n├── letter\r\n│   ├── [mail_id]\r\n│   │   └── page.tsx\r\n│   └── layout.tsx\r\n└── ui\r\n```\r\n\r\n`/support` is a client component that contains a form. When the form is submitted, it sends an XHR request.\r\n\r\nI discovered that when `/layout.tsx` is a server component, I can use the meta API to modify the title. However, its subcomponents appear to be limited to client components, and the meta API cannot be used within them.\r\n\r\nI attempted to use `next/Head` as an alternative but was unsuccessful. Therefore, I am inquiring if there is any method to display distinct titles between the `/about` and `/support` pages.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Nature of error.digest", "description": "### Summary\n\nIs `error.digest` deterministic, i.e., will hash of my custom error class be the same on every machine every single time?\r\n\r\n> #### `error.digest`\r\n>\r\n>An automatically generated hash of the error thrown in a Server Component. It can be used to match the corresponding error in server-side logs.\n\n### Additional information\n\n```js\nhttps://github.com/vercel/next.js/blob/ca18f4ff9d3afa63fe267d1071cfafb280853cc2/docs/02-app/02-api-reference/02-file-conventions/error.mdx#L87\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Error collecting traces on build, RangeError: Maximum call stack size exceeded", "description": "### Summary\r\n\r\nEverything works fine when doing the local build, but when I can't deploy because of that error, it seems to have to do with sass.\r\n\r\n### Additional information\r\n\r\n```js\r\nRangeError: Maximum call stack size exceeded\r\n    at RegExp.exec (<anonymous>)\r\n    at create (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:18889)\r\n    at create (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:18918)\r\n    at parse.fastpaths (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:18997)\r\n    at picomatch.makeRe (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:21635)\r\n    at picomatch (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:19637)\r\n    at /vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:19294\r\n    at Array.map (<anonymous>)\r\n    at picomatch (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:19286)\r\n    at micromatch.isMatch (/vercel/path0/node_modules/.pnpm/next@14.0.3_react-dom@18.2.0_react@18.2.0_sass@1.69.5/node_modules/next/dist/compiled/micromatch/index.js:15:1090)\r\n ELIFECYCLE  Command failed with exit code 1.\r\nError: Command \"pnpm run build\" exited with 1\r\n```"}
{"sentences": "Different solution to prefix static resources", "description": "### Summary\n\nI have a custom server and I would need to prefix all static resources with `/static__nextjs/<AppName>`.\r\nSince the very beginning of the project I used `setAssetPrefix` to prepend this.\r\nIs there a better way to achieve this? If yes, can you provide me some solutions?\r\n\r\nA guy here is trying a similar approach: https://github.com/vercel/next.js/issues/51223 and this stopped working starting from Next.js v13.5.\n\n### Additional information\n\n```js\nOperating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 23.2.0: Wed Nov 15 21:54:10 PST 2023; root:xnu-10002.61.3~2/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 21.4.0\r\n      npm: 10.2.4\r\n      Yarn: 1.22.21\r\n      pnpm: 8.12.1\r\n    Relevant packages:\r\n      next: 13.4.7\r\n      eslint-config-next: 13.4.7\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.3.3\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Getting error trying to start development server", "description": "Hello all!\r\n\r\nSo I have been using yarn autoclean to clean my dependencies since I added and then deleted some dependencies. I don't know if yarn autoclean corrupted my next project, but I do get an error now when I try to start the dev server (It also throws an error on next build & next start). I tried removing the node_modules folder and installing again, didn't work\r\n\r\nOutput on the console:\r\n```\r\nyarn run v1.22.17\r\n$ next dev\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\ninfo  - Loaded env from C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\.env.local\r\nError: Cannot find module './blocks/images'\r\nRequire stack:\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\build\\webpack\\config\\index.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\build\\webpack-config.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\server\\dev\\hot-reloader.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\server\\dev\\next-dev-server.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\server\\next.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\server\\lib\\start-server.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\cli\\next-dev.js\r\n- C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\bin\\next\r\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:885:15)\r\n    at Function.mod._resolveFilename (C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\build\\webpack\\require-hook.js:183:28)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:730:27)\r\n    at Module.require (internal/modules/cjs/loader.js:957:19)\r\n    at require (internal/modules/cjs/helpers.js:88:18)\r\n    at Object.<anonymous> (C:\\Users\\corsi\\WebstormProjects\\wisliger-frontend\\node_modules\\next\\dist\\build\\webpack\\config\\index.js:8:15)\r\n    at Module._compile (internal/modules/cjs/loader.js:1068:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1097:10)\r\n    at Module.load (internal/modules/cjs/loader.js:933:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:774:14) {\r\n  code: 'MODULE_NOT_FOUND',\r\n  requireStack: [  ]\r\n}\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nMy next info:\r\n```\r\n    Operating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 14.17.0\r\n      npm: 8.3.0\r\n      Yarn: 1.22.17\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 12.0.10\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n```"}
{"sentences": "Problem with parallel routes and server actions", "description": "I have a problem with parallel routes. I'm using its with server actions. So, if I use:\r\n- redirect: Not works.\r\n- revalidatePath or revalidateTag: the form go into an infinity submit status.\r\n\r\nThose problems only ocurs when a parallel route is active. Elsewhere, all works well."}
{"sentences": "unhandledRejection: TypeError: Cannot read properties of null (reading 'useReducer')", "description": "### Summary\r\n\r\nHey guys!\r\n\r\ni started my studies with next.js and i got this error when i'm trying to run the application.\r\n\r\n\"unhandledRejection: TypeError: Cannot read properties of null (reading 'useReducer')\" \r\nbut i'm not using \"useReducer\" in any archive.\r\n\r\nalready tried to downgrade react \r\n\r\n![image](https://github.com/vercel/next.js/assets/112417899/af7cd7dd-e285-4c53-af73-ba359edf6860)\r\n![image](https://github.com/vercel/next.js/assets/112417899/4956b835-a0bc-44d3-b7f6-ee1cd14a8092)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Next.js fonts are erroring out on `pnpm build`?", "description": "### Summary\r\n\r\nI am getting a bunch of this:\r\n\r\n```\r\nRetrying 1/3...\r\nrequest to https://fonts.gstatic.com/s/notosanstc/v35/-nF7OG829Oofr2wohFbTp9iFOisNA_cTyNromxqQuEMQ2wHYwbnmy1R1jDujLebozBXCo2qYhRo.90.woff2 failed, reason:\r\n\r\nRetrying 1/3...\r\nrequest to https://fonts.gstatic.com/s/notosanstc/v35/-nF7OG829Oofr2wohFbTp9iFOisNA_cTyNromxqQuEMQ2wHYwbnmy1R1jDujLebozBXCo2qYhRo.87.woff2 failed, reason:\r\n\r\nRetrying 1/3...\r\nrequest to https://fonts.gstatic.com/s/notosanstc/v35/-nF7OG829Oofr2wohFbTp9iFOisNA_cTyNromxqQuEMQ2wHYwbnmy1R1jDujLebozBXCo2qYhRo.86.woff2 failed, reason:\r\n\r\nRetrying 1/3...\r\nrequest to https://fonts.gstatic.com/s/notosanstc/v35/-nF7OG829Oofr2wohFbTp9iFOisNA_cTyNromxqQuEMQ2wHYwbnmy1R1jDujLebozBXCo2qYhRo.85.woff2 failed, reason:\r\n```\r\n\r\nIf I visit one of those links, it downloads the fonts, so why is Next.js failing to `pnpm build`?\r\n\r\nThe only thing that I think I may have changed is moved the font declarations to a separate standalone library which I then import into my Next.js app. Would that be causing this perhaps?\r\n\r\nIn the library I have:\r\n\r\n```ts\r\n'use client'\r\n\r\nimport React, { useEffect, useState } from 'react'\r\nimport { GoogleAnalytics } from 'nextjs-google-analytics'\r\nimport Script from 'next/script'\r\nimport {\r\n  Noto_Sans_Mono,\r\n  Noto_Sans_SC,\r\n  Noto_Sans_TC,\r\n} from 'next/font/google'\r\n\r\nimport cx from 'classnames'\r\n\r\nconst notoSansMono = Noto_Sans_Mono({\r\n  weight: ['400', '700'],\r\n  preload: true,\r\n  subsets: [],\r\n  variable: '--font-noto-sans-mono',\r\n})\r\n\r\nconst notoSansSC = Noto_Sans_SC({\r\n  weight: ['400', '700'],\r\n  preload: true,\r\n  subsets: ['latin'],\r\n  variable: '--font-noto-sans-sc',\r\n})\r\n\r\nconst notoSansTC = Noto_Sans_TC({\r\n  weight: ['400', '700'],\r\n  preload: true,\r\n  subsets: ['latin'],\r\n  variable: '--font-noto-sans-tc',\r\n})\r\n\r\nexport default function Container({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  const [className, setClassName] = useState<string>('hidden')\r\n\r\n  useEffect(() => {\r\n    setClassName(\r\n      cx(\r\n        notoSansMono.variable,\r\n        notoSansSC.variable,\r\n        notoSansTC.variable,\r\n        notoSansMono.className,\r\n      ),\r\n    )\r\n  }, [])\r\n\r\n  return (\r\n    <html lang=\"en\">\r\n      <body\r\n        className={cx(\r\n          className,\r\n          `font-sans w-full h-full min-w-screen min-h-screen`,\r\n        )}\r\n      >\r\n        <GoogleAnalytics trackPageViews />\r\n        <Script id=\"disable-scroll-restoration\">{`window.history.scrollRestoration = \"manual\"`}</Script>\r\n        {children}\r\n        <div id=\"overlay\" />\r\n      </body>\r\n    </html>\r\n  )\r\n}\r\n\r\n```\r\n\r\nIn the app I then do `app/layout.tsx`:\r\n\r\n```tsx\r\n'use client'\r\n\r\nimport { Container } from '@my/lib'\r\n\r\nexport default function AppLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return <Container>{children}</Container>\r\n}\r\n```\r\n\r\nIt has been erroring out for over 5 hours today, so I doubt it's a Google font thing. Any hints or suggestions?\r\n\r\nI will also note that it seems to build successfully on Vercel deploy, but just not building locally."}
{"sentences": "Selector \":root\" is not pure", "description": "What's the meaning of this?\r\n\r\n```\r\nerror - ./styles/vars.css:1:1\r\nSyntax error: Selector \":root\" is not pure (pure selectors must contain at least one local class or id)\r\n\r\n> 1 | :root {\r\n    |                           ^\r\n  2 | \t--primary-color: #d8d4ff;\r\n  3 | }\r\n```\r\n\r\nThis error message is not descriptive."}
{"sentences": "Routes in app/api is not working", "description": "As the title states, the routes inside the `app/api` directory in my project is somehow interpreted as a page (not found page returned). Routes in other directories are working fine. Anyone ever encountered this kind of issue? \r\nNote that, my project is upgraded from Page Router to App Router "}
{"sentences": "Website not Responsive on Next js 14.0.4", "description": "### Summary\r\n\r\n**so in desktop all the images are fine, but now the problem on mobile is i can scroll to the right**\r\n\r\n**my code for global css**\r\n\r\n```\r\n*,\r\n*::before, *::after { \r\nbox-sizing: border-box; \r\n}\r\n\r\nbody { \r\npadding: 0; \r\nmargin: 0; \r\n}\r\n\r\n.Content {\r\ndisplay: flex; \r\nflex-direction: column;\r\n min-height: 100vh; \r\n}\r\n\r\n.main { \r\nflex: 1; \r\n}\r\n```\r\n\r\n**and then my custom code for css**\r\n\r\n```\r\n.myFlex{\r\ndisplay:flex; \r\nalign-items: center; \r\njustify-content: space-around; \r\nborder: 1px solid red; \r\nmargin: 0 auto; \r\nflex-wrap: wrap; \r\nwidth: 900px;\r\n margin-top: 15px; \r\nmargin-bottom: 15px; \r\n}\r\n\r\n.superFlex{ \r\ndisplay: flex; \r\njustify-content: space-around; \r\nalign-items: center; \r\nwidth: 100%; \r\nflex-wrap: wrap;\r\n }\r\n\r\n.imgContainer { \r\ndisplay: flex; \r\njustify-content: center; \r\nwidth: 250px; \r\nheight: 250px; \r\nmargin-bottom: 5rem; \r\n}\r\n\r\n.mainImage{ \r\nobject-fit: contain; \r\n}\r\n```\r\n\r\n\r\n```\r\n@media only screen and (max-width: 600px) {\r\n\r\n.myFlex { width:100%; }\r\n\r\n.superFlex{ justify-content: center; }\r\n\r\n.imgContainer{ width: 100%; }\r\n}\r\n```\r\n\r\n\r\n**my layout file**\r\n\r\n\r\n```\r\nimport '@styles/global.css'\r\n\r\nimport Navbar from '@components/navbar'; \r\n\r\nimport Footer from '@components/footer';\r\n\r\nexport const metadata = {\r\ntitle:\"Fashion Paradise\", \r\ndescription:\"Discover all things fashion\" }\r\n\r\nexport const viewport = { \r\ninitialScale: 1, \r\nwidth: 'device-width' }\r\n\r\n\r\nconst RootLayout = ({children}) => {\r\nreturn (\r\n <html lang=\"en\">\r\n <body>\r\n <div className=\"Content\">\r\n <Navbar />\r\n <main className='main'>\r\n {children}\r\n </main>\r\n <Footer />\r\n </div>\r\n\r\n </body>\r\n\r\n </html>\r\n);\r\n\r\n}\r\nexport default RootLayout;\r\n```\r\n\r\n**my result below on mobile**\r\n\r\n![1](https://github.com/vercel/next.js/assets/77625215/2227649f-dc1e-4d8c-acf7-eee639df90ca)\r\n\r\n**Now i can SCROLL ALL THE WAY TO THE RIGHT!!**\r\n\r\n![2](https://github.com/vercel/next.js/assets/77625215/e001efb3-1e4a-476e-9a75-f27be5de1db0)\r\n\r\n\r\n**Please Help,Thanks :)**"}
{"sentences": "How do you read x-www-form-urlencoded content in api route?", "description": "Is it possible to read x-www-form-urlencoded content in api route?\r\n\r\nThis is the only information I've found but its out of date and the links to the documentation just don't contain any information about supporting x-www-form-urlencoded  content type."}
{"sentences": "Getting strange `;` at the end of HTML output", "description": "Anyone has any ideas why I am getting a mysterious semicolon at the end of the page?\r\n![image](https://user-images.githubusercontent.com/10786558/77415839-00c12480-6dfe-11ea-953f-bcaa25b53dd6.png)\r\n\r\nNowhere to find it in any of the code though:\r\n```\r\n//document.ts\r\nexport default class CustomDocument extends Document {\r\n  static async getInitialProps(ctx: DocumentContext) {\r\n    const sheets = new ServerStyleSheets()\r\n    const originalRenderPage = ctx.renderPage\r\n\r\n    ctx.renderPage = () =>\r\n      originalRenderPage({\r\n        enhanceApp: App => props => sheets.collect(<App {...props} />)\r\n      })\r\n    const initialProps = await Document.getInitialProps(ctx)\r\n\r\n    return {\r\n      ...initialProps,\r\n      styles: [\r\n        ...React.Children.toArray(initialProps.styles),\r\n        sheets.getStyleElement()\r\n      ]\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Html>\r\n        <Head />\r\n        <body>\r\n          <Main />\r\n          <NextScript />\r\n        </body>\r\n      </Html>\r\n    )\r\n  }\r\n```\r\n\r\n```\r\n//index.ts\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>233</title>\r\n        <meta charSet=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"initial-scale=1.0, width=device-width\" />\r\n      </Head>\r\n      <Layout maxWidth='xl' background='none' headerSettings={{menus,asyncSearch:true,showFilter:false}}>\r\n       <div className={showContents?classes.visible:classes.invisible}>\r\n        {pagination}\r\n        <div\r\n          ref={container}\r\n          style={{\r\n            position: 'relative',\r\n          }}\r\n        >\r\n          {currentEntries.length > 0 && renderPostList()}\r\n        </div>\r\n        {pagination}\r\n        </div>\r\n      </Layout>\r\n    </>\r\n  )\r\n}\r\n```\r\n\r\nAny ideas? Thanks!"}
{"sentences": "Upgraded from v12 to v12.2.3 -> ValidationError: Invalid configuration object. Webpack has been initialized using a configuration object that does not match the API schema", "description": "So I just upgraded from Next v12 to v12.2.3, created a new middleware.js file in the root directory, tried to do a \"yarn dev\" and got this:\r\n\r\n```\r\nValidationError: Invalid configuration object. Webpack has been initialized using a configuration object that does not match the API schema.\r\n - configuration[0].module.rules[5] should be one of these:\r\n   [\"...\" | object { assert?, compiler?, dependency?, descriptionData?, enforce?, exclude?, generator?, include?, issuer?, issuerLayer?, layer?, loader?, mimetype?, oneOf?, options?, parser?, realResource?, resolve?, resource?, resourceFragment?, resourceQuery?, rules?, scheme?, sideEffects?, test?, type?, use? }, ...]\r\n   -> A rule.\r\n   Details:\r\n    * configuration[0].module.rules[5].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[0].module.rules[5].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[0].module.rules[5].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[0].module.rules[5].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n - configuration[1].module.rules[4] should be one of these:\r\n   [\"...\" | object { assert?, compiler?, dependency?, descriptionData?, enforce?, exclude?, generator?, include?, issuer?, issuerLayer?, layer?, loader?, mimetype?, oneOf?, options?, parser?, realResource?, resolve?, resource?, resourceFragment?, resourceQuery?, rules?, scheme?, sideEffects?, test?, type?, use? }, ...]\r\n   -> A rule.\r\n   Details:\r\n    * configuration[1].module.rules[4].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[1].module.rules[4].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[1].module.rules[4].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[1].module.rules[4].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n - configuration[2].module.rules[8] should be one of these:\r\n   [\"...\" | object { assert?, compiler?, dependency?, descriptionData?, enforce?, exclude?, generator?, include?, issuer?, issuerLayer?, layer?, loader?, mimetype?, oneOf?, options?, parser?, realResource?, resolve?, resource?, resourceFragment?, resourceQuery?, rules?, scheme?, sideEffects?, test?, type?, use? }, ...]\r\n   -> A rule.\r\n   Details:\r\n    * configuration[2].module.rules[8].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[2].module.rules[8].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[2].module.rules[8].include[0] has an unknown property 'pages'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    * configuration[2].module.rules[8].include[0] has an unknown property 'appDir'. These properties are valid:\r\n      object { and?, not?, or? }\r\n      -> Logic operators used in a condition matcher.\r\n    at validate (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\compiled\\schema-utils3\\index.js:1:150815)\r\n    at validateSchema (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:139253:2)\r\n    at create (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:142750:24)\r\n    at webpack (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:142797:32)\r\n    at Object.f [as webpack] (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:97275:16)\r\n    at HotReloader.start (D:\\GitHub\\My_Projects\\node_modules\\next\\dist\\server\\dev\\hot-reloader.js:430:45)\r\n    at async DevServer.prepare (D:\\GitHub\\My_Project\\node_modules\\next\\dist\\server\\dev\\next-dev-server.js:334:9)\r\n    at async D:\\GitHub\\My_Project\\node_modules\\next\\dist\\cli\\next-dev.js:147:9 {\r\n  errors: [\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[0].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    },\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[1].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    },\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[2].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    }\r\n  ],\r\n  schema: {\r\n    definitions: {\r\n      Amd: [Object],\r\n      AssetFilterItemTypes: [Object],\r\n      AssetFilterTypes: [Object],\r\n      AssetGeneratorDataUrl: [Object],\r\n      AssetGeneratorDataUrlFunction: [Object],\r\n      AssetGeneratorDataUrlOptions: [Object],\r\n      AssetGeneratorOptions: [Object],\r\n      AssetInlineGeneratorOptions: [Object],\r\n      AssetModuleFilename: [Object],\r\n      AssetModuleOutputPath: [Object],\r\n      AssetParserDataUrlFunction: [Object],\r\n      AssetParserDataUrlOptions: [Object],\r\n      AssetParserOptions: [Object],\r\n      AssetResourceGeneratorOptions: [Object],\r\n      AuxiliaryComment: [Object],\r\n      Bail: [Object],\r\n      CacheOptions: [Object],\r\n      CacheOptionsNormalized: [Object],\r\n      Charset: [Object],\r\n      ChunkFilename: [Object],\r\n      ChunkFormat: [Object],\r\n      ChunkLoadTimeout: [Object],\r\n      ChunkLoading: [Object],\r\n      ChunkLoadingGlobal: [Object],\r\n      ChunkLoadingType: [Object],\r\n      Clean: [Object],\r\n      CleanOptions: [Object],\r\n      CompareBeforeEmit: [Object],\r\n      Context: [Object],\r\n      CrossOriginLoading: [Object],\r\n      CssChunkFilename: [Object],\r\n      CssExperimentOptions: [Object],\r\n      CssFilename: [Object],\r\n      CssGeneratorOptions: [Object],\r\n      CssParserOptions: [Object],\r\n      Dependencies: [Object],\r\n      DevServer: [Object],\r\n      DevTool: [Object],\r\n      DevtoolFallbackModuleFilenameTemplate: [Object],\r\n      DevtoolModuleFilenameTemplate: [Object],\r\n      DevtoolNamespace: [Object],\r\n      EmptyGeneratorOptions: [Object],\r\n      EmptyParserOptions: [Object],\r\n      EnabledChunkLoadingTypes: [Object],\r\n      EnabledLibraryTypes: [Object],\r\n      EnabledWasmLoadingTypes: [Object],\r\n      Entry: [Object],\r\n      EntryDescription: [Object],\r\n      EntryDescriptionNormalized: [Object],\r\n      EntryDynamic: [Object],\r\n      EntryDynamicNormalized: [Object],\r\n      EntryFilename: [Object],\r\n      EntryItem: [Object],\r\n      EntryNormalized: [Object],\r\n      EntryObject: [Object],\r\n      EntryRuntime: [Object],\r\n      EntryStatic: [Object],\r\n      EntryStaticNormalized: [Object],\r\n      EntryUnnamed: [Object],\r\n      Environment: [Object],\r\n      Experiments: [Object],\r\n      ExperimentsCommon: [Object],\r\n      ExperimentsNormalized: [Object],\r\n      ExternalItem: [Object],\r\n      ExternalItemFunctionData: [Object],\r\n      ExternalItemValue: [Object],\r\n      Externals: [Object],\r\n      ExternalsPresets: [Object],\r\n      ExternalsType: [Object],\r\n      FileCacheOptions: [Object],\r\n      Filename: [Object],\r\n      FilenameTemplate: [Object],\r\n      FilterItemTypes: [Object],\r\n      FilterTypes: [Object],\r\n      GeneratorOptionsByModuleType: [Object],\r\n      GlobalObject: [Object],\r\n      HashDigest: [Object],\r\n      HashDigestLength: [Object],\r\n      HashFunction: [Object],\r\n      HashSalt: [Object],\r\n      HotUpdateChunkFilename: [Object],\r\n      HotUpdateGlobal: [Object],\r\n      HotUpdateMainFilename: [Object],\r\n      HttpUriAllowedUris: [Object],\r\n      HttpUriOptions: [Object],\r\n      HttpUriOptionsAllowedUris: [Object],\r\n      IgnoreWarnings: [Object],\r\n      IgnoreWarningsNormalized: [Object],\r\n      Iife: [Object],\r\n      ImportFunctionName: [Object],\r\n      ImportMetaName: [Object],\r\n      InfrastructureLogging: [Object],\r\n      JavascriptParserOptions: [Object],\r\n      Layer: [Object],\r\n      LazyCompilationDefaultBackendOptions: [Object],\r\n      LazyCompilationOptions: [Object],\r\n      Library: [Object],\r\n      LibraryCustomUmdCommentObject: [Object],\r\n      LibraryCustomUmdObject: [Object],\r\n      LibraryExport: [Object],\r\n      LibraryName: [Object],\r\n      LibraryOptions: [Object],\r\n      LibraryType: [Object],\r\n      Loader: [Object],\r\n      MemoryCacheOptions: [Object],\r\n      Mode: [Object],\r\n      ModuleFilterItemTypes: [Object],\r\n      ModuleFilterTypes: [Object],\r\n      ModuleOptions: [Object],\r\n      ModuleOptionsNormalized: [Object],\r\n      Name: [Object],\r\n      NoParse: [Object],\r\n      Node: [Object],\r\n      NodeOptions: [Object],\r\n      Optimization: [Object],\r\n      OptimizationRuntimeChunk: [Object],\r\n      OptimizationRuntimeChunkNormalized: [Object],\r\n      OptimizationSplitChunksCacheGroup: [Object],\r\n      OptimizationSplitChunksGetCacheGroups: [Object],\r\n      OptimizationSplitChunksOptions: [Object],\r\n      OptimizationSplitChunksSizes: [Object],\r\n      Output: [Object],\r\n      OutputModule: [Object],\r\n      OutputNormalized: [Object],\r\n      Parallelism: [Object],\r\n      ParserOptionsByModuleType: [Object],\r\n      Path: [Object],\r\n      Pathinfo: [Object],\r\n      Performance: [Object],\r\n      PerformanceOptions: [Object],\r\n      Plugins: [Object],\r\n      Profile: [Object],\r\n      PublicPath: [Object],\r\n      RawPublicPath: [Object],\r\n      RecordsInputPath: [Object],\r\n      RecordsOutputPath: [Object],\r\n      RecordsPath: [Object],\r\n      Resolve: [Object],\r\n      ResolveAlias: [Object],\r\n      ResolveLoader: [Object],\r\n      ResolveOptions: [Object],\r\n      ResolvePluginInstance: [Object],\r\n      RuleSetCondition: [Object],\r\n      RuleSetConditionAbsolute: [Object],\r\n      RuleSetConditionOrConditions: [Object],\r\n      RuleSetConditionOrConditionsAbsolute: [Object],\r\n      RuleSetConditions: [Object],\r\n      RuleSetConditionsAbsolute: [Object],\r\n      RuleSetLoader: [Object],\r\n      RuleSetLoaderOptions: [Object],\r\n      RuleSetLogicalConditions: [Object],\r\n      RuleSetLogicalConditionsAbsolute: [Object],\r\n      RuleSetRule: [Object],\r\n      RuleSetRules: [Object],\r\n      RuleSetUse: [Object],\r\n      RuleSetUseItem: [Object],\r\n      ScriptType: [Object],\r\n      SnapshotOptions: [Object],\r\n      SourceMapFilename: [Object],\r\n      SourcePrefix: [Object],\r\n      StatsOptions: [Object],\r\n      StatsValue: [Object],\r\n      StrictModuleErrorHandling: [Object],\r\n      StrictModuleExceptionHandling: [Object],\r\n      Target: [Object],\r\n      TrustedTypes: [Object],\r\n      UmdNamedDefine: [Object],\r\n      UniqueName: [Object],\r\n      WarningFilterItemTypes: [Object],\r\n      WarningFilterTypes: [Object],\r\n      WasmLoading: [Object],\r\n      WasmLoadingType: [Object],\r\n      Watch: [Object],\r\n      WatchOptions: [Object],\r\n      WebassemblyModuleFilename: [Object],\r\n      WebpackOptionsNormalized: [Object],\r\n      WebpackPluginFunction: [Object],\r\n      WebpackPluginInstance: [Object]\r\n    },\r\n    title: 'WebpackOptions',\r\n    description: 'Options object as provided by the user.',\r\n    type: 'object',\r\n    additionalProperties: false,\r\n    properties: {\r\n      amd: [Object],\r\n      bail: [Object],\r\n      cache: [Object],\r\n      context: [Object],\r\n      dependencies: [Object],\r\n      devServer: [Object],\r\n      devtool: [Object],\r\n      entry: [Object],\r\n      experiments: [Object],\r\n      externals: [Object],\r\n      externalsPresets: [Object],\r\n      externalsType: [Object],\r\n      ignoreWarnings: [Object],\r\n      infrastructureLogging: [Object],\r\n      loader: [Object],\r\n      mode: [Object],\r\n      module: [Object],\r\n      name: [Object],\r\n      node: [Object],\r\n      optimization: [Object],\r\n      output: [Object],\r\n      parallelism: [Object],\r\n      performance: [Object],\r\n      plugins: [Object],\r\n      profile: [Object],\r\n      recordsInputPath: [Object],\r\n      recordsOutputPath: [Object],\r\n      recordsPath: [Object],\r\n      resolve: [Object],\r\n      resolveLoader: [Object],\r\n      snapshot: [Object],\r\n      stats: [Object],\r\n      target: [Object],\r\n      watch: [Object],\r\n      watchOptions: [Object]\r\n    }\r\n  },\r\n  headerName: 'Webpack',\r\n  baseDataPath: 'configuration',\r\n  postFormatter: [Function: postFormatter]\r\n}\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nI have no idea why this happened, what it means or how to fix it, but now I can't even revert to v12 and get anything to run!\r\nI don't touch any webpack stuff, so I'm not sure what to do.\r\n\r\nHere is my next.config.js file:\r\n```\r\nconst { withSuperjson } = require('next-superjson')\r\n\r\nmodule.exports = withSuperjson()({\r\n    images: {\r\n        domains: [`${process.env.S3_UPLOAD_BUCKET}.s3.amazonaws.com`],\r\n        formats: ['image/avif', 'image/webp'],\r\n    },\r\n    eslint: {\r\n        // Warning: This allows production builds to successfully complete even if\r\n        // your project has ESLint errors.\r\n        ignoreDuringBuilds: true,\r\n    },\r\n\r\n});\r\n```\r\n\r\nPlease help me solve this one,\r\nThanks,\r\n- Ivan"}
{"sentences": "Sharp `0.33.2` makes build at deployment fail", "description": "### Summary\r\n\r\nWhen Sharp `v0.33.2` is installed next build fails on vercel.\r\nIt works fine locally but fails when deploying on vercel\r\n```\r\nRangeError: Maximum call stack size exceeded\r\n--\r\n00:26:27.206 | at RegExp.exec (<anonymous>)\r\n00:26:27.206 | at create (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:18889)\r\n00:26:27.206 | at create (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:18918)\r\n00:26:27.206 | at parse.fastpaths (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:18997)\r\n00:26:27.206 | at picomatch.makeRe (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:21635)\r\n00:26:27.206 | at picomatch (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:19637)\r\n00:26:27.206 | at /vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:19294\r\n00:26:27.207 | at Array.map (<anonymous>)\r\n00:26:27.207 | at picomatch (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:19286)\r\n00:26:27.207 | at micromatch.isMatch (/vercel/path0/node_modules/.pnpm/next@14.0.4_@babel+core@7.23.7_react-dom@18.2.0_react@18.2.0/node_modules/next/dist/compiled/micromatch/index.js:15:1090)\r\n00:26:27.300 | ELIFECYCLE  Command failed with exit code 1.\r\n00:26:27.320 | Error: Command \"pnpm run build\" exited with 1\r\n\r\n```\r\n\r\nAfter all manual pinpointing turns out that I had updated sharp from `0.33.1` to `0.33.2`.\r\n\r\nI don't really know whether or not it is a bug from vercel, nextjs, sharp.\r\nTwo of my projects ran into this issue which was resolved after rolling back sharp\r\n\r\nNote: it only fails when deplying on vercel (not locally)\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Help me. I can't fix error after npm run build  \"ReferenceError: window is not defined\". Where should I fix the code?", "description": "### Summary\n\nThis error message.\r\n<img width=\"836\" alt=\"Screen Shot 2567-01-25 at 00 04 24\" src=\"https://github.com/vercel/next.js/assets/84759066/7208dc0c-8999-4a27-8348-abc9ee04b57e\">\r\n\r\nThis is a code that I think this wrong.\r\n\r\n```\r\n\"use client\";\r\nimport Image from \"next/image\";\r\nimport patternMobile from \"@/public/pattern-bg-mobile.png\";\r\nimport patternDesktop from \"@/public/pattern-bg-desktop.png\";\r\nimport arrowBtn from \"@/public/icon-arrow.svg\";\r\n\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport dynamic from \"next/dynamic\";\r\nconst MapContainer = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.MapContainer),\r\n  {\r\n    ssr: false,\r\n  }\r\n);\r\nconst TileLayer = dynamic(\r\n  () => import(\"react-leaflet\").then((mod) => mod.TileLayer),\r\n  {\r\n    ssr: false,\r\n  }\r\n);\r\n\r\nimport { useState } from \"react\";\r\nimport PositionMarker from \"./positionmarker\";\r\n\r\ntype ApiResponse = {\r\n  ip: string;\r\n  city: string;\r\n  country_name: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  isp: string;\r\n  time_zone: {\r\n    current_time: string;\r\n  };\r\n};\r\n\r\nexport default function Map() {\r\n  const [ipInput, setIpInput] = useState(\"\");\r\n  const [data, setData] = useState<ApiResponse | null>(null);\r\n\r\n  const fetchData = async (ip: string) => {\r\n    try {\r\n      const apiKey = \"8486414383d74704bbb0640c9d5677a1\";\r\n      const res = await fetch(\r\n        `https://api.ipgeolocation.io/ipgeo?apiKey=${apiKey}&ip=${ip}`\r\n      );\r\n      if (!res.ok) {\r\n        throw new Error(\"Error fetch data\");\r\n      }\r\n      const result: ApiResponse = await res.json();\r\n      setData(result);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const handleClick = () => {\r\n    fetchData(ipInput);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      <div>\r\n        <Image\r\n          className=\"bg-mobile\"\r\n          src={patternMobile}\r\n          alt=\"\"\r\n          width={0}\r\n          height={0}\r\n        />\r\n        <Image\r\n          className=\"bg-desktop\"\r\n          src={patternDesktop}\r\n          alt=\"\"\r\n          width={0}\r\n          height={0}\r\n        />\r\n      </div>\r\n      <div className=\"cotainer\">\r\n        <h1 className=\"text-white font-bold text-[24px] pb-[0.8rem]\">\r\n          IP Address Tracker\r\n        </h1>\r\n        <div className=\"flex items-center justify-center\">\r\n          <div>\r\n            <input\r\n              className=\"inputSearch\"\r\n              type=\"text\"\r\n              placeholder=\"Search for any IP or domain\"\r\n              value={ipInput}\r\n              onChange={(e) => setIpInput(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"arrowsBG\" onClick={handleClick}>\r\n            {\" \"}\r\n            <Image src={arrowBtn} alt=\"\" width={8} height={8} />\r\n          </div>\r\n        </div>\r\n\r\n        {data && (\r\n          <div className=\"content\">\r\n            <div>\r\n              <p>Ip address</p>\r\n              <p>{data.ip}</p>\r\n            </div>\r\n            <div>\r\n              <p>Location</p>\r\n              <p>\r\n                {data.city},{data.country_name}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <p>Timezone</p>\r\n              <p>{data.time_zone.current_time}</p>\r\n            </div>\r\n            <div>\r\n              <p>Isp</p>\r\n              <p>{data.isp}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      {data && (\r\n        <div>\r\n          <MapContainer\r\n            className=\"mapContent\"\r\n            center={[data.latitude, data.longitude]}\r\n            zoom={13}\r\n            scrollWheelZoom={false}\r\n          >\r\n            <TileLayer\r\n              attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n            />\r\n            <PositionMarker data={data} />\r\n          </MapContainer>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\nOr becuase of my file placement?\r\n<img width=\"1280\" alt=\"Screen Shot 2567-01-25 at 17 17 43\" src=\"https://github.com/vercel/next.js/assets/84759066/9ea14b3f-1e07-4463-9c4a-8754caf349ec\">\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "400 bad request in production after upgrading to 14.0.2 (and after)", "description": "### Summary\n\nIn the logs it's showing `ERR_INVALID_URL` with an input of something like \"/favicon.ico\" (instead of the full URL).\r\n\r\nFor context: This is running behind nginx, in a docker container, on a custom domain. It fails ONLY in production. I did put `ENV HOSTNAME \"0.0.0.0\"` in the dockerfile already.\r\n\r\nIt works fine if I run the docker image locally.\r\n\r\nAfter some debugging we discovered that this issue only occurs on routes that go through the middleware.\r\n\r\nI have basically tried any solution that I could find on Google/stackoverflow already.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Provider not work in function - nextJs 14", "description": "### Summary\r\n\r\nI don't know why function that i called my provider on it not work at all.\r\n\r\nBefore function SocketProvider every thing is fine but nothing work in the function and i called my provider on that function so my provider can't get any values\r\n\r\n```\r\n\"use client\"        \r\nimport { createContext, useEffect, useRef, useState } from 'react';    \r\nimport { io } from \"socket.io-client\";    \r\n\r\n// initial state    \r\nconst initialState = {    \r\n    a: false,    \r\n};   \r\nconst SocketContext = createContext(initialState);    \r\n    \r\n   console.log(\"first\")   //          here console works fine\r\n\r\nexport const SocketProvider = ({children}) => {    \r\n\r\n    console.log(\"second\")   //          here console not work\r\n\r\n    const [state, setState] = useState(initialState);    \r\n       \r\n    let a = true  \r\n    return (    \r\n        <SocketContext.Provider value={a}>    \r\n        {children}    \r\n        </SocketContext.Provider>    \r\n    );    \r\n}    \r\n    \r\n    \r\nexport default SocketContext;\r\n```\r\nthis is how i call that\r\n```\r\nimport { useContext } from 'react';\r\nimport SocketContext from 'contexts/socketContext';\r\n\r\nconst useSocket = () => {\r\n    const context = useContext(SocketContext);\r\n\r\n    return context;\r\n};\r\n\r\nexport default useSocket;\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Route Caching, am I doing it wrong? or it can't handle this simple scenario?", "description": "I was exploring Next.js for the first time, and within just 10 minutes, I noticed a significant issue with route caching – a feature that, in my opinion, is more of a drawback.\r\n\r\nConsider the following simple app scenario:\r\n\r\n**Route A:** A component (RSC) fetches records from Prisma and displays them in a list. Another component (RCC) has a button that triggers a server action that inserts a new record into the database and calls revalidatePath('/').\r\n\r\n**Route B:** Contains a basic heading (h1) saying 'Hello, World.'\r\n\r\n**The app layout consists of two Links, one pointing to Route A and the other to Route B. Both links have the prefetch={false} prop.**\r\n\r\nLet's walk through the issues:\r\n\r\n**Step 1:** Using Chrome, I navigate to Route A, click the button, and a new record appears in the list – so far, so good.\r\n\r\n**Step 2:** Switching to Firefox, I navigate to Route A. Despite seeing one record initially, clicking the button adds another record to the list. Now, there are two records.\r\n\r\n**Step 3:** Returning to Chrome, I still see only one record. Understandable, as it's not a real-time app. I navigate to Route B and then back to Route A. Surprisingly, I still see only one record. Clicking the button again updates the UI, now showing three records.\r\n\r\n**Step 4:** Back in Firefox, I observe two records. Following the Route B and Route A navigation, the count remains at two. Clicking the button reloads the list, and now there are four records.\r\n\r\nI can envision users encountering frustration quickly in a scenario like this during a Zoom call. Person A claims to have created the record, while person B, having navigated to a different page and back, doesn't see it. Person B decides to create it, leading to a duplicate entry. This user experience can be problematic.\r\n\r\nI know this cache is only 30 seconds but imagine that the scenario I'm experiencing is not acceptable, can it be solved in some way with RSC without having to create an API endpoint and fetch the data from the client each time the component mounts? also, I don't think hard navigation is an acceptable solution\r\n"}
{"sentences": "using {GoogleAnalytics} showing \"Unsupported Server Component\"", "description": "By refring to [docs](https://nextjs.org/docs/app/building-your-application/optimizing/third-party-libraries#google-analytics) \r\ni am using gtag something like\r\n```jsx\r\n// Import\r\nimport \"@/style/globals.css\";\r\nimport { Toaster } from \"react-hot-toast\";\r\nimport NavBar from \"@/components/Sections/NavBar\";\r\nimport ActiveSectionProvider from \"@/components/Context/ActiveSection\";\r\nimport Footer from \"@/components/Sections/Footer\";\r\nimport ThemeSwitcher from \"@/components/Subs/ThemeSwitcher\";\r\nimport { GoogleAnalytics } from \"@next/third-parties/google\";\r\n\r\nexport const metadata = {\r\n  title: \"Welcome to BIGBEASTISHANK's Portfolio website\",\r\n  description: \"Created by BBI\",\r\n};\r\n\r\nexport default function RootLayout({ children }) {\r\n  // Variable\r\n  return (\r\n    <html lang=\"en\" className=\"!scroll-smooth\">\r\n      <body className=\"bg-gray-50 text-gray-950 relative pt-28 sm:pt-36 dark:bg-gray-900 dark:text-gray-50 dark:text-opacity-90\">\r\n        {/* Initial 2 background color start */}\r\n        <div className=\"bg-[#fbe2e3] absolute top-[-6rem] -z-10 right-[11rem] h-[31.25rem] w-[31.25rem] rounded-full blur-[10rem] sm:w-[68.75rem] dark:bg-[#946263]\" />\r\n        <div className=\"bg-[#dbd7fd] absolute top-[-1rem] -z-10 left-[-35rem] h-[31.25rem] w-[50rem] rounded-full blur-[10rem] sm:w-[68.75rem] md:left-[-33rem] lg:left-[-28rem] xl:left-[-15rem] 2xl:left-[-5rem] dark:bg-[#676394]\" />\r\n        {/* Initial 2 background color end */}\r\n\r\n        <ActiveSectionProvider>\r\n          <NavBar />\r\n          {children}\r\n          <Footer />\r\n        </ActiveSectionProvider>\r\n\r\n        {/* Fixed Display */}\r\n        <ThemeSwitcher />\r\n        <Toaster position=\"top-right\" reverseOrder={false} />\r\n      </body>\r\n\r\n      <GoogleAnalytics gaId={process.env.gtag} />\r\n    </html>\r\n  );\r\n}\r\n```\r\n\r\nThen it is showing me error \r\n```\r\nUnhandled Runtime Error\r\nError: Unsupported Server Component type: undefined\r\n```\r\n\r\nThis error only occurs when I add `<GoogleAnalytics gaId={process.env.gtag} />` to the code.\r\n\r\n## I have tried\r\n- Adding it to page.jsx but it didnt worked\r\n\r\n## Versions\r\n```\r\n\"@next/third-parties\": \"^14.0.4\",\r\n\"next\": \"^14.0.4\",\r\n\"react\": \"^18\",\r\n```"}
{"sentences": "getServerSideProps cached at Vercel", "description": "### Summary\n\nThe `getServerSideProps` seems to be cached unexpectedly.\r\n\r\n**Context:** _I have at `Next.js 14.0.4` an admin function \"login as user\". That works by modifying cookies._ \r\n\r\n**The Issue:**\r\n1. I have a page `/profile` that unwrap cookies and serves the `userId` as a prop into the page.\r\n2. I have changed the cookie by redirect to /api/login and back to the page root `/`\r\n3. The user navigates to the `/profile` page and gets **outdated** version of the page\r\n\r\nThe `getServerSideProps` have not been called by the navigation:\r\na. It is called in the dev mode\r\nb. It is called in prod mode on local\r\nc. It is not called on Vercel in production\r\n\r\nPlease note that I have doisabled browser cache by a HTTP header and the oudated data page JSON is servered from the Vercel and the `getServerSideProps` has not been called.\r\n\r\nHow i can disable the server side cache if there is any or is that a bug please?\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "API routes using Firebase break in Production", "description": "I am sending data to Firebase's Firestore from my NextJS API route.  It works fine on my local dev env but it breaks when deployed on Vercel.\r\n\r\n\r\nThis is my API route page - \r\n\r\n```javascript\r\nimport firebase from \"firebase\";\r\n\r\nconst config = {\r\n // populated using .env.local in dev and populated using env variables on Vercel (in production)\r\n};\r\n\r\n!firebase.apps.length ? firebase.initializeApp(config) : firebase.app();\r\n\r\nconst handleFirebase = async (value) => {\r\n  //sending data to firebase\r\n\r\n  let db = firebase.firestore();\r\n  db.collection(\"contacts\")\r\n    .add(value)\r\n    .then((ref) => {\r\n      console.log(\"form submitted with ID:\" + ref.id);\r\n    })\r\n    .catch((error) => {\r\n      console.log(error);\r\n    });\r\n};\r\n\r\nexport default async (req, res) => {\r\n\r\n  console.log(req.body); **// GETS LOGGED IN FUNCTION LOGS**\r\n\r\n  await handleFirebase(req.body);  **// NO LOGS??**\r\n\r\n  console.log(\"logging works\");  **// GETS LOGGED IN FUNCTION LOGS**\r\n\r\n  res.statusCode = 200;\r\n  res.setHeader(\"Content-Type\", \"application/json\");\r\n  res.send(JSON.stringify(req.body));\r\n};\r\n``` \r\n\r\nAs you can see, it seems from the log that the function inside await () never gets executed because there are no logs from that function. But the logs above and below that are logged in serverless function.\r\n\r\nHere is an example log of function - \r\n\r\n```\r\n[POST] /api/contact-form\r\n19:45:16:34\r\n{\r\n  name: 'Test User',\r\n  email: 'test@test.com',\r\n  number: '897877121212',\r\n  message: 'any text goes here'\r\n}\r\nlogging works\r\n```\r\n\r\nThis works perfectly fine in dev (data gets updated in Firestore and all logs are there in the console) but not in production.\r\n\r\nAny possible reasons. "}
{"sentences": "\"Linting and checking validity of types ... Failed to compile. \" - Unable to deploy", "description": "### Summary\n\nCan anyone help me in this? i have stuck in this for a long time \r\n\r\nGithub repo : https://github.com/gowthamc0702/vak\r\n\r\nunable to deploy app , \r\nType error: Page \"app/products/[id]/page.tsx\" does not match the required types of a Next.js Page.\r\n\"ProductPage\" is not a valid Page export field.\r\n\r\n![image](https://github.com/vercel/next.js/assets/108746137/d4988d10-a21a-4435-84e2-e76d32c97903)\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Next 13 api route handler status code", "description": "### Summary\n\nHow can i set status code  in new NextResponse  and send it with json\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to use middleware to protect api auth (pages dir)", "description": "### Summary\r\n\r\nI was checking cookies in my api files by calling checkCookies and return 401 unauthorized.\r\nBut I don't want to call it in my all api files manually if possiable . So I tried middle but it is not working in my first time . \r\nI write without matcher but it doesn't work so I added matcher code and still doesn't work . Is there anything wrong ?\r\nI was using firebase and firebase admin sdk and store token in cookies . \r\n\r\n![image](https://github.com/vercel/next.js/assets/71011043/169e482e-aea7-4970-acc5-6775a911fc18)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Multiple middleware functions", "description": "I'm not sure if I'm missing something very obvious here... but I can't figure out how to run more than one middleware function. Is this supported?"}
{"sentences": "[Static export] Generated inline scripts, `self.__next_f.push` raises CSP errors", "description": "Hi, there're some related posts on this issue but opened a new discussion since some are already closed:\r\n* https://github.com/vercel/next.js/discussions/43710\r\n* https://github.com/vercel/next.js/issues/43743\r\n* https://github.com/vercel/next.js/discussions/42170\r\n\r\nThe error looks like this:\r\n<img width=\"1081\" alt=\"Screenshot 2023-08-17 at 1 26 28 PM\" src=\"https://github.com/vercel/next.js/assets/13231564/0728b93a-254e-4c20-bfa0-5aa3ac8b1c4d\">\r\n\r\nAnd by using CSP generator extension, I can confirm that the error is coming for those `self.__next_f.push` scripts:\r\n<img width=\"758\" alt=\"Screenshot 2023-08-17 at 1 25 15 PM\" src=\"https://github.com/vercel/next.js/assets/13231564/6f10bb1e-8863-436a-9a61-6d50c5ee0513\">\r\n\r\nThere're solutions for this \"only\" when using SSR such as using middleware or headers, but it looks like there's none for static export. [This post](https://github.com/vercel/next.js/issues/43743#issuecomment-1557252810) says the only solution for this is using CSP hashes but I can't find a way to add hash to those generated scripts. [This post](https://reesmorris.co.uk/blog/implementing-proper-csp-nextjs-styled-components) shows how to add hash to inline scripts but can't find a way to fetch all those `next_f.push` scripts and apply the hashes.\r\n\r\nI even tried to just add `'unsafe-inline'` into `script-src` but as you can see in the first screenshot, hash gets automatically added to CSP (by next.js I guess?) and `unsafe-inline` gets ignored. I added it like this:\r\n<img width=\"1017\" alt=\"Screenshot 2023-08-17 at 1 37 35 PM\" src=\"https://github.com/vercel/next.js/assets/13231564/98d35a08-ec69-4d31-b18b-aa8b23bd2c0b\">\r\n\r\nAnyone knows solution to this? \r\ncc @danieltott \r\nsorry but I'm tagging you since you looked like an expert to this issue🙏"}
{"sentences": "NEXTJS 13: self.__next_f.push append to <script> tag in source code", "description": "Hello, somebody knows what it is.__next_f.push in page source code??\r\n\r\ni use nextjs **app-router** (v13.5.5)\r\n\r\nThe data of the previous pages is appended to the source code as **self.__next_f.push** in **<script>** tags. self.__next_f.push double all content on the webpage. Thus, the page becomes almost twice as large.\r\nI have not seen this in version 12 or 13 with next.js **pages router**.\r\n\r\nnotice: i update our nextjs version to v14.0.2 and the issues still exists.\r\n\r\n![Capture](https://github.com/vercel/next.js/assets/48034022/d6545baf-02aa-4e47-ac27-3ec49ff0ab99)\r\n\r\n\r\n"}
{"sentences": "How Do I Remove `self.__next_f.push` From Static HTML Exports", "description": "### Summary\n\nHello. 👋 \r\n\r\nI'm in the process of working with the new `NextJS 13` stuff, and to be honest - I'm not really enjoying it.\r\n\r\nI'm trying to get a static artifact exported, and it kind of works, but it really doesn't.\r\n\r\nWhat's driving me nuts is that the static artifacts it's generating are adding all these unnecessary `self.__next_f.push` lines, that are really unneeded. And, I'm super confused as to what they're there for.\r\n\r\n# Next Config\r\nHere's my `next.config.js`\r\n\r\n```js\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n    distDir: \"build\",\r\n    output: \"export\"\r\n};\r\n\r\nmodule.exports = nextConfig;\r\n```\r\n\r\n# Source\r\nThis is the source page\r\n```tsx\r\nimport Image from \"next/image\";\r\n\r\nfunction Home() {\r\n    // ---------------------------------------------------------------------------\r\n    // Rendering\r\n    // ---------------------------------------------------------------------------\r\n    const final_render_element = (\r\n        <main>\r\n            <div>\r\n                <p>\r\n                    Get started by editing&nbsp;\r\n                    <code>src/app/page.tsx</code>\r\n                </p>\r\n                <div>\r\n                    <a\r\n                        href=\"https://vercel.com?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app\"\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                    >\r\n                        By <Image src=\"/vercel.svg\" alt=\"Vercel Logo\" width={100} height={24} priority />\r\n                    </a>\r\n                </div>\r\n            </div>\r\n\r\n            <div>\r\n                <Image src=\"/next.svg\" alt=\"Next.js Logo\" width={180} height={37} priority />\r\n            </div>\r\n\r\n            <div>\r\n                <a\r\n                    href=\"https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                >\r\n                    <h2>\r\n                        Docs <span>-&gt;</span>\r\n                    </h2>\r\n                    <p>Find in-depth information about Next.js features and API.</p>\r\n                </a>\r\n\r\n                <a\r\n                    href=\"https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                >\r\n                    <h2>\r\n                        Learn <span>-&gt;</span>\r\n                    </h2>\r\n                    <p>Learn about Next.js in an interactive course with&nbsp;quizzes!</p>\r\n                </a>\r\n\r\n                <a\r\n                    href=\"https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                >\r\n                    <h2>\r\n                        Templates <span>-&gt;</span>\r\n                    </h2>\r\n                    <p>Explore the Next.js 13 playground.</p>\r\n                </a>\r\n\r\n                <a\r\n                    href=\"https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template&utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                >\r\n                    <h2>\r\n                        Deploy <span>-&gt;</span>\r\n                    </h2>\r\n                    <p>Instantly deploy your Next.js site to a shareable URL with Vercel.</p>\r\n                </a>\r\n            </div>\r\n        </main>\r\n    );\r\n\r\n    return final_render_element;\r\n}\r\n\r\nexport default Home;\r\n```\r\n\r\n# Output \r\nI'm using a default `NextJS` application, and this is what it's outputting\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n        <link\r\n            rel=\"preload\"\r\n            as=\"font\"\r\n            href=\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\"\r\n            crossorigin=\"\"\r\n            type=\"font/woff2\"\r\n        />\r\n        <link rel=\"preload\" as=\"image\" href=\"/vercel.svg\" fetchPriority=\"high\" />\r\n        <link rel=\"preload\" as=\"image\" href=\"/next.svg\" fetchPriority=\"high\" />\r\n        <link rel=\"stylesheet\" href=\"/_next/static/css/ed4d508feb2dc8fd.css\" data-precedence=\"next\" />\r\n        <link rel=\"preload\" href=\"/_next/static/chunks/webpack-fece8402f682851f.js\" as=\"script\" fetchPriority=\"low\" />\r\n        <script src=\"/_next/static/chunks/fd9d1056-6b91f437b4d494b5.js\" async=\"\"></script>\r\n        <script src=\"/_next/static/chunks/596-d618d193f52e19b7.js\" async=\"\"></script>\r\n        <script src=\"/_next/static/chunks/main-app-e038a94c85256af1.js\" async=\"\"></script>\r\n        <link rel=\"icon\" href=\"/favicon.ico\" type=\"image/x-icon\" sizes=\"16x16\" />\r\n        <meta name=\"next-size-adjust\" />\r\n        <script src=\"/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js\" nomodule=\"\"></script>\r\n    </head>\r\n    <body class=\"__className_e66fe9\">\r\n        <main>\r\n            <div>\r\n                <p>Get started by editing <code>src/app/page.tsx</code></p>\r\n                <div>\r\n                    <a\r\n                        href=\"https://vercel.com?utm_source=create-next-app&amp;utm_medium=appdir-template&amp;utm_campaign=create-next-app\"\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        >By\r\n                        <img\r\n                            alt=\"Vercel Logo\"\r\n                            fetchPriority=\"high\"\r\n                            width=\"100\"\r\n                            height=\"24\"\r\n                            decoding=\"async\"\r\n                            data-nimg=\"1\"\r\n                            style=\"color: transparent\"\r\n                            src=\"/vercel.svg\"\r\n                    /></a>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <img\r\n                    alt=\"Next.js Logo\"\r\n                    fetchPriority=\"high\"\r\n                    width=\"180\"\r\n                    height=\"37\"\r\n                    decoding=\"async\"\r\n                    data-nimg=\"1\"\r\n                    style=\"color: transparent\"\r\n                    src=\"/next.svg\"\r\n                />\r\n            </div>\r\n            <div>\r\n                <a\r\n                    href=\"https://nextjs.org/docs?utm_source=create-next-app&amp;utm_medium=appdir-template&amp;utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    ><h2>Docs <span>-&gt;</span></h2>\r\n                    <p>Find in-depth information about Next.js features and API.</p></a\r\n                ><a\r\n                    href=\"https://nextjs.org/learn?utm_source=create-next-app&amp;utm_medium=appdir-template&amp;utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    ><h2>Learn <span>-&gt;</span></h2>\r\n                    <p>Learn about Next.js in an interactive course with quizzes!</p></a\r\n                ><a\r\n                    href=\"https://vercel.com/templates?framework=next.js&amp;utm_source=create-next-app&amp;utm_medium=appdir-template&amp;utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    ><h2>Templates <span>-&gt;</span></h2>\r\n                    <p>Explore the Next.js 13 playground.</p></a\r\n                ><a\r\n                    href=\"https://vercel.com/new?utm_source=create-next-app&amp;utm_medium=appdir-template&amp;utm_campaign=create-next-app\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    ><h2>Deploy <span>-&gt;</span></h2>\r\n                    <p>Instantly deploy your Next.js site to a shareable URL with Vercel.</p></a\r\n                >\r\n            </div>\r\n        </main>\r\n        <script src=\"/_next/static/chunks/webpack-fece8402f682851f.js\" async=\"\"></script>\r\n        <script>\r\n            (self.__next_f = self.__next_f || []).push([0]);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([\r\n                1,\r\n                '1:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\\n2:HL[\"/_next/static/css/ed4d508feb2dc8fd.css\",{\"as\":\"style\"}]\\n0:\"$L3\"\\n'\r\n            ]);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([\r\n                1,\r\n                '4:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-fece8402f682851f.js\",\"971:static/chunks/fd9d1056-6b91f437b4d494b5.js\",\"596:static/chunks/596-d618d193f52e19b7.js\"],\"name\":\"default\",\"async\":false}\\n6:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-fece8402f682851f.js\",\"971:static/chunks/fd9d1056-6b91f437b4d494b5.js\",\"596:static/chunks/596-d618d193f52e19b7.js\"],\"name\":\"\",\"async\":false}\\n7:I{\"id\":5840,\"chunks\":[\"185:static/chunks/app/layout-fcfe5bad3e0d6a2f.js\"],\"name\":\"\",\"async\":false}\\n8:I{\"id\":7767,\"chunks\"'\r\n            ]);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([\r\n                1,\r\n                ':[\"272:static/chunks/webpack-fece8402f682851f.js\",\"971:static/chunks/fd9d1056-6b91f437b4d494b5.js\",\"596:static/chunks/596-d618d193f52e19b7.js\"],\"name\":\"default\",\"async\":false}\\n9:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-fece8402f682851f.js\",\"971:static/chunks/fd9d1056-6b91f437b4d494b5.js\",\"596:static/chunks/596-d618d193f52e19b7.js\"],\"name\":\"default\",\"async\":false}\\nb:I{\"id\":3222,\"chunks\":[\"222:static/chunks/222-a1a53c3588663d0e.js\",\"951:static/chunks/app/home/page-184a94689c89ce33.js\"],\"name\":\"Image\",'\r\n            ]);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([1, '\"async\":false}\\n']);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([\r\n                1,\r\n                '3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ed4d508feb2dc8fd.css\",\"precedence\":\"next\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"QBbY6GxvsI2ECPcpts1-Q\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/home\",\"initialTree\":[\"\",{\"children\":[\"home\",{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"$L7\",null,{\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"children\":\"TODO\"}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"home\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$La\",[\"$\",\"main\",null,{\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[\"Get started by editing \",[\"$\",\"code\",null,{\"children\":\"src/app/page.tsx\"}]]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://vercel.com?utm_source=create-next-app\\u0026utm_medium=appdir-template\\u0026utm_campaign=create-next-app\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"By \",[\"$\",\"$Lb\",null,{\"src\":\"/vercel.svg\",\"alt\":\"Vercel Logo\",\"width\":100,\"height\":24,\"priority\":true}]]}]}]]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"$Lb\",null,{\"src\":\"/next.svg\",\"alt\":\"Next.js Logo\",\"width\":180,\"height\":37,\"priority\":true}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs?utm_source=create-next-app\\u0026utm_medium=appdir-template\\u0026utm_campaign=create-next-app\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"h2\",null,{\"children\":[\"Docs \",[\"$\",\"span\",null,{\"children\":\"-\\u003e\"}]]}],[\"$\",\"p\",null,{\"children\":\"Find in-depth information about Next.js features and API.\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/learn?utm_source=create-next-app\\u0026utm_medium=appdir-template\\u0026utm_campaign=create-next-app\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"h2\",null,{\"children\":[\"Learn \",[\"$\",\"span\",null,{\"children\":\"-\\u003e\"}]]}],[\"$\",\"p\",null,{\"children\":\"Learn about Next.js in an interactive course with quizzes!\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://vercel.com/templates?framework=next.js\\u0026utm_source=create-next-app\\u0026utm_medium=appdir-template\\u0026utm_campaign=create-next-app\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"h2\",null,{\"children\":[\"Templates \",[\"$\",\"span\",null,{\"children\":\"-\\u003e\"}]]}],[\"$\",\"p\",null,{\"children\":\"Explore the Next.js 13 playground.\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://vercel.com/new?utm_source=create-next-app\\u0026utm_medium=appdir-template\\u0026utm_campaign=create-next-app\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[[\"$\",\"h2\",null,{\"children\":[\"Deploy \",[\"$\",\"span\",null,{\"children\":\"-\\u003e\"}]]}],[\"$\",\"p\",null,{\"children\":\"Instantly deploy your Next.js site to a shareable URL with Vercel.\"}]]}]]}]]}],null],\"segment\":\"__PAGE__\"},\"styles\":[]}],\"segment\":\"home\"},\"styles\":[]}],\"params\":{}}],null]}]]\\n'\r\n            ]);\r\n        </script>\r\n        <script>\r\n            self.__next_f.push([\r\n                1,\r\n                '5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"3\",{\"name\":\"next-size-adjust\"}]]\\na:null\\n'\r\n            ]);\r\n        </script>\r\n    </body>\r\n</html>\r\n```\r\n\r\nThis is mostly fine, except it's doing this crazy thing with the `self.__next_f.push` and that's not helping me with my artifacts.\r\n\r\n# Additional Information\r\n\r\nI have tried modifying webpack to not use chunking. I have tried forcing client only.\r\n\r\nI have my `layout.tsx` file prepended with `\"use client\";` so that every page is supposedly client side only, even though that shouldn't matter.\r\n\r\nI have tried many solutions, but I just cannot figure out what's going here. This is the default application from NextJS. Why does it need to inject so much with JavaScript??\r\n\r\n# Question\r\n\r\nHow the heck do I get these `self.__next_f.push` to stop being generated and remove them entirely?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "I'm using Next.js 13.3 app route, I got self.__next_f.push and .txt file in routed URL", "description": "<img width=\"1130\" alt=\"스크린샷 2023-05-03 오전 12 55 20\" src=\"https://user-images.githubusercontent.com/131772167/235719939-692a0d52-c443-49fc-9840-4b6464cdf91b.png\">\r\n<img width=\"1122\" alt=\"스크린샷 2023-05-03 오전 12 55 27\" src=\"https://user-images.githubusercontent.com/131772167/235719969-210401da-b3ea-445e-9500-0ba0355a5599.png\">\r\n<img width=\"309\" alt=\"스크린샷 2023-05-03 오전 12 55 37\" src=\"https://user-images.githubusercontent.com/131772167/235720004-74da7054-fcc2-41d0-8ebb-daef74aadcdc.png\">\r\n<img width=\"376\" alt=\"스크린샷 2023-05-03 오전 12 59 30\" src=\"https://user-images.githubusercontent.com/131772167/235720749-ea34f968-3c86-47e4-b55e-21656d15c74e.png\">\r\n\r\n\r\nHi there. I'm using Next.js version 13.3. \r\n\r\nI built with output: \"export\" for SSG, and I keep getting txt after the URL whenever I app route.\r\n(npm run build -> npm run start) \r\n\r\nThis is my a tag in first HTML page.\r\n<img width=\"672\" alt=\"스크린샷 2023-05-03 오전 1 00 02\" src=\"https://user-images.githubusercontent.com/131772167/235720937-bed9997b-2ed1-4731-b4ad-b92e00a0301f.png\">\r\n\r\n\r\nIs there any way to fix this?"}
{"sentences": "Server component requires 'use client' to execute server action", "description": "I have following page structure:\r\n\r\n```\r\nimport { Label } from '@/components/ui/label';\r\nimport React, { Suspense } from 'react';\r\nimport ProductList from './ProductList';\r\nimport CreateProductForm from './CreateProductForm';\r\n\r\nexport default async function Products() {\r\n  return (\r\n    <main>\r\n      <Label>Products</Label>\r\n      <Suspense fallback={<Label>Loading Products List...</Label>}>\r\n        <ProductList />\r\n      </Suspense>\r\n      <CreateProductForm />\r\n    </main>\r\n  );\r\n}\r\n```\r\n\r\nAnd CreateProductForm is like this:\r\n\r\n\r\n```\r\nimport { createProductAction } from '@/lib/actions/products/actions';\r\n\r\nexport default function CreateProductForm() {\r\n  return (\r\n    <form\r\n      action={async () => {\r\n        await createProductAction('new product 5');\r\n      }}\r\n    >\r\n      <button type='submit'>Submit</button>\r\n    </form>\r\n  );\r\n}\r\n```\r\n\r\nbut i'm facing issue with the createProductAction action\r\n\r\n```\r\nError: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\".\r\n  <form action={function} children=...>\r\n```\r\n\r\naction file:\r\n\r\n```\r\n'use server';\r\n\r\nimport { createServerActionClient } from '@supabase/auth-helpers-nextjs';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createProductAction(title: string) {\r\n  const cookieStore = cookies();\r\n  const supabase = createServerActionClient({ cookies: () => cookieStore });\r\n  const {\r\n    data: { session }\r\n  } = await supabase.auth.getSession();\r\n  const user = session?.user;\r\n\r\n  if (!user) {\r\n    console.log('User is not authenticated');\r\n    return;\r\n  }\r\n\r\n  const res = await supabase.from('todos').insert({ title, user_id: user?.id });\r\n\r\n  revalidatePath('/products');\r\n}\r\n\r\nexport async function fetchProductsAction() {\r\n  const cookieStore = cookies();\r\n  const supabase = createServerActionClient({ cookies: () => cookieStore });\r\n  const {\r\n    data: { session }\r\n  } = await supabase.auth.getSession();\r\n  const user = session?.user;\r\n\r\n  const { data: todos, error } = await supabase\r\n    .from('todos')\r\n    .select('*')\r\n    .eq('user_id', user?.id);\r\n\r\n  return todos;\r\n}\r\n```\r\n\r\nIn the form if I switch from:\r\n\r\n```\r\naction={async () => {\r\n        await createProductAction('new product 5');\r\n}}\r\n```\r\n\r\nto:\r\n\r\n```\r\naction={async () => {\r\n        'use server'\r\n        await createProductAction('new product 5');\r\n}}\r\n```\r\n\r\nworks as expected but this shouldn't been required?\r\n\r\nAlso there is no parent component that is client so i'm not crossing this boundary basically form is direct child of page.tsx it self \r\n\r\nWhat could be the reason for requiring this use server in server component tree?\r\n\r\n![image](https://github.com/vercel/next.js/assets/32274987/924336a6-3ddc-4a46-875b-8a63fe2a0596)\r\n"}
{"sentences": "Create new Nextjs app", "description": "### Summary\r\n\r\n**I'm trying to create a new NextJS application but I'm getting this error:**\r\n<img width=\"1470\" alt=\"Screenshot 2024-01-14 at 3 31 57 PM\" src=\"https://github.com/vercel/next.js/assets/47941750/40d6336a-62a1-4712-ab66-c00225c4e2b5\">\r\n"}
{"sentences": "need to show product description and varients when a particular product is selected", "description": "### Summary\n\nwhen i click on a particular products i can see only the title, prize and add to cart but not able to see the product description ,when i console log description, descriptionHtml is null what to do?\r\n\r\nproducy {\r\n  id: 'gid://shopify/Product/7898192085142',\r\n  handle: 'the-collection-snowboard-liquid',\r\n  availableForSale: true,\r\n  title: 'The Collection Snowboard: Liquid',\r\n  description: '',\r\n  descriptionHtml: '',\r\n  options: [\r\n  {\r\n  id: 'gid://shopify/ProductOption/10028217893014',\r\n  name: 'Title',\r\n  values: [ 'Default Title' ]\r\n}\r\n],\r\n  priceRange: {\r\n  maxVariantPrice: { amount: '749.95', currencyCode: 'INR' },\r\n  minVariantPrice: { amount: '749.95', currencyCode: 'INR' }\r\n},\r\n  featuredImage: {\r\n  url: 'https://cdn.shopify.com/s/files/1/0628/7530/4086/products/Main_b13ad453-477c-4ed1-9b43-81f3345adfd6.jpg?v=1704172901',\r\n  altText: 'Top and bottom view of a snowboard. The top view shows a stylized scene of water, trees, mountains,\\n        sky and a moon in blue colours. The bottom view has a blue liquid, drippy background with the text “liquid” in\\n        a stylized script typeface.',\r\n  width: 1600,\r\n  height: 1600\r\n},\r\n  seo: { description: null, title: null },\r\n  tags: [ 'Accessory', 'Sport', 'Winter' ],\r\n  updatedAt: '2024-01-10T05:43:14Z',\r\n  images: [\r\n  {\r\n  url: 'https://cdn.shopify.com/s/files/1/0628/7530/4086/products/Main_b13ad453-477c-4ed1-9b43-81f3345adfd6.jpg?v=1704172901',\r\n  altText: 'Top and bottom view of a snowboard. The top view shows a stylized scene of water, trees, mountains,\\n        sky and a moon in blue colours. The bottom view has a blue liquid, drippy background with the text “liquid” in\\n        a stylized script typeface.',\r\n  width: 1600,\r\n  height: 1600\r\n}\r\n],\r\n  variants: [\r\n  {\r\n  id: 'gid://shopify/ProductVariant/42999768383638',\r\n  title: 'Default Title',\r\n  availableForSale: true,\r\n  selectedOptions: [ { name: 'Title', value: 'Default Title' } ],\r\n  price: { amount: '749.95', currencyCode: 'INR' }\r\n}\r\n]\r\n}\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Hard Reload a Route/Component to Reset the state", "description": "### Summary\n\nFrom the docs\r\n\r\n> `router.refresh()`: Refresh the current route. Making a new request to the server, re-fetching data requests, and re-rendering Server Components. The client will merge the updated React Server Component payload without losing unaffected client-side React (e.g. useState) or browser state (e.g. scroll position).\r\n\r\nI want to hard reload a page to lose the current state and reset it to its initial, much like what was possible with `router.reload` in the previous `next/router`. \r\n\r\nHow can I do this?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error: Array must contain at most 50 element(s) at \"images.remotePatterns\"", "description": "### Summary\n\nHi, I'm creating a project showing all Catalonia events in a single place. I'm getting the images from different sources and adding them to `next.config.js`. The problem is that I have reached a limit I didn't know, and there isn't documentation on how to make it work with more than 50 elements. Here's an example of the file:\r\n```\r\n ⚠ Found a change in next.config.js. Restarting the server to apply the changes...\r\nInvalid next.config.js options detected: \r\n    Array must contain at most 50 element(s) at \"images.remotePatterns\"\r\nSee more info here: https://nextjs.org/docs/messages/invalid-next-config\r\n```\r\n```\r\nimages: {\r\n    remotePatterns: [\r\n      { hostname: \"res.cloudinary.com\" },\r\n      { hostname: \"www.tarambana.cat\" },\r\n      { hostname: \"tarambana.cat\" },\r\n      { hostname: \"www.cinemaesbarjo.cat\" },\r\n      { hostname: \"www.teatreauditoricardedeu.cat\" },\r\n      { hostname: \"www.cardedeu.cat\" },\r\n      { hostname: \"www.llinarsdelvalles.cat\" },\r\n      { hostname: \"www.canovesisamalus.cat\" },\r\n      { hostname: \"www.lagarriga.cat\" },\r\n      { hostname: \"www.granollers.cat\" },\r\n      { hostname: \"www.llissadevall.cat\" },\r\n      { hostname: \"www.santantonidevilamajor.cat\" },\r\n      { hostname: \"www.martorelles.cat\" },\r\n      { hostname: \"www.santestevedepalautordera.cat\" },\r\n      { hostname: \"www.smpalautordera.cat\" },\r\n      { hostname: \"www.vilamajor.cat\" },\r\n      { hostname: \"www.parets.cat\" },\r\n      { hostname: \"www.santfeliudecodines.cat\" },\r\n      { hostname: \"www.caldesdemontbui.cat\" },\r\n      { hostname: \"estatics-nasia.dtibcn.cat\" },\r\n      { hostname: \"www.castellbisbal.cat\" },\r\n      { hostname: \"www.matadepera.cat\" },\r\n      { hostname: \"www.montcada.cat\" },\r\n      { hostname: \"www.rellinars.cat\" },\r\n      { hostname: \"www.savall.cat\" },\r\n      { hostname: \"www.staperpetua.cat\" },\r\n      { hostname: \"www.ullastrell.cat\" },\r\n      { hostname: \"www.polinya.cat\" },\r\n      { hostname: \"www.ametlla.cat\" },\r\n      { hostname: \"www.figaro-montmany.cat\" },\r\n      { hostname: \"www.fogarsdemontclus.cat\" },\r\n      { hostname: \"www.llagosta.cat\" },\r\n      { hostname: \"www.martorelles.cat\" },\r\n      { hostname: \"www.montseny.cat\" },\r\n      { hostname: \"www.santfost.cat\" },\r\n      { hostname: \"www.santamariademartorelles.cat\" },\r\n      { hostname: \"www.vallgorguina.cat\" },\r\n      { hostname: \"www.vallromanes.cat\" },\r\n      { hostname: \"www.vilalbasasserra.cat\" },\r\n      { hostname: \"www.vilanovadelvalles.cat\" },\r\n      { hostname: \"alella.cat\" },\r\n      { hostname: \"arenysdemar.cat\" },\r\n      { hostname: \"argentona.cat\" },\r\n      { hostname: \"cabrerademar.cat\" },\r\n      { hostname: \"caldetes.cat\" },\r\n      { hostname: \"calella.cat\" },\r\n      { hostname: \"www.dosrius.cat\" },\r\n      { hostname: \"www.mataro.cat\" },\r\n      { hostname: \"www.montgat.cat\" },\r\n      { hostname: \"www.orrius.cat\" },\r\n      { hostname: \"www.ajllavaneres.cat\" },\r\n    ],\r\n```\r\n\r\nThanks in advance\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://www.esdeveniments.cat/"}
{"sentences": "Error while creating cooking in server action", "description": "Hi friends i am new on Nextjs i try to create cookie in server action, i want to store accessToken and refreshToken in cookie so i pass object to cookie value but it generates this error Error: (intermediate value)(intermediate value)(intermediate value).toUTCString is not a function\r\n\r\n```\r\n'use server';\r\nimport { cookies } from 'next/headers';\r\nconst createCookie = async (data) => {\r\n  cookies().set('token', JSON.stringify(data), {\r\n    secure: true,\r\n    httpOnly: true,\r\n\r\n    expires: data.expiresIn,\r\n  });\r\n};\r\nexport const signUp = async (formData) => {\r\n  const data = {\r\n    email: formData.get('email'),\r\n    password: formData.get('password'),\r\n    returnSecureToken: true,\r\n  };\r\n  const url =\r\n    'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=something';\r\n  const res = await fetch(url, {\r\n    method: 'post',\r\n    headers: {\r\n      'content-type': 'application/json',\r\n    },\r\n    body: JSON.stringify(data),\r\n  });\r\n  const resData = await res.json();\r\n\r\n  createCookie(resData);\r\n  return resData;\r\n};\r\n```\r\n"}
{"sentences": "Not found (not-found.tsx) not using root layout?", "description": "### Summary\r\nHi!\r\n\r\nI'm new to Next.js and trying to get to grips with how it's working. Not doing anything advanced at the moment just getting some data from Strapi and displaying it. I have a few links that should result in a 404 and they do, so I've created a not-found.tsx in the app folder. For some reason it doesn't render my header, nor does it use the html lang attribute or the body class. Any idea why that is?\r\n\r\nI'm expecting the output of not-found.tsx to be a child of the root layout but this doesn't seem to be the case.\r\n\r\n### Additional information\r\n\r\n**layout.tsx**\r\n```\r\nimport './globals.scss'\r\n\r\nimport type { Metadata } from 'next'\r\nimport { Roboto } from 'next/font/google'\r\nimport Header from '@/src/partials/header'\r\n\r\nconst roboto = Roboto({ weight: ['400', '700'], subsets: ['latin'] })\r\n\r\nexport const metadata: Metadata = {\r\n  title: 'Title',\r\n  description: 'Description',\r\n}\r\n\r\nexport default function RootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return (\r\n    <html lang=\"en\">\r\n      <body className={roboto.className}>\r\n        <div className=\"container mx-auto p-4 py-16\">\r\n          <Header />\r\n          {children}\r\n        </div>\r\n      </body>\r\n    </html>\r\n  )\r\n}\r\n```\r\n\r\n**not-found.tsx**\r\n```\r\nimport type { Metadata } from 'next'\r\n\r\nexport const metadata: Metadata = {\r\n  title: 'Test - Not found',\r\n  description: 'Not found',\r\n}\r\n\r\nexport default function NotFound() {\r\n  return (\r\n    <h1 className=\"text-5xl font-bold mb-4\">Page not found</h1>\r\n  )\r\n}\r\n```"}
{"sentences": "Custom api routes using Next.js router", "description": "# Feature request\r\n\r\n## Is your feature request related to a problem? Please describe.\r\n\r\nOne limitation with the `api/` folder is that it requires you to have your api under `/api`. I'd like to define an API directly from the base url. I understand this is possible when using a custom server but I don't want to switch to a custom server since that would remove some performance optimizations that Next's internal router adds.\r\n\r\n\r\n## Describe the solution you'd like\r\n\r\nMaybe it's possible to decide in each file whether it's a page or an api endpoint, like this:\r\n```js\r\n// pages/index.js\r\nimport { api, page } from 'next'\r\n\r\n// an api endpoint\r\nexport default api((req, res) => 'hello')\r\n\r\n// a page\r\nexport default page((props) => 'hello')\r\n```\r\n\r\n_Originally posted by @lucleray in https://github.com/vercel/next.js/issues/7297#issuecomment-493676012_\r\n\r\nOr if we could just use the Next router to custom define the API endpoint, that would be great.\r\n\r\n## Describe alternatives you've considered\r\n\r\nThis example using Express seems to be the best alternative:\r\nhttps://github.com/vercel/next.js/tree/canary/examples/custom-server-express"}
{"sentences": "TypeError: Expected a non-empty string while pushing data to a state", "description": "### Summary\r\n\r\n**Problem Statement:**\r\nI am encountering an issue while attempting to retrieve images from OpenAI's DALL-E API in my `ImagePage component.` Despite successfully obtaining image URLs in the `response.data` from the API, I am facing a `TypeError: Expected a non-empty string` when attempting to update the images state.\r\n\r\n**Code Details:**\r\nBelow is the relevant section of the `ImagePage` component:\r\n\r\n```\r\n  const router = useRouter();\r\n  const [images, setImages] = useState<string[]>([]);\r\n\r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      prompt: \"\",\r\n      amount: \"1\",\r\n      resolution: \"512x512\",\r\n    },\r\n  });\r\n\r\n  const isLoading = form.formState.isSubmitting;\r\n\r\n  const onSubmit = async (values: z.infer<typeof formSchema>) => {\r\n    try {\r\n      setImages([]);\r\n\r\n      const response = await axios.post(\"/api/image\", values);\r\n      console.log(`response.data`, response.data);\r\n\r\n      const urls = response.data.map((image: { url: string }) => image.url);\r\n      console.log(`urls`, urls);\r\n\r\n      setImages(urls);\r\n      console.log(`images`, images);\r\n\r\n      form.reset();\r\n    } catch (error: any) {\r\n      // TODO: open Pro Modal\r\n      console.log(`error`, error);\r\n    } finally {\r\n      router.refresh();\r\n    }\r\n  };\r\n```\r\n**Observations:**\r\n1. Console Logs: The `response.data` and `urls` are correctly logged in the console, indicating that the image URLs are being received from the API.\r\n2. State Update: The issue arises when updating the `images` state using `setImages(urls)`, resulting in an empty `images` state.\r\n\r\n**Request for Assistance:**\r\nI have been trying to debug this for two days. I want some guidance to understand why the `images state` remains empty despite receiving valid image URLs in the `response.data`.\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\n// This is how i display the images\r\n\r\n<div className=\"grid grid-col-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mt-8\">\r\n            {images.map((image) => (\r\n              <Card key={image} className=\"rounded-lg overflow-hidden\">\r\n                <div className=\"relative aspect-square\">\r\n                  <Image alt=\"Image\" fill src={image} />\r\n                </div>\r\n                <CardFooter className=\"p-2\">\r\n                  <Button\r\n                    onClick={() => window.open(image)}\r\n                    variant=\"secondary\"\r\n                    className=\"w-full\">\r\n                    <Download className=\"h-4 w-4 mr-2\" />\r\n                    Download\r\n                  </Button>\r\n                </CardFooter>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n```\r\n"}
{"sentences": "How to only allow API requests from Next.js app", "description": "Does anyone know how to secure the serverless API routes to only be accessible from the web application itself? The app does not require user auth. I want to make sure other websites and servers can not make requests to the API. Only users on the site should be able to take actions that request the API routes."}
{"sentences": "Permission denied when building application", "description": "### Run `next info` (available from version 12.0.8 and up)\n\n_No response_\n\n### What version of Next.js are you using?\n\n12.0.7\n\n### What version of Node.js are you using?\n\n15.8.0\n\n### What browser are you using?\n\nnone\n\n### What operating system are you using?\n\nFreeBSD 12.2-RELEASE-p5\n\n### How are you deploying your application?\n\nnpm run build (next build)\n\n### Describe the Bug\n\nAfter migrating from version 11.1.2 to 12.0.7, I've started getting permission error when building next app. That's true, I don't have permission to /usr/home, because it's hosting server. I actually have permission to /usr/home/USER.\r\n\r\nI've reproduced this issue on new, clean project created using `yarn create next-app --typescript` command. One thing I had to do was to disable SWC (probably not having impact on the issue).\r\n\r\nTrying again on version 11.1.2 passed without issues.\r\n\r\n```\r\n> next build\r\n\r\ninfo  - Checking validity of types  \r\nwarn  - No ESLint configuration detected. Run next lint to begin setup\r\ninfo  - Disabled SWC as replacement for Babel because of custom Babel configuration \".babelrc\" https://nextjs.org/docs/messages/swc-disabled\r\ninfo  - Using external babel configuration from /usr/home/USER/domains/test_app/.babelrc\r\ninfo  - Creating an optimized production build ..<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\ninfo  - Creating an optimized production build ...<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\ninfo  - Creating an optimized production build  \r\ninfo  - Compiled successfully\r\n\r\n> Build error occurred\r\n[Error: EACCES: permission denied, readlink '/usr/home'] {\r\n  errno: -13,\r\n  code: 'EACCES',\r\n  syscall: 'readlink',\r\n  path: '/usr/home'\r\n}\r\ninfo  - Collecting page data .npm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! test_app@ build: `next build`\r\nnpm ERR! Exit status 1\r\nnpm ERR! \r\nnpm ERR! Failed at the test_app@ build script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /home/USER/.npm/_logs/2022-01-07T15_50_10_793Z-debug.log\r\n\r\n```\r\n\r\n\n\n### Expected Behavior\n\nBuilding project does not require any parent directory access permissions.\n\n### To Reproduce\n\nProbably restricting access to parent directories (/usr/home) and trying to build a project."}
{"sentences": "Next 13 is doing a full page refresh instead of client side navigation on route changes", "description": "## The issue\r\n\r\nAfter I upgraded to nextjs 13.1.6, whenever I do `router.push`, what before was just a client-side navigation became a full page reload in my application. As my application is huge this is causing problems as I am using client-side auth and whenever the user changes the page it does a full request to the server and load the authentication all the time. (I have done more tests and confirmed that is happening for other nextjs versions as well - `13.0.0` - but only in the versions deployed on vercel).\r\n\r\nThis is a odd behavior that I've noticed in the last days in two applications.\r\n\r\n## Steps to reproduce:\r\n\r\nI have created a reproduction which is available here https://github.com/lucashfreitas/next-reload-issue and the deployed vercel can be accessed here https://next-reload-issue.vercel.app/page1. \r\n\r\n1. import router from `next/navigation`.\r\n2. Do a `router.push` to another page in the `app` directory.\r\n3. Note that next will trigger a `document` request or a full refresh.\r\n4. After confirming the issue, if you run `next build` and `next start` and run the production version locally the issue is not present - atm it's only happening in vercel environment.\r\n\r\nHere is a discord thread, a few users have also reported this issue: https://discord.com/channels/752553802359505017/1077904797098856458 \r\n\r\n## Environment tested\r\n\r\n- Next: 13.1.6 & Next 13.0.0\r\n- app folder: true\r\n- node version: v16.19.0\r\n\r\n\r\n\r\n"}
{"sentences": "NEXT JS POST REQUEST ISSUE", "description": "### Summary\r\n\r\nHi , I recently used Next.js to build a simple blog. Everything is working well. I also successfully implemented authentication using NextAuth package . However, the main issue is that when I created a simple registration page to store user information in the database, unfortunately, I encountered a problem.\r\n![issue](https://github.com/vercel/next.js/assets/149194772/89802132-78cd-4d87-a303-0fa370c0ddcf)\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\n// register page\r\n\r\n\"use client\";\r\n\r\nimport Link from \"next/link\";\r\n\r\nimport { useState } from \"react\";\r\n\r\nconst Register = () => {\r\n  const [username, setUsername] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!username || !email || !password) {\r\n      setErr(\"Please fill in all fields\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\"api/signup\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          username,\r\n          email,\r\n          password,\r\n        }),\r\n      });\r\n\r\n      if (res.ok) {\r\n        const form = e.target;\r\n        form.reset();\r\n      } else {\r\n        console.log(\"Failed to register\" , res.status);\r\n      }\r\n    } catch (error) {\r\n      console.log(\"ERROR\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col gap-8 justify-center items-center p-5\">\r\n      <h2 className=\"font-bold text-4xl\">Sign Up</h2>\r\n      <form\r\n        onSubmit={handleSubmit}\r\n        className=\"flex flex-col gap-5 lg:w-1/3 w-full\"\r\n      >\r\n        <input\r\n          onChange={(e) => setUsername(e.target.value)}\r\n          placeholder=\"Username\"\r\n          type=\"text\"\r\n          className=\"text-white  rounded-md outline-none p-2 bg-transparent border border-teal-500 placeholder:text-sm\"\r\n        />\r\n        <input\r\n          onChange={(e) => setEmail(e.target.value)}\r\n          placeholder=\"Email\"\r\n          type=\"email\"\r\n          className=\"text-white  rounded-md outline-none p-2 bg-transparent border border-teal-500 placeholder:text-sm\"\r\n        />\r\n        <input\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          placeholder=\"Password\"\r\n          type=\"password\"\r\n          className=\"text-white  rounded-md outline-none p-2 bg-transparent border border-teal-500 placeholder:text-sm\"\r\n        />\r\n        {err && <p className=\"text-red-500 text-sm\">{err}</p>}\r\n        <button className=\"bg-teal-500 text-white p-2 rounded-md shadow-lg shadow-teal-500/50\">\r\n          Register\r\n        </button>\r\n      </form>\r\n      <Link href=\"/login\">Login With an existing account</Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Register;\r\n\r\n```\r\n```\r\n// signup.js\r\nimport UserModel from \"/app/models/User\";\r\nimport connect from \"/app/utils/db\";\r\nimport { NextResponse } from \"next/server\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    await connect();\r\n    const { username, email, password } = request.json();\r\n    const saltRounds = 10;\r\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\r\n\r\n    const user = await UserModel.create({\r\n      username,\r\n      email,\r\n      password: hashedPassword,\r\n    });\r\n\r\n    return new NextResponse(JSON.stringify(user), {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: {\r\n        data: JSON.stringify(user),\r\n        status: 200,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error while creating user:\", error);\r\n    return new NextResponse(`Error while creating user: ${error}`, {\r\n      status: 500,\r\n    });\r\n  }\r\n}\r\n\r\n```\r\n\r\n```\r\nuser model\r\n\r\nimport mongoose, { Schema } from \"mongoose\";\r\n\r\nconst UserSchema = new Schema(\r\n  {\r\n    username: { type: String, required: true },\r\n    email: { type: String, required: true },\r\n    password: { type: String, required: true },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nconst UserModel = mongoose.models.User || mongoose.model(\"User\", UserSchema);\r\n\r\nexport default UserModel;\r\n\r\n\r\n```\r\n\r\nim using cloud.mongodb and mongoose , nextauth and NEXT.js 14\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Failed to load plugin '@next/next' declared in '.eslintrc.js'", "description": "```bash\r\nerror - ESLint: Failed to load plugin '@next/next' declared in '.eslintrc.js': Unexpected token '.' Referenced from: \r\ninfo  - Creating an optimized production build...\r\nwarn  - Found lockfile missing swc dependencies, run next locally to automatically patch\r\n```"}
{"sentences": "Does _document's getInitialProps invalidate Auto Static Optimization?", "description": "Building the `with-styled-components` example which uses `getInitialProps` in `_document.js` gives me this cli output\r\n\r\n![image](https://user-images.githubusercontent.com/12380586/103147121-935e6d80-475a-11eb-812e-b705a0a49e1d.png)\r\n\r\nWhilst the docs mention that `getInitialProps will disable Automatic Static Optimization.` In the [_document docs](https://nextjs.org/docs/advanced-features/custom-document)\r\nit is mentioned that `Document's getInitialProps function is not called during client-side transitions, nor when a page is statically optimized.`.\r\n\r\nIn conclusion, although the build output suggests that the pages are static, I'm confused as to whether that's actually the case."}
{"sentences": "Next.js doesn't respect Browserslist", "description": "Out of the box, defining a [browserslist](https://github.com/browserslist/browserslist) query [the standard ways](https://github.com/browserslist/browserslist#config-file) in your project (e.g. via a `package.json` `browserslist` field) is not respected by Next.js for builds.\r\n\r\nI see people hardcoding a query into the Next.js Babel preset config, like this:\r\n\r\nhttps://github.com/zeit/next.js/blob/fa5be4971ad1a3fb8f6214d8f21cc03ca60d6457/test/integration/babel-custom/fixtures/targets-string/.babelrc#L7\r\n\r\nBut that is a poor solution as Browserslist won't find the query for other tools (e.g. ESLint plugins).\r\n\r\nI'm not even sure what it does, since Next.js customises the `@babel/preset-env` `targets` for the server build, and maybe differently for 2 versions of the client build (modern?) but that's not documented anywhere. Does Next.js respect your query, but then exclude more targets on top, or does it totally ignore it?\r\n\r\nIdeally we should be able to specify our Browserslist queries the standard ways, and Next.js will never add targets on top of it - only intersect that query and possibly reduce the number of targets as a result for the special builds."}
{"sentences": "How can I quickly find all TypeScript errors?", "description": "Next.js fails the build when it finds TypeScript errors. How can I find those errors without running `next build`? `next build` is slow and only reports one error at a time. VSCode only reports errors in files that are currently open."}
{"sentences": "Where can I find a changelog for human?", "description": "### Summary\n\nhttps://github.com/vercel/next.js/releases doesn't help me find changes from next@13.3.4 to @13.5.4.\r\n\r\nI literally don't understand what could have changed there and how it will affect me.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Next.js sends back empty html from the server", "description": "Next.js does client Side rendering although build status shows my pages to be prerendered at the server-side, as far as I could understand I should get some HTML in the response of next.js server instead I get a blank page(no HTML) and what happens is my whole app is client-side rendered ruining the whole purpose of getting next.js.\r\n\r\n\r\nmy expected behavior for my app should be that I should get HTML inside the page source but what I am actually getting is an empty div with id=\"__next\" as a response with some scripts to generate the page using CSR; ruining the whole purpose of using next.js.\r\n\r\nalthough the build shows that my particular page is a static one, seeing which I expect a pre-rendered HTML but even if I use getserversideprops or getstaticprops to enforce the behaviour, all in vain...\r\n![image](https://user-images.githubusercontent.com/57627350/90756085-91daef80-e2f9-11ea-8cf9-5e481799ca28.png)\r\n\r\nPage Source : \r\n![image](https://user-images.githubusercontent.com/57627350/90758418-a10f6c80-e2fc-11ea-97a8-e646e5f3b994.png)\r\n\r\n\r\n\r\n\r\nCan someone tell me where exactly am I going wrong? \r\nPlease excuse any stupidity if you find considering the fact that I am a complete beginner.\r\n\r\nThanks in advance."}
{"sentences": "getInitialProps not saving to store - redux-toolkit & next-redux-wrapper", "description": "Hi there.\r\nI've got a very weird problem that when I'm calling store dispatch in `getInitialProps` in `_app.ts`, and then `console.log` store state it is correct, but it is not saved to actual store - redux devtool is still displaying initial state.\r\nIf I call the same reducer client side it is working correctly.\r\n\r\n`_app.ts`\r\n```\r\nMyApp.getInitialProps = async ({Component, ctx}) => {\r\n  const { req, store } = ctx;\r\n  await store.dispatch(init());\r\n\r\n  console.log(store.getState('test'))\r\n\r\n  return {\r\n    pageProps: {\r\n      ...(Component.getInitialProps ? await Component.getInitialProps(ctx) : {}),\r\n    },\r\n    pathname: (req && req.url) || ctx.pathname,\r\n  };\r\n}\r\n\r\nexport default wrapper.withRedux(MyApp);\r\n```\r\n\r\n`store.ts`\r\n```\r\nimport testReducer from './slices/testSlice';\r\n\r\nexport const makeStore: MakeStore = () => configureStore({\r\n  reducer: {\r\n    test: testReducer,\r\n  },\r\n  middleware: getDefaultMiddleware(),\r\n  devTools: process.env.NODE_ENV !== 'production',\r\n});\r\n\r\n\r\nexport const wrapper = createWrapper(makeStore);\r\n```\r\n\r\n`testSlice.ts`\r\n```\r\nexport const increment = createAction('increment')\r\nexport const decrement = createAction('decrement')\r\n\r\nexport const init = createAsyncThunk(\r\n  'test/init',\r\n  async (_, thunkAPI) => {\r\n    const test1 = new Promise((resolve, reject) => {\r\n      setTimeout(() => {\r\n        resolve(10);\r\n      }, 500);\r\n    });\r\n\r\n    try {\r\n      const response = test1;\r\n\r\n      return response;\r\n    } catch (error) {\r\n      return thunkAPI.rejectWithValue({ error: error.message })\r\n    }\r\n  }\r\n)\r\n\r\nconst testSlice = createSlice({\r\n  name: 'test',\r\n  initialState: 0,\r\n  reducers: {},\r\n  extraReducers: builder => {\r\n    builder\r\n      .addCase(increment, state => {\r\n        return state += 1;\r\n      })\r\n      .addCase(decrement, state => {\r\n        return state -= 1;\r\n      })\r\n      .addCase(init.pending, state => {\r\n        return state = 0;\r\n      })\r\n      .addCase(init.fulfilled, (state, action) => {\r\n        return state = action.payload;\r\n      })\r\n      .addCase(init.rejected, state => {\r\n        return state = 0;\r\n      })\r\n  },\r\n})\r\n\r\nexport const selectTest = createSelector(\r\n  (state) => ({\r\n    test: state,\r\n  }),\r\n  (state) => state\r\n)\r\n\r\nexport default testSlice.reducer\r\n```\r\n\r\nAnyone ever had similar issue?"}
{"sentences": "Blank screen on Vercel deployment", "description": "### Summary\n\nHi, I just deployed my Next.js app on Vercel but it gets a blank screen. If I build and run it locally it doesn't do this and works perfectly fine. I looked at the Source tab and the only files listed in the output are favicon.ico, index.html, manifest.json, robots.txt. I use a monorepo but I've already set the root directory to the correct directory.\r\n\r\nYou can see the deployment here: https://qw-app.vercel.app/\r\n\r\nThere are no errors in the console and the logs in Vercel are empty. I've deployed other apps in Next.js without issue, this particular one is a migration from Create React App maybe I've missed something...\n\n### Additional information\n\n```js\nOperating System:\r\n  Platform: darwin\r\n  Arch: arm64\r\n  Version: Darwin Kernel Version 23.2.0: Wed Nov 15 21:53:18 PST 2023; root:xnu-10002.61.3~2/RELEASE_ARM64_T6000\r\nBinaries:\r\n  Node: 21.4.0\r\n  npm: 10.2.4\r\n  Yarn: 1.22.19\r\n  pnpm: N/A\r\nRelevant Packages:\r\n  next: 14.0.5-canary.27\r\n  eslint-config-next: 14.0.4\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 4.9.4\r\nNext.js Config:\r\n  output: N/A\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Same code, same dependencies, and one build has: Uncaught Error: Minified React error #423;", "description": "I do not have particular code example. I haven't any issues with build locally on mac. On digitalocean server I also have no issues within 3 cases of 4.\r\n\r\n<img width=\"1433\" alt=\"Screenshot 2023-12-24 at 16 32 54\" src=\"https://github.com/vercel/next.js/assets/887178/acdd898b-1bb2-4ffc-b51f-42658f9eaea8\">\r\n\r\nFor example: \r\n[https://wwc.nature.football/](url) works good, build good\r\n[https://nac.nature.football/](url) works good, build with errors\r\n\r\n <img width=\"1438\" alt=\"Screenshot 2023-12-24 at 16 36 26\" src=\"https://github.com/vercel/next.js/assets/887178/c8c114bc-a2b3-4384-9e8f-143cf5d8110e\">\r\n\r\n<img width=\"1436\" alt=\"Screenshot 2023-12-24 at 16 36 35\" src=\"https://github.com/vercel/next.js/assets/887178/f4fe959d-3a5b-464e-9a37-d5c830308fd3\">\r\n\r\nNode version: 18.18.0\r\n\r\n```\r\n{\r\n  \"name\": \"hobby as is (c)\",\r\n  \"version\": \"0.2.27\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"execute\": \"npx ts-node -P tsconfig.json src/simulator/execute/execute.ts\",\r\n    \"execute:test\": \"npx ts-node -P tsconfig.json src/simulator/execute/test-execute.ts\",\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\",\r\n    \"prisma:merge\": \"npx prismerge -i prismerge.json\",\r\n    \"prisma:generate\": \"npx prisma generate --schema ./src/database/schema.prisma\",\r\n    \"prisma:migrate\": \"npx prisma migrate dev --schema ./src/database/schema.prisma\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@prisma/client\": \"5.3.1\",\r\n    \"@tailwindcss/typography\": \"^0.5.10\",\r\n    \"@types/node\": \"^20.6.3\",\r\n    \"@types/react\": \"18.2.22\",\r\n    \"@types/react-dom\": \"18.2.7\",\r\n    \"autoprefixer\": \"10.4.15\",\r\n    \"next\": \"14.0.3\",\r\n    \"nprogress\": \"^0.2.0\",\r\n    \"postcss\": \"8.4.30\",\r\n    \"prisma\": \"^5.3.1\",\r\n    \"react\": \"18.2.0\",\r\n    \"react-dom\": \"18.2.0\",\r\n    \"tailwind-merge\": \"^1.14.0\",\r\n    \"tailwindcss\": \"3.3.3\",\r\n    \"typescript\": \"5.2.2\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@prisma-utils/prismerge\": \"^1.7.0\",\r\n    \"commander\": \"^11.0.0\",\r\n    \"dotenv\": \"^16.3.1\",\r\n    \"prettier\": \"^3.0.3\",\r\n    \"ts-node\": \"^10.9.1\",\r\n    \"tsconfig-paths\": \"^4.2.0\"\r\n  }\r\n}\r\n\r\n```\r\n\r\n```\r\n/** @type {import('next').NextConfig} */\r\nconst path = require('path')\r\n\r\nconst nextConfig = {\r\n  output: 'export',\r\n  distDir: 'build',\r\n  compress: false,\r\n  reactStrictMode: true,\r\n  swcMinify: true,\r\n  trailingSlash: true,\r\n  generateEtags: false,\r\n  experimental: {\r\n    appDir: true,\r\n    scrollRestoration: true\r\n  },\r\n  images: { unoptimized: true }\r\n}\r\n\r\nmodule.exports = nextConfig\r\n\r\n```\r\n\r\nI think it's not related to the Next directly, maybe something with dependencies, but I wondering why it works in other cases?"}
{"sentences": ".next/cache in production", "description": "Is `.next/cache` folder needed in production for production server and build to work? \r\n\r\nIt has a substantial size so not uploading into into Docker image would be great save of space.\r\n"}
{"sentences": "opengraph-image.jpg in public folder", "description": "### Summary\n\nHi everyone,\r\n\r\nI'm trying to set all the metadata in my application and I encountered an error (unless I'm doing something wrong) with the og:image implementation. According to the documentation, I can drop a file named \"opengraph-image.jpg\" somewhere in the \"route segment\". I tried leaving it in the public folder. And seemingly everything is ok because in devtools in I see , but in sharing debugger the image does not display. Only after uploading the file to /app did everything work.\r\n\r\nIs this a bug or is this what I should do?\r\n\r\nPs: favicon.ico in public folder works perfectly.\r\nPs2: This is my first approach to next.js and I'm probably doing something wrong for which I apologize in advance.\r\n\r\nThanks! <3\n\n### Additional information\n\n```js\nError message at sharing debugger \"Could not be processed as an image because it has an invalid content type\" when the image is in public folder\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Page is blocked from indexing, according to web.dev/meaure", "description": "Blocking Directive Source\r\n--\r\nX-Robots-Tag: noindex\r\n\r\n![Screen Shot 2563-06-18 at 19 58 28](https://user-images.githubusercontent.com/21255931/85022877-172d1100-b19e-11ea-8b2b-3fcb368759b9.png)\r\n\r\nThis is the url -- https://jpdiary-git-next-privacy.patarapolw.vercel.app/"}
{"sentences": "Next 13.3.0 DELETE HTTP method issue ( Edit: issue still persists in 13.4 ( April 6, 2023 - May 6, 2023 ))", "description": "### Summary\r\n\r\nI'm creating a CRUD application to play around with the new app directory and I've encountered a problem when upgrading to Next JS 13.3.0: \r\n\r\nFor some reason, \"DELETE\" does not work in the api endpoints. Prior to 13.3, I was working with 13.2.4 and I've never encountered that issue. \r\n\r\nI do apologize in advance if my explanation of the issue is a bit hard to understand ( I am a bit of a novice fullstack dev ), but I will try my best.\r\n\r\nHere's my code: \r\n\r\nDELETE fn\r\n```typescript\r\nexport async function DELETE(request: Request) {\r\n    const post = await ValidateRequest(request, 'DELETE')\r\n    if (post instanceof Error) return failedResponse(post, badRequest)\r\n    try {\r\n        // Identify the specific post\r\n        const postDoc = doc(db, 'posts', post.id!)\r\n\r\n        await deleteDoc(postDoc)\r\n    } catch (err) {\r\n        // On network error\r\n        const error = err as Error\r\n        return failedResponse(error, fetchFail)\r\n    }\r\n    return new Response(JSON.stringify(post), responseSuccess)\r\n}\r\n```\r\n\r\nValidation method for request body\r\n```typescript\r\nasync function ValidateRequest(request: Request, HTTP: HTTP){\r\n    let post: PostObj;\r\n    try {\r\n        console.log(request)\r\n        post = await request.json()\r\n        console.log(post)\r\n        switch (HTTP){\r\n            // Check if its missing any required properties (for each method)\r\n            .....\r\n            case 'DELETE' : {\r\n                if (!post.id){\r\n                    throw new Error(`\\nInvalid 'post' request body:\r\n                        id?               ${post.id ? 'OK' : 'MISSING'}\r\n                    `)\r\n                }\r\n                break;\r\n            }\r\n            .....\r\n            default : {\r\n                throw new Error('Unknown HTTP method')\r\n            }\r\n        }\r\n    } catch (err) {\r\n        // Error if missing any properties\r\n        console.log(err)\r\n        return err as Error\r\n    }\r\n    // Will return if valid \r\n    return post\r\n}\r\n```\r\n\r\nThe fetcher fn\r\n```typescript\r\nexport async function mutatePost(method: HTTP, content: {}): Promise<void> {\r\n    if (method === 'GET') return \r\n    const res = await fetch(`${url}/api/posts`, {\r\n        method: method,\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify(content)\r\n    })\r\n    if (!res.ok) {\r\n        console.log(await res.json())\r\n    }\r\n}\r\n```\r\n( Please note that the other DELETE fns are similar just different data )\r\n\r\nWith that being said, for some reason it \"works\" with useSWR hook. The reason why i put quotes on \"works\" is bc it doesn't really call the DELETE method, but it still manages to do the job. I've checked this by putting console.log() everywhere to find out what's going on, but this is for the first time i was so genuinely confused. \r\n\r\nThat these errors ( or lack thereof if I'm using useSWR ) occured after I've upgraded from 13.2.4 to 13.3.0. \r\n\r\n( The error is usually just a Syntax Error for some reason: Error: Unexpected end of JSON input )\r\n\r\nAfter downgrading back to 13.2.4, all went back to normal. Does anyone else have this problem?\r\n\r\n### Additional information\r\n\r\n```\r\nJust in case: \r\n\r\n\r\n\"dependencies\": {\r\n    \"@next/bundle-analyzer\": \"^13.2.4\",\r\n    \"@types/node\": \"18.15.0\",\r\n    \"@types/react\": \"18.0.28\",\r\n    \"@types/react-dom\": \"18.0.11\",\r\n    \"encoding\": \"^0.1.13\",\r\n    \"firebase\": \"^9.17.2\",\r\n    \"framer-motion\": \"^10.10.0\",\r\n    \"next\": \"^13.2.4\",\r\n    \"popmotion\": \"^11.0.5\",\r\n    \"react\": \"18.2.0\",\r\n    \"react-dom\": \"18.2.0\",\r\n    \"swr\": \"^2.1.1\",\r\n    \"typescript\": \"4.9.5\",\r\n    \"zustand\": \"^4.3.7\"\r\n  }\r\n```\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Next.js Link Component Not Updating Dynamic Pages on Subsequent Navigation", "description": "### Summary\n\nhref link is given using next/link.\r\nBut for dynamic pages, when right click and select open in new tab then page is not load and no api call send.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "OG Image Not Working", "description": "### Summary\n\nOG Image Not Working is not working on Vercel but working on the on LocalHost. And also i am not using Noto Sans. I am using Jost for custom font.\r\n\r\n<img width=\"1414\" alt=\"Screenshot 2023-12-21 at 2 53 20 PM\" src=\"https://github.com/vercel/next.js/assets/12649422/1146ed1d-0f28-48f7-b8f5-b33fc4cd3a67\">\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://quillcheckv3-frontend-git-og-image-front-qa.vercel.app/eth/0xe0f63a424a4439cbe457d80e4f4b51ad25b2c56c"}
{"sentences": "does next js 14 has pages router or now only app router?", "description": "does next js 14 has pages router or now only app router?\r\n"}
{"sentences": "next/font/google does not create CSS Variables after refresh", "description": "### Summary\n\nVery weird issue. I am using `next/font/google` to get fonts using CSS Variables. In dev mode, the first render after starting the server works perfectly - fonts are loaded and shown correctly. If I refresh the browser, fonts are no longer loaded because the CSS Variables are missing.\r\n\r\nIn production mode, fonts are loaded correctly even after refresh because CSS Variables exist even afte refresh.\r\n\r\nNext.js version: 13.5.6\r\n\r\n### First load\r\n![image](https://github.com/vercel/next.js/assets/1220198/70d6739a-2d1f-41bf-8ad6-47dad4106732)\r\n\r\n### After refresh\r\nCSS Variables are lost\r\n\r\n![image](https://github.com/vercel/next.js/assets/1220198/38d6d650-d9b1-4d01-afac-dabbcafd7449)\r\n\r\n\n\n### Additional information\n\n```js\nimport { Inter, Roboto_Mono as RobotoMono } from 'next/font/google';\r\n\r\nconst inter = Inter({\r\n  subsets: ['latin'],\r\n  variable: '--font-family-sans',\r\n  display: 'swap',\r\n});\r\nconst robotoMono = RobotoMono({\r\n  subsets: ['latin'],\r\n  variable: '--font-family-mono',\r\n  display: 'swap',\r\n});\r\n\r\ninterface RootLayoutProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function RootLayout({ children }: RootLayoutProps) {\r\n  return (\r\n    <html\r\n      className={`${inter.variable} ${robotoMono.variable} theme-light`}\r\n      lang=\"en\"\r\n    >\r\n      <body className=\"bg-base text-primary antialiased\">\r\n        Hello World\r\n      </body>\r\n    </html>\r\n  );\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Are there any downsides or limitations of using Next.js api routes instead of custom server?", "description": "I have a huge backend application using Express, with many routes, middlewares, databases etc. Is it possible to recreate all of these features and others using Next.js API routes and is it worth to do so? What are the downsides of using API routes?"}
{"sentences": "how to get the client Ip address in app router?", "description": "how to get the client Ip address in app router?"}
{"sentences": "How do I use css variables with css modules in Next.JS", "description": "How do I make other modules share similar values like colours? I have tried using composes, it only works when I declare styles for each element as a class. @value syntax isn't working at all.\r\n\r\n```\r\n.links {\r\n    //styles\r\n}\r\n\r\n.links a {\r\n  //composes doesn't work here\r\n}\r\n```"}
{"sentences": "Vercel deployment failing with \"ReferenceError: document is not defined\"", "description": "### Issue\r\nI've been trying to deploy my project ([cryptoTracker](https://github.com/rudy-patel/cryptoTracker)) on Vercel, but I'm running into some issues that don't seem to come up locally.\r\n\r\n### Background\r\nI've seen lots of people having similar issues, have tried most of the suggestions, but no luck... I'm trying to deploy my project through Vercel, and my project builds fine locally (`npm run build`, `npm run dev`, and `npm start` all seem to be working).\r\n\r\nFor reference, here is the project I'm trying to deploy: [cryptoTracker](https://github.com/rudy-patel/cryptoTracker)\r\n\r\n### Stack trace\r\nWhen trying to deploy on Vercel, I'm getting the stack trace shown below:\r\n\r\n```\r\n20:57:49\tCloning github.com/rudy-patel/cryptoTracker (Branch: main, Commit: 83bbd80)\r\n20:57:50\tCloning completed in 1512ms\r\n20:57:50\tAnalyzing source code...\r\n20:57:51\tInstalling build runtime...\r\n20:57:52\tBuild runtime installed: 1871.789ms\r\n20:57:54\tLooking up build cache...\r\n20:57:54\tBuild cache not found\r\n20:57:55\tInstalling dependencies...\r\n20:58:00\t> sharp@0.26.3 install /vercel/workpath0/node_modules/sharp\r\n20:58:00\t> (node install/libvips && node install/dll-copy && prebuild-install) || (node-gyp rebuild && node install/dll-copy)\r\n20:58:00\tinfo sharp Using cached /vercel/.npm/_libvips/libvips-8.10.0-linux-x64.tar.br\r\n20:58:01\t> @ampproject/toolbox-optimizer@2.7.1-alpha.0 postinstall /vercel/workpath0/node_modules/@ampproject/toolbox-optimizer\r\n20:58:01\t> node lib/warmup.js\r\n20:58:01\tBrowserslist: caniuse-lite is outdated. Please run:\r\n20:58:01\tnpx browserslist@latest --update-db\r\n20:58:02\tAMP OPTIMIZER Downloaded latest AMP runtime data.\r\n20:58:02\tnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.3.2 (node_modules/fsevents):\r\n20:58:02\tnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.3.2: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"})\r\n20:58:02\tadded 317 packages from 350 contributors in 6.346s\r\n20:58:02\t27 packages are looking for funding\r\n20:58:02\t  run `npm fund` for details\r\n20:58:02\tRunning \"npm run build\"\r\n20:58:02\t> crypto-tracker@0.1.0 build /vercel/workpath0\r\n20:58:02\t> next build\r\n20:58:03\tinfo  - Creating an optimized production build...\r\n20:58:03\tAttention: Next.js now collects completely anonymous telemetry regarding usage.\r\n20:58:03\tThis information is used to shape Next.js' roadmap and prioritize features.\r\n20:58:03\tYou can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n20:58:03\thttps://nextjs.org/telemetry\r\n20:58:11\tinfo  - Compiled successfully\r\n20:58:11\tinfo  - Collecting page data...\r\n20:58:11\t> Build error occurred\r\n20:58:11\tReferenceError: document is not defined\r\n20:58:11\t    at new StyleSheet (/vercel/workpath0/node_modules/styled-jsx/dist/lib/stylesheet.js:40:35)\r\n20:58:11\t    at new StyleSheetRegistry (/vercel/workpath0/node_modules/styled-jsx/dist/stylesheet-registry.js:26:33)\r\n20:58:11\t    at Object.<anonymous> (/vercel/workpath0/node_modules/styled-jsx/dist/style.js:15:26)\r\n20:58:11\t    at Module._compile (internal/modules/cjs/loader.js:1063:30)\r\n20:58:11\t    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\r\n20:58:11\t    at Module.load (internal/modules/cjs/loader.js:928:32)\r\n20:58:11\t    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\r\n20:58:11\t    at Module.require (internal/modules/cjs/loader.js:952:19)\r\n20:58:11\t    at require (internal/modules/cjs/helpers.js:88:18)\r\n20:58:11\t    at Object.<anonymous> (/vercel/workpath0/node_modules/styled-jsx/dist/server.js:9:14)\r\n20:58:11\t    at Module._compile (internal/modules/cjs/loader.js:1063:30)\r\n20:58:11\t    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\r\n20:58:11\t    at Module.load (internal/modules/cjs/loader.js:928:32)\r\n20:58:11\t    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\r\n20:58:11\t    at Module.require (internal/modules/cjs/loader.js:952:19)\r\n20:58:11\t    at require (internal/modules/cjs/helpers.js:88:18)\r\n20:58:11\tnpm ERR! code ELIFECYCLE\r\n20:58:11\tnpm ERR! errno 1\r\n20:58:11\tnpm ERR! crypto-tracker@0.1.0 build: `next build`\r\n20:58:11\tnpm ERR! Exit status 1\r\n20:58:11\tnpm ERR! \r\n20:58:11\tnpm ERR! Failed at the crypto-tracker@0.1.0 build script.\r\n20:58:11\tnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n20:58:11\tnpm ERR! A complete log of this run can be found in:\r\n20:58:11\tnpm ERR!     /vercel/.npm/_logs/2021-02-17T03_58_11_341Z-debug.log\r\n20:58:11\tError: Command \"npm run build\" exited with 1\r\n20:58:14\tDone with \"package.json\"\r\n```\r\n\r\n### Things I have tried\r\n* adding `node_modules` to my `.gitignore`\r\n* changing `Layout.js` to `layout.js`\r\n* messing around with the `\"scripts` section in `package.json`\r\n\r\nAny help and/or suggestions would be appreciated!"}
{"sentences": "IP addresses of Vercel servers", "description": "### Summary\n\nOur [site](https://thepopulationproject.org) is build on Next.js and hosted by Vercel. It makes lots of API calls to the back-end to build dynamic pages. As could be expected, our back-end receives a ton of unwanted calls that have nothing do with the site, yet use up our resources. \r\nSince the site is the only authorized user of the API, my idea would be to disallow all API calls other than those coming from Vercel's IP addresses. Is there such a list? I understand Vercel uses dynamic IP but still they must have a range of addresses.\r\nAny help will be greatly appreciated :)\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Access client IP address in server action", "description": "I've been experimenting with server actions, since I like the progressive enhancement approach.\r\n\r\nFor auditing reasons, I need to access the IP address of the client making the request. \r\n\r\nI haven't seem able to find a way to access this, is it possible? If I'm not mistaken, the function only gets passed the formData, and nothing else."}
{"sentences": "Geolocation Header on every request from node server.", "description": "Is there any way thru which we can attach the geolocation header which we get from Cloudflare to every request from node server?"}
{"sentences": "Middleware with geolocation", "description": "I have a question about the nextjs page middleware, [see here](https://nextjs.org/docs/advanced-features/middleware), according to the documentation the request object should contain geo, IP, ua, cookies and nexturl properties.\r\n\r\nSo all I am trying to do is get the users location through page middleware like this:\r\n\r\n```js\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function middleware(req) {\r\n  const { nextUrl, geo } = req;\r\n  console.log(geo) //=> always empty {}\r\n  const country = geo.country || 'US'\r\n  nextUrl.searchParams.set('locale', country);\r\n\r\n\r\n  return NextResponse.rewrite(nextUrl);\r\n}\r\n ```\r\n \r\n But when I run my project locally the geolocation is an empty object, why?\r\n\r\nWill all hosting providers send geolocation data, or does it depend on the provider?"}
{"sentences": "Why can't getStaticProps include the \"req\" object when not executed during build", "description": "I understand that when `getStaticProps` is ran during the build time we cannot have the `req` object, as there isn't any request being made, but what if there  is? Like on a cache revalidate request, where the user receives the old content while the new one is being regenerated, (_stale-while-regenerate_).\r\n\r\nIn this case, the `getStaticProps` function is being triggered by a request, so why can't i have the `req` object?"}
{"sentences": "NextJS App Router Course - Question where are the images stored?", "description": "### Summary\n\nHi! I am in the process of doing the Next JS course and right now at the point [Fetching data for LatestInvoices](https://nextjs.org/learn/dashboard-app/fetching-data#fetching-data-for-latestinvoices)\r\n\r\nIt works and I have no issues here. But however I am wondering where the` image_url: '/customers/lee-robinson.png',` are coming from? I see them in the placeholder-data.js but cannot find the actual images? Where are they stored? And how could they end up in the Vercel postgres database - I mean how can they be accessed as I do not see where they are? I actually feel stupid for asking that but I am somewhat confused about storing images in the database. I hope someone can help me please and clarify it?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Share the data and full route caches across multiple instances", "description": "### Summary\n\nCaching and revalidation with revalidatePath and revalidateTag works fine if I serve my app from a single running instance. Most non-toy applications will need to run multiple instances for redundancy and for horizontal scaling. Some of these instances will need to run on multiple machines as well to guard against hardware failures. If the cache is not shared or synchronized across these instances, the app may serve stale data which may not be acceptable. Is there a general solution to this problem? Without a solution I have two options: 1) run my app in a single instance, 2) opt out of the nextjs data cache. Neither option is very appealing.  Any guidance would be greatly appreciated.\r\n\r\nThank you\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Fast Refresh takes 20+ seconds to trigger", "description": "I'm having an issue regarding to Fast Refresh on all our pages. Currently, each change triggers Fast Refresh after at least 20 to 30 seconds.\r\n\r\nEnv: Mac M2, 32GB"}
{"sentences": "Multi page form cache issue", "description": "### Summary\n\nHello everyone,\r\n\r\nI'm trying to use a js object to cache objects during multistep form in order to put them in DB at the end of the form.\r\n\r\nIt works locally, it works with docker deployment, but it does not work with Vercel.\r\n\r\nHere is how I do: \r\n\r\ni) Contact form page. When I click next, it calls a server action in another file:\r\n\r\n```\r\nconst CONTACT_CACHE = {}\r\n\r\nconst handleNewContact = async (contactId, formData) => {\r\n  CONTACT_CACHE[contactId] = {data0: formData.get(0), ...};\r\n} \r\n```\r\n\r\nThen it redirects to my next form page, with contactId as search param, which is about place informations.\r\n\r\nFirst I call a server action to store the contactId\r\n\r\n```\r\nconst PLACE_CACHE = {}\r\n\r\nconst handleContactId = async (contactId, placeId) => {\r\n  PLACE_CACHE[placeId] = {contactId: contactId};\r\n} \r\n```\r\n\r\nThen I add my place form info:\r\n```\r\nconst handlePlaceForm = async (placeId, formData) => {\r\n  PLACE_CACHE[placeId] = {...PLACE_CACHE[placeId], data0: formData.get(0), data1: formData.get(1)};\r\n} \r\n```\r\n\r\nMy issue is that it seems that my PLACE_CACHE does not keep userId on Vercel but does in local and when I deploy with docker.\r\n\r\nAny help on this one?\r\n\r\n\n\n### Additional information\n\n```js\nI'm using nextjs 14.0.4.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "No router instance found.  and  You should only use \"next/router\" on the client side of your app.", "description": "### Summary\r\n\r\n这么写有什么问题吗\r\n```\r\n\"use client\";\r\n\r\nimport React from \"react\";\r\nimport { App, Button, ConfigProvider } from \"antd\";\r\nimport router from \"next/router\";\r\n\r\nconst MyPage: React.FC = () => {\r\n  const test = () => {\r\n      router.push('/dashboard');\r\n  };\r\n  return (\r\n    <>\r\n      <Button onClick={test}>test</Button>\r\n    </>\r\n  );\r\n};\r\n\r\nconst MyApp: React.FC = () => (\r\n  <ConfigProvider>\r\n    <App>\r\n      <MyPage />\r\n    </App>\r\n  </ConfigProvider>\r\n);\r\n\r\nexport default MyApp;\r\n\r\n```\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Where loading.tsx should be located with dynamic segments to keep instant state", "description": "Consider following directory structure in app dir. Project files is pretty complex.\r\n<img width=\"199\" alt=\"Screenshot 2023-12-07 at 19 13 20\" src=\"https://github.com/vercel/next.js/assets/32598874/6baa2248-1be4-4de6-9cde-eacd14c7466d\">\r\n\r\nWhere should I keep `loading.tsx` to keep my navigation immediate?\r\nWith the current structure NextJS preloads `page.tsx` with specified parameters instead of a shared loading state between that segment. With the debugger, I see that each time I click a link to `/product/some_sku` I get preloaded `/product/some_sku?_rsc=1itg6` instead of some shared information about `loading.tsx`.\r\n\r\nMaybe there is more suggestion about achieving instant loading? [NextJS Documentation](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming#instant-loading-states) has no much information about complex cases.\r\n\r\n- `page.tsx`  contains 'async' component with `async  generateMetadata` with a large client-side component tree.\r\n- `loading.tsx` does not use any of `useSearchparams` or `useParams`.\r\n- `revalidate` entry is set to 300 seconds in `page.tsx`\r\n\r\n"}
{"sentences": "Observability: OpenTelemetry", "description": "### Describe the feature you'd like to request\r\n\r\nI woud like to suggest improved support observability through the standard OpenTelemetry which has specifications for tracing, metrics, logging and profiling. Would be beneficial to have support for this without the need to fork or monkey patch.\r\n\r\nOpenTelemetry Javascript has GA v1 of Metrics and Tracing, next steps, are working on logging\r\n\r\nThis was discussed previously in October 2021 with hasn't moved forward\r\n\r\n### Describe the solution you'd like\r\n\r\nStandardised approach to observe Next application, such as creating metrics (e.g. for API endpoints), and/or tracing. I think it would be awesome if Vercel then would offer an instance of `otel-collector` or OTLP protocol to send traces and logging.\r\n\r\nWhy OpenTelemetry? It's supported by all major companies in the field, built-in Microsoft's .NET Core, Google, Amazon, NewRelic, Dynatrace etc. \r\n\r\n### Describe alternatives you've considered\r\n\r\nCurrently, I am experimenting with monkey patching Next 12 to add support for tracing\r\n\r\nAn example of Opentelemetry with Next that is not an amazing experience can be found at:\r\nhttps://github.com/open-telemetry/opentelemetry-demo/tree/v1.0.0/src/frontend"}
{"sentences": "How to ignore a folder when running \"next build\"", "description": "When we run \"next build\" in our production server, it takes +20mins for the process to finish.\r\nThe problem for this delay is that we have a folder in the public/ directory called \"uploads\" and it has about 30,000 folders and files. This is our project hierarchy:\r\n\r\n- ... other folders\r\n- public/\r\n   - ... other folders\r\n   - uploads/     #### << here\r\n      - ... (huge number of files)\r\n- pages/\r\n\r\nis there a way to prevent the build command from going through each folder and file inside the uploads folder because they are only used for serving static pictures and assets.\r\n\r\nmaybe adding an argument inside \"next.config.js\" to exclude specific folders?\r\n\r\nthank you for your time!"}
{"sentences": "Unable to setup Opentelemetry in Next.js", "description": "### Summary\n\nHi guys, I recently found out that Next.js has support for Opentelemetry, and I think it's amazing they have their own package for adding OpenTelemetry quite easily.  However, Opentelemetry doesn't seem to work in my existing project even though I followed each step in the documentation (https://nextjs.org/docs/advanced-features/open-telemetry).  My setup is basically what Next.js provided:\r\n\r\n`next.config.ts`\r\n```\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  experimental: {\r\n    reactStrictMode: true,\r\n    instrumentationHook: true,\r\n  },\r\n};\r\n\r\nmodule.exports = nextConfig;\r\n```\r\n`instrumentation.ts`\r\n```\r\nimport { registerOTel } from \"@vercel/otel\";\r\n\r\nexport function register() {\r\n  registerOTel(\"next-app\");\r\n}\r\n```\r\n\r\nBut this doesn't seem to work.  I even tried copying the example, but that didn't work as well.  Well, I did a partial copy of the example they provided: https://github.com/vercel/next.js/tree/canary/examples/with-opentelemetry.\r\n\r\nThe example actually worked, and something I noticed is that it only worked when I used the App Router feature, but it never worked for projects that don't use the app router feature.  My pages, apis, and shared code are located in the src directory.  I'm not sure if Opentelemetry only works when Next.js is using the App Router feature, or I'm missing a small configuration that isn't mentioned in the documentation.  \r\n\r\nAny thoughts?\n\n### Additional information\n\n```js\nHere is my project directory\r\n- .next/\r\n- node_modules/\r\n- public/\r\n- src/\r\n  - pages/\r\n  - shared/\r\n  - styles/\r\n- instrumentation.ts\r\n- next-env.d.ts\r\n- next.config.js\r\n- ...\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "SyntaxError: Unexpected token '??=' after creating nextjs app and running it", "description": "### Summary\n\nNode: v14.7.0\r\n\r\nOs: MacOs Ventura 13.3.1\r\n\r\nSyntaxError: Unexpected token '??='\r\n    at wrapSafe (internal/modules/cjs/loader.js:1172:16)\r\n    at Module._compile (internal/modules/cjs/loader.js:1220:27)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1277:10)\r\n    at Module.load (internal/modules/cjs/loader.js:1105:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:967:14)\r\n    at Module.require (internal/modules/cjs/loader.js:1145:19)\r\n    at require (internal/modules/cjs/helpers.js:75:18)\r\n    at Object.<anonymous> (/Users/sakenbolatzhanuly/Downloads/Projects/pet/nextjs-blog/node_modules/next/dist/telemetry/post-payload.js:17:20)\r\n    at Module._compile (internal/modules/cjs/loader.js:1256:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1277:10)\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! nextjs-blog@0.1.0 dev: `next dev`\r\nnpm ERR! Exit status 1\r\nnpm ERR! \r\nnpm ERR! Failed at the nextjs-blog@0.1.0 dev script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/sakenbolatzhanuly/.npm/_logs/2023-05-17T09_57_58_649Z-debug.log\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Infinite redirect on 404 not found page (production)", "description": "### Summary\r\n\r\nWhen navigating to a non-existent path on my website the custom `not-found.tsx` loads but the site seems to infinitely refresh. This appears similar to the following:\r\n#50732\r\n#10024\r\n#50429\r\n\r\nThese other issues seem to only apply to development mode, but this issue is occurring on my production site.\r\n1. Is it possible that the site is running in development mode? and if so, how can I change that.\r\n2. Have I misconfigured the not-found page?\r\n\r\nNote: the not-found.tsx file is the only one in the project and is in the /app directory.\r\n\r\nThanks in advance for any assistance.\r\n\r\n\r\nProduction website not found link: https://katapod.com/this-page-does-not-exist\r\n\r\n## Not found file\r\n```tsx\r\n// app/not-found.tsx\r\nimport { Button } from '@katapod/ui/components/ui/button';\r\n\r\nexport default function NotFound() {\r\n  return (\r\n    <div className=\"relative isolate px-6 pt-10 lg:px-8\">\r\n      <div className=\"mx-auto max-w-2xl py-16 sm:py-36 lg:py-44\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-4xl font-bold tracking-tight text-gray-900 sm:text-6xl\">404</h1>\r\n          <p className=\"mt-6 text-lg leading-8 text-gray-600\">Page not found!</p>\r\n\r\n          <div className=\"mt-10 flex items-center justify-center gap-x-6\">\r\n            <a href=\"#\">\r\n              <Button size=\"lg\" variant=\"secondary\">\r\n                Return Home\r\n              </Button>\r\n            </a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div\r\n        className=\"absolute inset-x-0 top-[calc(100%-13rem)] -z-10 transform-gpu overflow-hidden blur-3xl sm:top-[calc(100%-30rem)]\"\r\n        aria-hidden=\"true\"\r\n      >\r\n        <div\r\n          className=\"relative left-[calc(50%+3rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 bg-gradient-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%+36rem)] sm:w-[72.1875rem]\"\r\n          style={{\r\n            clipPath:\r\n              'polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)',\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\n### Additional information\r\n\r\n![image](https://github.com/vercel/next.js/assets/5667907/ffcab148-6293-4dae-b17d-ec7da96d10d9)\r\n\r\nVersions\r\nnext-js: 14.0.2\r\nreact: 18.2.0\r\nreact-dom: 18.2.0\r\nnode: 18.18.1\r\n\r\n### Example\r\n\r\nhttps://katapod.com/this-page-does-not-exist"}
{"sentences": "Wrong environment variable used in production", "description": "### Summary\n\nWe have a monorepo with 3 applications.  One of the applications, CD, has a `.env.development` file.  A second application, SE does not have that file.  When we deploy to production, SE is using CD's `.env.development` file, even though it's not in the SE directory and SE is in the production environment.\r\n\r\nIf we remove `cd/.env.development` from the repo an redeploy SE, everything works as expected.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Can't get latest data from fetch call, any help is appreciated!", "description": "### Summary\r\n\r\nHello,\r\n\r\nI've been trying to finally find a solution to a recurring problem I've been having for months.\r\nI can't get the latest data when navigating to a dynamic page.\r\n\r\nExample: I add a new favorite from the homepage, I navigate to the /favorites via the `<Link/>` component, but the newest favorite doesn't appear. I have to refresh the page to get it.\r\n\r\nHere is my implementation:\r\n\r\n**In the /favorites page:**\r\n\r\n- Added the noStore() at the top of the fetch function (as shown in the new -Learn Nextjs- doc)\r\n\r\n- Added the revalidate 0 in the fetch call\r\n\r\n**In the api route /select-all**\r\n\r\n- Added the constant revalidate 0\r\n\r\n- Added the revalidatePath function\r\n\r\nHowever, I still don't get the latest data when navigating to the /favorites page.\r\n\r\nIf you have any recommendations, it would be highly appreciated.\r\n\r\nThanks!\r\n\r\n![CleanShot 2023-12-03 at 18 34 38@2x](https://github.com/vercel/next.js/assets/96829831/ef8fdcdf-3056-4516-ab0a-081f6755ca3f)\r\n![CleanShot 2023-12-03 at 18 34 10@2x](https://github.com/vercel/next.js/assets/96829831/bc0917f3-cccf-427a-b082-1510aea1b682)\r\n\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Why is my dynamic sitemap.xml not working?", "description": "I am using nextjs14. According to nextjs docs I create an sitemap.js file inside my app directory for create an dynamic sitemap but when I go to http://localhost:3000/sitemap.xml I see 404 not found\r\n\r\n \r\n![image](https://github.com/vercel/next.js/assets/84085024/d5356ffa-b9ce-4b4e-bddb-7863f7879c98)\r\n\r\n\r\nHere is my code\r\n\r\n```\r\n-> app\r\n   ->sitemap.js\r\n```\r\n\r\n\r\n```\r\nexport default function sitemap() {\r\n  return [\r\n    {\r\n      url: 'https://acme.com',\r\n      lastModified: new Date(),\r\n      changeFrequency: 'yearly',\r\n      priority: 1,\r\n    },\r\n    {\r\n      url: 'https://acme.com/about',\r\n      lastModified: new Date(),\r\n      changeFrequency: 'monthly',\r\n      priority: 0.8,\r\n    },\r\n    {\r\n      url: 'https://acme.com/blog',\r\n      lastModified: new Date(),\r\n      changeFrequency: 'weekly',\r\n      priority: 0.5,\r\n    },\r\n  ]\r\n}\r\n```\r\nBut when I create an sitemap.xml inside my app directory I can see only static content not getting any content from sitemap.js\r\n \r\n![ss](https://github.com/vercel/next.js/assets/84085024/e1ccd729-5033-4e9a-9a14-c23bd300825d)\r\n\r\n"}
{"sentences": "Why there's no new Who's hiring posts?", "description": "### Summary\n\nI saw there was a post every month.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Static assets upload returns 404 in production", "description": "# Bug report\r\n\r\n## Describe the bug\r\nIn production, when I upload an image to the public folder, next.js returns a 404 error when trying to view the image. I have to restart the server for next.js to respond with a 200 to the request.\r\nIn dev mode, it works without needing to restart or recompile.\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior, please provide code snippets or a repository:\r\n\r\n1. Clone the repository at [https://github.com/arso1er/next.js-static-404](url)\r\n2. Install the dependencies with `yarn install`\r\n3. Run `yarn build` then `yarn start`\r\n4. Open `localhost:3000` in your browser, and choose an image to upload\r\n5. The image will be uploaded to `public/assets/img/users` folder, but it won't be displayed next to the image picker (404 error). \r\n\r\n## Expected behavior\r\nExpected the same behavior as dev mode ie the image should be displayed after upload and without the need to restart the server.\r\n\r\n## System information\r\n\r\n- OS: Windows 10 (WSL)\r\n- Browser: Chrome v83.0.4103.97\r\n- Version of Next.js: 9.4.4\r\n- Version of Node.js: 12.16.3\r\n"}
{"sentences": "What import alias would you like confiugred?", "description": "### Summary\n\nWhen I am creating the next app these options are coming to me. I never see this in any tutorial or any person who uses Next.js. can someone explain to me what it is? Is this a new thing on Next.js 13?? or I am only seeing these ??\r\n\r\n![image](https://user-images.githubusercontent.com/58598919/219853094-63e3c208-e25e-4f52-a668-e643fd56f11e.png)\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "is there any way to delete all cookies with one command", "description": "### Summary\r\n\r\nfor delete  cookies in next.js 14 i'm using this code\r\n`'use server'\r\n \r\nimport { cookies } from 'next/headers'\r\n \r\nasync function create(data) {\r\n  cookies().delete('name')\r\n}\r\n`\r\nwith this code i always should put name on delete and delete on by one and i think it's not good idea.\r\n\r\nis there any better way to delete all cookies with on command?\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "NextApiRequest  POST METHOD HAS EMPTY BODY", "description": "Hello, I am unable to get the body from NextApiRequest when making a request to the server from postman, I have gone through many discusion and have tried many solutions but I am yet able to get the pages/api on next js to read the body as it returns undefined.\r\n\r\nWhen making a request from android it gives the request method as GET yet the sent request was POST. Any assistance will be appreciated\r\n![Error1](https://github.com/vercel/next.js/assets/20380993/de7dff80-4f68-49f1-a06d-d84148ba09d7)\r\n![ErrorAndroid](https://github.com/vercel/next.js/assets/20380993/2d629e17-0402-48bb-8f8d-44cd4cecd954)\r\n![Android1 (1)](https://github.com/vercel/next.js/assets/20380993/4e587f19-1a52-423e-aace-01e70080130c)\r\n![Android1 (2)](https://github.com/vercel/next.js/assets/20380993/dbe42181-e00e-4588-bea5-b467be5aca61)\r\n"}
{"sentences": "Hide Warning about Automatic Static Optimization", "description": "Is there a way to hide the warning about:\r\n\r\n```\r\nWarning: You have opted-out of Automatic Static Optimization due to `getInitialProps` in `pages/_app`. This does not opt-out pages with `getStaticProps`\r\nRead more: https://nextjs.org/docs/messages/opt-out-auto-static-optimization\r\n```\r\n\r\nI am aware of using this, and it is needed as i have to check the user and its config on every single page (this is why i fetch it on `App.getInitialProps`). I just want to remove the warning on build."}
{"sentences": "Is getInitialProps deprecated or just not recommended?", "description": "Hey there!\r\n\r\nWe're rolling out some Next.js usage at my workplace, and I wanted to poke at the removal of `getInitialProps` removal from some of the main documentation paths. Our use case really falls specifically into the `getInitialProps` scenario - that is, we want to fetch once from the server on load, and then run it via the client on future routing. This is the case for things like leveraging our client cache, snappier page transitions, feature flags (we don't really need the server to get them the second time, could pass them via the route), etc. \r\n\r\nAnyways, trying to get an answer if the `getInitialProps` is slated for removal, or is just not recommended as much anymore for general use"}
{"sentences": "Prefetch on hover/on touch option?", "description": "Hi there, I was \"surprised\" to learn that next/link [will prefetch any Link that is in the viewport](https://nextjs.org/docs/api-reference/next/link). For two reasons:\r\n1- When you have a long menu list, it seems counter-intuitive to load it all at once\r\n2- I thought that prefetching could instead be based on whether or not the user is likely willing to click on that link\r\n\r\nI just want to open the discussion and see if you ever thought/discussed on implementing a prefetch that is based on mouse over/touch instead? Just like https://instant.page/ is doing.\r\n\r\ncc @dieulot maybe since you're the author of instant.page you might have some ideas here!"}
{"sentences": "Deploying Next.js to IIS with a custom server", "description": "Hi everyone\r\nIs there any way to deploy Next js app to IIS, nearly there are no docs those are related to the deployment if you have any idea or docs that will help to solve the issue, please share.\r\nAny answer will be appreciated."}
{"sentences": "Express.Js Server as Backend not working on Vercel", "description": "I have a full stack project where I'm using **Next.Js 13 App Directory** as _frontend_ and **Express.Js Server** as _backend_. Which works fine locally but when I try with vercel and deploy them separately for frontend and backend. Frontend works fine but backend won't load data from MongoDB to display.\r\n\r\nHere's my GitHub repository: https://github.com/devhasibulislam/ciseco-ecommerce\r\n\r\nI would be grateful to you whether your suggestion help me 🎉"}
{"sentences": "Chunks commons bundle big because of ellipses, bn.js etc", "description": "Hi all,\r\n\r\nMy commons chunk file has become big, stat size 3.07 mb and gzipped size is almost 400kb. I noticed when i analyzed it that elliptic, browserify-sign and bn.js takes alot of size, I don't know why the are getting bundled. Google gave me an answer about using crypto but i dont use that. It seems like it comes from node-libs-browser. Anyone got any ideas how to find where they are getting bundled in?\r\n\r\nThanks in advance!\r\n![commons](https://user-images.githubusercontent.com/7669015/83417266-254f0380-a422-11ea-8495-54d0b05846e6.png)\r\n\r\n"}
{"sentences": "Redirects with wildcards", "description": "Hi \r\n\r\nI have a number of redirects from an old php site where the incoming url has a dynamic pattern that I want to redirect.\r\n\r\n/Bill-Jones\r\n/Bill-Jones-Director\r\n/Bill-Jones-Project-Wilson\r\n\r\nThere's an unknown number of options that are incoming after the /Bill-Jones that aren't on the new site\r\n\r\nI want to make next redirect all urls starting with /Bill-Jones to /artists/bill-jones\r\n\r\nWhat I can't work out is how to do a wildcard on the incoming url for the redirect.\r\n\r\nI've tried this from the docs but to no avail\r\n\r\n```\r\n{\r\n    source: '/Bill-Jones\\\\(*\\\\)',\r\n    destination: '/artists/bill-jones',\r\n    permanent: true,\r\n}\r\n```\r\nAll help appreciated\r\n\r\n"}
{"sentences": "Middleware not compiling with --turbo [Next JS 14]", "description": "### Summary\n\nWhen I run the project with `npx next dev --turbo`, the middleware doesn't compile, but just like version 13, npx next dev successfully runs this one.\r\nThis is the console messages with npx next dev\r\n![image](https://github.com/vercel/next.js/assets/30959724/4ad39625-0275-4d6c-a42d-4a95e826e327)\r\nAnd this with npx next dev --turbo\r\n![image](https://github.com/vercel/next.js/assets/30959724/51496de8-1c09-497d-8c03-826f4365c700)\r\n\r\nMy middleware just get cookies and redirect if is logged\n\n### Additional information\n\n```js\nexport default async function middleware(request: NextRequest) {\r\n  const jwt = request.cookies.get('business-login');\r\n\r\n  // this condition avoid to show the login page if the user is logged in\r\n  if (jwt) {\r\n    if (request.nextUrl.pathname === '/login') {\r\n      try {\r\n        const verified = await jwtVerify(\r\n          jwt.value,\r\n          new TextEncoder().encode(process.env.secret_jwt_key),\r\n        );\r\n        if (verified) {\r\n          return NextResponse.redirect(new URL('/reports', request.url));\r\n        }\r\n        return NextResponse.next();\r\n      } catch (error) {\r\n        return NextResponse.next();\r\n      }\r\n    }\r\n\r\n    try {\r\n      await jwtVerify(\r\n        jwt.value,\r\n        new TextEncoder().encode(process.env.secret_jwt_key),\r\n      );\r\n      if (request.nextUrl.pathname === '/') {\r\n        return NextResponse.redirect(new URL('/reports', request.url));\r\n      }\r\n      return NextResponse.next();\r\n    } catch (error) {\r\n      return NextResponse.redirect(new URL('/login', request.url));\r\n    }\r\n  }\r\n\r\n  if (request.nextUrl.pathname !== '/login') {\r\n    return NextResponse.redirect(new URL('/login', request.url));\r\n  }\r\n  return NextResponse.next();\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How to see list of modules compiled?", "description": "### Summary\r\n\r\nI'm getting very slow build times in dev, and in the console I'm seeing a lot modules being compiled: `event compiled client and server successfully in 21.8s (2214 modules)`. \r\n\r\nI'm using modularizeImports for my icon library, which has helped, but I'd like to see a list of all 2k+ compiled modules so I might hopefully be able to also address those.\r\n\r\nDoes anybody know how I might approach this?\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Imgix loader seems broken after upgrading from next/legacy/image to next/image", "description": "### Summary\n\nHi, we are using the `imgix` loader configured as:\r\n\r\n```\r\n  images: {\r\n    loader: 'imgix',\r\n    path: process.env.NEXT_PUBLIC_IMGIX_URL || 'https://tome.imgix.net/',\r\n    domains: ['{PROD}.imgix.net', '{DEV}.imgix.net', '{STAGING}.imgix.net'],\r\n```\r\n\r\nWhile using `next/legacy/image` the loader takes a URL like: `s3://companyAssets/clgpmwipw00044v42gvknpiuq/assets/clorlr9k8000ulh7amfoskvpq/4d7c84b5-03f1-41c8-9f1d-9939e088a561.jpg`\r\nand loads a URL like\r\n`https://{STAGING}.imgix.net/companyAssets/clgpmwipw00044v42gvknpiuq/assets/clorlr9k8000ulh7amfoskvpq/4d7c84b5-03f1-41c8-9f1d-9939e088a561.jpg?auto=format&fit=max&w=640`\r\n\r\nBut after switching to `next/image` and making no other changes, the loaded URL looks like\r\n`https:/{STAGING}.imgix.net/?url=%companyAssets%2Fclgpmwipw00044v42gvknpiuq%2Fassets%2Fclorlr9k8000ulh7amfoskvpq%2F4d7c84b5-03f1-41c8-9f1d-9939e088a561.jpg%235&w=640&q=75&dpl=dpl_8nyWFVdk2y19PGVymjR96jZrTHmc`\r\n\r\nand this fails to load because it's not a valid URL and has strange percent encodings\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why can't we get pathName in server component ?", "description": "### Summary\n\nHI, I just want to highlight a menu link in a server component by compare pathname with href property in link, but look like there is no way to get pathname on server.\r\nI must use client component to get pathname. \r\nI just wonder, Why create a client component for something small?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Return redirect from getServerSideProps", "description": "For example to redirect from `/` to `/dashboard` if user is logged in, otherwise to `/login`.\r\n\r\n- When the `getServerSideProps` is called during SSR it should return a 3xx response with Location header.\r\n- When the `getServerSideProps` is called during client-side router transition it should perform `Router.push()`.\r\n\r\nWould be cool to be able to do this easily, for example by `return { redirect: '/login' }`.\r\n\r\nOr is it possible to do such thing now? I could not find any way except maybe handling both cases manually and doing `Router.push()` myself in the page component."}
{"sentences": "You are using a non-standard \"NODE_ENV\" value in your environment. This creates inconsistencies in", "description": "in `package.json`\r\n\r\n```\r\n  \"scripts\": {\r\n    \"test1\": \"cross-env NODE_ENV=test1 PORT=3000 node node.js\",\r\n    \"test2\": \"cross-env NODE_ENV=test2 PORT=3000 node node.js\",\r\n    \"build\": \"next build\",\r\n    \"export\": \"next build && next export\",\r\n    \"start\": \"next start\"\r\n  },\r\n```\r\n\r\n\r\nin `a.tsx`\r\n```\r\nconst NODE_ENV = process.env.NODE_ENV; \r\nconst  url = NODE_ENV+\"/login\"\r\n\r\n```\r\n\r\ni got the error:  \r\n` You are using a non-standard \"NODE_ENV\" value in your environment. This creates inconsistencies in `\r\n\r\n\r\n-----"}
{"sentences": "Best way to switch to maintenance mode", "description": "I’ve created a maintenance page that I’d like all routes to redirect to for a specified day/time every week. The way I see it working right now is to have a separate now.json, or modify the existing one, where I redirect all routes to the maintenance page and set up a deploy hook to redeploy the website. Just wondering if there are any best practices when it comes to making updates to the now.json file and redeploying? Are others taking a similar approach or is there a better way to go about this? "}
{"sentences": "Where to statically fetch site-wide data?", "description": " (9.3.0) I have data that my entire site relies upon (nav, footer) that I really only want to fetch at build time. Is there a way to do this within _app.js. From what I understand, `getStaticProps` doesn't work at the component level or within `_app`"}
{"sentences": "Semantics of `GET` v `DELETE` for Logging Out", "description": "I have a client component (`'use client'`). Actually, the code and the accompanying comment say it all:\r\n\r\n```tsx\r\n{/**\r\n             * Although it would be more semantically correct to use `POsT` or `DELETE` to affect the log out,\r\n             * NextJS docs 📝 say,\r\n             * \"Use the `<Link>` component for navigation unless you have a specific requirement for using `useRouter.`\"\r\n             * @see https://nextjs.org/docs/app/api-reference/functions/use-router\r\n             *\r\n             * So, semantics be darned, this is more idiomatic NextJS and less code.\r\n             */}\r\n            <NavLink href=\"/api/logout\">\r\n              <ExitIcon />\r\n              &nbsp;Logout\r\n            </NavLink>\r\n```\r\n\r\nThat works. ☝️ I'm just a little bothered by violating REST conventions/semantics! \r\n\r\nAlternatively, to be semantically correct, I would use an `onClick` and trigger a `fetch` from the client to the `DELETE` route handler. Then, I would also need a `useRouter` in the client to `refresh` once the server has done its thing in the *route handler.* The `redirect` in the handler would not trigger a refresh on the client b/c all of this stays on the 'home page' (`/`). \r\n\r\nIn other words, to be semantically correct adds a lot more code. "}
{"sentences": "Use of ServerAction is triggering \"ReferenceError: FormData is not defined\" while building the application", "description": "### Summary\r\n\r\nI have been building and deploying my NextJS 13 app for a while now. I adopted server-actions to submit form. \r\nNow if I run `npm run build` I receive error `ReferenceError: FormData is not defined` in the `Generating static pages` step. \r\n\r\nI tried using `import { experimental_useFormState as useFormState } from \"react-dom\";` in the client component to use the server action and maintain a state, but did not help\r\n\r\nI am using Node v16.15.0 and NextJS 13.5.6\r\n\r\nHow do I fix this problem\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "intercepting responses in middleware and modifying them", "description": "### Summary\n\nI have a section of my api (e.g., /api/objects/[type] and similar) that always return json. the json needs to be reprocessed before being sent to the client. I don't want to do this in every single route. instead, I thought using middleware was a good idea.\r\n\r\nI do not understand how I can intercept responses in middleware (or if that is even the correct use case for middleware), rewrite the response and then send the modified response back to the client. \r\n\r\nhow do I do it?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Can I switch from create-react-app to create-next-app automatically using a CLI?", "description": "### Summary\n\nTitle describes the question. I want something like `npx create-next-app --migrate`.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Build Log shows /_not-found", "description": "### Summary\n\nMy build log shows /_not-found and I am not sure how to figure out what is causing it.  It is driving me nuts!! Any help / idea are appreciated :)\r\n\r\nMy site runs perfectly fine and no information seems to be missing.\r\n\r\n![Screenshot 2023-10-31 at 5 35 32 PM](https://github.com/vercel/next.js/assets/102450568/c9b2ed4a-97b3-4f03-aaa8-682241328644)\r\n\r\nrepo: https://github.com/chris-nowicki/chrisnowicki.io\r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "how to show favicon?", "description": "### Summary\n\n**layout.tsx**\r\n```tsx\r\nimport type { Metadata } from 'next'\r\nimport { Inter } from 'next/font/google'\r\nimport './globals.css'\r\n\r\nconst inter = Inter({ subsets: ['latin'] })\r\n\r\nexport const metadata: Metadata = {\r\n  title: 'Jotion',\r\n  description: 'Made by Antonio',\r\n  icons:{\r\n    icon:[\r\n      {media:\"(prefers-color-scheme: light)\",\r\n      url:'/logo.svg',\r\n      href:'/logo.svg'},\r\n       {media:\"(prefers-color-scheme: dark)\",\r\n      url:'/logo-dark.svg',\r\n      href:'/logo-dark.svg'},\r\n    ] \r\n  }\r\n}\r\n\r\nexport default function RootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return (\r\n    <html lang=\"en\">\r\n      <body className={inter.className}>{children}</body>\r\n    </html>\r\n  )\r\n}\r\n\r\n```\r\n\r\n![image](https://github.com/vercel/next.js/assets/39565703/506c3be8-bdfb-49f2-ab3c-1e340ec186d0)\r\n\r\n\r\nI use this guide and it doesn't work for me - https://youtu.be/0OaDyjB9Ib8?t=2637\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Self hosted NextCache config", "description": "### Summary\n\nIn the announcement  of Next Cache on this page\r\nhttps://nextjs.org/blog/next-13-2#nextjs-cache-when-self-hosted\r\n\r\nThere is a reference to configuring how the cache works when self-hosted and that it can be configured or disabled. But there is no link to docs on how to do it. I have found a few keys in NextConfig.experimental that might be involved, but that is it.\r\n\r\nIs there more information somewhere?\r\n\r\nThanks :-)\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Dynamic routes and state management", "description": "### Summary\n\nHi. I'm building an app that let's the user manage a list of devices and their attributes. These attributes form a hierarchy. Let's say each device can have multiple firmware versions, and each firmware version contains a list a parameters. The user can select a device, firmware version, and parameter combination to display the parameter details. This details page is on a dynamic route `/device/[deviceId]/version/[versionId]/parameter/[parameterId]`. There's a nav bar at the top that's always visible, with three quick search components also displaying the currently selected device's, firmware's and parameter's name. I just can't figure out how to get the following requirements working together:\r\n\r\n- Fetch list of devices, etc... on the server based on the URL params -> I can do this in the appropriate layouts.\r\n- Parse selected device ID, etc... -> I can also use the layouts for this.\r\n- Make sure navigating between the pages keeps updating the selected device ID, firmware ID, device list, etc in sync with the visited URL. -> Use templates instead or together with layouts? \r\n- Keep the page data and the quick search data in sync. -> I have a global Zustand store to tackle this.\r\n\r\nMy latest approach was:\r\n- Fetch initial device list in `/layout.tsx`, firmware list in `/device/[deviceId]/layout.tsx`\r\n- Pass the lists to a client component that calls setState on the Zustand store in a useEffect.\r\n- Use a root template to initialise the store with the dynamic route params. This ought to make sure that the store is reset on route changes. \n\nStill this doesn't let me set the list states properly. On '/' the firmware version list should be empty while on '/device/[deviceId]\" it should contain the selected device's firmware versions. If I reset the list in the root template that'll always overwrite it even if the layout in the sub route sets it, because the root renders last. I can't initialise everything in the root template because it has to be a client component to access the route params, so I'm stuck. \n\n### Example\n\nI'll provide one if we need it to solve the issue. "}
{"sentences": "NextJS page keep reloading again and again.", "description": "**What version of Next.js are you using?**\n\n10.0.3\n\n**What version of Node.js are you using?**\n\n12.0.0\n\n**What browser are you using?**\n\nChrome\n\n**What operating system are you using?**\n\nmacOS, Windows\n\n**How are you deploying your application?**\n\nnext start\n\n**Describe the Bug**\n\nIt occurs sometimes to me that my page keeps reloading and again. I don't know why it occurs but it happens for only one page and the problem is that I am unable to reproduce this but I often get feedbacks from  the users and acknowledged one or two times myself that it is reloading my page again and again.\r\n\r\ncan you please guide that what can be the issue that It keeps reloading?\r\n\r\nwhen i close the tab and reopen the page it does not occur. Strange\n\n**Expected Behavior**\n\nIt should not reload page and again \n\n**To Reproduce**\n\nI am unable to reproduce this by repeating any scenario.\n\n"}
{"sentences": "window.gtag is not a function on redirect back to site?", "description": "### Summary\r\n\r\nOn our ecom site we direct our customers to a hosted payment page, once payment is complete the payment page returns the user to our site at the result page.\r\n\r\nWhen a user is returned to our site we are getting the error `TypeError: window.gtag is not a function`, I'm not sure why this would be happening only when the user is returned to our site? There are no issues with gtag at any other point.\r\n```\r\nUnhandled Runtime Error\r\nTypeError: window.gtag is not a function\r\n\r\nSource\r\nsrc/components/layout/CookieBanner.jsx (19:11) @ gtag\r\n\r\n  17 | const newValue = cookieConsent ? \"granted\" : \"denied\";\r\n  18 | \r\n> 19 | window.gtag(\"consent\", \"update\", {\r\n     |       ^\r\n  20 |   analytics_storage: newValue,\r\n  21 | });\r\n  22 | \r\n```\r\n\r\nsrc/components/layout/CookieBanner.jsx:\r\n```\r\nuseEffect(() => {\r\n    const newValue = cookieConsent ? \"granted\" : \"denied\";\r\n\r\n    window.gtag(\"consent\", \"update\", {\r\n      analytics_storage: newValue,\r\n    });\r\n\r\n    setLocalStorage(\"cookie_consent\", cookieConsent);\r\n  }, [cookieConsent]);\r\n  ```\r\n"}
{"sentences": "How is nextjs.org/docs made?", "description": "### Summary\n\nHi,\r\n\r\nI'm currently in a deep dive trying to figure out how next.js docs is made.\r\nI know the mdx text content is in [here](https://github.com/vercel/next.js/tree/canary/docs) but I'm trying to figure out how the \r\nnon text template design is made. Especially the \"Was this helpful?\" button at the bottom of each page \r\n\r\nI'm not sure if the docs are made using nextra or not. And I can't find the source code for the \"was this helpful?\" button.\r\n\r\nAny thoughts?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "NextJS 13 : How to get a dynamic page id in the url from a component?", "description": "### Summary\n\nI have a component called **Button** and inside that component, I want to make a calculation based on the ID in the route but I got blocked to find a way to access that directly from the component.\r\n\r\n\r\nMy route looks like this:\r\n\r\n `http://localhost:3000/75DADAS/energy-check/energy-efficiency?modernization=current&previous-page=building-details`\r\n\r\nThis is a dynamic parameter `75DADAS` which is a dynamic page in the folder structure `[id]`.\r\n\r\nMy Button.jsx:\r\n\r\n```jsx\r\n\r\nexport default function MainButton({ investment }: { investment: IInvestment }) {\r\n  const router = useRouter()\r\n\r\n  const searchParams = useSearchParams()\r\n\r\n  const modernizationStatus = searchParams.get(\"modernization\")\r\n\r\n  const previousPage = searchParams.get(\"previous-page\")\r\n\r\n  const isCurrentModernization = modernizationStatus === \"current\"\r\n\r\n  const isPlannedModernization = modernizationStatus === \"plan\"\r\n\r\n  const isFromBuildingDetailsPage = previousPage === \"building-details\"\r\n  \r\n // How do you access that ID in the URL?\r\n\r\n  const encryptedID=75DADAS\r\n\r\n  const baseUrl = `/${encryptedId}/energy-check`\r\n\r\n//rest of code\r\n}\r\n```\r\n\r\n\r\nCurrently, I can access the query parameters using `useSearchParams`,; the only way I know to access the [id] which is `75DADAS` is through `props` inside the page **energy-efficiency** but this will lead to props drilling to storing it inside a global state\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to request a new example repo?", "description": "### Summary\r\n\r\nIs there a way to make a request to have a new example repo created? \r\n\r\nI am hoping for a Todo app similar to the one in the existing repo \"with-aws-amplify\" but using App Router instead of Pages Router. Maybe name it \"with-aws-amplify-approuter\"?\r\n\r\nHere is the existing repo: https://github.com/vercel/next.js/tree/canary/examples/with-aws-amplify\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "NextJS 13 + MongoDB - Data won't update in real time in production, but works on dev", "description": "Hi everyone.\r\nI am trying to implement CRUD feature in NextJS app router with MongoDB.\r\nBut in production mode, I added one data and tried to get full data of that but added new data doesn't appear.\r\nThis is my api code to get full data\r\n```\r\nimport Prompts from \"@/models/Prompt\";\r\nimport { connectDb } from \"@/utils/mongodb\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\n/**\r\n * @method GET\r\n * @returns NextResponse\r\n * @description Find All Prompts and return\r\n */\r\nexport const GET = async () => {\r\n\tawait connectDb();\r\n\r\n\ttry {\r\n\t\tconst result = await Prompts.find();\r\n\t\treturn NextResponse.json(result.reverse(), { status: 200 });\r\n\t} catch (err) {\r\n\t\treturn NextResponse.json(\"Failed to get Prompt Template.\", {\r\n\t\t\tstatus: 500\r\n\t\t});\r\n\t}\r\n};\r\n```\r\nThe added data is saved in mongodb correctly and I can see that data in the MongoDB Compass.\r\nBut backend api doesn't pull only that data.\r\nIn development mode, all things are working well but not working on production mode.\r\nI tried to google but other developer is facing this problem.\r\nhttps://stackoverflow.com/questions/76787615/nextjs-13-w-mongodb-data-wont-update-in-real-time-in-production-but-works-o\r\nWhat is the solution for this?"}
{"sentences": "Problem with yandex metrics", "description": "### Summary\n\nAfter switching to app router. Yandex metrics no longer identifies the source in 99% of cases, and the web viewer records less than 2% of visits\n\n### Additional information\n\n```js\nlayout.tsx\r\n\r\n\r\nexport default function RootLayout({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <html lang=\"ru\" dir=\"ltr\">\r\n      <PreloadResources />\r\n      <head>\r\n        <script\r\n          type=\"text/javascript\"\r\n          dangerouslySetInnerHTML={{\r\n            __html: `(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};\r\n          m[i].l=1*new Date();\r\n          for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}\r\n          k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})\r\n          (window, document, \"script\", \"https://mc.yandex.ru/metrika/tag.js\", \"ym\");\r\n\r\n          ym(___, \"init\", {\r\n          defer:true,\r\n          clickmap:true,\r\n          trackLinks:true,\r\n          accurateTrackBounce:true,\r\n          webvisor:true,\r\n          ecommerce:\"dataLayerYa\"\r\n        });`,\r\n          }}\r\n        />\r\n      </head>\r\n      <body className={cn(montserrat.variable, roboto.variable)}>\r\n        <noscript>\r\n          <div>\r\n            {/* eslint-disable-next-line @next/next/no-img-element */}\r\n            <img src=\"https://mc.yandex.ru/watch/___\" style={{ position: \"absolute\", left: \"-9999px\" }} alt=\"\" />\r\n          </div>\r\n        </noscript>\r\n        <Suspense>\r\n          <YandexMetrika />\r\n        </Suspense>\r\n        <Suspense>\r\n          <ActivityGoal />\r\n        </Suspense>\r\n        <AppProvider>\r\n          <Header />\r\n          {children}\r\n          <LayoutWidgets />\r\n        </AppProvider>\r\n      </body>\r\n    </html>\r\n  );\r\n}\r\n```\r\n\r\nYandexMetrika.tsx\r\n```\r\n\"use client\";\r\n\r\nimport { useNavigation } from \"../../hooks/useNavigation\";\r\n\r\nexport default function YandexMetrika() {\r\n  useNavigation({\r\n    on: {\r\n      routeChanged: ({ url }) => {\r\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n        // @ts-ignore\r\n        window.ym(___, \"hit\", url);\r\n      },\r\n    },\r\n  });\r\n\r\n  return null;\r\n}\r\n```\r\n\r\nuseNavigation.tsx\r\n```\r\nimport { usePathname, useSearchParams } from \"next/navigation\";\r\nimport { useEffect } from \"react\";\r\n\r\nimport { usePrevious } from \"./usePrevious\";\r\n\r\ninterface NavigationEvents {\r\n  routeChanged: ({ url }: { url: string }) => void;\r\n}\r\n\r\nexport const useNavigation = ({ on: { routeChanged } }: { on: NavigationEvents }) => {\r\n  const pathname = usePathname();\r\n  const prevPathname = usePrevious(pathname);\r\n\r\n  const searchParams = useSearchParams();\r\n  const prevSearchParams = usePrevious(searchParams);\r\n\r\n  useEffect(() => {\r\n    let url = window.origin + pathname;\r\n    if (searchParams?.toString()) {\r\n      url = url + `?${searchParams.toString()}`;\r\n    }\r\n    if (searchParams?.toString() !== prevSearchParams?.toString() || pathname !== prevPathname) {\r\n      routeChanged({ url });\r\n    }\r\n  }, [pathname, prevPathname, prevSearchParams, routeChanged, searchParams]);\r\n};\r\n```\r\n\r\nusePrevious.tsx\r\n```\r\nimport { useEffect, useRef } from \"react\";\r\n\r\nexport const usePrevious = <T>(value: T) => {\r\n  const ref = useRef<T>(value);\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  });\r\n  return ref.current;\r\n};\r\n```\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "getting full uri/url on getServerSideProps all parameters after an hash (\"#\") are being discarded", "description": "### Summary\n\nHi!\r\n\r\nI'm using a window.replace for setting up parameters without having to refresh the page. I tried shallow routing didn't work.\r\n'window.location.replace(`#?${urlParams.toString()}`);` \r\n\r\nso this creates an url like:\r\nhttps://webpage/Explore#?parameter1=XXX\r\n\r\nso the idea is that the user can easily copy and paste the url to someone, and that the  URL parameters to generate SEO tags.\r\n\r\nwhen I use the code:\r\n```\r\nexport const getServerSideProps = async (ctx: NextPageContext) => {\r\n   console.log(ctx.params)\r\n   console.log(ctx.url)\r\n}\r\n```\r\nI don't get any parameters which are behind an hash.\r\n\r\nI also tried to create a middleware:\r\n```\r\nimport { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\n \r\nexport function middleware(request: NextRequest) {\r\n    // console.log(request.nextUrl.pathname)\r\n    console.log(request.nextUrl.href)\r\n}\r\n```\r\ndidnt work.\r\n\r\nany ideas?\r\n[code](https://github.com/helpbuttons/helpbuttons/blob/main/web/src/pages/Explore/HoneyComb/index.tsx#L247)\r\n[demo](https://dev.helpbuttons.org/Explore)\r\n\r\nI'm developing https://dev.helpbuttons.org\r\ncheck out the code in here: https://github.com/helpbuttons/helpbuttons\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "is this is the correct usage of next.js app and pages directories?", "description": "I'm working on next.js v13 project which uses /pages directory instead of /app, I just added /app directory to use its new features for dynamic sitemap rendering and only for that, routing still happens in /pages,  is this acceptable practice ? "}
{"sentences": "SignIn throws 405 error", "description": "### Summary\n\nI am using Next Auth to authenticate my users. When the user tries to sign in using the custom sign in page I am getting a 405 error if the app is deployed to Vercel. Locally it runs fine. What am I missing to configure on vercel? \r\n\r\nFollowing is my setup:\r\n- Next JS 13\r\n- Next Auth for authentication\r\n- Next Auth route has credentials provider configured\r\n- Custom SignIn page configured\r\n- SignIn page has a button that invokes \"signIn\" method with no redirect\r\n- Using \"useRouter\" to route the page to the callback URL\r\n- Middleware setup\r\n\r\nNext Auth route config\r\n``` typescript\r\nimport NextAuth from \"next-auth/next\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\n\r\nconst handler = NextAuth({\r\n    providers: [\r\n        CredentialsProvider({\r\n            name: \"Credentials\",\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"text\", placeholder: \"jdoe@acme.com\" },\r\n                password: { label: \"Password\", type: \"coolbeans\" },\r\n            },\r\n            async authorize(credentials, req) {\r\n                const user = { id: \"1\", name: \"John Doe\", email: \"jdoe@acme.com\", password: \"coolbeans\" };\r\n                if (credentials?.email === user.email && credentials?.password === user.password) {\r\n                    return user;\r\n                } else {\r\n                    return null;\r\n                }\r\n            },\r\n        }),\r\n    ],\r\n    pages: {\r\n        signIn: \"/auth/signin\",\r\n    },\r\n});\r\n\r\nexport { handler as GET, handler as POST };\r\n```\r\n\r\nFunction that is invoked when SignIn button is clicked\r\n``` typescript\r\nconst onSubmit = async () => {\r\n        const callbackUrlParam = searchParams.get(\"callbackUrl\");\r\n        const result = await signIn(\"credentials\", {\r\n            email: email.current,\r\n            password: pass.current,\r\n            redirect: false,\r\n        });\r\n        router.push(callbackUrlParam as string);\r\n    };\r\n```\r\n\r\nMiddlerware.ts setup\r\n``` typescript\r\nimport { withAuth } from \"next-auth/middleware\";\r\n\r\nexport default withAuth({\r\n    // Matches the pages config in `[...nextauth]`\r\n    pages: {\r\n        signIn: \"/auth/signin\",\r\n    },\r\n});\r\n```\r\n\r\nI have properly setup environment variables on Vercel as well.\r\nIt also fails when I do `npm run start`\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error: getaddrinfo ENOTFOUND in API route", "description": "i got Error: getaddrinfo ENOTFOUND api.my-app.test error in API route when trying to fetch data from local backend (api.my-app.test). i also have tried using original address (localhost:5000) but no success, however it works fine when i fetch on normal page function.\r\nfetching data from dummy API [https://jsonplaceholder.typicode.com/posts](https://jsonplaceholder.typicode.com/posts) works too. \r\n\r\ni use docker for my development environment, here is my stack:\r\nnginx 80 to 80\r\nnextjs - localhost:3000 to localhost (my-app.test)\r\nexpressjs - localhost:5000  to localhost (api.my-app.test)\r\n\r\nthank you in advance"}
{"sentences": "Middleware vs Prefetch", "description": "Can someone explain to me why middleware works on prefetch requests? How can I disable this behavior?\r\n\r\nFor example, I would like to specify a specific cookie depending on the current language. There is no built-in ability to process languages and translations for app router. "}
{"sentences": "Why won't my code deploy without this error to Vercel?", "description": "### Summary\n\nMy repo is publicly hosted at https://github.com/mkelley33/mkelley33-pwa/pull/1 and I've already reached out in Discord to no avail, response, or solution.   The logs output is below:\r\n\r\n```[15:49:33.548]    Collecting page data ...\r\n[15:49:34.209] TypeError [ERR_INVALID_URL]: Invalid URL\r\n[15:49:34.210]     at new NodeError (node:internal/errors:405:5)\r\n[15:49:34.210]     at new URL (node:internal/url:611:13)\r\n[15:49:34.210]     at 45203 (/vercel/path0/.next/server/chunks/197.js:1:1151)\r\n[15:49:34.210]     at Function.webpack_require (/vercel/path0/.next/server/webpack-runtime.js:1:145)\r\n[15:49:34.210]     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n[15:49:34.211]     at async collectGenerateParams (/vercel/path0/node_modules/next/dist/build/utils.js:858:17)\r\n[15:49:34.211]     at async /vercel/path0/node_modules/next/dist/build/utils.js:1074:17\r\n[15:49:34.211]     at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:105:20) {\r\n[15:49:34.211]   input: 'mkelley33-or0at8tef-mkelley33.vercel.app',\r\n[15:49:34.211]   code: 'ERR_INVALID_URL'\r\n[15:49:34.211] }\r\n[15:49:34.217] \r\n[15:49:34.217] > Build error occurred\r\n[15:49:34.218] Error: Failed to collect page data for /blog/[slug]\r\n[15:49:34.219]     at /vercel/path0/node_modules/next/dist/build/utils.js:1178:15\r\n[15:49:34.219]     at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {\r\n[15:49:34.219]   type: 'Error'\r\n[15:49:34.219] }\r\n[15:49:34.315] Error: Command \"npm run build\" exited with 1\r\n```\r\n\r\nSee the below fetch examples:\r\n\r\n```const handleOnSubmit: SubmitHandler<IContactForm> = async (data) => {\r\n    const res = await fetch('/api/contact/hcaptcha', {\r\n      method: 'POST',\r\n      body: JSON.stringify({ token }),\r\n    });\r\n    const json = await res.json();\r\n\r\n    if (!json.success) {\r\n      setHCaptchaError('hCaptcha validation failed. Please try again.');\r\n    }\r\n\r\n    if (isValid && json.success) {\r\n      const res = await fetch('/api/contact', {\r\n        method: 'POST',\r\n        body: JSON.stringify(data),\r\n      });\r\n      const json = await res.json();\r\n\r\n      if (json.success) {\r\n        router.push('/post-contact');\r\n      } else if (json.error) {\r\n        if (captchaRef.current) {\r\n          // @ts-expect-error resetCaptcha does in fact exist on this ref\r\n          captchaRef.current.resetCaptcha();\r\n        }\r\n        toast.error(json.error, {\r\n          position: toast.POSITION.TOP_CENTER,\r\n          hideProgressBar: true,\r\n        });\r\n      }\r\n    }\r\n  };```\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://github.com/mkelley33/mkelley33-pwa/pull/1"}
{"sentences": "How to change output type parameter in NextJS build command?", "description": "### Summary\n\nI want to change the output type parameter in the NextJS build command so that it only outputs 'standalone' during Docker builds and not locally. \r\nIs there a command similar to ```next build --output standalone``` that can accomplish this? \r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "404 error  for /public/static just uploaded files only in production mode", "description": "My project is based on NextJS 9 custom server. Custom server is Express v4.\r\n\r\nI upload files through the multipart form to the server into /public/static/ folder by multer. \r\n\r\nIn production mode I always receive response with 404 code for GET-requests to just uploaded files. \r\nAfter server restart I receive response with 200 code for all previously uploaded files and 404 code for new uploads only.\r\n\r\nThis issue does not exist in developer mode.\r\n\r\nProblem is not present only if\r\nserver.js contained:\r\n`const nextApp = nextjs({ dev }); `\r\nand server launch command is:\r\n`$ nodemon server.js`\r\n\r\n[github project ](https://github.com/haw0k/ds-collections)"}
{"sentences": "Static pages and A/B testing with middleware - HOW?", "description": "Our goal: Have two **static** pages index.tsx and index2.tsx used in an A/B experiment where we use middleware rewrite() to switch between them.\r\n\r\nI want to mention that we host Next.js in Azure on our own, and we do not use Vercel.\r\n\r\nThe problem we are having is that for static pages Next.js emits a cache control header that makes our CDN cache one page or another. And we cannot override cache control headers (to set it to no-cache) for static pages in next.config.js. Here's what the [docs](https://nextjs.org/docs/going-to-production#caching) say: _Cache-Control headers set in next.config.js will be overwritten in production to ensure that static assets can be cached effectively._ \r\n\r\nIt's probably something very simple that I am missing, but I don't understand how we can have two static pages (built at Next.js build time with GetStaticPageProps) involved in an A/B test directed by middleware, and also use a CDN in front?"}
{"sentences": "Next.js 13, ts. Unexpected Video Element in URL Params from layout", "description": "### Summary\r\n\r\nPage structure in my Next.js project: events/[eventId]\r\n\r\nI have layout inside the events directory, which applies to both pages in events and events/[id]. Within the layout, I've included a simple video background. However, I've noticed that sometimes when I navigate from the event page to the event/[eventId] page, the event[id] page in the URL parameters receives a element with a src or poster attribute. I'm not sure why this is happening or how to fix it.\r\n\r\nAny help or insights on how to resolve this issue would be greatly appreciated!\r\n\r\nevents/layout.tsx:\r\n```\r\nexport default function RootLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode\r\n}) {\r\n  return (\r\n    <>\r\n        <BackgroundVideo />\r\n            {children}\r\n    </>\r\n    \r\n  );\r\n}\r\n```\r\n\r\nBackgrounVideo component:\r\n```\r\n\"use client\"\r\nconst BackgroundVideo = () => {\r\n  const [isClient, setIsClient] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setIsClient(true)\r\n  },[])\r\n\r\n  return(\r\n    <div >\r\n      {\r\n      isClient && \r\n      <video \r\n        autoPlay loop muted\r\n        poster=\"videoBgPoster.jpg\"\r\n        >\r\n          \r\n      <source src=\"videoBg.mp4\" \r\n              type=\"video/mp4\"/>\r\n      </video>\r\n      }\r\n      <div className=\"z-[-90] fixed bg-black bg-opacity-40 h-full w-full\"></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BackgroundVideo;\r\n```\r\n\r\nevents/[eventId]:\r\n```\r\ntype Props = {\r\n  params: {\r\n    eventId: string,\r\n  },\r\n  searchParams: Record<string, string> | null | undefined\r\n}\r\n\r\nconst Event = async ({ params, searchParams }: Props) => {\r\n\r\n  console.log(\"Params...: \", params)\r\n}\r\n```\r\n\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\nSometimes it receives proper id, sometimes this...\r\nConsole:\r\nParams...: { id: 'videoBgPoster.jpg' }\r\nParams...: { id: 'videoBg.mp4' }\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "After the app has been running for a period of time, some routes will lose response and will return 304 when accessed", "description": "### Summary\n\nAfter the app has been running for a period of time, some routes will lose response and will return 304 when accessed (normally it should be 200). \r\nKilling pid and restarting node has no effect.\r\nWe must recompile and then start the service to restore the service.\r\nNext.js 13.5\r\nNodejs 18.18.0\n\n### Additional information\n\n```js\ncurl -i 'http://127.0.0.1:3100/news'\r\nHTTP/1.1 304 Not Modified\r\nset-cookie: User-UUID=34d041f3-dd64-4855-b00e-c93978bbc893; Path=/; Expires=Tue, 24 Sep 2024 04:31:55 GMT\r\nVary: RSC, Next-Router-State-Tree, Next-Router-Prefetch, Next-Url, Accept-Encoding\r\nx-nextjs-cache: STALE\r\nCache-Control: s-maxage=600, stale-while-revalidate\r\nETag: \"vz3aqh8r2g8bf0\"\r\nContent-Type: text/html; charset=utf-8\r\nContent-Length: 388737\r\nDate: Sun, 24 Sep 2023 03:31:55 GMT\r\nConnection: keep-alive\r\nKeep-Alive: timeout=5\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How to \"combine\" matchers for different middleware use cases?", "description": "Hello.\r\nI'm facing an issue with `middleware.ts`.\r\n\r\nI currently use [Next International](https://github.com/QuiiBz/next-international), which requires a _middleware.ts_ to work properly.\r\n\r\nHere is the catch: the matcher is spreading to almost all the routes.\r\n\r\n```ts\r\nexport const config = {\r\n  matcher: ['/((?!api|static|_next|.*\\\\..*).*)']\r\n};\r\n```\r\n\r\nNow, if I want to use [Next Auth](https://github.com/nextauthjs/next-auth), and especially the `withAuth` feature, allowing to protect the routes which corresponds to the `matcher`... How could I set up the matcher to be `'/((?!api|static|_next|.*\\\\..*).*)'` for Next International, and to be `[\"'/dashboard/:path*'\"]` for Next Auth, which I want to keep its scope to the minimum?\r\n\r\nIt looks impossible to do so. :/\r\n\r\nRegards!\r\n\r\n---\r\n\r\nhttps://nextjs.org/docs/app/building-your-application/routing/middleware\r\nhttps://next-international.vercel.app/docs/app-setup#setup-middleware\r\nhttps://next-auth.js.org/configuration/nextjs#middleware\r\n\r\n---\r\n\r\nIt looks like this issue has been discussed before, but I haven't found anything very satisfactory.\r\n\r\nhttps://github.com/vercel/next.js/discussions/53997\r\nhttps://github.com/vercel/next.js/discussions/51221"}
{"sentences": "RFC - add rawBody to NextApiRequest", "description": "# Feature request\r\n\r\nAs per @timneutkens request, this is an RFC to add `rawBody` to NextApiRequest.\r\n\r\n## Is your feature request related to a problem? Please describe.\r\n\r\nCurrently, there is no way to use both a body parser _and_ recuperate the raw body of a request. This makes things like [securing github webhooks](https://developer.github.com/webhooks/securing/), which rely on calculating a hash based on a raw body, difficult in NextJS.\r\n\r\n## Describe the solution you'd like\r\n\r\nThe solution I proposed in the PR above is to add a raw body field to NextApiRequest.\r\n\r\n## Describe alternatives you've considered\r\n\r\nThe alternative we're currently using is deploying a separate microservice to handle our github webhook. It could be that this feature is outside the scope of nextjs, in which case the separate microservice makes sense."}
{"sentences": "Why is state update not working when a component is imported into root page?", "description": "### Summary\n\nsay I have a counter component:\r\n\r\n```\r\n'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\n\r\nexport default function Counter() {\r\nconst [count, setCount] = useState(0)\r\n \r\nuseEffect(() => { \r\nconsole.log(\"i am a counter\"); \r\n}, []);\r\n\r\nreturn (\r\n<div>\r\n<p>You clicked {count} times</p>\r\n<button onClick={() => setCount(p => p + 1)}>Click me</button>\r\n</div>\r\n)\r\n}\r\n```\r\n\r\nthen I import this into my root Page.tsx.\r\n\r\n```\r\nexport default function Home() {\r\nreturn (\r\n<main className=\"flex min-h-screen flex-col items-center justify-between p-24\">\r\n<Counter />\r\n</main>\r\n)\r\n}\r\n```\r\n\r\nWhen I hit the 'Click Me' button the counter state doesn't change. For fun then I put a useEffect into the counter component and added a console log and it printed nothing.\r\n\r\nI know root layout cannot be a server component but does that apply to root page as well and any imported client components? If I put the same counter within a component say at route <URL>/about/page.tsx then it works.\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Puppeteer does not work on vercel plattform", "description": "### What version of Next.js are you using?\r\n\r\n11.1.2\r\n\r\n### What version of Node.js are you using?\r\n\r\n14.16.1\r\n\r\n### What browser are you using?\r\n\r\nChrome\r\n\r\n### What operating system are you using?\r\n\r\nWindows\r\n\r\n### How are you deploying your application?\r\n\r\nnpm run build \r\n\r\n### Describe the Bug\r\n\r\nI am using puppeteer in my API routes. I basically go to a page and generate a pdf file and sent an email.\r\nThis works perfectly fine locally, but it does not work on vercel.\r\n\r\nI get a 500 error code with following message:\r\n\r\n```\r\n[POST] /api/sendgrid\r\n21:54:39:79\r\n2021-10-17T19:54:40.690Z\t089c6c73-09af-48cb-a740-be76fc06b7a0\tERROR\tError: Could not find expected browser (chrome) locally. Run `npm install` to download the correct Chromium revision (901912).\r\n    at ChromeLauncher.launch (/var/task/node_modules/puppeteer/lib/cjs/puppeteer/node/Launcher.js:88:27)\r\n```\r\n\r\n### Expected Behavior\r\n\r\nI expect to have a successful call so that puppeteer can generate a pdf from my page URL.\r\n\r\n### To Reproduce\r\n\r\nYou can probably reproduce this creating an api file and calling that using fetch or axios.\r\nOne needs to install puppeteer and call a function like this:\r\n\r\n\r\n```\r\nasync function generatePdf() {\r\n  const browser = await puppeteer.launch();\r\n  const page = await browser.newPage();\r\n  // GEN_PDF_URL, is the URL which shall be generated later on to a pdf file\r\n  await page.goto(process.env.GEN_PDF_URL, {\r\n    waitUntil: \"networkidle2\",\r\n  });\r\n  const pdf = await page.pdf({\r\n    path: 'wahlkalender.pdf',\r\n    printBackground: true,\r\n    format: 'a4',\r\n  });\r\n  await browser.close();\r\n\r\n  return pdf;\r\n}\r\n```"}
{"sentences": "Serving non-html content from non-api route", "description": "I have posts at `/posts/[slug].tsx` and I want to return a plain text response from `posts/[slug]/raw.tsx`. Is there any way to do this? I want this to work with `next export` so I can't do it in an API route."}
{"sentences": "What is a technical definition of \"hydration\" within NextJS?", "description": "The terms _hydration_, _rehydration_, _hydrate_, etc. appear periodically in NextJS documentation, but I'm unclear exactly what they refer to.\r\n\r\n[For example](https://nextjs.org/docs/advanced-features/automatic-static-optimization):\r\n\r\n> Statically generated pages are still reactive: Next.js will hydrate your application client-side to give it full interactivity.\r\n\r\nFrom context clues (and ReactJS [documentation](https://reactjs.org/docs/react-dom.html#hydrate)) it seems hydration is the process of imbuing server-rendered HTML with the client-side JS necessary for dynamic elements or interaction? But I would appreciate a more technical definition. Is hydration a specific _event_? A general concept accomplished in many ways? A specific function or method? Is it just inherited from ReactJS with no changes?\r\n\r\nThanks dearly!"}
{"sentences": "Error 500 when in production", "description": "### Summary\n\nMy project used to work perfectly, I just added a new page and now I only get 500 | internal server error when the site is in production. (everything works perfectly on localhost)\r\nI have these errors in the logs on vercel:\n\n### Additional information\n\n```js\n…/var/task/.next/server/pages/_app.js',\r\n    '/var/task/node_modules/next/dist/server/require.js',\r\n    '/var/task/node_modules/next/dist/server/next-server.js',\r\n    '/var/task/___next_launcher.cjs'\r\n  ],\r\n  page: '/'\r\n}\r\nError: Cannot find module 'core-js/modules/es.array.map.js'\r\nRequire stack:\r\n- /var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js\r\n- /var/task/node_modules/next-i18next/dist/commonjs/appWithTranslation.js\r\n- /var/task/node_modules/next-i18next/dist/commonjs/index.js\r\n- /var/task/.next/server/pages/_app.js\r\n- /var/task/node_modules/next/dist/server/require.js\r\n- /var/task/node_modules/next/dist/server/next-server.js\r\n- /var/task/___next_launcher.cjs\r\n    at Module._resolveFilename (node:internal/modules/cjs/loader:1077:15)\r\n    at /var/task/node_modules/next/dist/server/require-hook.js:54:36\r\n    at Module._load (node:internal/modules/cjs/loader:922:27)\r\n    at Ze.e.<computed>._module.Module._load (/var/task/___vc/__launcher/__launcher.js:14:1964)\r\n    at Module.require (node:internal/modules/cjs/loader:1143:19)\r\n    at mod.require (/var/task/node_modules/next/dist/server/require-hook.js:64:28)\r\n    at require (node:internal/modules/cjs/helpers:121:18)\r\n    at Object.<anonymous> (/var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js:35:1)\r\n    at Module._compile (node:internal/modules/cjs/loader:1256:14)\r\n    at Module._extensions..js (node:internal/modules/cjs/loader:1310:10) {\r\n  code: 'MODULE_NOT_FOUND',\r\n  requireStack: [\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js',\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/appWithTranslation.js',\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/index.js',\r\n    '/var/task/.next/server/pages/_app.js',\r\n    '/var/task/node_modules/next/dist/server/require.js',\r\n    '/var/task/node_modules/next/dist/server/next-server.js',\r\n    '/var/task/___next_launcher.cjs'\r\n  ]\r\n}\r\nError: Cannot find module 'core-js/modules/es.array.map.js'\r\nRequire stack:\r\n- /var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js\r\n- /var/task/node_modules/next-i18next/dist/commonjs/appWithTranslation.js\r\n- /var/task/node_modules/next-i18next/dist/commonjs/index.js\r\n- /var/task/.next/server/pages/_app.js\r\n- /var/task/node_modules/next/dist/server/require.js\r\n- /var/task/node_modules/next/dist/server/next-server.js\r\n- /var/task/___next_launcher.cjs\r\n    at Module._resolveFilename (node:internal/modules/cjs/loader:1077:15)\r\n    at /var/task/node_modules/next/dist/server/require-hook.js:54:36\r\n    at Module._load (node:internal/modules/cjs/loader:922:27)\r\n    at Ze.e.<computed>._module.Module._load (/var/task/___vc/__launcher/__launcher.js:14:1964)\r\n    at Module.require (node:internal/modules/cjs/loader:1143:19)\r\n    at mod.require (/var/task/node_modules/next/dist/server/require-hook.js:64:28)\r\n    at require (node:internal/modules/cjs/helpers:121:18)\r\n    at Object.<anonymous> (/var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js:35:1)\r\n    at Module._compile (node:internal/modules/cjs/loader:1256:14)\r\n    at Module._extensions..js (node:internal/modules/cjs/loader:1310:10) {\r\n  code: 'MODULE_NOT_FOUND',\r\n  requireStack: [\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/config/createConfig.js',\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/appWithTranslation.js',\r\n    '/var/task/node_modules/next-i18next/dist/commonjs/index.js',\r\n    '/var/task/.next/server/pages/_app.js',\r\n    '/var/task/node_modules/next/dist/server/require.js',\r\n    '/var/task/node_modules/next/dist/server/next-server.js',\r\n    '/var/task/___next_launcher.cjs'\r\n  ],\r\n  page: '/'\r\n}\r\nError: Runtime exited without providing a reason\r\nRuntime.ExitError\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Modify/filter  __NEXT_DATA__", "description": "Hi Fork,\r\n\r\nActually my requirement is, I want to filter initial data before adding in the script tag.\r\n\r\nI did not find any function to modify __NEXT_DATA__ data. In that reason, my page size is too big"}
{"sentences": "Error: An error occurred in the Server Components render. Next 13 App router", "description": "Hi community, I am using Next 13.4.2 along with the App router, and I am facing the following error. \r\n\r\n```\r\n\r\nError: An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included in this error instance which may provide additional details about the nature of the error.\r\n\r\n```\r\n\r\n** No error in development or local production mode. Only I face this error when I visit a page on a live site, hosted on AWS EC2 using Docker.** \r\n\r\nMy way of API calls. I am using the `fetch API, I `actions` folder in the app dir where I make functions like \r\n\r\n```\r\nasync function getData(token) {\r\n  const res = await fetch('https://api.example.com/...')\r\n  // The return value is *not* serialized\r\n  // You can return Date, Map, Set, etc.\r\n  // passing token to headers => token\r\n \r\n  if (!res.ok) {\r\n    // This will activate the closest `error.js` Error Boundary\r\n    throw new Error('Failed to fetch data')\r\n  }\r\n \r\n  return res.json()\r\n}\r\n```\r\n\r\nThen on pages I do \r\n\r\n```\r\nimport { cookies } from \"next/headers\";\r\n\r\nexport default async function Page() {\r\n  const cookieStore = cookies();\r\n  const token = cookieStore.get(process.env.COOKIE_NAME);\r\n\r\n  const data = await getData((token?.value)\r\n \r\n  return <main></main>\r\n}\r\n```\r\n\r\nThat's all I am doing to fetch data. I am not able to find the problem why in live production website pages don't load the data, even the page itself doesn't load. I am facing the same error on 3 different pages. \r\n\r\n![Error in browser](https://res.cloudinary.com/dcyrcksal/image/upload/v1695317645/issue%20reporting/Screenshot_from_2023-09-21_22-30-39_aft0vt.png\r\n \"Error in browser\").\r\n\r\n\r\n\r\nYes, I have studied similar questions and issues on Stackoverflow and on GitHub. Still finding out why it is happening. Searching for the solution. I guess the error is due to passing the token from the page to the getData() function. "}
{"sentences": "problem with fetch", "description": "I created a next app using `npx create-next-app@latest`  and pasted the \"fetch api\" document \r\n\r\n```typescript\r\nasync function getData() {\r\n  const res = await fetch('https://api.example.com/...')\r\n  // The return value is *not* serialized\r\n  // You can return Date, Map, Set, etc.\r\n \r\n  if (!res.ok) {\r\n    // This will activate the closest `error.js` Error Boundary\r\n    throw new Error('Failed to fetch data')\r\n  }\r\n \r\n  return res.json()\r\n}\r\n \r\nexport default async function Page() {\r\n  const data = await getData()\r\n \r\n  return <main></main>\r\n}\r\n``` \r\nand changed it to this to see what the error is: \r\n\r\n```typescript\r\nasync function getData() {\r\ntry{\r\n  const res = await fetch('https://dummy.restapiexample.com/api/v1/employees')\r\n  return res.json()\r\n}catch(err){\r\nconsole.log(err)\r\n}\r\n}\r\n \r\nexport default async function Page() {\r\n  const data = await getData()\r\n \r\n  return <main></main>\r\n}\r\n``` \r\nand i get:\r\n```powershell\r\nTypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:13220:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {\r\n  cause: Error: self-signed certificate in certificate chain\r\n      at TLSSocket.onConnectSecure (node:_tls_wrap:1659:34)\r\n      at TLSSocket.emit (node:events:514:28)\r\n      at TLSSocket._finishInit (node:_tls_wrap:1070:8)\r\n      at ssl.onhandshakedone (node:_tls_wrap:856:12)\r\n      at TLSWrap.callbackTrampoline (node:internal/async_hooks:130:17) {\r\n    code: 'SELF_SIGNED_CERT_IN_CHAIN'\r\n  }\r\n}\r\nundefined\r\n``` \r\nand even when i try to `npm run build` i get this error:\r\n```powershell\r\n> next dev\r\n\r\n  ▲ Next.js 13.5.3\r\n  - Local:        http://localhost:3000\r\n\r\n ✓ Ready in 6.9s\r\nrequest to https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap failed, reason: self-signed certificate in certificate chain\r\n\r\nRetrying 1/3...\r\nrequest to https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap failed, reason: self-signed certificate in certificate chain\r\n\r\nRetrying 2/3...\r\nFetchError: request to https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap failed, reason: self-signed certificate in certificate chain\r\n    at ClientRequest.<anonymous> (C:\\Users\\deghat\\Desktop\\Dana\\dana\\node_modules\\next\\dist\\compiled\\node-fetch\\index.js:1:65756)\r\n    at ClientRequest.emit (node:events:514:28)\r\n    at TLSSocket.socketErrorListener (node:_http_client:495:9)\r\n    at TLSSocket.emit (node:events:514:28)\r\n    at emitErrorNT (node:internal/streams/destroy:151:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:116:3)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  type: 'system',\r\n  errno: 'SELF_SIGNED_CERT_IN_CHAIN',\r\n  code: 'SELF_SIGNED_CERT_IN_CHAIN'\r\n}\r\n ⨯ Failed to download `Inter` from Google Fonts. Using fallback font instead.\r\n\r\nFailed to fetch `Inter` from Google Fonts.}\r\n ○ Compiling /page ...\r\n ✓ Compiled /page in 8.7s (425 modules)\r\n ⨯ Internal error: TypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:13220:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n ⨯ Internal error: TypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:13220:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\ndigest: \"2492120818\"\r\n``` \r\nso basically i cannot fetch any data,not even the google fonts.\r\ni have tried : \r\n`npm config set strict-ssl=false`\r\n`npm config set strict-ssl false --global`\r\n`set NODE_TLS_REJECT_UNAUTHORIZED=0`\r\n`git config http.sslVerify false`\r\nnode version : v20.8.0\r\nnpm version : 10.1.0\r\npackage.json file : \r\n```\r\n{\r\n  \"name\": \"dana\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\"\r\n  },\r\n  \"dependencies\": {\r\n    \"react\": \"latest\",\r\n    \"react-dom\": \"latest\",\r\n    \"next\": \"latest\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"typescript\": \"latest\",\r\n    \"@types/react\": \"latest\",\r\n    \"@types/node\": \"latest\",\r\n    \"@types/react-dom\": \"latest\",\r\n    \"eslint\": \"latest\",\r\n    \"eslint-config-next\": \"latest\"\r\n  }\r\n}\r\n\r\n``` "}
{"sentences": "FATAL ERROR: Reached heap limit (Nextjs 13.4.19)", "description": "### Summary\r\n\r\n# To Reproduce\r\n1. start app in production mode\r\n2. leave for several days (we leave app due to national holiday) and issue happened\r\n\r\n# Environment information\r\nplease note that this is amazon linux 2023 on ec2 environment\r\n```\r\n    Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #1 SMP PREEMPT_DYNAMIC Tue Jun  6 00:47:06 UTC 2023\r\n    Binaries:\r\n      Node: 18.16.0\r\n      npm: 9.5.1\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant Packages:\r\n      next: 13.4.19\r\n      eslint-config-next: 13.4.3\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.2.2\r\n    Next.js Config:\r\n      output: N/A\r\n```\r\n\r\n# Related Issues\r\nmaybe related issue? not sure...\r\nbecause mine is occurred with production mode while these article says it's in dev mode\r\n#32314\r\n#50001\r\n#46756\r\n\r\n# Detailed error message\r\n```\r\n<--- Last few GCs --->\r\n\r\n[2766124:0x6be8150] 520600736 ms: Mark-sweep 2031.4 (2083.6) -> 2030.0 (2083.6) MB, 5138.6 / 0.0 ms  (average mu = 0.884, current mu = 0.830) allocation failure; scavenge might not succeed\r\n[2766124:0x6be8150] 520633952 ms: Mark-sweep 2031.4 (2083.8) -> 2030.2 (2084.1) MB, 4332.9 / 0.0 ms  (average mu = 0.877, current mu = 0.870) allocation failure; scavenge might not succeed\r\n\r\n\r\n<--- JS stacktrace --->\r\n\r\nFATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\r\n 1: 0xb7a940 node::Abort() [next-router-worker]\r\n 2: 0xa8e823  [next-router-worker]\r\n 3: 0xd5c940 v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, bool) [next-router-worker]\r\n 4: 0xd5cce7 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [next-router-worker]\r\n 5: 0xf3a3e5  [next-router-worker]\r\n 6: 0xf4c8cd v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [next-router-worker]\r\n 7: 0xf26fce v8::internal::HeapAllocator::AllocateRawWithLightRetrySlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [next-router-worker]\r\n 8: 0xf28397 v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [next-router-worker]\r\n 9: 0xf0956a v8::internal::Factory::NewFillerObject(int, v8::internal::AllocationAlignment, v8::internal::AllocationType, v8::internal::AllocationOrigin) [next-router-worker]\r\n10: 0x12ce7af v8::internal::Runtime_AllocateInYoungGeneration(int, unsigned long*, v8::internal::Isolate*) [next-router-worker]\r\n11: 0x16fb6b9  [next-router-worker]\r\nerror Command failed with signal \"SIGABRT\".\r\n```\r\n\r\n# Question\r\nis this code related? or problem on nextjs itself?\r\nand how can i resolve it?\r\n\r\neven PM2 does not restart automatically\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Static pages are not displaying any UI - only raw arrays and objects", "description": "### Summary\n\nI have a pretty weird issue that I just cannot solve. When deploying my NextJS 13 app to production, static pages are not displaying any UI after hitting the refresh button in the browser. It just shows raw data like for example:\r\n\r\n```\r\n0:[[[\"\",{\"children\":[\"(legals)\",{\"children\":[\"impressum\",{\"children\":[\"\",{}]}]}]},null,null,true],\"$L1\",[\"$L2\",null]]]\r\n2:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"Impressum | Lovemade Presents\"}],[\"$\",\"meta\",null,{\"name\":\"description\",\"content\":\"Das Impressum von Lovemade Presents.\"}],null,null,[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\"}],null,null,null,[[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#fff\"}]],null,[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",null,{\"name\":\"creator\",\"content\":\"Arthur Eberle\"}],null,[\"$\",\"meta\",null,{\"name\":\"robots\",\"content\":\"noindex\"}],null,null,null,null,null,null,null,[]],[null,null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-32x32.png\",\"sizes\":\"32x32\",\"type\":\"image/png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-16x16.png\",\"sizes\":\"16x16\",\"type\":\"image/png\"}]],[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-touch-icon.png\",\"sizes\":\"180x180\",\"type\":\"image/png\"}]],null]]\r\n4:I{\"id\":\"8041\",\"name\":\"\",\"chunks\":[\"2272:webpack-d1218b23a205f2fd\",\"9701:9701-c57f081795e4e716\"],\"async\":false}\r\n5:I{\"id\":\"2760\",\"chunks\":[\"2575:2575-1c83760e8d588a9e\",\"3520:3520-e70f2dc7e2a48956\",\"7054:7054-03b6491f820047ea\",\"7601:app/error-432bc813c1fb06c7\"],\"name\":\"default\",\"async\":true}\r\n6:I{\"id\":\"26\",\"name\":\"\",\"chunks\":[\"2272:webpack-d1218b23a205f2fd\",\"9701:9701-c57f081795e4e716\"],\"async\":false}\r\n7:I{\"id\":\"5135\",\"name\":\"ScrollUp\",\"chunks\":[\"3520:3520-e70f2dc7e2a48956\",\"6394:6394-e1cef6a31e7244f9\",\"795:app/ueber-mich/page-5434c427c45dcd3e\"],\"async\":false}\r\n8:I{\"id\":\"2575\",\"name\":\"\",\"chunks\":[\"2575:2575-1c83760e8d588a9e\",\"3520:3520-e70f2dc7e2a48956\",\"6394:6394-e1cef6a31e7244f9\",\"7949:7949-533403c5e9441a0e\",\"9700:9700-6a651601299108cd\",\"3466:3466-02cbcde03af577fd\",\"4978:4978-dd069b7e82a1af2a\",\"4746:4746-54762bd4c8c9ca89\",\"1875:1875-5f85a037b46a66b7\",\"4567:4567-04f0634b5c1c4a4f\",\"6034:app/shop/[slug]/page-706bb76de63d39d1\"],\"async\":false}\r\n9:I{\"id\":\"9884\",\"name\":\"Toaster\",\"chunks\":[\"2575:2575-1c83760e8d588a9e\",\"3520:3520-e70f2dc7e2a48956\",\"6394:6394-e1cef6a31e7244f9\",\"7949:7949-533403c5e9441a0e\",\"3594:3594-9ff82cf174d0fb3a\",\"4567:4567-04f0634b5c1c4a4f\",\"3185:app/layout-ae11a79c912e5906\"],\"async\":false}\r\n```\r\n\r\nIt does only happen on pages that are either marked with the (Static) or (SSG) Symbol and also only in production. In my local environment everything works fine.\r\n\r\nHere is an link of my clients page to try it for yourself:\r\n\r\nhttps://lovemadepresents.de/agb\r\n--> marked with `export const dynamic = \"force-dynamic\";`\r\n--> no issues\r\n\r\nhttps://lovemadepresents.de/impressum\r\n--> not marked with anything\r\n--> displays raw data after page refresh\r\n\r\nBesides that both pages are equal, do not fetch anything, have hardcoded text and a metadata object (which is not the problem since commenting it does not solve it)\r\n\r\nTried it with the canary version and downgraded to 13.2.3\r\n\r\nI would appreciate any help since i am completely lost at this point\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Is useEffect working in the next js version 13.5.3?", "description": "I am trying to use useEffect() but it is not working. Can anyone help me? \r\n\r\n```\r\n\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nfunction Dashboard() {\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    fetch(\"https://jsonplaceholder.typicode.com/users\")\r\n      .then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"Network response was not ok\");\r\n        }\r\n        return response.json();\r\n      })\r\n      .then((result) => {\r\n        setData(result);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error fetching data:\", error);\r\n      })\r\n      .finally(() => {\r\n        setLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      {loading ? (\r\n        <div>Loading...</div>\r\n      ) : (\r\n        <>\r\n          <h1>User List</h1>\r\n          <ul>\r\n            {data.map((item: any) => (\r\n              <li key={item.id}>{item.name}</li>\r\n            ))}\r\n          </ul>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Dashboard;\r\n```\r\n"}
{"sentences": "How do I make that all `dashboard` pages are passed `isAdmin` check using `SessionProvider`?", "description": "### Summary\n\nI have 3 routes:\r\n\r\n- /dashboard\r\n- /dashboard/support\r\n- /dashboard/admin\r\n\r\nI want to pass all 3 routes a prop from the top called `isAdmin`. `isAdmin` is a boolean to make sure only admins access `/dashboard/admin` route.\r\n\r\nIt uses swr:\r\n\r\n```tsx\r\nimport useSWRImmutable from \"swr/immutable\"\r\n\r\nconst fetcher = (...args: [any]) => fetch(...args).then((res) => res.json())\r\n\r\nexport const useAdminStatus = () => {\r\n\tconst { data, error, isLoading } = useSWRImmutable(`/api/admin`, fetcher)\r\n\r\n\treturn {\r\n\t\tdata,\r\n\t\terror,\r\n\t\tisLoading,\r\n\t}\r\n}\r\n```\r\n\r\nHow do I pass it now that I don't have `_app.tsx`?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How can I view the response of an API on the front end?", "description": "### Summary\n\nI am getting \"undefined\" in the front end when I try to get the response back from the api..\r\n \r\nHere is the code on the front end:\r\n\r\n```\r\nconst response = await fetch(\"/api/ai1\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json, text/plain, */*\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(data),\r\n    });\r\n    // reset value of input\r\n    setText(\"\");\r\n\r\n    const searchRes = await response.json();\r\n    console.log(searchRes.output.response);  /// <-- this is coming undefined.\r\n```\r\n\r\nThis is the code on the back end:\r\n\r\n\r\n```\r\nconst workWithLangchain = async (req, res) => {\r\n  const model = new OpenAI({\r\n    temperature: 0,\r\n    openAIApiKey: process.env.OPENAI_API_KEY,\r\n  });\r\n\r\n  const message = req.body.newText;\r\n\r\n  console.log(message);\r\n\r\n  const template = \"Be very funny when answering questions {question}\";\r\n\r\n  const prompt = new PromptTemplate({ template, inputVariables: [\"question\"] });\r\n\r\n  const chain = new LLMChain({ llm: model, prompt });\r\n\r\n  const result = await chain.call({\r\n    question: message,\r\n  });\r\n  console.log(result.text);  /// <--  this is working to load the answer in the console in VS code\r\n  res.status(200).json({ output: result });  <--  this doesn't seem to be communicating to catch it in the front end..\r\n};\r\n```\r\n\r\n\r\nNow... I can do console.log in the front end and see them in the browser console..  I suspect this is not a problem of console.log, but proper communication from the back to the front end.. \r\n\r\nAny feedback would be awesome... thank you much! \r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Deploying the NextJS blog tutorial to Vercel is failing (no such file or directory, scandir '/vercel/path0/posts')", "description": "### Summary\r\n\r\nI'm in the middle of the NextJS blog tutorial ([https://nextjs.org/learn/basics/deploying-nextjs-app/deploy](https://nextjs.org/learn/basics/deploying-nextjs-app/deploy)) and am deploying to Vercel for the first time. Vercel is failing to launch the code. I'm confused about why because I haven't really strayed from the tutorial. Can someone please guide me in the right direction?\r\n\r\nHere's my repo code: [https://github.com/annetters/nextjs-blog](https://github.com/annetters/nextjs-blog)\r\n\r\n[13:44:25.038] Running build in Washington, D.C., USA (East) – iad1 (Hive)\r\n[13:44:25.149] Cloning github.com/annetters/nextjs-blog (Branch: main, Commit: 7e6eb0f)\r\n[13:44:25.158] Skipping build cache, deployment was triggered without cache.\r\n[13:44:25.464] Cloning completed: 314.953ms\r\n[13:44:25.763] Running \"vercel build\"\r\n[13:44:26.224] Vercel CLI 32.3.1\r\n[13:44:26.596] Warning: Detected \"engines\": { \"node\": \">=18\" } in your `package.json` that will automatically upgrade when a new major Node.js Version is released. Learn More: http://vercel.link/node-version\r\n[13:44:26.601] Installing dependencies...\r\n[13:44:42.042] \r\n[13:44:42.042] added 114 packages in 15s\r\n[13:44:42.042] \r\n[13:44:42.042] 72 packages are looking for funding\r\n[13:44:42.042]   run `npm fund` for details\r\n[13:44:42.061] Detected Next.js version: 13.5.2\r\n[13:44:42.063] Detected `package-lock.json` generated by npm 7+\r\n[13:44:42.064] Running \"npm run build\"\r\n[13:44:42.907] \r\n[13:44:42.907] > build\r\n[13:44:42.907] > next build\r\n[13:44:42.907] \r\n[13:44:43.411] Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n[13:44:43.412] This information is used to shape Next.js' roadmap and prioritize features.\r\n[13:44:43.412] You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n[13:44:43.412] https://nextjs.org/telemetry\r\n[13:44:43.412] \r\n[13:44:43.499]    Linting and checking validity of types...\r\n[13:44:43.644]    Creating an optimized production build...\r\n[13:44:51.163]  ✓ Compiled successfully\r\n[13:44:51.164]    Collecting page data...\r\n**[13:44:51.820] Error: ENOENT: no such file or directory, scandir '/vercel/path0/posts'\r\n[13:44:51.820]     at Object.readdirSync (node:fs:1527:3)\r\n[13:44:51.820]     at _ (/vercel/path0/.next/server/chunks/628.js:1:2665)\r\n[13:44:51.820]     at x (/vercel/path0/.next/server/pages/posts/[id].js:1:1408)\r\n[13:44:51.820]     at buildStaticPaths (/vercel/path0/node_modules/next/dist/build/utils.js:733:39)\r\n[13:44:51.820]     at /vercel/path0/node_modules/next/dist/build/utils.js:1164:116\r\n[13:44:51.820]     at async Span.traceAsyncFn (/vercel/path0/node_modules/next/dist/trace/trace.js:105:20) {\r\n[13:44:51.821]   errno: -2,\r\n[13:44:51.821]   syscall: 'scandir',\r\n[13:44:51.821]   code: 'ENOENT',\r\n[13:44:51.821]   path: '/vercel/path0/posts'\r\n[13:44:51.821] }\r\n[13:44:51.823] \r\n[13:44:51.823] > Build error occurred\r\n[13:44:51.825] Error: Failed to collect page data for /posts/[id]\r\n[13:44:51.825]     at /vercel/path0/node_modules/next/dist/build/utils.js:1195:15 {\r\n[13:44:51.826]   type: 'Error'\r\n[13:44:51.826] }\r\n[13:44:51.866] Error: Command \"npm run build\" exited with 1**\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Invalid <Link> with <a> child error is driving me nuts", "description": "Since upgrading to Next 13 I keep getting the error message:\r\n\r\n```\r\nError: Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>.\r\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor\r\n```\r\n\r\nSo, I went through my site with a fine tooth comb and cleaned up the `<Link>s` with an `<a>` tag as dictated by the docs [here](https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor). Then I ran the code mod just to be sure I had not missed anything (I had - in my header component [thanks code mod]). \r\n\r\nNow my site loads in localhost (it used to throw the error right away) however when I attempt to navigate to any sub-pages I keep getting the `Invalid <Link> with <a> child` error. The problem with the error is that it does not specify where I have an incorrect `<Link>` tag. When I run the code mod it returns:\r\n\r\n```\r\nAll done.\r\nResults:\r\n0 errors\r\n27 unmodified\r\n0 skipped\r\n5 ok\r\n```\r\n\r\nThe site builds fine in Vercel, so there are no build errors - just in local host. My repo can be found [here](https://github.com/Isaac-Tait/ilovetofish)\r\n\r\nHas anyone else run into this issue? If so how did you resolve it? I did notice that the code mod was putting `legacyBehavior` as a prop on `<Link>` tags without an `<a>` tag (as can be seen [here](https://github.com/Isaac-Tait/ilovetofish/commit/987a6b61c21e6053ec3eba72699c3341c8576134)) - it is my understanding that you do not need the `legacyBehavior` prop unless you are using an `<a>` tag. Is that correct?"}
{"sentences": "I need help with getStaticProps", "description": "### Summary\n\nMy site page is located inside the app directory and I used generation without getStaticProps, with my own async function, and everything worked for me, then I found out that it is possible to use getStaticProps better. And I did something like in this tutorial: https://nextjs.org/learn/basics/data-fetching/with-data, but the data was undefined. I realized that getStaticProps cannot be used in the app directory, so I created a pages folder and put the folder with the page there, but then Next.js cannot find the path to it and a 404 error appears.\r\n\r\nWhat am I doing wrong?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "getSortedPostsData \"is not a function\"", "description": "Getting a TypeError when going through the tutorial, section \"Pre-rendering and Data Fetching\", part 7:\r\n\r\nTypeError: (0 , _lib_posts__WEBPACK_IMPORTED_MODULE_3__.getSortedPostsData) is not a function\r\n\r\nCode is exactly as specified, copy/pasted from tutorial."}
{"sentences": "How to get server side html when using App Router", "description": "I'm using `emotion/server` and try to solve cssinjs problem.\r\n\r\nwith `emotion/server`, I can use \r\n\r\n```\r\nlet { html, css, ids } = extractCritical(renderToString(<App />))\r\n```\r\n\r\nto get style in server side.\r\n\r\nAnd it can work well with page router using `_doucment`\r\n\r\n```tsx\r\nclass MyDocument extends Document {\r\n  static async getInitialProps(ctx: DocumentContext) {\r\n\r\n    const page = await ctx.renderPage({\r\n      enhanceApp: (App) => (props) => (\r\n        <StyleProvider cache={extractStaticStyle.cache}>\r\n          <App {...props} />\r\n        </StyleProvider>\r\n      ),\r\n    });\r\n    const styles = extractStaticStyle(page.html)\r\n\r\n return {\r\n      ...initialProps,\r\n      styles: (\r\n        <>\r\n          {initialProps.styles}\r\n          {styles}\r\n        </>\r\n      ),\r\n    };\r\n}\r\n\r\n```\r\n\r\nBut I don't find any place with app router that I can get rendered html."}
{"sentences": "App router full-stack debugging doesn't hit break-point for client components", "description": "It worked before but it no longer hit client side components break-points after I updated next module.\r\nmodule version is 13.5.2 and I followed vscode launch.json\r\n\r\nIs it something related with 'debugWithChrome' ? I didn't install 'Debugger for Chrome' which is deprecated.\r\n\r\nAny ideas to debug both server and client components in app router mode as same as before?\r\n\r\n```\r\n{\r\n  // Use IntelliSense to learn about possible attributes.\r\n  // Hover to view descriptions of existing attributes.\r\n  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\r\n  \"version\": \"0.2.0\",\r\n  \"configurations\": [\r\n    {\r\n      \"name\": \"Next.js: debug server-side\",\r\n      \"type\": \"node-terminal\",\r\n      \"request\": \"launch\",\r\n      \"command\": \"npm run dev\"\r\n    },\r\n    {\r\n      \"name\": \"Next.js: debug client-side\",\r\n      \"type\": \"chrome\",\r\n      \"request\": \"launch\",\r\n      \"url\": \"http://localhost:3000\"\r\n    },\r\n    {\r\n      \"name\": \"Next.js: debug full stack\",\r\n      \"type\": \"node-terminal\",\r\n      \"request\": \"launch\",\r\n      \"command\": \"npm run dev\",\r\n      \"serverReadyAction\": {\r\n        \"pattern\": \"started server on .+, url: (https?://.+)\",\r\n        \"uriFormat\": \"%s\",\r\n        \"action\": \"debugWithChrome\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```"}
{"sentences": "Deployment fails when Loading UI is deleted", "description": "When I delete loading.tsx file (which I added and deployed before) that I use in my app route, I get such an error on Vercel Dashboard;\r\n\r\nModule not found: Can't resolve '/vercel/path0/app/loading.tsx'"}
{"sentences": "cant run docker images after success build.", "description": "I'm encountering an issue while setting up my Next.js production environment using Docker for the first time. The problem I'm facing is that when I run the Docker image, my application keeps loading indefinitely. The page appears to blink, and it never fully loads.\r\n\r\n<img width=\"768\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/25787603/2204fe3b-f84c-4cc4-852c-dc75aaf893b5\">\r\n<img width=\"1216\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/25787603/cc6c2779-a009-4fff-8a1b-ea5911add7b7\">\r\n\r\n### Dockerfile\r\n\r\n```Dockerfile\r\n# Stage 1: Build the application\r\nFROM node:18-slim as builder\r\n\r\nWORKDIR /app\r\n\r\n# Copy package.json and yarn.lock files to the container\r\nCOPY package.json yarn.lock ./\r\n\r\n# Install dependencies using yarn with a frozen lockfile\r\nRUN yarn install --frozen-lockfile\r\n\r\n# Copy the rest of the application code to the container\r\nCOPY . .\r\n\r\nENV BUILD_STANDALONE true\r\n\r\n# Build the Next.js application\r\nRUN yarn build\r\n\r\n# Stage 2: Run the production application\r\nFROM node:18-slim as runner\r\n\r\nWORKDIR /app\r\n\r\n# Copy necessary files from the build stage\r\nCOPY --from=builder /app/package.json .\r\nCOPY --from=builder /app/yarn.lock .\r\nCOPY --from=builder /app/next.config.js ./\r\nCOPY --from=builder /app/public ./public\r\nCOPY --from=builder /app/.next/standalone ./\r\nCOPY --from=builder /app/node_modules ./node_modules\r\nCOPY --from=builder /app/.next/static ./.next/static\r\n\r\n# Expose the port the application will run on\r\nEXPOSE 3000\r\n\r\n# Specify the entry point to run the application\r\nENTRYPOINT [ \"node\", \"server.js\" ]\r\n\r\n```\r\n\r\n### next.config.js\r\n```js\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  swcMinify: true,\r\n  output: process.env.BUILD_STANDALONE === 'true' ? 'standalone' : undefined,\r\n  images: {\r\n    remotePatterns: [\r\n      {\r\n        protocol: 'https',\r\n        hostname: '**',\r\n      },\r\n    ],\r\n  },\r\n};\r\n\r\nmodule.exports = nextConfig;\r\n```\r\n"}
{"sentences": "Cannot read file/directory from getServerSideProps", "description": "When trying to read a file from `getServerSideProps` locally it works, but when deployed to Vercel, I get the following error:\r\n\r\n```\r\n2021-03-07T18:49:00.919Z\ta9c0e291-7071-4b74-87ae-2b6bf3bc0359\tERROR\tError: ENOENT: no such file or directory, scandir '/vercel/workpath0/content/posts'\r\n    at Object.readdirSync (fs.js:1021:3)\r\n```\r\n\r\n[Reproduction repo](https://github.com/robertcoopercode/with-mdx-remote-app)\r\nDeployment URL: https://with-mdx-remote-app.vercel.app/\r\n\r\nApp structure\r\n\r\n```\r\n├─ pages\r\n│  ├ posts.js\r\n|    ├[slug].js\r\n|  ├ index.js\r\n│  └ rss.js\r\n├─ posts\r\n│  ├ example-1.js\r\n│  └ example-2.js\r\n└ next.config.js\r\n```\r\n\r\nIn `rss.js` i'm trying to get the list of posts from the `posts` directory using [this strategy](https://github.com/vercel/next.js/issues/8251#issuecomment-547702744) to get the correct content path:\r\n\r\n```js\r\nexport const getServerSideProps = (context) => {\r\n  const res = context.res;\r\n  const posts = fs.readdirSync(postsDirectory);\r\n  console.log(posts);\r\n  return { props: {} };\r\n}\r\n```\r\n\r\nThis works perfectly fine locally, but in a deployed environment, this does not work.\r\n\r\n"}
{"sentences": "Can't deploy my Next app on Vercel platform", "description": "### Summary\n\nHi!\r\n\r\nIm trying to deploy my Next app on Vercel, but every build fails with same error. Im using [next.cloudinary.dev](https://next.cloudinary.dev/) for image optimization \r\n\r\n// Image component\r\nimport { CldImage } from 'next-cloudinary';\r\n\r\nCan someone please explain what this error means \r\n`You must supply a cloudName when initializing the asset` \n\n### Additional information\n\n```js\nYou must supply a cloudName when initializing the asset\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Can I detect draftMode client-side (with pages router)?", "description": "### Summary\r\n\r\nI know I can do the following to detect if draft mode is on server-side:\r\n\r\n```js\r\nexport async function getStaticProps(context) {\r\n  if (context.draftMode) {\r\n    // draftMode is on\r\n  }\r\n}\r\n```\r\n\r\nIs there any way I can do the same client-side **using pages router**? I've tried checking to see if the `__prerender_bypass` cookie is present, but because it is a SameSite Lax cookie I don't think that is possible.\r\n\r\n## Why I want to do this\r\n\r\nI have two versions of my website, a production and a preview one. In the preview, I want to enable draftMode on by default, so that the user doesn't need to go to an `/api/preview` route to enable it. But I can't seem to do it, except by redirecting the user to `/api/preview` and then back to where they were, and for that I need to detect client-side if draftMode is already on.\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Static js files being shown on screen", "description": "### Summary\r\n\r\nHi,\r\n\r\nI created an application using next.js and it almost always works fine. But if a page is left idle for some time and the user goes back to the tab in the browser, it displays static js chunk files name instead of rendering html. (Please refer the screenshot below)\r\n\r\n![Screenshot (6)](https://github.com/vercel/next.js/assets/100556689/fef98fc9-4148-4b95-a292-a8f47a862d1c)\r\n\r\nI tried checking **console** and **network** in dev tools but those are all blank.\r\n\r\nHowever, the html is rendered correctly if the page is refreshed.\r\n\r\nPlease help me on this. Thanks!\r\n\r\n\r\n### Additional information\r\n\r\nUsing next version: 13.4.5\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies", "description": "Hi i have exactly same error as closed Issue #27650 so need help\r\n\r\nI have been trying to get 1 project work for 2 days now. I have wiped all traces of nodejs, reinstalled it, cloned example nextjs projects from scratch, and this error occurs on \"npm run build\"\r\n\r\n> Some kind of error happened... You need to enable debug logging to see the error:\r\n> \r\n> ```js\r\n> // next.config.js\r\n> module.exports = {\r\n>   webpack(config) {\r\n>     config.infrastructureLogging = { debug: /PackFileCache/ }\r\n>     return config;\r\n>   }\r\n> }\r\n> ```\r\n\r\nHere's what I got on my console after enabling it:\r\n\r\nPS E:\\React Projects\\testapp> yarn dev\r\nyarn run v1.22.11\r\n$ next dev\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\ninfo  - Using webpack 5. Reason: Enabled by default https://nextjs.org/docs/messages/webpack5\r\n    [webpack.cache.PackFileCacheStrategy] No pack exists at E:\\React Projects\\testapp\\.next\\cache\\webpack\\client-development.pack: Error: ENOENT: no such f\r\nile or directory, stat 'E:\\React Projects\\testapp\\.next\\cache\\webpack\\client-development\\index.pack'\r\n<t> [webpack.cache.PackFileCacheStrategy] restore cache container: 47.1833 ms\r\n    [webpack.cache.PackFileCacheStrategy] No pack exists at E:\\React Projects\\testapp\\.next\\cache\\webpack\\server-development.pack: Error: ENOENT: no such f\r\nile or directory, stat 'E:\\React Projects\\testapp\\.next\\cache\\webpack\\server-development\\index.pack'\r\n<t> [webpack.cache.PackFileCacheStrategy] restore cache container: 44.0038 ms\r\n    [webpack.cache.PackFileCacheStrategy] Pack got invalid because of write to: ResolverCachePlugin|normal|dependencyType=|esm|path=|E:\\React Projects\\test\r\napp|request=|E:\\React Projects\\testapp\\node_modules\\@next\\react-refresh-utils\\runtime.js\r\n    [webpack.cache.PackFileCacheStrategy] Storing pack...\r\n    [webpack.cache.PackFileCacheStrategy] Capturing build dependencies... (E:\\React Projects\\testapp\\next.config.js, E:\\React Projects\\testapp\\node_modules\r\n\\next\\dist\\compiled\\, E:\\React Projects\\testapp\\node_modules\\next\\dist\\build\\webpack\\loaders\\next-client-pages-loader.js, E:\\React Projects\\testapp\\node_mo\r\ndules\\@next\\react-refresh-utils\\loader.js, E:\\React Projects\\testapp\\node_modules\\next\\dist\\build\\babel\\loader\\index.js, E:\\React Projects\\testapp\\node_mod\r\nules\\next\\dist\\build\\webpack\\loaders\\next-style-loader\\index.js, E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\css-loader\\cjs.js, E:\\React Proj\r\nects\\testapp\\node_modules\\next\\dist\\compiled\\postcss-loader\\cjs.js)\r\nevent - compiled successfully\r\n    [webpack.cache.PackFileCacheStrategy] Pack got invalid because of write to: ResolverCachePlugin|normal|dependencyType=|esm|path=|E:\\React Projects\\test\r\napp|request=|private-next-pages/_app.js\r\n    [webpack.cache.PackFileCacheStrategy] Storing pack...\r\n    [webpack.cache.PackFileCacheStrategy] Capturing build dependencies... (E:\\React Projects\\testapp\\next.config.js, E:\\React Projects\\testapp\\node_modules\r\n\\next\\dist\\compiled\\, E:\\React Projects\\testapp\\node_modules\\next\\dist\\build\\babel\\loader\\index.js, E:\\React Projects\\testapp\\node_modules\\next\\dist\\compil\r\ned\\ignore-loader\\index.js)\r\n<t> [webpack.cache.PackFileCacheStrategy] resolve build dependencies: 2174.4305 ms\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp: Error: EI\r\nNVAL: invalid argument, read\r\n<t> [webpack.cache.PackFileCacheStrategy] snapshot build dependencies: 10.1572 ms\r\n<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\n    [webpack.cache.PackFileCacheStrategy] Error: Unable to snapshot resolve dependencies\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:77909:13\r\n        at jobError (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56110:5)\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56161:10\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56957:13\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130615:5\r\n        at Hook.eval [as callAsync] (eval at create (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:31934:10), <anonymous>:6:\r\n1)\r\n        at Hook.CALL_ASYNC_DELEGATE [as _callAsync] (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:31736:14)\r\n        at AsyncQueue._handleResult (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130585:21)\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130568:11\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56906:12\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects: Error: EINVAL: in\r\nvalid argument, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\: Error: EINVAL: invalid argument\r\n, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp\\node_modul\r\nes\\@next: Error: EINVAL: invalid argument, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp\\node_modul\r\nes: Error: EINVAL: invalid argument, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp\\node_modul\r\nes\\@babel: Error: EINVAL: invalid argument, read\r\n<t> [webpack.cache.PackFileCacheStrategy] resolve build dependencies: 1628.2388 ms\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects: Error: EINVAL: in\r\nvalid argument, read\r\n<t> [webpack.cache.PackFileCacheStrategy] snapshot build dependencies: 8.8026 ms\r\n<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\n    [webpack.cache.PackFileCacheStrategy] Error: Unable to snapshot resolve dependencies\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:77909:13\r\n        at jobError (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56110:5)\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56161:10\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56957:13\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130615:5\r\n        at Hook.eval [as callAsync] (eval at create (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:31934:10), <anonymous>:6:\r\n1)\r\n        at AsyncQueue._handleResult (E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130585:21)\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:130568:11\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:56906:12\r\n        at E:\\React Projects\\testapp\\node_modules\\next\\dist\\compiled\\webpack\\bundle5.js:29533:16\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp: Error: EI\r\nNVAL: invalid argument, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\: Error: EINVAL: invalid argument\r\n, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp\\node_modul\r\nes: Error: EINVAL: invalid argument, read\r\n    [webpack.cache.PackFileCacheStrategy/webpack.FileSystemInfo] Error snapshotting file timestamp hash combination of E:\\React Projects\\testapp\\node_modul\r\nes\\@babel: Error: EINVAL: invalid argument, read\r\n\r\n_Originally posted by @Fangston0 in https://github.com/vercel/next.js/issues/27650#issuecomment-891831607_"}
{"sentences": "Alternative to App.getInitialProps", "description": "Is there any good alternative to App.getInitialProps to fetch global data for every page?"}
{"sentences": "nextjs first time load take while", "description": "in nextjs production when I run the server for the first time and create the first request \r\n[GET, POST,  ...], it take about 3-7 seconds to respond then the website run normally\r\ni figured that next js create static generation on first user visit the website \r\nhow to prevent this or how to trigger this event after run server so the first user no need to wait for this event to happen \r\n\r\nI have solve this by just create an custom express server and run axios request to home page to trigger this event after server starts\r\n\r\nbut in my case iam using **pm2** for production and wen i create more than 2 cluster the first cluster who trigger this event wen i call axios request for my domain and the other clusters still waiting for 3-7 sec at first visit  "}
{"sentences": "BAD_GATEWAY : ROUTER_CANNOT_MATCH", "description": "### Summary\n\nHello,\r\n\r\nI am migrating Next 12 to Next 13, no problem locally and on a local build. \r\nI also tested with `vercel dev` and everything is ok.\r\n\r\nAt the time of putting in prod, I find myself with this message: \r\n<img width=\"561\" alt=\"Capture d’écran 2023-04-09 à 22 10 14\" src=\"https://user-images.githubusercontent.com/5682535/230794338-14ab844d-3aeb-4cff-8eb3-e38a7ecbd4f0.png\">\r\n\r\nI've tried a lot of manipulations but nothing works, even though everything is fine locally.\r\n\r\nDo you have an idea of the problem?\r\n\r\nRegards\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How can I push() a different key/value set into an object repeatedly?", "description": "### Summary\n\n***** Hint – I think this might be a problem of my Visual Studio Code… but you guys can read it all to see…\r\n\r\nProblem:\r\nI have a JSON file to which I want to add another key/value pair kind of like this:\r\n\r\n`“text2”: “here is something else”`\r\n\r\nHere is a sample of the original json without the addition:\r\n```\r\n{\r\n“data”: [\r\n{\r\n“id”: “1700148573403304137”,\r\n“text”: “hola”\r\n},\r\n{\r\n“id”: “1700147255322259501”,\r\n“text”: “hello”\r\n},\r\n{\r\n“id”: “1700146984903155986”,\r\n“text”: “hi”\r\n}\r\n]\r\n}\r\n```\r\n\r\nHere is the code:\r\n```\r\nvar data = fs.readFileSync(“./thejsons/a.json”);\r\nvar myObject = JSON.parse(data);\r\n\r\nlet toAdd = { text2: { valuefortext2 } };\r\n\r\nconsole.log(toAdd);\r\n\r\nmyObject.data[textIndex++].push(toAdd);\r\nvar newData2 = JSON.stringify(myObject);\r\n\r\ntimesRun += 1;\r\n\r\nif (timesRun === 3) {\r\n  clearInterval(myIntervals);\r\n\r\n  fs.writeFile(\"./thejsons/a1.json\", newData2, (err) => {\r\n    // error checking\r\n    if (err) throw err;\r\n\r\n    console.log(\"New data added\");\r\n  });\r\n\r\n```\r\n\r\n`Error:  is not a function`    when I try this ` myObject.data[textIndex++].push(toAdd);`\r\n\r\nOR.... if I delete` [textIndex++]`  the `toAdd`  gets added, but just once (last data at the run), at the bottom of the .data array as a new object in the array..\r\n\r\nI think the problem might be from my Visual Studio Code changing this format below??\r\n\r\n`let toAdd = { text2: { valuefortext2 } };`  <--   that is what visual studio code is re-formatting this line after I save.\r\n\r\n`let toAdd = \"text2\" : `${ valuefortext2 }` ;`  <---  but I want something more like this, to be added under each one of the \"text\" key/value pairs of the .data array...\r\n\r\nAny feedback on how I could fix this?.....  any information would be awesome...\r\n\r\n\r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to embedded a Font Awesome Icon inside a Link", "description": "Hello! I'm trying to make a Fontawesome Icon clickable, and when it gets clicked, to load another page of /pages folder. \r\n\r\nThis is my code:\r\n```\r\n<section>\r\n  <Link>\r\n    <a href=\"/counter\"><FontAwesomeIcon icon={faChevronRight} /></a>\r\n  </Link>\r\n</section>\r\n``` \r\n\r\nBut I'm getting these errors:\r\n![errors](https://user-images.githubusercontent.com/38326017/85904181-77473700-b7de-11ea-9136-4bf974b2bb64.png)\r\n\r\nWhat I'm doing wrong?\r\n\r\n"}
{"sentences": "What versioning scheme does Next.js adhere to?", "description": "### Summary\n\nThis has been surprisingly hard to figure out. I have tried searching around on Google, and looking in the GitHub repo, but haven't found any comments on the versioning scheme. Does anybody know, and can provide a link to the official documentation about it?\r\n\r\nI want to upgrade Next.js from 13.4.2 to 13.4.19, and it will be easier if I know there are no breaking changes, which it shouldn't be if Next.js adheres to semantic versioning.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Parallel Route in App Router", "description": "I am learning Next JS's Parallel Route, I got stuck into it. I was testing it without using `src` directory, Parallel Router acted weird without `src` directory, but when I created new project with `src` directory it worked, I want to know why? Do I need some additional configuration for parallel routes to use it without `src` directory or is it some weird bug untested on same scenario?"}
{"sentences": "'use client' not working", "description": "### Summary\n\nhi, i have a button with an event handler that does a console log ('ok'). however, when i click the button, nothing is logged, neither server side nor client side. i added another console log ('rendering') before the event handler definition, and this one does log but only on the server side. i have 'use client' at the top of the file. shouldn't 'rendering' be logged client side? and why is the event handler on the button not called on click?\n\n### Additional information\n\n```js\n'use client'\r\n\r\nimport React from 'react'\r\n\r\nconst Home = () => {\r\n  console.log('rendering')\r\n  function handleClick() {console.log('ok')}\r\n  \r\n  return (\r\n    <div>\r\n      <button onClick={handleClick}>button</button>\r\n    </div>\r\n    \r\n  )  \r\n}\r\nexport default Home\r\n```\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How to configure <Image /> to support hiDpi (Retina) images?", "description": "I can define image sizes in next.config.js for different viewports.\r\n```\r\nmodule.exports = {\r\n\timages: {\r\n\t\tdeviceSizes: [576, 768, 1024, 1440, 1920, 2560, 3840],\r\n\t},\r\n};\r\n```\r\nBut how, for example, to include a **2x** size image? Do I have to specify an additional size **2x** for each size **1x**? Like:\r\n\r\ndeviceSizes: [576, **1152**, 768, **1536**, 1024, **2048**, 1440, **2880**, 1920, **3840**, 2560, **5120**, **7680**]\r\n\r\nThen, how can I target these sizes, like `srcset` in standart `<img />`?\r\nThx."}
{"sentences": "Is the \"Static Exports\" feature still available in the App Router?", "description": "Hello 👋,\r\n\r\nI am particularly interested in knowing if \"Static Exports\" is still supported in the current version of the Next.js with App Router. If it is, could you please provide some details or examples on how it works? If it's not, what are the alternatives for achieving similar functionality?\r\n\r\nThanks in advance for your help!\r\n\r\n"}
{"sentences": "How is Vercel shipping the Next.js docs?", "description": "### Summary\n\nHow are Next.js docs built with custom tags like `<AppOnly />` and `<PageOnly />` rendered on https://nextjs.org/docs ? \r\n\r\nMy intention is to create an unofficial localization of the docs for the community.\r\n\r\nP.S. If there's already an internalization going on somewhere, please let me know, thank you.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "TypeError: configDeviceSizes is not iterable", "description": "Am encountering this error from nextjs and donot know how to go about it\r\n```js\r\n.next\\server\\pages\\_app.js (125:7) @ Object../node_modules/next/dist/client/image.js\r\n\r\n  123 | // sort smallest to largest\r\n  124 | const allSizes = [\r\n> 125 |     ...configDeviceSizes,\r\n      |       ^\r\n  126 |     ...configImageSizes\r\n  127 | ];\r\n  128 | configDeviceSizes.sort((a, b)=>a - b\r\n"}
{"sentences": "Add option to disable getServerSideProps on client-side navigation", "description": "# Feature request\r\n\r\n## Is your feature request related to a problem? Please describe.\r\n\r\n1. Function `getServerSideProps` runs on every request and there is no way to use apollo [existing cache to load data from on client-side navigation.](https://github.com/vercel/next.js/discussions/11957#discussioncomment-48814) It's will do unnecessary request to server if there is data already in client cache.\r\n\r\n2. We need SSR only on initial render for SEO, there is no need for it to run every time and block page rander, it's better to show loading or page skeleton.\r\n\r\n## Describe the solution you'd like\r\n\r\nAdd option to disable getServerSideProps on client-side navigation\r\n\r\n```\r\nexport async function getServerSideProps(context) {\r\n  return {\r\n    props: {},\r\n    disableOnClientSideNavigation: true,\r\n  }\r\n}\r\n```\r\n\r\n## Describe alternatives you've considered\r\n\r\nAdd another function like `getServerSideProps` thats will not run on client navigation.\r\n\r\nOR\r\n\r\nAdd export config from page:\r\n```\r\nexport pageConfig = {\r\n    disableOnClientSideNavigation: true,\r\n}\r\n```\r\n\r\nOR\r\n\r\nAdd option to router:\r\n`router.push('user/1', undefined, { disableGetServerSideProps : true })`\r\n\r\n## Additional context\r\n\r\nThen you can use same graphql query in component and getStaticProps\r\n\r\n```\r\nconst UserQuery = gql`\r\n  query User {\r\n    getUser {\r\n      id\r\n    }\r\n  }\r\n`\r\n\r\nexport function User(): JSX.Element {\r\n  const { data } = useQuery(UserQuery)\r\n\r\n  return (\r\n      <div>user</div>\r\n  )\r\n}\r\n\r\nexport const getStaticProps: GetStaticProps = async (ctx) => {\r\n  const apolloClient = initializeApollo(null)\r\n\r\n    await apolloClient.query({ query: UserQuery})\r\n\r\n  return {\r\n    props: {\r\n      initialApolloState: apolloClient.cache.extract(),\r\n    },\r\n  }\r\n}\r\n```"}
{"sentences": "next.js problem compiling - node modules error", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n\r\n    Operating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Home\r\n    Binaries:\r\n      Node: 19.1.0\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.0.4\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\n\n### What browser are you using? (if relevant)\n\nNot relevant, but Chrome\n\n### How are you deploying your application? (if relevant)\n\ninstalled via npx create-next-app\n\n### Describe the Bug\n\nYou can see the error here:\r\n`wait  - compiling /_error (client and server)...\r\nevent - compiled client and server successfully in 80 ms (187 modules)\r\nWarning: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\r\n1. You might have mismatching versions of React and the renderer (such as React DOM)\r\n2. You might be breaking the Rules of Hooks\r\n3. You might have more than one copy of React in the same app\r\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.\r\nTypeError: Cannot read properties of null (reading 'useContext')\r\n    at Object.useContext (C:\\Users\\garced\\Documents\\anthonygarced.com\\my-app\\node_modules\\react\\cjs\\react.development.js:1618:21)\r\n    at Html (webpack-internal:///../../../AppData/Roaming/npm/node_modules/next/dist/pages/_document.js:678:104)\r\n    at renderWithHooks (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5658:16)\r\n    at renderIndeterminateComponent (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5731:15)\r\n    at renderElement (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5946:7)\r\n    at renderNodeDestructiveImpl (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:6104:11)\r\n    at renderNodeDestructive (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:6076:14)\r\n    at finishClassComponent (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5688:3)\r\n    at renderClassComponent (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5696:3)\r\n    at renderElement (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5943:7)\r\nnpm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:6076:14)\r\n    at finishClassComponent (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5688:3)\r\n    at renderClassComponent (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5696:3)\r\n    at renderElement (C:\\Users\\garced\\AppData\\Roaming\\npm\\node_modules\\next\\node_modules\\react-dom\\cjs\\react-dom-server.browser.development.js:5943:7)`\r\n\r\nI have checked multiple times, there is no duplicates of any react folder, I reinstalled the next.js variables by installing them multiple times in different folders, and BY default it creates this error every single time.\r\n\r\nI even reinstalled node,js and react and it still creates this issue. I also made a post on StackOverflow, but got no response.\r\nI'm lilkely missing something here, but I'd thought I would make an issue here and see if this would help with the issue.\n\n### Expected Behavior\n\nI expected to see the default page when you first installed next.js, which would be how to get started.\r\n\r\nInstead, I got a context error.\n\n### Link to reproduction - Issues with a link to complete (but minimal) reproduction code will be addressed faster\n\nhttps://github.com/anthonygarced/test-example\n\n### To Reproduce\n\n_This should be how you do it here:_\r\n\r\n1. Open VSC (Visual Studio Code)\r\n2.. ctrl `, npx install create-next-app\r\n3. This does not matter if you install ESLint or TypeScript, this issue occurs via the node_modules\r\n\r\n"}
{"sentences": "With the new app router, can you still render components on the server, and then also make them client side?", "description": "Let's take a product listing page for example. I'd prefer the products, without any filters selected, by loaded from the server... but then on page load, allow the products to be filtered / updated dynamically when the user applies categories or search criteria. This is for SEO purposes. This was achievable with the pages router - curious if this same concept is achievable with the app router.\r\n\r\nThanks"}
{"sentences": "Next/link not following redirects defined in next.config.js", "description": "# Bug report\r\n\r\nWhen specifying redirects in the next.config.js on next.js 9.5.3, `next/link` on the page will not pick that up that redirect correctly, and not redirect accordingly, leading to a navigation to the source of the redirect (instead of the destination).\r\n\r\n\r\nI made a minimal repository with said error: https://github.com/homefully/next-js-9-5-3-link-redirect-bug\r\n\r\nSteps:\r\n- next.js config with a redirect (here from `/failure` to `/success`)\r\n- `<Link passHref href=\"/failure\">...</Link>` \r\n- It should instead go to `/success`, but doesn't.\r\n\r\nTo use the provided repository:\r\n- `npm run ci`\r\n- `npm run dev`\r\n- go to \"localhost:3000\"\r\n- Link should lead to /success, but instead goes to /failure\r\n\r\nHappens in both dev and production builds.\r\n\r\n## Expected behavior\r\n\r\nLink should follow the redirect and go to `/success`, Best case, even show that redirect in the link preview beforehand.\r\n\r\n\r\n## Additional context\r\n\r\nThis behavior did work as expected prior to next.js 9.5.3 (in 9.5.2 for example).\r\n"}
{"sentences": "in next/image onLoad or onLoadingComplete not trigger any function", "description": "here is my code onLoadingComplete not trigger the handleImageLoaded i am also try onLoad it also not work. can anyone helps with this.\r\n\r\n\r\n\"use client\"\r\nimport Image from 'next/image'\r\nimport { useState } from 'react'\r\nimport ImageSkeleton from './Components/ImageSkeleton'\r\n\r\nexport default function Home() {\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handleImageLoaded = () => {\r\n    console.log(\"Image loaded!\"); // Check if this message appears in the console\r\n    setLoading(false);\r\n  };\r\n\r\n  console.log(\"Rendering component. Loading:\", loading); // Check if this message appears in the console\r\n\r\n  return (\r\n    <div>\r\n      {loading ? (\r\n        <ImageSkeleton />\r\n      ) : (\r\n        <Image\r\n          src={\"https://images.pexels.com/photos/12843871/pexels-photo-12843871.jpeg\"}\r\n          width={200}\r\n          height={200}\r\n          alt={\"image\"}\r\n          onLoadingComplete={handleImageLoaded}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"}
{"sentences": "Standalone build assetPrefix conditional config", "description": "### Summary\r\n\r\nTrying to set `assetPrefix` based on a `process.env` value after a production build, does not seem possible.\r\n\r\nReading, does not mention this value is static and cannot change after the build:\r\n\r\nhttps://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix\r\n\r\nIt has the example of a conditional use of `process.env`\r\n\r\n```javascript\r\nconst isProd = process.env.NODE_ENV === 'production'\r\n\r\nmodule.exports = {\r\n  // Use the CDN in production and localhost for development.\r\n  assetPrefix: isProd ? 'https://cdn.mydomain.com' : undefined,\r\n}\r\n```\r\n\r\nThis led me to believe that it's possible to change this based on another process env, say for instance a custom deployment environment:\r\n\r\n```javascript\r\nmodule.exports = {\r\n  // eg change via env config on when the server starts\r\n  assetPrefix: process.env.CDN_PATH,\r\n}\r\n```\r\n\r\nCan't get this to work in the production build as the `assetPrefix` is used in the `.next` output for various `required-server-files.json` files and generated html statically.\r\n\r\nAnyone know how to set the `assetPrefix` dynamically, from `process.env` I am guessing its just not possible from what I can see."}
{"sentences": "TypeError: fetch failed with Next 13.4.19", "description": "### Summary\r\n\r\nAfter upgrading to the latest version of Next.js we are getting a lot of errors on our Kubernetes pods.\r\nAnd I cant seem to figure out what is causing this but it seems like its coming from Next server.\r\n\r\nThe fetch fails errors is sporadic and doesnt show right away but after some time.\r\n\r\nI hope someone can help us figure this out.\r\n\r\nErrors are shown below.\r\n\r\n### Additional information\r\n\r\n```js\r\nTypeError: fetch failed\r\nat Object.fetch (node:internal/deps/undici/undici:11457:11)\r\nat process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\nat async invokeRequest (/opt/app-root/src/node_modules/next/dist/server/lib/server-ipc/invoke-request.js:17:12)\r\nat async invokeRender (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:254:29)\r\nat async handleRequest (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:447:24)\r\nat async requestHandler (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:464:13)\r\nat async Server.<anonymous> (/opt/app-root/src/node_modules/next/dist/server/lib/start-server.js:117:13) {\r\ncause: SocketError: other side closed\r\nat Socket.onSocketEnd (/opt/app-root/src/node_modules/next/dist/compiled/undici/index.js:1:63301)\r\nat Socket.emit (node:events:525:35)\r\nat endReadableNT (node:internal/streams/readable:1359:12)\r\nat process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\ncode: 'UND_ERR_SOCKET',\r\nsocket: {\r\nlocalAddress: 'some IP address',\r\nlocalPort: 44056,\r\nremoteAddress: undefined,\r\nremotePort: undefined,\r\nremoteFamily: undefined,\r\ntimeout: undefined,\r\nbytesWritten: 1485,\r\nbytesRead: 244\r\n\r\n\r\nTypeError: fetch failed\r\nat Object.fetch (node:internal/deps/undici/undici:11457:11)\r\nat process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\nat async invokeRequest (/opt/app-root/src/node_modules/next/dist/server/lib/server-ipc/invoke-request.js:17:12)\r\nat async invokeRender (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:254:29)\r\nat async handleRequest (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:447:24)\r\nat async requestHandler (/opt/app-root/src/node_modules/next/dist/server/lib/router-server.js:464:13)\r\nat async Server.<anonymous> (/opt/app-root/src/node_modules/next/dist/server/lib/start-server.js:117:13) {\r\ncause: SocketError: other side closed\r\nat Socket.onSocketEnd (/opt/app-root/src/node_modules/next/dist/compiled/undici/index.js:1:63301)\r\nat Socket.emit (node:events:525:35)\r\nat endReadableNT (node:internal/streams/readable:1359:12)\r\nat process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\ncode: 'UND_ERR_SOCKET',\r\nsocket: {\r\nlocalAddress: 'some IP address',\r\nlocalPort: 42532,\r\nremoteAddress: 'some IP address, same as localAddress',\r\nremotePort: 41517,\r\nremoteFamily: 'IPv4',\r\ntimeout: undefined,\r\nbytesWritten: 1485,\r\nbytesRead: 244\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How to preserve ISR cache on revalidation error", "description": "I dont always want to return a 404 page if my relidation function returned invalid page information or the call failed.\r\n\r\nIn the documentation, it states that if the revalidation function fails the cache will be left alone and the current page will stay online.\r\n\r\nI'm struggling to get this to work as the suggested method of throwing an error causes the server to fall over completely\r\n\r\n```\r\nexport async function getStaticProps() {\r\n    console.log('Get Static Props - making a call');\r\n    let siteDefaults = await getContent('regLoginImage');\r\n    if (siteDefaults?.fields === undefined) {\r\n        console.log('CMS content not found');\r\n         throw Error('CMS content not found');\r\n    }\r\n\r\n    console.log('CMS content ready');\r\n    return {\r\n        props: {\r\n            content: siteDefaults \r\n        }, // will be passed to the page component as props\r\n        revalidate: 10\r\n    };\r\n}\r\n```"}
{"sentences": "Next.js' own developer guide to getting the product running doesn't work on MacOS", "description": "### Summary\n\nThe [Next.js developer guide](https://github.com/vercel/next.js/blob/32f11c34e8d342d8ab7993fcde2a6c5e7033387b/contributing/core/developing.md) does not work on an M2 Mac.\r\n\r\npnpm dev fails to start turbo, and then fails with\r\n\r\n>Failed: bench-nested-deps#dev, bench-nested-deps-app-router#dev\r\n\r\nI'm the most common dev use case. Where am I going wrong?\r\n\r\n1. I'v tried node 20 and node 18.\r\n2. I followed the instructions exactly.\r\n3. I've deleted the entire repo and rebuilt. Same error.\r\n\r\nAs a workaround,  I'm running turbo outside of Next.js. `pnpm dev` works in the external turbo directory, but `next info` still gets a `command not found`.\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How can I update the URL in browser address bar when using middleware redirects in Next 13?", "description": "In my middleware I'm checking if the given route has a session present, and if not - redirect to the `/sign-in` page:\r\n\r\n```\r\n// src/middleware.js\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function middleware(req) {\r\n  const res = NextResponse.next();\r\n\r\n  // check for session here\r\n\r\n  if (!session) {\r\n    return NextResponse.redirect(new URL('/sign-in', req.url));\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nexport const config = {\r\n  matcher: ['/', '/profile'],\r\n};\r\n```\r\n\r\nNow, it works as expected - but the URL in the browser stays the same as the original route. So for example if I'm not logged-in and go to `/profile`, I'm redirected to my `/sign-in` page, but the URL stays as `/profile`. Same thing with the root route.\r\n\r\nIs there a way to make the URL change as well after the redirect? I was always under the impression that was supposed to be the default behaviour. Am I just missing something obvious? Would appreciate any help. Thanks"}
{"sentences": "Occasionally get served plain text version of website on DigitalOcean", "description": "Hi, after upgrading to Next.js 13 we have been seeing some weird behavior every now and then. We are using the localization system defined in the documentation on the app directory section, the [lang] sub-route manual middleware.\r\n\r\nBut sometimes, we think it is after a crash and restart (hosted on DigitalOcean app platform) we sometimes get served a plain text webpage instead of the actual full site on one or multiple locales, but there is always some locale that work. As an example, that is the worst case for us. The locale \"nb\" is not loading properly, but the locale \"en\" is working. Which is awful to happen as most of our customers will have Norwegian locale. The only way to fix it, is to restart or in DigitalOcean terms \"deploy\". \r\n\r\nWe've only found one instance of another person asking about this issue: [link to stackoverflow question](https://stackoverflow.com/questions/76466634/nextjs-serves-some-text-instead-of-html#comment135685299_76466634) and we are lost on how to treat this. As a stop gap I might just need to force the page to send me an email every time it restarts and manually check if it is working, as the page is still going to serve something so the regular uptime tracker wont catch it. \r\n\r\nIt also does not produce any errors that is logged to Sentry or in console. I could not find an example of our own issue, but it looks almost identical to the example in the stackoverflow post. \r\n\r\nIs this DigitalOcean issue, or is this known elsewhere?"}
{"sentences": "document.getElementById(\"root\") in next.js", "description": "Hi I am facing an issue with scss and next.js\r\n\r\nin a simple reacts app this does work\r\n\r\n```\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n```\r\n\r\nscss:\r\n\r\n```\r\nhtml,\r\nbody,\r\n#root {\r\n  width: 100%;\r\n  height: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  overflow: hidden;\r\n}\r\n\r\n```\r\nIn next.js, it doesn't work... next.js doesn't have a `#root` id element and all my scss doesn't work in UI it renders everything in one main div block, everything overlaps...\r\n\r\n_app.js:\r\n\r\n```\r\nimport './index.scss'\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  return <Component {...pageProps} />\r\n}\r\n\r\nexport default MyApp\r\n```\r\n\r\nHow can I resolve this issue? I need the same thing `document.getElementById(\"root\")` because in react native works.."}
{"sentences": "App router infinite loop when Promise proxied", "description": "👋 Hi Next.js community. I am an engineer from the New Relic browser agent team and I need some help resolving a compatibility issue between Next.js and the New Relic Browser Agent. We have a customer that has reached out indicating our agent is breaking use of `router.push()`.\r\n\r\n[This](https://github.com/david-keefe/nextjs-new-relic-browser-agent-repro) is the customer's reproduction. I traced the issue back to our wrapping of the global `Promise`. It seems like any modification of this global ends up causing an infinite loop in the app router. For example, I modified the reproduction [here](https://github.com/patrickhousley/nextjs-new-relic-browser-agent-repro), removed everything New Relic, and simply added `window.Promise = new Proxy(window.Promise, {})`.\r\n\r\nI have been able to confirm that this stops working in Next.js version 13.3.2-canary.2 and works fine in 13.3.1. I thought maybe [this](https://github.com/vercel/next.js/discussions/52561) discussion is related or maybe is the exact issue but the versions there do not work in the reproduction for this issue.\r\n\r\nI appreciate any help the community and developers can provide. Thanks!!"}
{"sentences": "using the url in generateMetadata Function", "description": "### Summary\r\n\r\nI need to create dynamic metadata based on the subdomain in my url so need to access the url in it, not sure how it can be done if it's supported at the moment.\r\n\r\n### Additional information\r\nUsing Nextjs version -> 13.2.4\r\n"}
{"sentences": "SSG - App Router - when using { cache: 'no-store' } Next no longer generates static HTML files.", "description": "When adding { cache: 'no-store' } to server side fetch calls, NEXT.js no longer generates static html files.\r\n\r\nI want: To prebuild a couple of pages on the server, and build the rest on demand, and at the same time I do not want any of the fetch calls cached. \r\n\r\nReproduction:\r\n\r\n- Clone this official app router demo repo: https://app-router.vercel.app/\r\n- In /app/ssg/[id] add { cache: 'no-store' } as the second parameter to the fetch call.\r\n- Visit pages (http://localhost:3000/ssg/1 ) and look at the .next/server/app/ssg folder and you will see that the static pages are no longer being generated, neither the ones defined inside generateStaticParams. When visiting and revisiting http://localhost:3000/ssg/1 each time it now says \"generated 0seconds ago\", which means SSG is no longer working.\r\n\r\nTo circumvent this I tried not using 'no-store' cache headers and played with on demand revalidation and revalidatePath instead without success (it's not revalidating the data that I manually changed in another backend and the fetch is holding on to old data unfortunately). It would be nice having some kind of solution. Update: I got the on demand revalidation to work, apparently I must provide the revalidate fetch option.\r\n\r\nSummary: I want to disable the data caching of fetch calls, but I want to keep static generation when using generateStaticParams. I did not want to open an issue, because maybe it's working as intended.\r\n\r\n\r\n\r\n"}
{"sentences": "Fetch is caching 404 and returning 200 on subsequent requests", "description": "### Summary\n\nHi, I made a simple API endpoint app/api/hello/route.ts with this code to fetch from a known 404 page:\r\n\r\n```typescript\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function GET(req: Request) {\r\n    const res = await fetch(\"https://optinmonster.com/404\");\r\n    console.log(\"Res is\", res.status);\r\n    return new NextResponse(\"done\", { status: res.status });\r\n}\r\n```\r\n\r\nHitting the endpoint the first time, I get a 404 response which is expected, but subsequent calls return a 200 response. Why is this so?\r\n\r\nIf I add the { cache: \"no-store\"} option to fetch, then it works as expected.  This is NextJS 13.2.4.\r\n\r\nthanks\r\n   Matt\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "next/image Error: Invalid src prop", "description": "I tried to use next/image component in my project, but it keeps giving me a server error, I already changed my `next.config.js` file according to the doc but the app is still broken\r\n![image](https://user-images.githubusercontent.com/61914365/177063198-172f9c8b-f4be-40c6-8b16-79e3bcdef6e9.png)\r\nrepro:  https://stackblitz.com/edit/nextjs-vjxdw5?file=pages/index.js"}
{"sentences": "onClick is not working", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 16.13.2\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant Packages:\r\n      next: 13.4.19\r\n      eslint-config-next: 13.4.19\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.6\r\n    Next.js Config:\r\n      output: N/A\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\n_No response_\n\n### Link to the code that reproduces this issue or a replay of the bug\n\nhttps://github.com/SpBhalani/Netflix-clone-NextJs\n\n### To Reproduce\n\nNA\n\n### Describe the Bug\n\nonClick event is not getting triggered on any of the components.\r\nEven I tried to console log the onChange event but it also didnt work.\r\nIn the given repo in auth path in component called card.tsx on the button component onClick is not working\n\n### Expected Behavior\n\nonClick should execute the function passed to the body of it.\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_"}
{"sentences": "13.4.15 listening host issue in docker", "description": "I hold back from upgrading from 13.4.12 due to some ENV bugs, tested 13.4.15 but my health checks are failing.\r\n\r\nso in standalone mode it seems next server is binding to an ipv6 interface.\r\n\r\n---\r\n\r\nwhen the server starts up we can see it's now binding to ipv6 interface.\r\nin the Dockerfile I put `ENV HOSTNAME localhost` to no avail.\r\n\r\n13.4.12: `Listening on port 3000 url: http://localhost:3000`\r\n13.4.15: `- ready started server on [::1]:3000, url: http://[::1]:3000`\r\n\r\nsomeone got it working?\r\n"}
{"sentences": "Does `has` in `cookies` don't work in Route Handler?", "description": "### Description\r\n`cookies().has('text')` throws an error when used in `route.ts`\r\n### Console\r\n\r\n```console\r\n- error TypeError: (0 , next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)(...).has is not a function\r\n    at GET (webpack-internal:///(rsc)/./src/app/api/route.ts:11:78)\r\n    at ...\r\n```\r\n\r\n### Reproduction\r\n\r\n```ts\r\n// route.ts\r\nimport { NextResponse } from 'next/server'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function GET() {\r\n  const hasToken = cookies().has('token')\r\n  if (!hasToken) return NextResponse.json({ message: 'token is missing' })\r\n  return NextResponse.json({ message: 'token exists' })\r\n}\r\n```"}
{"sentences": "generateStaticParams ~~> TypeError: result is not iterable", "description": "### Summary\n\nhey there , i'm using next js v13.4.10 & app direcotry. \r\nim getting this error while using generateStaticParams function for each api endpoints : \r\n- error Failed to generate static paths for /study/[slug]/study-guide: TypeError: result is not iterable\r\n\r\nthis is my implementation : \r\n\r\n![image](https://github.com/vercel/next.js/assets/124883615/7facccb2-5696-43d6-ae5f-01edf01a138f)\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "how to use less in next.js 13.4.13?", "description": "### Summary\n\nMy current version of next.js is 13.4.13. I am very anxious about how to use less. I hope everyone can help me answer, whether it is app routing mode or pages routing mode\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "question on preventing css flickering when implementing dark mode", "description": "I have a simple setup that persists a theme(such as dark mode) by using css variables and localStorage. My goal is to load the page with the correct theme, without the flashing of the default css theme(in this case it would be a light theme).\r\n\r\nHere's an example below that shows flashing as I refresh. The flashing is more prevalent upon loading routes.\r\n![flashing](https://user-images.githubusercontent.com/29286430/81105330-a28d6400-8ec8-11ea-80ae-6ba5ed30b89d.gif)\r\n\r\n\r\nThe way I prevented flashing was running a script before the content loads, to read local storage, get theme, and set css variables to the appropriate theme.\r\n\r\n`_document.js`\r\n```js\r\nimport Document, { Html, Head, Main, NextScript } from \"next/document\";\r\n\r\nclass MyDocument extends Document {\r\n  render() {\r\n    return (\r\n      <Html>\r\n        <Head>\r\n          <script src=\"/static/theme.js\"></script>\r\n        </Head>\r\n        <body>\r\n          {/* some sources placed script inside body, before Main, but I experienced flashing */}\r\n          <Main />\r\n          <NextScript />\r\n        </body>\r\n      </Html>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MyDocument;\r\n```\r\n`/static/theme.js`\r\n```js\r\n(function () {\r\n  var currentTheme;\r\n\r\n  function changeTheme(inputTheme) {\r\n    if (inputTheme === \"dark\") {\r\n      const theme = themeConfig.dark;\r\n      for (let key in theme) {\r\n        setCSSVar(key, theme[key]);\r\n      }\r\n      localStorage.setItem(\"theme\", inputTheme);\r\n    } else {\r\n      const theme = themeConfig.light;\r\n      for (let key in theme) {\r\n        setCSSVar(key, theme[key]);\r\n      }\r\n      localStorage.setItem(\"theme\", inputTheme);\r\n    }\r\n  }\r\n\r\n  function setCSSVar(property, color) {\r\n    document.documentElement.style.setProperty(property, color);\r\n  }\r\n  try {\r\n    currentTheme = localStorage.getItem(\"theme\") || \"light\";\r\n\r\n    var themeConfig = {\r\n      dark: {\r\n        \"--color-homepage-bg\": \"#0e141b\",\r\n        \"--color-text\": \"#fff\",\r\n        \"--code\": \"#ccc\",\r\n        \"--color-blue\": \"#f300e0\",\r\n        \"--color-grey\": \"#ccc\",\r\n      },\r\n      light: {\r\n        \"--color-homepage-bg\": \"#fff\",\r\n        \"--color-text\": \"#000\",\r\n        \"--code\": \"#f1f1f1\",\r\n        \"--color-blue\": \"#0070f3\",\r\n        \"--color-grey\": \"#eaeaea\",\r\n      },\r\n    };\r\n\r\n    changeTheme(currentTheme);\r\n  } catch (err) {\r\n    console.log(new Error(\"accessing theme has been denied\"));\r\n  }\r\n})();\r\n```\r\nHere's the result with no flashing, as I refresh. [Live Demo](https://nextjs-toggle-theme-nonflash-b8cko6a71.now.sh/)\r\n![no-flashing](https://user-images.githubusercontent.com/29286430/81107101-7a533480-8ecb-11ea-9999-1285b4c5978d.gif)\r\n\r\n\r\nEven though I solved my problem, is it optimal or a bad solution? Here's the [source code](https://github.com/aquaductape/nextjs-toggle-theme-nonflash)."}
{"sentences": "It is posible to send query params when executing router.back()?", "description": "It's posible to send query params when using router.back()?\r\n\r\n```\r\nimport {useRouter} = \"next/navigation\"\r\n\r\nconst router = useRouter()\r\n\r\nrouter.back()\r\n```\r\n"}
{"sentences": "How to install next-js with react 17?", "description": "Hello\r\n\r\nHow I can install next.js with React 17? When I type:\r\n`npx create-next-app --ts`, npx installed Next with React 18, but I can't use React 18, because Stripe not working at the moment with R18 (https://www.npmjs.com/package/stripe). \r\n\r\n"}
{"sentences": "next/image type declarations are missing on CI", "description": "### Summary\n\nImporting images works fine locally but fails on CI. \r\nIt complains about the type for the images not found.\r\n\r\nThe errors:\r\n<img width=\"1547\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/54242706/ec0f96a6-24e1-4ee2-aeb7-81a8383bbb80\">\r\n\r\nHow I import my images (just an example, it not the ones in the screenshot, but same issue here)\r\n<img width=\"658\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/54242706/4e81ce10-7f55-4b6e-ac55-164501d3d056\">\r\n\r\nThis way it works fine:\r\n<img width=\"336\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/54242706/98a56407-8682-4dd0-8b61-d5b1b83e1549\">\r\n\r\n<details>\r\n  <summary>My folder structure:</summary>\r\n\r\n```\r\napps/\r\n└── nextjs/\r\n    ├── public/\r\n    └── src/\r\n        └── pages/\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n  <summary>My main tsconfig:</summary>\r\n  \r\n  ```json\r\n    {\r\n      \"compilerOptions\": {\r\n        \"target\": \"es2017\",\r\n        \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\r\n        \"allowJs\": true,\r\n        \"checkJs\": true,\r\n        \"skipLibCheck\": true,\r\n        \"strict\": true,\r\n        \"forceConsistentCasingInFileNames\": true,\r\n        \"noEmit\": true,\r\n        \"esModuleInterop\": true,\r\n        \"module\": \"esnext\",\r\n        \"moduleResolution\": \"node\",\r\n        \"resolveJsonModule\": true,\r\n        \"isolatedModules\": true,\r\n        \"jsx\": \"preserve\",\r\n        \"incremental\": true,\r\n        \"noUncheckedIndexedAccess\": true,\r\n        \"noErrorTruncation\": true\r\n      },\r\n      \"include\": [\r\n        \".eslintrc.js\",\r\n        \"prettier.config.cjs\",\r\n        \"./packages/config/eslint/index.js\"\r\n      ]\r\n    }\r\n  ```\r\n</details>\r\n\r\n<details>\r\n  <summary>My nextjs app tsconfig:</summary>\r\n\r\n  ```json\r\n    {\r\n      \"extends\": \"../../tsconfig.json\",\r\n      \"compilerOptions\": {\r\n        \"baseUrl\": \".\",\r\n        \"paths\": {\r\n          \"~/*\": [\"./src/*\"]\r\n        },\r\n        \"plugins\": [{ \"name\": \"next\" }]\r\n      },\r\n      \"exclude\": [],\r\n      \"include\": [\r\n        \"next-env.d.ts\",\r\n        \"**/*.ts\",\r\n        \"**/*.tsx\",\r\n        \"**/*.cjs\",\r\n        \"**/*.mjs\",\r\n        \".next/types/**/*.ts\"\r\n      ]\r\n    }\r\n  ```\r\n</details>\r\n\r\n<details>\r\n  <summary>My next-env.d.ts file:</summary>\r\n\r\n```typescript\r\n  /// <reference types=\"next\" />\r\n  /// <reference types=\"next/image-types/global\" />\r\n  \r\n  // NOTE: This file should not be edited\r\n  // see https://nextjs.org/docs/basic-features/typescript for more information.\r\n```\r\n</details>\r\n\r\n<details>\r\n  <summary>next info output</summary>\r\n\r\n```\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.3.0: Mon Jan 30 20:38:37 PST 2023; root:xnu-8792.81.3~2/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 18.16.0\r\n      npm: 9.5.1\r\n      Yarn: 1.22.19\r\n      pnpm: 8.3.1\r\n    Relevant packages:\r\n      next: 13.4.5\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.6\r\n```\r\n\r\n</details>\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why the \"Streaming with Suspense\"  in official App-Rourer demo deployed in vercel not work", "description": "When I visited the officail app-router demo of Streaming with Suspense , I ran into error report, both on Edge Runtime and Node Runtime. \r\n\r\nDetail:\r\nsite: https://app-router.vercel.app/streaming\r\nscreenshoot:\r\n<img width=\"959\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/8624194/9e706d7a-6d1b-43e1-8acd-fdc536a864cc\">\r\nerror msg : \r\n> Application error: a server-side exception has occurred (see the server logs for more information).\r\nDigest: 2219929594\r\n\r\nerror msg in console:\r\n> 6473-8c2b72212b579295.js:1 Error: An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.\r\n"}
{"sentences": "info Using wasm build of next-swc", "description": "### Summary\n\n- info Using wasm build of next-swc\r\n- warn Attempted to load @next/swc-win32-x64-gnu, but it was not installed\r\n- warn Attempted to load @next/swc-win32-x64-msvc, but an error occurred: The specified module could not be found.\r\n\r\n\r\nthis is way out of my leauge....help please\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to set custom headers for all pages via next.config.js", "description": "The following example which taken from [nextjs.org/docs/api-reference/next.config.js/headers](https://nextjs.org/docs/api-reference/next.config.js/headers)\r\n\r\nwill set the custom header `x-hello: there` for all pages except the index page (which have `/` path)\r\n\r\n```\r\nmodule.exports = {\r\n  async headers() {\r\n    return [\r\n      {\r\n        source: '/:path*',\r\n        headers: [\r\n          {\r\n            key: 'x-hello',\r\n            value: 'there'\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n}\r\n```\r\n\r\nmy question: What is the pattern value that I have to pass to the `source` property which will set the custom header for all pages\r\n"}
{"sentences": "Angular Scully Preset does not access Chromium", "description": "I was not able to make the Angular Scully preset work with default configuration, when the Scully build step starts, it fails to run Chromium.\r\nAnyone knows what the problem might be?\r\n\r\n`Puppeteer cannot find or launch the browser. (by default chrome)`"}
{"sentences": "Next13 notFound() working case question", "description": "I use notFound() in next13 with axios find various case.\r\nBut Why some case is working, some case is not working don't know.\r\n\r\nPlease tell me notFound() working logic.\r\nif you want to detail case logic please view [https://github.com/osydoo/next13-not-found](https://github.com/osydoo/next13-not-foundl)\r\n\r\n## Summary\r\n1. why useEffect notFound() in 'use client' working  diff?\r\n2. why sync axios.interceptors throw Error but async axios.interceptors ignore notFound()?\r\n3. click event trigger notFound() why throw Error?\r\n\r\n## Case\r\n### **In 'use client'**\r\n1. useEffect - Error case\r\n```\r\nuseEffect(()=> {\r\n    (async () => {\r\n        try{\r\n            await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n            console.log('success');\r\n        }catch(e){\r\n            console.log('error')\r\n            notFound()\r\n        }\r\n    })()\r\n}, [])\r\n```\r\n2. useEffect - working case\r\nwhy not working try catch after fetch case but this case is working?\r\n```\r\nconst [data, setData] = useState('init');\r\n\r\nuseEffect(()=> {\r\n    (async () => {\r\n        try{\r\n            await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n            console.log('success');\r\n        }catch(e){\r\n            console.log('error')\r\n            setData('error')\r\n        }\r\n    })()\r\n}, [])\r\n\r\nuseEffect(()=> {\r\n    if(data === 'error') {\r\n        notFound();\r\n    }    \r\n}, [data])\r\n```\r\n4. click event - Error case\r\n```\r\nconst handleClick = async () => {\r\n        try{\r\n            await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n            console.log('success');\r\n        }catch(e){\r\n            console.log('error')\r\n            notFound();\r\n        }\r\n}\r\n```\r\n5. axios.interceptor\r\nwhy except fetch sync case other case is ignore interceptors notFound() function?>?\r\n```\r\nconst axios = _axios.create();\r\naxios.interceptors.response.use(\r\n    function(res){\r\n        return res\r\n    },\r\n    function(err){\r\n        if(err){\r\n            console.log('interceptors')\r\n            notFound(); // not working\r\n        }\r\n    }\r\n)\r\n...\r\nasync () => {\r\n    try{\r\n        await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n        console.log('success');\r\n    }catch(e){\r\n        console.log('error')\r\n        notFound()\r\n    }\r\n}\r\n```\r\n8. sync fetch\r\n```\r\nconst axios = _axios.create();\r\naxios.interceptors.response.use(\r\n    function(res){\r\n        return res\r\n    },\r\n    function(err){\r\n        if(err){\r\n            console.log('interceptors')\r\n            notFound();\r\n        }\r\n    }\r\n)\r\n...\r\ntry{\r\n    axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n    console.log('success');\r\n}catch(e){\r\n    console.log('error');\r\n    notFound();\r\n}\r\n```\r\n9. component rendering working case\r\n```\r\n    const [data, setData] = useState('init');\r\n    if(data === 'error') {\r\n        notFound();\r\n    }\r\n\r\n    useEffect(()=> {\r\n        (async () => {\r\n            try{\r\n                await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n                console.log('success');\r\n            }catch(e){\r\n                console.log('error')\r\n                setData('error')\r\n            }\r\n        })()\r\n    }, [])\r\n\r\n```\r\n### **SSR**\r\n1. docs example case\r\n```\r\n    try{\r\n        await axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n        console.log('success');\r\n    }catch(e){\r\n        console.log('error')\r\n        notFound()\r\n    }\r\n```\r\n2. ignored axios interceptors also SSR -> view Rendering Page not 404\r\n```\r\nconst axios = _axios.create();\r\naxios.interceptors.response.use(\r\n    function(res){\r\n        return res\r\n    },\r\n    function(err){\r\n        if(err){\r\n            console.log('interceptors')\r\n            notFound(); // not working\r\n        }\r\n    }\r\n)\r\n...\r\nconst AxiosInterceptors = () => {\r\n    try{\r\n        axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n        console.log('success');\r\n    }catch(e){\r\n        console.log('error');\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            Rendering Page\r\n        </div>\r\n    )\r\n}\r\n```\r\n3. syncAxiosInterceptors\r\nlike 'use client' working in intercpetors and throw Error 'NEXT_NOT_FOUND'\r\n```\r\naxios.interceptors.response.use(\r\n    function(res){\r\n        return res\r\n    },\r\n    function(err){\r\n        if(err){\r\n            console.log('interceptors')\r\n            notFound();\r\n        }\r\n    }\r\n)\r\n...\r\ntry{\r\n    axios.get('http://127.0.0.1:3001/error'); // 404 error\r\n    console.log('success');\r\n}catch(e){\r\n    console.log('error');\r\n}\r\n```\r\n\r\n+ When i use React Query useQuery and useMutation onSuccess, onError then notFound is not working.\r\n"}
{"sentences": "Nextjs <Link> not working", "description": "### Summary\r\n\r\nI create nextjs app, added a link, when clicking to the link it gives me 404 error, even though i create the next page.\r\nI also tried the anchor tag, but it is also not the same. I read that this is a bug, but i dont know how to fix it, it is my first time creating this app.\r\n\r\nAfter creating the app i dont have the pages folder, im assuming this the is latest version, all tutorials has pages folder and index.js inside it but mine does not have it. I really appreciate the help\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\nimport Link from 'next/link'\r\nexport default function Home() {\r\n  return (\r\n    <><><div>\r\n<Link href='/about'>test</Link> &nbsp;\r\n<Link href={'/about'}>ABout</Link> &nbsp;\r\n<a href='/about'>anchor tag</a>\r\n    </div>\r\n    </></>\r\n  )\r\n}\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Error with cookies (DynamicServerError: Dynamic server usage: cookies)", "description": "### Summary\r\n\r\n[Logs Failed Deployment](https://cdn.discordapp.com/attachments/1132999126536163470/1133007455308218438/message.txt)\r\n[Logs OK and Deployed](https://cdn.discordapp.com/attachments/1132999126536163470/1133007312081125386/message.txt)\r\n\r\n```\r\n[14:05:31.540] node:internal/process/promises:288\r\n[14:05:31.541]             triggerUncaughtException(err, true /* fromPromise */);\r\n[14:05:31.541]             ^\r\n[14:05:31.541] \r\n[14:05:31.541] DynamicServerError: Dynamic server usage: cookies\r\n[14:05:31.541]     at staticGenerationBailout (/vercel/path0/.next/server/chunks/851.js:202:21)\r\n[14:05:31.542]     at Object.cookies (/vercel/path0/.next/server/chunks/851.js:94:62)\r\n[14:05:31.542]     at NextServerComponentAuthStorageAdapter.getCookie (/vercel/path0/.next/server/chunks/388.js:203:42)\r\n[14:05:31.542]     at NextServerComponentAuthStorageAdapter.getItem (/vercel/path0/.next/server/chunks/388.js:572:28)\r\n[14:05:31.542]     at getItemAsync (/vercel/path0/.next/server/chunks/388.js:3655:33)\r\n[14:05:31.542]     at SupabaseAuthClient.__loadSession (/vercel/path0/.next/server/chunks/388.js:2052:71)\r\n[14:05:31.542]     at async /vercel/path0/.next/server/chunks/388.js:2027:28\r\n[14:05:31.543]     at async Object.__stack_guard___useSession__ (/vercel/path0/.next/server/chunks/388.js:3874:32)\r\n[14:05:31.543]     at async stackGuard (/vercel/path0/.next/server/chunks/388.js:3876:12)\r\n[14:05:31.543]     at async SupabaseAuthClient._useSession (/vercel/path0/.next/server/chunks/388.js:2025:16) {\r\n[14:05:31.543]   digest: 'DYNAMIC_SERVER_USAGE'\r\n[14:05:31.543] }\r\n}\r\n```\r\n\r\nDuring previous builds, I already had this error and it still deployed, but now that there are fewer than usual, it doesn't want to deploy anymore and ends up with the error. \r\n\r\n```\r\n[14:05:31.543] Node.js v18.16.1\r\n[14:05:31.585] \r\n[14:05:31.586] > Build error occurred\r\n[14:05:31.589] Error: Call retries were exceeded\r\n[14:05:31.590]     at ChildProcessWorker.initialize (/vercel/path0/node_modules/next/dist/compiled/jest-worker/index.js:1:11661)\r\n[14:05:31.590]     at ChildProcessWorker._onExit (/vercel/path0/node_modules/next/dist/compiled/jest-worker/index.js:1:12599)\r\n[14:05:31.590]     at ChildProcess.emit (node:events:513:28)\r\n[14:05:31.590]     at ChildProcess.emit (node:domain:489:12)\r\n[14:05:31.590]     at ChildProcess._handle.onexit (node:internal/child_process:291:12) {\r\n[14:05:31.590]   type: 'WorkerError'\r\n[14:05:31.590] }\r\n[14:05:31.689] Error: Command \"prisma generate && next build\" exited with 1\r\n```\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 18.16.0\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: 8.6.0\r\n    Relevant Packages:\r\n      next: 13.4.12-canary.0\r\n      eslint-config-next: 13.4.8\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.6\r\n    Next.js Config:\r\n      output: N/A\r\n\r\n```\r\n\r\nwith or without next canary\r\n\r\n### Example\r\n\r\nhttps://github.com/Steellgold/linkfy/tree/nextjs"}
{"sentences": "Unable to import Html5 Navigator", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nI'm unable to use [Navigator](https://www.w3schools.com/html/html5_geolocation.asp), I'm getting:\r\n\r\n```\r\nReferenceError: navigator is not defined\r\n``` \r\n\r\n## To Reproduce\r\n\r\nSimple try to use native HTML5 navigator api.\r\n\r\n## Expected behavior\r\n\r\nBe able to access navigator\r\n\r\n## System information\r\n\r\n- OS: macOS\r\n- Browser (if applies): Chrome\r\n- Version of Next.js: 9.2.2\r\n"}
{"sentences": "redirect() issue, error code: UND_ERR_REQ_CONTENT_LENGTH_MISMATCH", "description": "### Summary\n\nI have a server action function that updates the list on the database\r\n\r\n```js\r\nasync function toUpdate(id: string) {\r\n  \"use server\";\r\nawait // update list\r\n  redirect(\"/\");\r\n}\r\n```\r\n\r\nredirect to the same home page to show me the updated list, but it is not updating. When I manually did a refresh again, It get's shown. I want something which re-renders the server component when I do redirect.\r\n\r\nThanks for the help :)\r\n\r\nThis is my actual code\r\n\r\n```js\r\nimport TodoItem from \"@/components/TodoItem\";\r\nimport { prisma } from \"@/db\";\r\nimport { redirect } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\nfunction getTodos() {\r\n  return prisma.todo.findMany();\r\n}\r\n\r\nasync function toggleTodoCompleted(id: string, completed: boolean) {\r\n  \"use server\";\r\n  console.log(id, completed);\r\n\r\n  await prisma.todo.update({ where: { id }, data: { completed } });\r\n}\r\n\r\nasync function todoDelete(id: string) {\r\n  \"use server\";\r\n  await prisma.todo.delete({ where: { id } });\r\n  redirect(\"/\");\r\n}\r\n\r\nexport default async function Home() {\r\n  const todos = await getTodos();\r\n\r\n  return (\r\n    <>\r\n      <header>\r\n        <h1> Todo App </h1>\r\n        <Link href=\"/new\"> Add Task </Link>\r\n      </header>\r\n\r\n      <ul>\r\n        {todos.map((todo) => (\r\n          <TodoItem\r\n            key={todo.id}\r\n            {...todo}\r\n            toggleTodo={toggleTodoCompleted}\r\n            todoDelete={todoDelete}\r\n          />\r\n        ))}\r\n      </ul>\r\n    </>\r\n  );\r\n}\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Random socket errors since Next v13.4.2", "description": "### Summary\n\nHi, we are running a Next app on AWS behind ALB and Nginx like this: ALB -> Nginx -> Next\r\n\r\nSince we upgraded to Next v13.4.12, we are running into two problems:\r\n\r\n1. We get sockets errors (ECONNRESET, EPIPE) from the sockets after a while. Sometimes it happens within 20 minutes, sometimes it may take longer. At first, we thought this might be the problem and solution:\r\n\r\n> When deploying Next.js behind a downstream proxy (e.g. a load-balancer like AWS ELB/ALB) it's important to configure Next's underlying HTTP server with [keep-alive timeouts](https://nodejs.org/api/http.html#http_server_keepalivetimeout) that are larger than the downstream proxy's timeouts. Otherwise, once a keep-alive timeout is reached for a given TCP connection, Node.js will immediately terminate that connection without notifying the downstream proxy. This results in a proxy error whenever it attempts to reuse a connection that Node.js has already terminated.\r\n\r\n-- https://nextjs.org/docs/app/api-reference/next-cli#keep-alive-timeout\r\n\r\nBut setting the keep alive timeout for next to a higher value than nginx and the nginx keep alive timeout higher than the ALB did not help. The errors still occur:\r\n\r\n_nginx_:\r\n```\r\n2023/08/02 14:22:04 [error] 3910#3910: *150 upstream prematurely closed connection while reading response header from upstream, client: 172.31.31.39, server: , request: \"GET / HTTP/1.1\", upstream: \"http://127.0.0.1:8080/\", host: \"stacker.news\"\r\n[...]\r\n2023/08/02 16:17:15 [error] 1449#1449: *3509 upstream prematurely closed connection while reading response header from upstream, client: 172.31.45.98, server: , request: \"GET / HTTP/1.1\", upstream: \"http://127.0.0.1:8080/\", host: \"stacker.news\"\r\n[...]\r\n2023/08/02 18:17:35 [error] 3176#3176: *5661 upstream prematurely closed connection while reading response header from upstream, client: 172.31.31.39, server: , request: \"GET / HTTP/1.1\", upstream: \"http://127.0.0.1:8080/\", host: \"stacker.news\"\r\n```\r\n\r\n_next_:\r\n```\r\nAug  2 14:22:04 ip-172-31-32-196 web: node:events:505\r\nAug  2 14:22:04 ip-172-31-32-196 web: throw er; // Unhandled 'error' event\r\nAug  2 14:22:04 ip-172-31-32-196 web: ^\r\nAug  2 14:22:04 ip-172-31-32-196 web: Error: read ECONNRESET\r\nAug  2 14:22:04 ip-172-31-32-196 web: at TCP.onStreamRead (node:internal/stream_base_commons:217:20)\r\nAug  2 14:22:04 ip-172-31-32-196 web: Emitted 'error' event on Socket instance at:\r\nAug  2 14:22:04 ip-172-31-32-196 web: at Socket.onerror (node:internal/streams/readable:773:14)\r\nAug  2 14:22:04 ip-172-31-32-196 web: at Socket.emit (node:events:527:28)\r\nAug  2 14:22:04 ip-172-31-32-196 web: at Socket.emit (node:domain:475:12)\r\nAug  2 14:22:04 ip-172-31-32-196 web: at emitErrorNT (node:internal/streams/destroy:157:8)\r\nAug  2 14:22:04 ip-172-31-32-196 web: at emitErrorCloseNT (node:internal/streams/destroy:122:3)\r\nAug  2 14:22:04 ip-172-31-32-196 web: at processTicksAndRejections (node:internal/process/task_queues:83:21) {\r\nAug  2 14:22:04 ip-172-31-32-196 web: errno: -104,\r\nAug  2 14:22:04 ip-172-31-32-196 web: code: 'ECONNRESET',\r\nAug  2 14:22:04 ip-172-31-32-196 web: syscall: 'read'\r\nAug  2 14:22:04 ip-172-31-32-196 web: }\r\n[...]\r\nAug  2 16:17:15 ip-172-31-36-51 web: node:events:505\r\nAug  2 16:17:15 ip-172-31-36-51 web: throw er; // Unhandled 'error' event\r\nAug  2 16:17:15 ip-172-31-36-51 web: ^\r\nAug  2 16:17:15 ip-172-31-36-51 web: Error: write EPIPE\r\nAug  2 16:17:15 ip-172-31-36-51 web: at WriteWrap.onWriteComplete [as oncomplete] (node:internal/stream_base_commons:94:16)\r\nAug  2 16:17:15 ip-172-31-36-51 web: Emitted 'error' event on Socket instance at:\r\nAug  2 16:17:15 ip-172-31-36-51 web: at Socket.onerror (node:internal/streams/readable:773:14)\r\nAug  2 16:17:15 ip-172-31-36-51 web: at Socket.emit (node:events:527:28)\r\nAug  2 16:17:15 ip-172-31-36-51 web: at Socket.emit (node:domain:475:12)\r\nAug  2 16:17:15 ip-172-31-36-51 web: at emitErrorNT (node:internal/streams/destroy:157:8)\r\nAug  2 16:17:15 ip-172-31-36-51 web: at emitErrorCloseNT (node:internal/streams/destroy:122:3)\r\nAug  2 16:17:15 ip-172-31-36-51 web: at processTicksAndRejections (node:internal/process/task_queues:83:21) {\r\nAug  2 16:17:15 ip-172-31-36-51 web: errno: -32,\r\nAug  2 16:17:15 ip-172-31-36-51 web: code: 'EPIPE',\r\nAug  2 16:17:15 ip-172-31-36-51 web: syscall: 'write'\r\nAug  2 16:17:15 ip-172-31-36-51 web: }\r\n[...]\r\nAug  2 18:17:35 ip-172-31-17-173 web: node:events:505\r\nAug  2 18:17:35 ip-172-31-17-173 web: throw er; // Unhandled 'error' event\r\nAug  2 18:17:35 ip-172-31-17-173 web: ^\r\nAug  2 18:17:35 ip-172-31-17-173 web: Error: write EPIPE\r\nAug  2 18:17:35 ip-172-31-17-173 web: at WriteWrap.onWriteComplete [as oncomplete] (node:internal/stream_base_commons:94:16)\r\nAug  2 18:17:35 ip-172-31-17-173 web: Emitted 'error' event on Socket instance at:\r\nAug  2 18:17:35 ip-172-31-17-173 web: at Socket.onerror (node:internal/streams/readable:773:14)\r\nAug  2 18:17:35 ip-172-31-17-173 web: at Socket.emit (node:events:527:28)\r\nAug  2 18:17:35 ip-172-31-17-173 web: at Socket.emit (node:domain:475:12)\r\nAug  2 18:17:35 ip-172-31-17-173 web: at emitErrorNT (node:internal/streams/destroy:157:8)\r\nAug  2 18:17:35 ip-172-31-17-173 web: at emitErrorCloseNT (node:internal/streams/destroy:122:3)\r\nAug  2 18:17:35 ip-172-31-17-173 web: at processTicksAndRejections (node:internal/process/task_queues:83:21) {\r\nAug  2 18:17:35 ip-172-31-17-173 web: errno: -32,\r\nAug  2 18:17:35 ip-172-31-17-173 web: code: 'EPIPE',\r\nAug  2 18:17:35 ip-172-31-17-173 web: syscall: 'write'\r\nAug  2 18:17:35 ip-172-31-17-173 web: }\r\n```\r\n\r\nIt looks like both ends of the socket think the other end closed the socket. So we thought it might be a TCP race condition like mentioned [here](https://iximiuz.com/en/posts/reverse-proxy-http-keep-alive-and-502s/) but we already tried setting increasing keep alive timeouts and also `--keepAliveTimeout 0` in `next start` to disable the keep-alive timeout behavior on incoming connections.\r\n\r\nBut still, same error.\r\n\r\n2. Furthermore, we noticed that the router process crashes but the render process keeps running:\r\n\r\n_before the crash:_\r\n```\r\n1507 webapp    20   0   61.6g 473852  48960 R  64.3 11.9  27:26.13 next-render-wor                                                               \r\n1488 webapp    20   0   51.3g 313056  43684 R  14.0  7.9   9:17.58 next-router-wor \r\n```\r\n\r\n_after the crash:_\r\n```\r\n3957 webapp    20   0   51.5g 345632  48428 R  10.6  8.7   4:22.40 next-render-wor \r\n```\r\n\r\nWe think that's the reason why the AWS failover doesn't work and zombie processes keep accumulating.\r\n\r\nSo we are here asking if someone else encountered this issue and has any idea.\r\n\r\nWe would be very glad about any help regarding this!\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why can't we have non React files inside our pages folder", "description": "Before Next.js, I used to have my tests and storybook files next to my page component, like so:\r\n\r\n```\r\nApp.tsx\r\nApp.test.tsx\r\nApp.stories.tsx\r\n```\r\n\r\nNext.js disallows that, because when you try to run `next build`, it complains that `describe is not defined` etc. I'm going to assume it prefers us to put all our non React files outside the page directory in /tests, /stories.\r\nBut I don't want to.\r\nHaving all App related files side by side helps alot in maintainability, especially in a large project. Is there a way to do this instead?"}
{"sentences": "Generic error message being shown when a server component throws an error, I'd expect my error page or global-error page to appear?", "description": "### Summary\r\n\r\nI have a page (`src/app/(main)/product/[id]/page.tsx`) where I am intentionally triggering an error on the server side (via Zod) to test our error handling.\r\n\r\nWhen I build a production build and run the production server and navigate to that page I get the standard `Application error: a client-side exception has occurred (see the browser console for more information)` error page.\r\n\r\nCould someone help me understand why I am not seeing the `src/app/(main)/product/[id]/error.tsx` error page, or even `src/app/global-error.tsx`? Both of those pages are client components (`'use client'` pages).\r\n\r\nHere is the `src/app/(main)/product/[id]/error.tsx`:\r\n\r\n```typescript\r\n'use client'; // Error components must be Client components\r\n\r\nimport { Button } from '@/components/Button/Button';\r\nimport PageWrapper from '@/components/Layout/PageWrapper';\r\nimport { useEffect } from 'react';\r\n\r\nexport default function Error({ error, reset }: { error: Error; reset: () => void }) {\r\n  useEffect(() => {\r\n    console.error(error);\r\n\r\n    if (process.env.NODE_ENV === 'production') {\r\n      // @TODO: Send the error.digest to a service like Rollbar\r\n      // On production `error` will be a generic message by design byt we can\r\n      // get a `error.digest`\r\n      // hash that we can push to Rollbar or an equivalent service and\r\n      // cross-reference against the server logs.\r\n    }\r\n  }, [error]);\r\n\r\n  return (\r\n    <PageWrapper>\r\n      <h1 className=\"text-3xl font-bold\">We couldn&apos;t load this product</h1>\r\n      <p>Sorry</p>\r\n      <Button\r\n        intent=\"primary\"\r\n        onClick={\r\n          // Attempt to recover by trying to re-render the segment\r\n          () => reset()\r\n        }\r\n      >\r\n        Try again\r\n      </Button>\r\n    </PageWrapper>\r\n  );\r\n}\r\n```\r\n\r\nHere is `src/app/(main)/product/[id]/page.tsx`. I am intentionally altering the API response to trigger an error from Zod.\r\n\r\n```tsx\r\nimport PageWrapper from '@/components/Layout/PageWrapper';\r\nimport basicPluralise from '@/utils/basicPluralise';\r\nimport formatPrice from '@/utils/formatPrice';\r\nimport Image from 'next/image';\r\nimport { Metadata } from 'next';\r\nimport { createZodFetcher } from 'zod-fetch';\r\nimport { z } from 'zod';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nasync function getProduct(productId: string) {\r\n  const fetchWithZod = createZodFetcher();\r\n  // const fetchWithZod = createZodFetcher(getBFF);\r\n\r\n  return await fetchWithZod(\r\n    z.object({\r\n      name: z.string(),\r\n      inStock: z.boolean(),\r\n      description: z.string(),\r\n      price: z.number(),\r\n      sizeUnit: z.string(),\r\n      size: z.number(),\r\n      images: z\r\n        .array(\r\n          z.object({\r\n            mediaStorageKey: z.string()\r\n          })\r\n        )\r\n        .length(3)\r\n    }),\r\n    `/products/details/${productId}?store_id=605dc6c0-d1c0-4461-8768-8e055606e011`,\r\n    {\r\n      cache: 'no-cache'\r\n    }\r\n    // Leaving the caching/revalidation off while we play with Zod\r\n    // {\r\n    //   next: {\r\n    //     revalidate: 600\r\n    //   }\r\n    // }\r\n  );\r\n}\r\n\r\nexport async function generateStaticParams() {\r\n  return [];\r\n}\r\n\r\nexport async function generateMetadata({ params }: { params: { id: string } }): Promise<Metadata> {\r\n  const product = await getProduct(params.id);\r\n  return { title: product.name, description: product.description };\r\n}\r\n\r\nexport default async function ProductPage({ params }: { params: { id: string } }) {\r\n  const product = await getProduct(params.id);\r\n  const productImage = product.images[2].mediaStorageKey;\r\n\r\n  return (\r\n    <PageWrapper>\r\n      <h1 className=\"text-3xl font-bold\">{product.name}</h1>\r\n      <p>{product.description}</p>\r\n      <p className=\"font-bold\">{formatPrice(product.price)}</p>\r\n      {product.sizeUnit && product.size ? (\r\n        <p>{basicPluralise(product.size, product.sizeUnit).toLowerCase()}</p>\r\n      ) : null}\r\n\r\n      <Image src={productImage} alt=\"\" width=\"450\" height=\"450\" priority />\r\n    </PageWrapper>\r\n  );\r\n}\r\n```\r\n\r\n<details>\r\n<summary>Here is the terminal output:</summary>\r\n\r\n```bash\r\n[Error: An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.] {\r\n  digest: '3758196747'\r\n}\r\nZodError: [\r\n  {\r\n    \"code\": \"invalid_type\",\r\n    \"expected\": \"boolean\",\r\n    \"received\": \"string\",\r\n    \"path\": [\r\n      \"inStock\"\r\n    ],\r\n    \"message\": \"Expected boolean, received string\"\r\n  }\r\n]\r\n    at handleResult (/Users/wolsph/Projects/shop-next/.next/server/chunks/510.js:744:23)\r\n    at ZodObject.safeParse (/Users/wolsph/Projects/shop-next/.next/server/chunks/510.js:871:16)\r\n    at ZodObject.parse (/Users/wolsph/Projects/shop-next/.next/server/chunks/510.js:848:29)\r\n    at /Users/wolsph/Projects/shop-next/.next/server/chunks/510.js:50:23\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async getProduct (/Users/wolsph/Projects/shop-next/.next/server/app/(main)/product/[id]/page.js:367:12)\r\n    at async ProductPage (/Users/wolsph/Projects/shop-next/.next/server/app/(main)/product/[id]/page.js:393:21) {\r\n  issues: [\r\n    {\r\n      code: 'invalid_type',\r\n      expected: 'boolean',\r\n      received: 'string',\r\n      path: [Array],\r\n      message: 'Expected boolean, received string'\r\n    }\r\n  ],\r\n  addIssue: [Function (anonymous)],\r\n  addIssues: [Function (anonymous)],\r\n  errors: [\r\n    {\r\n      code: 'invalid_type',\r\n      expected: 'boolean',\r\n      received: 'string',\r\n      path: [Array],\r\n      message: 'Expected boolean, received string'\r\n    }\r\n  ]\r\n}\r\n```\r\n</details>\r\n\r\nI can't share the repo, but here is my `app` directory structure:\r\n\r\n```\r\nsrc\r\n├── app\r\n│   ├── (main)\r\n│   │   ├── about\r\n│   │   │   └── page.tsx\r\n│   │   ├── error.tsx\r\n│   │   ├── layout.tsx\r\n│   │   ├── loading.tsx\r\n│   │   ├── page.tsx\r\n│   │   └── product\r\n│   │       └── [id]\r\n│   │           ├── error.tsx\r\n│   │           └── page.tsx\r\n│   ├── (simplified)\r\n│   │   ├── checkout\r\n│   │   │   └── page.tsx\r\n│   │   └── layout.tsx\r\n│   ├── api\r\n│   │   └── version\r\n│   │       └── route.ts\r\n│   ├── global-error.tsx\r\n│   └── layout.tsx\r\n\r\n```\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 22.3.0: Thu Jan  5 20:53:49 PST 2023; root:xnu-8792.81.2~2/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 18.14.0\r\n      npm: 9.5.0\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.2.3\r\n      eslint-config-next: 13.2.3\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n```"}
{"sentences": "React Server Component not revalidated", "description": "Hi, \r\n\r\nI'm using NextJS  version -> \"next\": \"13.4.10\",\r\nand I have some project CRUD (Products), i have face two problems:\r\n\r\n1. I was add my product data using client component, and then back to my product list after submit.. but the new data not show;\r\n2. I was update my product data, and then back to my product list after submit.. but the updated data not show\r\n\r\nthe product list have stale data..\r\n\r\nthe solution I was try:\r\n1. add this line of code\r\n`export const fetchCache = \"force-no-store\";\r\nexport const revalidate = 0; // seconds\r\nexport const dynamic = \"force-dynamic\";`\r\n\r\n2. also add option revalidate when get all the product list in api router:\r\n`const response = await fetch(`${getBaseUrl()}/api/products/get-all`, {\r\n    next: { revalidate: 0 },\r\n  });`\r\n\r\n3. add prefetch to Link component\r\n4. \r\nnote:\r\nin development mode, its work like a charm, but when I deployed to Vercel.. the page list of Product have cache problem\r\nhow to fix the stale data? i want the page list of Product alwasy have a fresh data\r\n\r\nhere my project -> https://nextjs-mantap-mania.vercel.app/products"}
{"sentences": "react-hooks/rules-of-hooks", "description": "### Summary\r\n\r\nwhen i deploy  the nextjs website on Vercel this error occure on every page  = Error: React Hook \"useState\" is called in function \"page\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".  react-hooks/rules-of-hooks.\r\n what is this can anyone explain ?\r\n\r\n\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Image SRC Width and Height Issue", "description": "Hello, I have been receiving this error when I already set the width and height for the images that I want to upload.\r\nBackstory: I am creating an NFT Marketplace and currently using the test network Localhost:8545 to host it. I will be moving it to Polygon Mumbai but want to test out the create NFT feature first. Might anyone know why this could be happening?\r\n\r\nThis is the whole error:\r\nUncaught Error: Image with src \"https://vivi-project.infura-ipfs.io/ipfs/QmPHThqtKGAHHgBub542k4bXH9vb55Cc64ZsCyLQYhX3oc\" must use \"width\" and \"height\" properties or \"layout='fill'\" property.\r\n\r\nThis is my image properties:\r\n                         <Image\r\n                            src={fileUrl}\r\n                            alt=\"Picture of the NFT\"\r\n                            className=\"rounded mt-4\"\r\n                            width={350}\r\n                            height={500}\r\n                            //blurDataURL=\"data:...\" automatically provided\r\n                            //placeholder=\"blur\" // Optional blur-up while loading\r\n                          />"}
{"sentences": "Documentation is very misleading regarding client-side route invalidation.", "description": "Whilst they are excellent in many ways, I have been banging my head against the wall over the last couple of days trying to get my head around the client-side route cache. Imagine this fairly common use case:\r\n\r\n1. A user navigates to their `/collection` route. This is a server component page.tsx, which fetches the data.\r\n2. The user navigates to a `/search` route, where they find an item they want to add to their collection, they do so, updating the database in the process.\r\n3. The user later navigates back to the `/collection` page, expecting to see their up-to-date data, but it has cached the original request, and the data is out of date.\r\n\r\n\r\nThe documentation talks at length about the fetch api, which is featured in the `/collection` page. It states that in order to force refetching, you can use properties like `revalidate: 0` or `cache: no-store`. (https://nextjs.org/docs/app/building-your-application/data-fetching/revalidating)\r\n\r\nThere are other options as well, I can try and perform on demand revalidation, I can create a route handler that uses `revalidatePath` or `revalidateTag`. \r\n\r\nThere are also route-level config that we can use like `export const dynamic = \"force-dynamic\"` that looks like it should invalidate the route and force the fetch to re-occur on every request. https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config\r\n\r\nHowever, this does not help our use case, as this is not what we need to invalidate, as the problem, as far as I can tell, is actually to do with routing, and 'soft-navigation'. https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#how-navigation-works\r\n\r\n\"Soft Navigation\r\n\r\nOn navigation, the cache for changed segments is reused (if it exists), and no new requests are made to the server for data.\"\r\n\r\nThere is also a small **good to know** on this page:\r\n\"Good to know: This client-side cache is different from the server-side [Next.js HTTP cache](https://nextjs.org/docs/app/building-your-application/data-fetching#caching-data).\"\r\n\r\nIf we scroll down, we find something that looks helpful:\r\n\r\n\"Invalidating the Cache\r\n\r\n[Server Actions](https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions) can be used to revalidate data on-demand by path ([revalidatePath](https://nextjs.org/docs/app/api-reference/functions/revalidatePath)) or by cache tag ([revalidateTag](https://nextjs.org/docs/app/api-reference/functions/revalidateTag)).\"\r\n\r\nhuh, well server actions are an alpha feature so I won't want to touch those. I had also tried using revalidatePath / revalidateTag, with route handlers instead - but this seemed to fall into the same problem as before; that request invalidation is not the same as invalidating the client-side cache. \r\n\r\n\"Conditions for Soft Navigation\r\n\r\nOn navigation, Next.js will use soft navigation if the route you are navigating to has been [prefetched](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#prefetching), and either doesn't include [dynamic segments](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes) or has the same dynamic parameters as the current route.\"\r\n\r\nThis is strange, because pre-fetching is disabled on the development server - so I think it is understandable to assume that no soft navigation would take place here, but that doesn't seem to be the case. Indeed setting prefetch={false} on a link back to our collection doesn't solve our problem in production either - and I guess the problem here is that even if we HAVE a dynamic route (say, `/collection/[userId]/page.tsx` ...which I also tried), is that we are navigating to **the same dynamic route**, so soft navigation is enabled, it seems. \r\n\r\n**The only solution I have found**\r\nA client side `useRouter.refresh()`. This has to happen _before_ we land on the page though, as the refresh means that only the next time we visit the route will it refresh (this means we can't have a 'refresh data' button, as it won't take effect until we go away and come back again). \r\n\r\nWe can probably have some client side useEffect to call this for us, but honestly I can't believe this is the envisiged solution. But Ive tried hard to scour the documentation, and nothing that _seems_ like it should perform like I want it too, does - so I am left with this. \r\n\r\nI would love to hear of what I am sure is a painfully obvious solution that I have missed - but at the same time I think its fair to be frustrated at this fairly common usage not acting in a way that seems logical, based on the documentation provided. "}
{"sentences": "Incremental Static Regeneration", "description": "### Summary\n\nHello Community,\r\n\r\nI am using Incremental Static Regeneration approach with Next.Js v13.2.4.\r\n\r\nI have promotional data with the default disabled, when it is not active the promo page will not be displayed, or 404. and when the promo is activated it will display the page along with the promo data. But, it doesn't work as expected, when the promo is activated what should be displayed is the promo page, but now what I'm experiencing is always showing 404. In this case, the ISR doesn't seem to regenerate the page I activated. But, when I update data other than boolean type, ISR runs fine.\r\n\r\nI hope y'all here can help to solve this issue, thank you in advance.\n\n### Additional information\n\n```js\nexport async function getStaticPaths() {\r\n\tconst { data: promotions } = await PromotionServices.getPromotions('v1');\r\n\r\n\tconst paths = promotions.map((promotion) => ({\r\n\t\tparams: {\r\n\t\t\tslug: promotion.slug,\r\n\t\t},\r\n\t}));\r\n\r\n\treturn {\r\n\t\tpaths,\r\n\t\tfallback: 'blocking',\r\n\t};\r\n}\r\n\r\nexport async function getStaticProps(context) {\r\n\tconst { slug } = context.params;\r\n\r\n\tconst { data: promotions } = await PromotionServices.getPromotions('v1');\r\n\r\n\tconst isPublished = promotions.some((promotion) => promotion.slug === slug && promotion.active);\r\n\r\n\tif (!isPublished) {\r\n\t\treturn {\r\n\t\t\tnotFound: true,\r\n\t\t};\r\n\t}\r\n\r\n\tconst { data: promotion } = await PromotionServices.getPromotionBySlug('v1', slug);\r\n\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tpromotion,\r\n\t\t},\r\n\t\trevalidate: 10,\r\n\t};\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How do I serve a text file?", "description": "### Summary\n\nI want to serve a text file, like a `install.bash` to install something -- but when people navigate to the URL, it should display the script instead of just downloading it to their computer.\r\n\r\n\n\n### Additional information\n\n```js\nI tried placing it in the public folder, but this causes the browser to try to download it when going to `myapplication.com/install.bash`\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "View Page Source included JSON data?", "description": "Hello,\r\n\r\nIn the footer area. My website has included the JSON data with the following example.\r\n\r\n`<script id=\"__NEXT_DATA__\" type=\"application/json\">{\"props\":{\"pageProps\":{\"originalUrl\":\"\",\"active_sub\":\"\",\"gt_language\":null,\"post_type\":\"page\",\"parent_1\":\"\",\"parent_2 ....`\r\n\r\nCan we hide this? Or this is necessary to hide? \r\n\r\nUsed GetStaticProps.\r\n\r\nThanks."}
{"sentences": "Server side generated page with a video tag throws an error about failed hydration", "description": "### Summary\n\nMy Next.js app has a video on the landing page. The video tag looks like this:\r\n```\r\n<video\r\nautoPlay\r\npreload=\"auto\"\r\nloop\r\nmuted\r\nclassName={styles.watchlistVideo}\r\n>\r\n  <source src=\"/landing/watchlist.webm\" type=\"video/webm\" />\r\n  Your browser does not support the video.\r\n</video>\r\n```\r\n\r\n> The problem I have is that in development, Next throws an error saying that \"Error: Hydration failed because the initial UI does not match what was rendered on the server.\r\n\r\nI know this issue is caused by video, because I have been commenting each part of the code and it turned out it's the video. When I remove the video tag, the error disappears. It's strange, because when I grab the page with curl, which I guess is showing what the server side rendered page looks like, the video tag is perfectly rendered in the string that is returned.\r\n\r\nI double confirmed it's the issue with the video by commenting out all the code for the page except for the video code I mentioned above. The error is still the same, as if the video could not be rendered server side:\r\n\r\n> Unhandled Runtime Error\r\n> \r\n> Error: Hydration failed because the initial UI does not match what was rendered on the server.\r\n> \r\n> Warning: Expected server HTML to contain a matching < video > in < main >.\r\n> See more info here: https://nextjs.org/docs/messages/react-hydration-error\r\n> Component Stack\r\n> Call Stack\r\n> throwOnHydrationMismatch\r\n> node_modules/react-dom/cjs/react-dom.development.js (12507:0)\r\n> tryToClaimNextHydratableInstance\r\n> node_modules/react-dom/cjs/react-dom.development.js (12535:0)\r\n> updateHostComponent\r\n> node_modules/react-dom/cjs/react-dom.development.js (19902:0)\r\n> beginWork\r\n> node_modules/react-dom/cjs/react-dom.development.js (21618:0)\r\n> callCallback\r\n> node_modules/react-dom/cjs/react-dom.development.js (4164:0)\r\n> invokeGuardedCallbackDev\r\n> node_modules/react-dom/cjs/react-dom.development.js (4213:0)\r\n> invokeGuardedCallback\r\n> node_modules/react-dom/cjs/react-dom.development.js (4277:0)\r\n> beginWork$1\r\n> node_modules/react-dom/cjs/react-dom.development.js (27451:0)\r\n> performUnitOfWork\r\n> node_modules/react-dom/cjs/react-dom.development.js (26557:0)\r\n> workLoopSync\r\n> node_modules/react-dom/cjs/react-dom.development.js (26466:0)\r\n> renderRootSync\r\n> node_modules/react-dom/cjs/react-dom.development.js (26434:0)\r\n> performConcurrentWorkOnRoot\r\n> node_modules/react-dom/cjs/react-dom.development.js (25738:0)\r\n> workLoop\r\n> node_modules/scheduler/cjs/scheduler.development.js (266:0)\r\n> flushWork\r\n> node_modules/scheduler/cjs/scheduler.development.js (239:0)\r\n> performWorkUntilDeadline\r\n> node_modules/scheduler/cjs/scheduler.development.js (533:0)\r\n\r\nI figured out that I can avoid this issue by conditionally rendering the video tag on the client side (there's no error then), but I want my page to by fully SSR, so I don't wish to go that way.\r\n\r\nIs there any way to tackle that problem?\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Reusing ISR cache across builds on Vercel", "description": "https://vercel.com/docs/concepts/next.js/incremental-static-regeneration#isr:-not-just-caching states:\r\n\r\n> ISR is designed to persist your generated pages between deployments. This means you are able to rollback instantly and not lose your previously generated pages.\r\n\r\nThat makes sense to me. However, I'm wondering if ISR+Vercel utilizes the previous build's page cache if the new page generation is turned off at build time (i.e., `getStaticPaths()` returns `{ paths: [], fallback: 'blocking' }`? OR... will Next.js think that the page doesn't exist in the cache then generate it on demand?\r\n\r\nI'm trying to see if it's possible to set up ISR so that it only ever regenerates the page if the props have actually changed -- and not on every build."}
{"sentences": "Dynamic assetPrefix for ISR pages (custom server)", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nPages that are marked as ISR are built with a static `assetPrefix` upon first load.\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior, please provide code snippets or a repository:\r\n\r\n1. Create an ISR page (`getStaticPaths` with `fallback: true`, and `getStaticProps` with `revalidate: x`)\r\n2. Create a custom server that sets a dynamic assetPrefix (``app.setAssetPrefix(`/assets/${process.env.REGION}`);``)\r\n3. Build/run server with `export REGION=eu .....`\r\n4. Load page and see static assets loaded from `/_next/static/**/*`)\r\n5. Reload page and see static assets loaded from `/assets/eu/_next/static/**/*`\r\n\r\n## Expected behavior\r\n\r\nWe expect the ISR pages to have the correct assetPrefix upon first load, since we are waiting for `getStaticProps` anyway, thus no need for a build-time assetPrefix.\r\n\r\n## System information\r\n\r\n- Version of Next.js: 9.5.5\r\n\r\n## Additional context\r\n\r\nOur use-case is we prepend our assets with a specific region tag so we can run different releases in different CDN clusters (eg: `/nl/` page serves assets through `/assets/eu/_next/static/**/*`).\r\n"}
{"sentences": "How to handle SVG as a React component and an image?", "description": "### Summary\r\n\r\n### Stack\r\n\r\n- Nextjs 13.14.7\r\n- @svgr/webpack 8.0.1\r\n\r\nI wanted to use SVG as a React component in Next.js 13, so I installed @svgr/webpack and added some webpack configurations. After I added that config, I was able to get the SVG file as a React component, but I encountered an issue when trying to use the SVG file as an Image src.\r\n\r\nI tried using `<Image src={IcLogo} />`, but it seems that the IcLogo is not being fetched as an image since there is nothing in the network tab. I'm wondering why the webpack configuration for \\*.svg?url is not working properly.\r\n\r\nI tried logging <IcLogo/> to the console.\r\n<img width=\"1207\" alt=\"스크린샷 2023-07-19 오후 5 36 01\" src=\"https://github.com/vercel/next.js/assets/38061822/53441b2e-99c3-4d5a-b7a5-b67d5f3193ca\">\r\n\r\nRendered Image\r\n<img width=\"185\" alt=\"스크린샷 2023-07-19 오후 5 36 33\" src=\"https://github.com/vercel/next.js/assets/38061822/8bb1dd31-6db0-47d0-b374-84321ca1afc4\">\r\n\r\n### Additional information\r\n\r\n```js\r\n// package.json dependency\r\n  \"dependencies\": {\r\n    \"@headlessui/react\": \"^1.7.15\",\r\n    \"@tanstack/react-query\": \"^4.29.19\",\r\n    \"@types/node\": \"20.3.1\",\r\n    \"@types/react\": \"18.2.14\",\r\n    \"@types/react-dom\": \"18.2.6\",\r\n    \"autoprefixer\": \"10.4.14\",\r\n    \"axios\": \"^1.4.0\",\r\n    \"date-fns\": \"^2.30.0\",\r\n    \"eslint\": \"8.43.0\",\r\n    \"next\": \"13.4.7\",\r\n    \"postcss\": \"8.4.24\",\r\n    \"react\": \"18.2.0\",\r\n    \"react-dom\": \"18.2.0\",\r\n    \"react-hook-form\": \"^7.45.1\",\r\n    \"react-spring-bottom-sheet\": \"3.5.0-alpha.0\",\r\n    \"styled-components\": \"^6.0.2\",\r\n    \"typescript\": \"5.1.3\",\r\n    \"zustand\": \"^4.3.8\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@babel/core\": \"^7.22.5\",\r\n    \"@babel/plugin-syntax-typescript\": \"^7.22.5\",\r\n    \"@babel/preset-react\": \"^7.22.5\",\r\n    \"@svgr/webpack\": \"^8.0.1\",\r\n    \"@types/babel-plugin-macros\": \"^3\",\r\n    \"@types/babel__core\": \"^7\",\r\n    \"@types/eslint\": \"^8\",\r\n    \"@types/prettier\": \"^2\",\r\n    \"@types/styled-components\": \"^5.1.26\",\r\n    \"babel-loader\": \"^9.1.2\",\r\n    \"babel-plugin-macros\": \"^3.1.0\",\r\n    \"babel-plugin-styled-components\": \"^2.1.4\",\r\n    \"env-cmd\": \"^10.1.0\",\r\n    \"prettier\": \"^2.8.8\",\r\n    \"prettier-plugin-tailwindcss\": \"^0.3.0\",\r\n    \"tailwindcss\": \"^3.3.2\",\r\n    \"twin.macro\": \"^3.3.1\"\r\n  },\r\n  \"babelMacros\": {\r\n    \"twin\": {\r\n      \"preset\": \"styled-components\"\r\n    }\r\n  }\r\n```\r\n\r\n```javascript\r\n// next.config.js\r\nconst withTwin = require(\"./withTwin\");\r\n\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  compiler: {\r\n    styledComponents: true,\r\n  },\r\n  ...withTwin({\r\n    webpack: (config) => {\r\n      // Grab the existing rule that handles SVG imports\r\n      const fileLoaderRule = config.module.rules.find((rule) =>\r\n        rule.test?.test?.(\".svg\")\r\n      );\r\n\r\n      config.module.rules.push(\r\n        // Reapply the existing rule, but only for svg imports ending in ?url\r\n        {\r\n          ...fileLoaderRule,\r\n          test: /\\.svg$/i,\r\n          resourceQuery: /url/, // *.svg?url\r\n        },\r\n        // Convert all other *.svg imports to React components\r\n        {\r\n          test: /\\.svg$/i,\r\n          issuer: /\\.[jt]sx?$/,\r\n          resourceQuery: { not: /url/ }, // exclude if *.svg?url\r\n          use: [\"@svgr/webpack\"],\r\n        }\r\n      );\r\n\r\n      // Modify the file loader rule to ignore *.svg, since we have it handled now.\r\n      fileLoaderRule.exclude = /\\.svg$/i;\r\n      return config;\r\n    },\r\n  }),\r\n};\r\n\r\nmodule.exports = nextConfig;\r\n```\r\n\r\n```javascript\r\n// page\r\nimport Image from \"next/image\";\r\nimport IcLogo from \"assets/logo/IcLogo.svg\";\r\n\r\nfunction Page() {\r\n  console.log(\"IcLogo :>> \", IcLogo);\r\n  return (\r\n    <>\r\n      <IcLogo />\r\n      <Image src={IcLogo} alt=\"logo\" />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Page;\r\n```\r\n"}
{"sentences": "Force re-render of the Layout", "description": "Hi there,\r\n\r\nI've got a List of People, fetched from a Database with either a Detail-Page or a \"New User\"-Page to the right.\r\nHowever, when creating a new user (or editing an existing one). The List of course does not update. Is there any way how I can force the layout to rerender? Example is below:\r\n\r\n```tsx\r\n//layout.tsx\r\nimport { Suspense, ReactNode } from \"react\";\r\nimport Loading from \"components/loading\";\r\nimport styles from \"./team.module.scss\"\r\nimport TeamList from \"./teamList\";\r\n\r\nexport default async function Layout({ children }: { children: ReactNode }) {\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <Suspense fallback={<Loading />}>\r\n        {/* @ts-expect-error Async Server Component */}\r\n        <TeamList />\r\n      </Suspense>\r\n      <div className={styles.details}>\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\n```tsx\r\n//teamList.tsx\r\nimport Link from \"next/link\";\r\nimport styles from \"./team.module.scss\"\r\nimport { BsPlus } from \"react-icons/bs\";\r\nimport prisma from \"lib/prismadb\"\r\n\r\nexport const revalidate = false;\r\n\r\nexport default async function TeamList() {\r\n\r\n  let users = await prisma.user.findMany({\r\n    select: {\r\n      id: true,\r\n      name: true,\r\n      vorname: true,\r\n    },\r\n    where: {\r\n      deleted: false,\r\n    },\r\n    orderBy: {\r\n      name: \"asc\",\r\n    },\r\n  })\r\n\r\n  return (\r\n    <div className={styles.team}>\r\n      <Link href=\"/team/new\" className={styles.listentry}>\r\n        <BsPlus />\r\n        <span>New</span>\r\n      </Link>\r\n      {users.map((user) => (\r\n        <Link href={\"/team/\" + user.id} key={user.id} className={styles.listentry}>\r\n          {user.name + \", \" + user.vorname}\r\n        </Link>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\nI had a look at [revalidate](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#revalidate) as you can still see in the teamList.tsx but this is either related to https://github.com/vercel/next.js/discussions/42290 OR this is not the intended use all along.\r\nI also checked out [revalidatePath](https://nextjs.org/docs/app/api-reference/functions/revalidatePath) when creating a new user and tried the path of the layout and also the path of the page itself, but that did not seem to do the trick either.\r\n\r\nI used revalidatePath like this:\r\n```tsx\r\n  //page.tsx\r\n  [...]\r\n\r\n  async function formAction(formData: FormData) {\r\n    \"use server\"\r\n    console.log(\"creating user\", formData)\r\n\r\n    const user = await prisma.user.create({\r\n      data: {\r\n        email: formData.get(\"mail\") as string,\r\n        password: formData.get(\"password\") as string,\r\n        name: formData.get(\"name\") as string,\r\n        vorname: formData.get(\"vorname\") as string,\r\n      }\r\n    })\r\n    revalidatePath(\"/team/\" + user.id)\r\n\r\n    redirect(\"/team/\" + user.id)\r\n  }\r\n\r\n  [...]\r\n```"}
{"sentences": "Nextjs abnormal Serverless Build error", "description": "Hey folks,\r\n\r\nHelp me resolve this issue.\r\nI don't want to create serverless at all. I only want to use Nextjs App Router, but it's suddenly building a serverless function on vercel. I only want to create an SSR application.\r\n\r\nKey points:-\r\n- My project is a Monorepo\r\n- I use swc\r\n- Local Build is OK\r\n- Storybook build is perfectly fine, in different vercel project.\r\n\r\nSource Code at :- [SHX](https://github.com/bravo68web/shx)\r\n\r\nBuild Log\r\n\r\n```\r\n[16:30:07.588] Running build in Cleveland, USA (East) – cle1\r\n[16:30:07.644] Cloning github.com/BRAVO68WEB/shx (Branch: dev, Commit: eb77ad9)\r\n[16:30:07.875] Previous build cache not available\r\n[16:30:08.101] Cloning completed: 457.4ms\r\n[16:30:08.209] Running \"vercel build\"\r\n[16:30:08.683] Vercel CLI 29.3.6\r\n[16:30:08.888] Installing dependencies...\r\n[16:30:09.140] yarn install v1.22.17\r\n[16:30:09.235] [1/4] Resolving packages...\r\n[16:30:09.652] [2/4] Fetching packages...\r\n[16:30:35.497] [3/4] Linking dependencies...\r\n[16:30:35.499] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > shx-api > ts-node@10.9.1\" has unmet peer dependency \"@types/node@*\".\r\n[16:30:35.501] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > shx-api > multer-s3 > @aws-sdk/lib-storage@3.338.0\" has unmet peer dependency \"@aws-sdk/abort-controller@^3.0.0\".\r\n[16:30:35.502] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > react-hot-toast > goober@2.1.13\" has unmet peer dependency \"csstype@^3.0.10\".\r\n[16:30:35.503] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-class-properties@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.503] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-export-namespace-from@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.503] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-numeric-separator@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.503] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-object-rest-spread@7.20.7\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.504] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-syntax-bigint@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.504] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-syntax-dynamic-import@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.504] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-syntax-import-assertions@7.20.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.504] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-transform-runtime@7.22.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.504] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env@7.22.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-react@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-typescript@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > css-loader@6.8.1\" has unmet peer dependency \"webpack@^5.0.0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > node-polyfill-webpack-plugin@2.0.1\" has unmet peer dependency \"webpack@>=5\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > postcss-loader@7.3.2\" has unmet peer dependency \"webpack@^5.0.0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > sass-loader@12.6.0\" has unmet peer dependency \"webpack@^5.0.0\".\r\n[16:30:35.505] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > style-loader@3.3.3\" has unmet peer dependency \"webpack@^5.0.0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-class-properties > @babel/helper-create-class-features-plugin@7.22.1\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-export-namespace-from > @babel/plugin-syntax-export-namespace-from@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-numeric-separator > @babel/plugin-syntax-numeric-separator@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-object-rest-spread > @babel/helper-compilation-targets@7.22.1\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-object-rest-spread > @babel/plugin-syntax-object-rest-spread@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.506] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-proposal-object-rest-spread > @babel/plugin-transform-parameters@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-transform-runtime > babel-plugin-polyfill-corejs2@0.4.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-transform-runtime > babel-plugin-polyfill-corejs3@0.8.1\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-transform-runtime > babel-plugin-polyfill-regenerator@0.5.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-bugfix-safari-id-destructuring-collision-in-function-expression@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-bugfix-v8-spread-parameters-in-optional-chaining@7.22.3\" has unmet peer dependency \"@babel/core@^7.13.0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-proposal-private-property-in-object@7.21.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-async-generators@7.8.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-class-properties@7.12.13\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-class-static-block@7.14.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-import-attributes@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-import-meta@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-json-strings@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-logical-assignment-operators@7.10.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-nullish-coalescing-operator@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.508] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-optional-catch-binding@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-optional-chaining@7.8.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-private-property-in-object@7.14.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-top-level-await@7.14.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-unicode-sets-regex@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-arrow-functions@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-async-generator-functions@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-async-to-generator@7.20.7\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-block-scoped-functions@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-block-scoping@7.21.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-class-properties@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-class-static-block@7.22.3\" has unmet peer dependency \"@babel/core@^7.12.0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-classes@7.21.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-computed-properties@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-destructuring@7.21.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.509] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-dotall-regex@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-duplicate-keys@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-dynamic-import@7.22.1\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-exponentiation-operator@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-export-namespace-from@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-for-of@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-function-name@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-json-strings@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-literals@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-logical-assignment-operators@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-member-expression-literals@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-modules-amd@7.20.11\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-modules-commonjs@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-modules-systemjs@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-modules-umd@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-named-capturing-groups-regex@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-new-target@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.510] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-nullish-coalescing-operator@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-numeric-separator@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-object-rest-spread@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-object-super@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-optional-catch-binding@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-optional-chaining@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-private-methods@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-private-property-in-object@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-property-literals@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-regenerator@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-reserved-words@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-shorthand-properties@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-spread@7.20.7\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-sticky-regex@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-template-literals@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-typeof-symbol@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-unicode-escapes@7.21.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-unicode-property-regex@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-unicode-regex@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-unicode-sets-regex@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/preset-modules@0.1.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.511] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-react > @babel/plugin-transform-react-display-name@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-react > @babel/plugin-transform-react-jsx-development@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-react > @babel/plugin-transform-react-pure-annotations@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-typescript > @babel/plugin-syntax-jsx@7.21.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-typescript > @babel/plugin-transform-typescript@7.22.3\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @storybook/preset-react-webpack > @babel/preset-flow@7.21.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/plugin-transform-runtime > babel-plugin-polyfill-corejs2 > @babel/helper-define-polyfill-provider@0.4.0\" has unmet peer dependency \"@babel/core@^7.4.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-syntax-unicode-sets-regex > @babel/helper-create-regexp-features-plugin@7.22.1\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/plugin-transform-async-generator-functions > @babel/helper-remap-async-to-generator@7.18.9\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-env > @babel/preset-modules > @babel/plugin-proposal-unicode-property-regex@7.18.6\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @babel/preset-typescript > @babel/plugin-transform-typescript > @babel/plugin-syntax-typescript@7.21.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @storybook/preset-react-webpack > @babel/preset-flow > @babel/plugin-transform-flow-strip-types@7.21.0\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.512] warning \"workspace-aggregator-da78451b-7099-4f4a-b378-2de730cd3ac9 > dashboard > @storybook/nextjs > @storybook/preset-react-webpack > @babel/preset-flow > @babel/plugin-transform-flow-strip-types > @babel/plugin-syntax-flow@7.21.4\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\n[16:30:35.546] warning Workspaces can only be enabled in private projects.\r\n[16:31:04.630] [4/4] Building fresh packages...\r\n[16:31:06.280] Done in 57.14s.\r\n[16:31:06.321] Detected Next.js version: 13.4.3\r\n[16:31:06.322] Running \"yarn run build\"\r\n[16:31:06.484] yarn run v1.22.17\r\n[16:31:06.522] $ next build\r\n[16:31:06.916] Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n[16:31:06.916] This information is used to shape Next.js' roadmap and prioritize features.\r\n[16:31:06.916] You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n[16:31:06.916] https://nextjs.org/telemetry\r\n[16:31:06.916] \r\n[16:31:07.007] - info Creating an optimized production build...\r\n[16:31:16.613] - info Compiled successfully\r\n[16:31:16.615] - info Linting and checking validity of types...\r\n[16:31:19.055] \r\n[16:31:19.055] ./components/Lists/UploadsList/LinearList.tsx\r\n[16:31:19.055] 2:10  Warning: 'Delete' is defined but never used.  @typescript-eslint/no-unused-vars\r\n[16:31:19.055] \r\n[16:31:19.055] ./components/ui/Button.tsx\r\n[16:31:19.056] 1:39  Warning: 'InputHTMLAttributes' is defined but never used.  @typescript-eslint/no-unused-vars\r\n[16:31:19.056] \r\n[16:31:19.056] info  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules\r\n[16:31:19.766] - info Collecting page data...\r\n[16:31:31.888] - info Generating static pages (0/6)\r\n[16:31:31.955] - info Generating static pages (1/6)\r\n[16:31:31.962] - info Generating static pages (2/6)\r\n[16:31:32.042] - info Generating static pages (4/6)\r\n[16:31:32.077] - info Generating static pages (6/6)\r\n[16:31:32.086] - info Finalizing page optimization...\r\n[16:31:32.088] \r\n[16:31:32.096] Route (app)                                Size     First Load JS\r\n[16:31:32.096] ┌ ○ /                                      135 B          77.2 kB\r\n[16:31:32.096] ├ ○ /dashboard                             0 B                0 B\r\n[16:31:32.096] ├ ○ /favicon.ico                           0 B                0 B\r\n[16:31:32.096] └ ○ /login                                 0 B                0 B\r\n[16:31:32.096] + First Load JS shared by all              77.1 kB\r\n[16:31:32.096]   ├ chunks/7fd0f9f1-b28565d010a41fbc.js    50.5 kB\r\n[16:31:32.096]   ├ chunks/9-1ec9606b120287ed.js           24.7 kB\r\n[16:31:32.097]   ├ chunks/main-app-9ab3bd7464ea6e45.js    211 B\r\n[16:31:32.097]   └ chunks/webpack-3fd80da83add4e61.js     1.64 kB\r\n[16:31:32.097] \r\n[16:31:32.097] Route (pages)                              Size     First Load JS\r\n[16:31:32.097] ─ ○ /404                                   178 B          83.8 kB\r\n[16:31:32.097] + First Load JS shared by all              83.6 kB\r\n[16:31:32.097]   ├ chunks/main-131630bde90d2445.js        81.8 kB\r\n[16:31:32.097]   ├ chunks/pages/_app-415a5670032b79f5.js  190 B\r\n[16:31:32.097]   └ chunks/webpack-3fd80da83add4e61.js     1.64 kB\r\n[16:31:32.098] \r\n[16:31:32.098] ○  (Static)  automatically rendered as static HTML (uses no initial props)\r\n[16:31:32.098] \r\n[16:31:32.794] Done in 26.31s.\r\n[16:31:53.272] Traced Next.js server files in: 20.450s\r\n[16:31:55.830] Warning: Max serverless function size of 50 MB compressed or 250 MB uncompressed almost reached\r\n[16:31:55.830] Serverless Function's pages: favicon.ico.js, index.js, login.js\r\n[16:31:55.836] Large Dependencies                     Uncompressed size  Compressed size\r\n[16:31:55.836] node_modules/@swc/core-linux-x64-gnu            49.75 MB         16.52 MB\r\n[16:31:55.836] node_modules/@swc/core-linux-x64-musl           49.37 MB         16.39 MB\r\n[16:31:55.836] node_modules/next/dist                          21.75 MB          5.56 MB\r\n[16:31:55.837] node_modules/@swc/wasm                          19.29 MB          4.53 MB\r\n[16:31:55.837] node_modules/@esbuild/linux-x64                  8.68 MB          3.64 MB\r\n[16:31:55.837] node_modules/webpack/lib                         3.35 MB        880.31 KB\r\n[16:31:55.837] node_modules/react-dom/cjs                       1.64 MB        404.02 KB\r\n[16:31:55.837] node_modules/caniuse-lite/data                  882.5 KB         316.5 KB\r\n[16:31:55.837] packages/dashboard/.next                         1.59 MB        230.81 KB\r\n[16:31:55.837] node_modules/terser/dist                       957.25 KB        183.23 KB\r\n[16:31:55.837] node_modules/uglify-js/lib                     972.25 KB        166.19 KB\r\n[16:31:55.837] node_modules/webpack/schemas                   607.14 KB         93.85 KB\r\n[16:31:55.837] \r\n[16:31:55.837] All dependencies                               162.02 MB         49.66 MB\r\n[16:31:55.837] Serverless Function's page: dashboard.js\r\n[16:31:55.842] Large Dependencies                     Uncompressed size  Compressed size\r\n[16:31:55.842] node_modules/@swc/core-linux-x64-gnu            49.75 MB         16.52 MB\r\n[16:31:55.842] node_modules/@swc/core-linux-x64-musl           49.37 MB         16.39 MB\r\n[16:31:55.842] node_modules/next/dist                          19.66 MB          4.87 MB\r\n[16:31:55.842] node_modules/@swc/wasm                          19.29 MB          4.53 MB\r\n[16:31:55.842] node_modules/@esbuild/linux-x64                  8.68 MB          3.64 MB\r\n[16:31:55.842] node_modules/webpack/lib                         3.35 MB        880.31 KB\r\n[16:31:55.842] node_modules/react-dom/cjs                       1.64 MB        404.02 KB\r\n[16:31:55.842] node_modules/caniuse-lite/data                  882.5 KB         316.5 KB\r\n[16:31:55.842] packages/dashboard/.next                         1.11 MB        188.05 KB\r\n[16:31:55.842] node_modules/terser/dist                       957.25 KB        183.23 KB\r\n[16:31:55.842] node_modules/uglify-js/lib                     972.25 KB        166.19 KB\r\n[16:31:55.842] node_modules/webpack/schemas                   607.14 KB         93.85 KB\r\n[16:31:55.842] \r\n[16:31:55.842] All dependencies                                159.3 MB         48.88 MB\r\n[16:31:55.845] Created all serverless functions in: 2.573s\r\n[16:31:55.852] Collected static files (public/, static/, .next/static): 4.094ms\r\n[16:31:57.120] Build Completed in /vercel/output [2m]\r\n[16:31:57.521] Deploying outputs...\r\n[16:32:05.664] Failed to process build result for \"login\". Data: {\"type\":\"Prerender\"}.\r\n[16:32:05.664] Failed to process build result for \"login.rsc\". Data: {\"type\":\"Prerender\"}.\r\n[16:32:05.664] Failed to process build result for \"favicon.ico\". Data: {\"type\":\"Prerender\"}.\r\n[16:32:05.665] Failed to process build result for \"index\". Data: {\"type\":\"Prerender\"}.\r\n[16:32:05.665] Failed to process build result for \"index.rsc\". Data: {\"type\":\"Prerender\"}.\r\n[16:32:05.667] Error: The Serverless Function \"login\" is 50.63mb which exceeds the maximum size limit of 50mb. Learn More: https://vercel.link/serverless-function-size\r\n[16:32:07.776] NOW_SANDBOX_WORKER_MAX_LAMBDA_SIZE: The Serverless Function \"login\" is 50.63mb which exceeds the maximum size limit of 50mb.\r\n```"}
{"sentences": "Next.js API route error on Vercel - Unhandled Promise Rejection", "description": "### Summary\n\nThe code works perfectly fine on my local machine using a development server, but on the deployed version on Vercel, the API route call always fails. For reference, I am on an M1 MacBook Air, 16 GB unified memory. \r\n\r\nThis is the code for the project - https://github.com/csvidit/turbobiz\r\n\r\nThis is the link to the production build, hosted on Vercel - https://turbobiz.viditkhandelwal.com\r\n\r\nThis is the error I get in the Serverless Function logs on Vercel -\r\n\r\nUnhandled Promise Rejection \t{\"errorType\":\"Runtime.UnhandledPromiseRejection\",\"errorMessage\":\"Error: EMFILE: too many open files, open '/var/task/node_modules/@firebase/auth/dist/node-esm/index.js'\",\"reason\":{\"errorType\":\"Error\",\"errorMessage\":\"EMFILE: too many open files, open '/var/task/node_modules/@firebase/auth/dist/node-esm/index.js'\",\"code\":\"EMFILE\",\"errno\":-24,\"syscall\":\"open\",\"path\":\"/var/task/node_modules/@firebase/auth/dist/node-esm/index.js\",\"stack\":[\"Error: EMFILE: too many open files, open '/var/task/node_modules/@firebase/auth/dist/node-esm/index.js'\",\"    at Object.openSync (node:fs:601:3)\",\"    at Object.readFileSync (node:fs:469:35)\",\"    at Module._extensions..js (node:internal/modules/cjs/loader:1271:18)\",\"    at Module.load (node:internal/modules/cjs/loader:1117:32)\",\"    at Module._load (node:internal/modules/cjs/loader:958:12)\",\"    at ModuleWrap.<anonymous> (node:internal/modules/esm/translators:169:29)\",\"    at ModuleJob.run (node:internal/modules/esm/module_job:194:25)\"]},\"promise\":{},\"stack\":[\"Runtime.UnhandledPromiseRejection: Error: EMFILE: too many open files, open '/var/task/node_modules/@firebase/auth/dist/node-esm/index.js'\",\"    at process.<anonymous> (file:///var/runtime/index.mjs:1189:17)\",\"    at process.emit (node:events:525:35)\",\"    at emit (node:internal/process/promises:149:20)\",\"    at processPromiseRejections (node:internal/process/promises:283:27)\",\"    at process.processTicksAndRejections (node:internal/process/task_queues:96:32)\"]}\r\nUnknown application error occurred\r\nRuntime.Unknown\r\n\r\nI have spent 4 hours searching for fixes, but nothing has worked yet. Let me know if you need any more information or context.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Module not found: Can't resolve 'private-next-root-dir/middleware.ts'", "description": "### Summary\r\n\r\nI add a **`middleware.ts`** file to my pro. When running **`npm run dev`** it goes well. Howerver, while I try to run **`npm run build`** the error occurs as follow.  I don't know what to do and find nothing useful about it. Anyone got the same error? I think I need some help\r\n(QAQ)\r\n\r\n![image](https://github.com/vercel/next.js/assets/87525137/08ec32ad-ed39-4b39-8ef1-34dbcde927f3)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "How can i use dynamic route in Korean language ???", "description": "I use app router in my blog, and i use dynamic path.\r\nwhen i use dynamic path in Korean, i face a problem.\r\n\r\nI use category/[slug] in my URL path like below image,\r\n\r\n![image](https://github.com/vercel/next.js/assets/59411107/3d3fa10d-6012-4a7c-98dc-741c1b9d9461)\r\n\r\nbut slug is not an outcome I didn't anticipate. when i print my slug(category[slug]), the slug is printed like below.\r\n![image](https://github.com/vercel/next.js/assets/59411107/0499b5ff-c7ee-4288-b499-a8139b22516c)\r\n\r\nmy entire code is this!\r\n```js\r\n\r\n//cartegory/[slug]/page.tsx\r\n\r\nimport Link from 'next/link';\r\nimport Title from '@/Component/About/Title';\r\nimport PostLayout from '@/Component/Common/PostLayout';\r\nimport { getCategoryFilteredPosts } from '../../../../lib/api';\r\nimport Image from 'next/image';\r\n\r\nexport default function Home({\r\n  params,\r\n}: {\r\n  params: {\r\n    categoryId: string;\r\n  };\r\n}) {\r\n  const posts = getCategoryFilteredPosts(\r\n    ['title', 'data', 'slug', 'category', 'excerpt', 'date', 'image'],\r\n    params.categoryId\r\n  );\r\n\r\n  console.log(posts, params);\r\n\r\n  return (\r\n    <>\r\n      <h2>{params.categoryId}</h2>\r\n      <main\r\n        style={{\r\n          minWidth: '60%',\r\n        }}\r\n      >\r\n        {posts.map((post) => (\r\n          <PostLayout key={post.title}>\r\n            <Link href={`/blog/${post.slug}`}>\r\n              <Title title={post.title} />\r\n              <p>{post.category}</p>\r\n              {post.content}\r\n            </Link>\r\n\r\n            <div\r\n              style={{\r\n                display: 'flex',\r\n                position: 'relative',\r\n                width: '150px',\r\n                height: '150px',\r\n              }}\r\n            >\r\n              <Image\r\n                src={post.image}\r\n                fill\r\n                alt=\"블로그 대표 이미지\"\r\n                style={{\r\n                  objectFit: 'cover',\r\n                }}\r\n              />\r\n            </div>\r\n          </PostLayout>\r\n        ))}\r\n      </main>\r\n    </>\r\n  );\r\n\r\n```\r\n\r\n📦category\r\n ┗ 📂[categoryId]\r\n ┃ ┣ 📂[slug]\r\n ┃ ┃ ┗ 📜page.tsx\r\n ┃ ┗ 📜page.tsx"}
{"sentences": "'use client' causes page to crash, in dev but not in build", "description": "### Summary\r\n\r\nI am starting a new project and am going for the app router this time.\r\nI could go reasonably far, until I added my first 'useState' ...\r\n\r\nPage quickly flashes and then crashes during hydration with `TypeError: __webpack_require__.n is not a function`\r\n\r\nThis problem only happens with `npm run dev`, if I `npm run build` then `npm start`, I get no issue.\r\n\r\nAt this stage, I'm using the counter code at https://nextjs.org/docs/getting-started/react-essentials and adding that component to my page that otherwise works fine. \r\n\r\nI am running out of ideas, any hint ?\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.5.0: Thu Jun  8 22:21:34 PDT 2023; root:xnu-8796.121.3~7/RELEASE_ARM64_T8112\r\n    Binaries:\r\n      Node: 18.16.1\r\n      npm: 9.5.1\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant Packages:\r\n      next: 13.4.9\r\n      eslint-config-next: 13.4.9\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.6\r\n    Next.js Config:\r\n      output: N/A\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Next.js Slack Workspace", "description": "Is there a next.js slack community?"}
{"sentences": "Tailwind CSS installation question", "description": "Hello, \r\nUsually I install tailwind manually in Nextjs and until now I install as DEV dependency, however since Nextjs now also suggest to install and preconfig it together to gain some times, but i notice the installation is on dependency and not in dev, so is there a particular reason?  since Tailwind docs always recommand to install on the dev, since we only use it on dev mode ? "}
{"sentences": "Getting error when trying to use a package that imports JSON file for i18n", "description": "### Summary\r\n\r\nI have a package that I'm importing into my Next.js project (v13.4.3) that has a sub-dependency on another package which supplies it with translations via a JSON file. However, when I attempt to use the package and compile, I get this error:\r\n\r\n```\r\n- info Collecting page data ..Error: Cannot find module '/Users/user/app/.next/server/chunks/translations.json'\r\n    at webpackEmptyContext (/Users/user/app/.next/server/chunks/7208.js:9:10)\r\n    at Object.9641 (/Users/user/app/.next/server/chunks/9716.js:10551:45)\r\n    at __webpack_require__ (/Users/user/app/.next/server/webpack-runtime.js:25:42)\r\n    at Object.11450 (/Users/user/app/.next/server/chunks/9716.js:5138:31)\r\n    at __webpack_require__ (/Users/user/app/.next/server/webpack-runtime.js:25:42)\r\n    at Object.4847 (/Users/user/app/.next/server/chunks/9716.js:5309:14)\r\n    at __webpack_require__ (/Users/user/app/.next/server/webpack-runtime.js:25:42)\r\n    at Object.59204 (/Users/user/app/.next/server/chunks/9716.js:6898:14)\r\n    at __webpack_require__ (/Users/user/app/.next/server/webpack-runtime.js:25:42)\r\n    at /Users/user/app/.next/server/pages/projects/[id].js:27:79 {\r\n  code: 'MODULE_NOT_FOUND'\r\n}\r\n```\r\n\r\nWhen I go into the actual node_module folder, the .json file is indeed there. Might be worth noting that both packages belong to an NPM scope (e.g. `@mycompany`), which was added to `transpilePackages` array as `[\"@mycompany\"]` to prevent a separate error I was getting that said `SyntaxError: Unexpected token 'export'`.\r\n\r\n### Additional information\r\n\r\n```\r\n    Operating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 22.4.0: Mon Mar  6 21:00:17 PST 2023; root:xnu-8796.101.5~3/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 16.20.0\r\n      npm: 8.19.4\r\n      Yarn: 1.22.19\r\n      pnpm: 8.5.1\r\n    Relevant packages:\r\n      next: 13.4.3\r\n      eslint-config-next: 13.4.3\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.0.4\r\n```\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Local port calls since v13 upgrade", "description": "### Summary\n\nSince we upgraded to v13 our NewRelic dashboards show weird external services calls which we are unable to identify. This is the big picture (2nd deployment was v13 upgrade):\r\n![Screenshot 2023-07-13 at 10 49 26](https://github.com/vercel/next.js/assets/87317406/7e9867d5-e570-4a80-9156-3d2ea7b1e22b)\r\nand this is the list of external services it calls:\r\n![Screenshot 2023-07-13 at 10 50 44](https://github.com/vercel/next.js/assets/87317406/2d1ac011-0c7a-4ef9-99e2-f30dd5686e25)\r\nYou can see they are all local ports (except for sentry but that's what we account for), but they all seem random. We are 100% sure it is connected to Next.js being upgraded from v12 to v13, but as I scanned through changelog I was unable to find anything related to it.\r\n\r\nDoes anybody have any idea what this is about?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Meta title is not updated in browser tab on route change.", "description": "### Summary\r\n\r\nOnly the initial selected route title is shown in the browser tab. When following links the title in the browser tab does not change, despite the page title changing in the source.\r\n\r\n### Additional information\r\n\r\n```js\r\nThe routes that don't update are children of a Radix UI NavigationMenu component and use next/link.\r\n```\r\n\r\nedit: I should add that this is on ISR pages only\r\n"}
{"sentences": "Is Next.js patching the built-in Promise?", "description": "**Is Next.js patching the built-in Promise?**\r\n\r\nWe're using `openapi-typescript-codegen` to build our own api sdk from the backend openapi.json.\r\n`openapi-typescript-codegen` produces a number of methods, eg. `client.postCreateUser`, that we then use along with react-query's `useMutation` hook.\r\n\r\n`client.postCreateUser` returns a `CancelablePromise` - it extends built-in Promise.\r\n\r\nEverything worked fine up until `next@3.4.7`.\r\n\r\nAfter upgrading to `next@3.4.8 ` (tested aslo with `3.4.9` and `3.4.10.canary.3`) the Promise returned by `client.postCreateUser` never settles (it remains in pending state forever).\r\nNothing else changed in the repository - only Next.js upgrade.\r\n\r\nThat would only makes sense if Next.js is patching global Promise - is that the case?\r\n"}
{"sentences": "minimumCacheTTL for images not setting correct caching header?", "description": "I'm using the `next/image` component to load my images. All images are stored in the `/public` folder, but there are dynamic images (i.e. not available at build time) so I'm loading them as Remote images instead of local. So a request looks like this:\r\n\r\n`https://mydomain.com/_next/image?url=https%3A%2F%2Fmydomain.com%2Fimages%2image.png&w=828&q=75`\r\n\r\nRight now it works but the `Cache-control` header is \"wrong\".  For each image it will make a small request to check if the content changed, and this slows the loading of the page. What I want is to set the max-age to a higher number and not 0.\r\n\r\n`Cache-Control: public, max-age=0, must-revalidate`\r\n\r\nI tried to use `minimumCacheTTL` in the `next.config.js` file but it didn't change the header, I also tried to set the header directly for images but also didn't work.\r\n\r\nNot sure what I'm doing wrong or if I am missing something.\r\n\r\n\r\nMy attempts:\r\n\r\n```\r\nimages: {\r\n\t\tdomains: [\"mydomain.com\"],\r\n\t\tminimumCacheTTL: 60,\r\n\t},\r\n```\r\n\r\n```\r\nasync headers() {\r\n\t\treturn [\r\n\t\t\tsource: '/:all*(svg|jpg|png)',\r\n                        locale: false,\r\n                        headers: [\r\n                          {\r\n                            key: 'Cache-Control',\r\n                            value: 'public, max-age=9999999999, must-revalidate',\r\n                          }]\r\n}\r\n\r\n```"}
{"sentences": "getStaticPaths ran but getStaticProps didn't", "description": "### Summary\r\n\r\n```\r\n\"next\": \"13.4.8\",\r\n\"react\": \"18.2.0\",\r\n\"@trpc/client\": \"^10.33.1\",\r\n\"@trpc/next\": \"^10.33.1\",\r\n\"@trpc/react-query\": \"^10.33.1\",\r\n\"@trpc/server\": \"^10.33.1\",\r\n```\r\n\r\nI was trying to implement SSG for my effect detail page but it didn't work. On run build the `getStaticPaths` seems run fine and return all the effect Id as expected. But it seems `getStaticProps` didn't run and the id in the component was undefined\r\n\r\nI was following [trpc SSG guide](https://trpc.io/docs/client/nextjs/ssg) and [NextJs SSG guide](https://nextjs.org/docs/pages/building-your-application/rendering/static-site-generation)\r\n\r\nin my `src\\pages\\effect\\[id].tsx`\r\n\r\n```typescript  \r\nimport { appRouter } from '@root/server/api/router/_app';\r\nimport { db } from '@root/server/db';\r\nimport { effects } from '@root/server/db/schema';\r\nimport { apiContext } from '@root/utils/trpc';\r\nimport { createServerSideHelpers } from '@trpc/react-query/server';\r\nimport type { GetStaticPaths, GetStaticPropsContext, InferGetStaticPropsType } from 'next';\r\n\r\nexport const getStaticPaths: GetStaticPaths = async () => {\r\n  const effectIds = await db.select({ id: effects.id }).from(effects);\r\n\r\n  return {\r\n    paths: effectIds.map(({ id }) => {\r\n      console.log(id);\r\n      return { params: { id } };\r\n    }),\r\n    fallback: 'blocking',\r\n  };\r\n};\r\n\r\nexport const getStaticProps = async (context: GetStaticPropsContext<{ id: string }>) => {\r\n  const helpers = createServerSideHelpers({ router: appRouter, ctx: {} });\r\n  const id = context.params?.id;\r\n  // the code didn't throw at this point\r\n  if (!id) throw new Error('Debugging - id is undefined - getStaticProps');\r\n\r\n  await helpers.effect.getOne.prefetch({ id });\r\n  return { props: { trpcState: helpers.dehydrate(), id }, revalidate: 1 };\r\n};\r\n\r\nexport default function EffectDetail({ id }: InferGetStaticPropsType<typeof getStaticProps>) {\r\n  // the code throw at this point, means `getStaticProps` didn't run at all\r\n  if (!id) throw new Error('Debugging - id is undefined - client');\r\n\r\n  const { data, isError, error } = apiContext.effect.getOne.useQuery({ id });\r\n\r\n  return (\r\n    // render Effect ...\r\n  );\r\n}\r\n```\r\n\r\n### Additional information\r\n\r\n```js\r\nfull code implement https://github.com/Senbonzakura1234/sophie-dex/tree/feature/implement-ssg\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Unable to run Next App in Ubantu", "description": "### Summary\n\nHello All, I've install ubantu recently and I was trying to run one of my old project (which is working fine in my windows laptop). So I tried creating a new project with `npx create-next-app@latest` but it has the same issue \r\n\r\n**Error** : Error [ValidationError]: Invalid configuration object. Webpack has been initialized using a configuration object that does not match the API schema.\r\n\r\nI'm not much familiar with the new env so I'm not able to figure out is the issue. and below is the next info\r\n```\r\nOperating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #24-Ubuntu SMP PREEMPT_DYNAMIC Fri Jun 16 12:03:50 UTC 2023\r\n    Binaries:\r\n      Node: 18.16.1\r\n      npm: 9.5.1\r\n      Yarn: N/A\r\n      pnpm: 8.6.5\r\n    Relevant packages:\r\n      next: 13.4.7\r\n      eslint-config-next: 13.4.7\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.6\r\n```\n\n### Additional information\n\n```js\nThe Whole Error output: \r\nvignesh@Leo:~/Desktop/Code It!/projects/my-app$ npm run dev\r\n\r\n> my-app@0.1.0 dev\r\n> next dev\r\n\r\n- ready started server on 0.0.0.0:3000, url: http://localhost:3000\r\nError [ValidationError]: Invalid configuration object. Webpack has been initialized using a configuration object that does not match the API schema.\r\n - configuration[0].cache.cacheDirectory: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/cache/webpack\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> Base directory for the cache (defaults to node_modules/.cache/webpack).\r\n - configuration[0].context: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The base directory (absolute path!) for resolving the `entry` option. If `output.pathinfo` is set, the included pathinfo is shortened to this directory.\r\n - configuration[0].module.rules[3].oneOf[17].issuer.and[0]: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n - configuration[0].output.path: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The output directory as **absolute path** (required).\r\n - configuration[1].cache.cacheDirectory: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/cache/webpack\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> Base directory for the cache (defaults to node_modules/.cache/webpack).\r\n - configuration[1].context: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The base directory (absolute path!) for resolving the `entry` option. If `output.pathinfo` is set, the included pathinfo is shortened to this directory.\r\n - configuration[1].module.rules[4].oneOf[15].issuer.and[0]: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n - configuration[1].output.path: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/server\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The output directory as **absolute path** (required).\r\n - configuration[2].cache.cacheDirectory: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/cache/webpack\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> Base directory for the cache (defaults to node_modules/.cache/webpack).\r\n - configuration[2].context: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The base directory (absolute path!) for resolving the `entry` option. If `output.pathinfo` is set, the included pathinfo is shortened to this directory.\r\n - configuration[2].module.rules[8].oneOf[15].issuer.and[0]: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n - configuration[2].output.path: The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/server\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.\r\n   -> The output directory as **absolute path** (required).\r\n    at validate (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/compiled/schema-utils3/index.js:1:150822)\r\n    at validateSchema (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/compiled/webpack/bundle5.js:28:1412868)\r\n    at create (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/compiled/webpack/bundle5.js:28:1458302)\r\n    at webpack (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/compiled/webpack/bundle5.js:28:1458939)\r\n    at f (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/compiled/webpack/bundle5.js:28:888402)\r\n    at HotReloader.start (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/server/dev/hot-reloader.js:756:51)\r\n    at async DevServer.prepareImpl (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/server/dev/next-dev-server.js:672:9)\r\n    at async NextServer.prepare (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/server/next.js:165:13)\r\n    at async Server.<anonymous> (/home/vignesh/Desktop/Code It!/projects/my-app/node_modules/next/dist/server/lib/render-server.js:124:17) {\r\n  type: 'ValidationError',\r\n  errors: [\r\n    {\r\n      keyword: 'anyOf',\r\n      dataPath: '[0].cache',\r\n      schemaPath: '#/anyOf',\r\n      params: {},\r\n      message: 'should match some schema in anyOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Object],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[0].context',\r\n      schemaPath: '#/definitions/Context/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app'\r\n    },\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[0].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[0].output.path',\r\n      schemaPath: '#/definitions/Path/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app/.next'\r\n    },\r\n    {\r\n      keyword: 'anyOf',\r\n      dataPath: '[1].cache',\r\n      schemaPath: '#/anyOf',\r\n      params: {},\r\n      message: 'should match some schema in anyOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Object],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[1].context',\r\n      schemaPath: '#/definitions/Context/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app'\r\n    },\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[1].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[1].output.path',\r\n      schemaPath: '#/definitions/Path/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/server\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app/.next/server'\r\n    },\r\n    {\r\n      keyword: 'anyOf',\r\n      dataPath: '[2].cache',\r\n      schemaPath: '#/anyOf',\r\n      params: {},\r\n      message: 'should match some schema in anyOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Object],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[2].context',\r\n      schemaPath: '#/definitions/Context/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app'\r\n    },\r\n    {\r\n      keyword: 'oneOf',\r\n      dataPath: '[2].module.rules',\r\n      schemaPath: '#/properties/rules/oneOf',\r\n      params: [Object],\r\n      message: 'should match exactly one schema in oneOf',\r\n      schema: [Array],\r\n      parentSchema: [Object],\r\n      data: [Array],\r\n      children: [Array]\r\n    },\r\n    {\r\n      dataPath: '[2].output.path',\r\n      schemaPath: '#/definitions/Path/absolutePath',\r\n      keyword: 'absolutePath',\r\n      params: [Object],\r\n      message: `The provided value \"/home/vignesh/Desktop/Code It!/projects/my-app/.next/server\" contains exclamation mark (!) which is not allowed because it's reserved for loader syntax.`,\r\n      parentSchema: [Object],\r\n      schema: true,\r\n      data: '/home/vignesh/Desktop/Code It!/projects/my-app/.next/server'\r\n    }\r\n  ],\r\n  schema: {\r\n    definitions: {\r\n      Amd: [Object],\r\n      AmdContainer: [Object],\r\n      AssetFilterItemTypes: [Object],\r\n      AssetFilterTypes: [Object],\r\n      AssetGeneratorDataUrl: [Object],\r\n      AssetGeneratorDataUrlFunction: [Object],\r\n      AssetGeneratorDataUrlOptions: [Object],\r\n      AssetGeneratorOptions: [Object],\r\n      AssetInlineGeneratorOptions: [Object],\r\n      AssetModuleFilename: [Object],\r\n      AssetModuleOutputPath: [Object],\r\n      AssetParserDataUrlFunction: [Object],\r\n      AssetParserDataUrlOptions: [Object],\r\n      AssetParserOptions: [Object],\r\n      AssetResourceGeneratorOptions: [Object],\r\n      AuxiliaryComment: [Object],\r\n      Bail: [Object],\r\n      CacheOptions: [Object],\r\n      CacheOptionsNormalized: [Object],\r\n      Charset: [Object],\r\n      ChunkFilename: [Object],\r\n      ChunkFormat: [Object],\r\n      ChunkLoadTimeout: [Object],\r\n      ChunkLoading: [Object],\r\n      ChunkLoadingGlobal: [Object],\r\n      ChunkLoadingType: [Object],\r\n      Clean: [Object],\r\n      CleanOptions: [Object],\r\n      CompareBeforeEmit: [Object],\r\n      Context: [Object],\r\n      CrossOriginLoading: [Object],\r\n      CssChunkFilename: [Object],\r\n      CssExperimentOptions: [Object],\r\n      CssFilename: [Object],\r\n      CssGeneratorOptions: [Object],\r\n      CssParserOptions: [Object],\r\n      Dependencies: [Object],\r\n      DevServer: [Object],\r\n      DevTool: [Object],\r\n      DevtoolFallbackModuleFilenameTemplate: [Object],\r\n      DevtoolModuleFilenameTemplate: [Object],\r\n      DevtoolNamespace: [Object],\r\n      EmptyGeneratorOptions: [Object],\r\n      EmptyParserOptions: [Object],\r\n      EnabledChunkLoadingTypes: [Object],\r\n      EnabledLibraryTypes: [Object],\r\n      EnabledWasmLoadingTypes: [Object],\r\n      Entry: [Object],\r\n      EntryDescription: [Object],\r\n      EntryDescriptionNormalized: [Object],\r\n      EntryDynamic: [Object],\r\n      EntryDynamicNormalized: [Object],\r\n      EntryFilename: [Object],\r\n      EntryItem: [Object],\r\n      EntryNormalized: [Object],\r\n      EntryObject: [Object],\r\n      EntryRuntime: [Object],\r\n      EntryStatic: [Object],\r\n      EntryStaticNormalized: [Object],\r\n      EntryUnnamed: [Object],\r\n      Environment: [Object],\r\n      Experiments: [Object],\r\n      ExperimentsCommon: [Object],\r\n      ExperimentsNormalized: [Object],\r\n      Extends: [Object],\r\n      ExtendsItem: [Object],\r\n      ExternalItem: [Object],\r\n      ExternalItemFunctionData: [Object],\r\n      ExternalItemValue: [Object],\r\n      Externals: [Object],\r\n      ExternalsPresets: [Object],\r\n      ExternalsType: [Object],\r\n      FileCacheOptions: [Object],\r\n      Filename: [Object],\r\n      FilenameTemplate: [Object],\r\n      FilterItemTypes: [Object],\r\n      FilterTypes: [Object],\r\n      GeneratorOptionsByModuleType: [Object],\r\n      GlobalObject: [Object],\r\n      HashDigest: [Object],\r\n      HashDigestLength: [Object],\r\n      HashFunction: [Object],\r\n      HashSalt: [Object],\r\n      HotUpdateChunkFilename: [Object],\r\n      HotUpdateGlobal: [Object],\r\n      HotUpdateMainFilename: [Object],\r\n      HttpUriAllowedUris: [Object],\r\n      HttpUriOptions: [Object],\r\n      HttpUriOptionsAllowedUris: [Object],\r\n      IgnoreWarnings: [Object],\r\n      IgnoreWarningsNormalized: [Object],\r\n      Iife: [Object],\r\n      ImportFunctionName: [Object],\r\n      ImportMetaName: [Object],\r\n      InfrastructureLogging: [Object],\r\n      JavascriptParserOptions: [Object],\r\n      Layer: [Object],\r\n      LazyCompilationDefaultBackendOptions: [Object],\r\n      LazyCompilationOptions: [Object],\r\n      Library: [Object],\r\n      LibraryCustomUmdCommentObject: [Object],\r\n      LibraryCustomUmdObject: [Object],\r\n      LibraryExport: [Object],\r\n      LibraryName: [Object],\r\n      LibraryOptions: [Object],\r\n      LibraryType: [Object],\r\n      Loader: [Object],\r\n      MemoryCacheOptions: [Object],\r\n      Mode: [Object],\r\n      ModuleFilterItemTypes: [Object],\r\n      ModuleFilterTypes: [Object],\r\n      ModuleOptions: [Object],\r\n      ModuleOptionsNormalized: [Object],\r\n      Name: [Object],\r\n      NoParse: [Object],\r\n      Node: [Object],\r\n      NodeOptions: [Object],\r\n      Optimization: [Object],\r\n      OptimizationRuntimeChunk: [Object],\r\n      OptimizationRuntimeChunkNormalized: [Object],\r\n      OptimizationSplitChunksCacheGroup: [Object],\r\n      OptimizationSplitChunksGetCacheGroups: [Object],\r\n      OptimizationSplitChunksOptions: [Object],\r\n      OptimizationSplitChunksSizes: [Object],\r\n      Output: [Object],\r\n      OutputModule: [Object],\r\n      OutputNormalized: [Object],\r\n      Parallelism: [Object],\r\n      ParserOptionsByModuleType: [Object],\r\n      Path: [Object],\r\n      Pathinfo: [Object],\r\n      Performance: [Object],\r\n      PerformanceOptions: [Object],\r\n      Plugins: [Object],\r\n      Profile: [Object],\r\n      PublicPath: [Object],\r\n      RawPublicPath: [Object],\r\n      RecordsInputPath: [Object],\r\n      RecordsOutputPath: [Object],\r\n      RecordsPath: [Object],\r\n      Resolve: [Object],\r\n      ResolveAlias: [Object],\r\n      ResolveLoader: [Object],\r\n      ResolveOptions: [Object],\r\n      ResolvePluginInstance: [Object],\r\n      RuleSetCondition: [Object],\r\n      RuleSetConditionAbsolute: [Object],\r\n      RuleSetConditionOrConditions: [Object],\r\n      RuleSetConditionOrConditionsAbsolute: [Object],\r\n      RuleSetConditions: [Object],\r\n      RuleSetConditionsAbsolute: [Object],\r\n      RuleSetLoader: [Object],\r\n      RuleSetLoaderOptions: [Object],\r\n      RuleSetLogicalConditions: [Object],\r\n      RuleSetLogicalConditionsAbsolute: [Object],\r\n      RuleSetRule: [Object],\r\n      RuleSetRules: [Object],\r\n      RuleSetUse: [Object],\r\n      RuleSetUseItem: [Object],\r\n      ScriptType: [Object],\r\n      SnapshotOptions: [Object],\r\n      SourceMapFilename: [Object],\r\n      SourcePrefix: [Object],\r\n      StatsOptions: [Object],\r\n      StatsValue: [Object],\r\n      StrictModuleErrorHandling: [Object],\r\n      StrictModuleExceptionHandling: [Object],\r\n      Target: [Object],\r\n      TrustedTypes: [Object],\r\n      UmdNamedDefine: [Object],\r\n      UniqueName: [Object],\r\n      WarningFilterItemTypes: [Object],\r\n      WarningFilterTypes: [Object],\r\n      WasmLoading: [Object],\r\n      WasmLoadingType: [Object],\r\n      Watch: [Object],\r\n      WatchOptions: [Object],\r\n      WebassemblyModuleFilename: [Object],\r\n      WebpackOptionsNormalized: [Object],\r\n      WebpackPluginFunction: [Object],\r\n      WebpackPluginInstance: [Object],\r\n      WorkerPublicPath: [Object]\r\n    },\r\n    title: 'WebpackOptions',\r\n    description: 'Options object as provided by the user.',\r\n    type: 'object',\r\n    additionalProperties: false,\r\n    properties: {\r\n      amd: [Object],\r\n      bail: [Object],\r\n      cache: [Object],\r\n      context: [Object],\r\n      dependencies: [Object],\r\n      devServer: [Object],\r\n      devtool: [Object],\r\n      entry: [Object],\r\n      experiments: [Object],\r\n      extends: [Object],\r\n      externals: [Object],\r\n      externalsPresets: [Object],\r\n      externalsType: [Object],\r\n      ignoreWarnings: [Object],\r\n      infrastructureLogging: [Object],\r\n      loader: [Object],\r\n      mode: [Object],\r\n      module: [Object],\r\n      name: [Object],\r\n      node: [Object],\r\n      optimization: [Object],\r\n      output: [Object],\r\n      parallelism: [Object],\r\n      performance: [Object],\r\n      plugins: [Object],\r\n      profile: [Object],\r\n      recordsInputPath: [Object],\r\n      recordsOutputPath: [Object],\r\n      recordsPath: [Object],\r\n      resolve: [Object],\r\n      resolveLoader: [Object],\r\n      snapshot: [Object],\r\n      stats: [Object],\r\n      target: [Object],\r\n      watch: [Object],\r\n      watchOptions: [Object]\r\n    }\r\n  },\r\n  headerName: 'Webpack',\r\n  baseDataPath: 'configuration'\r\n}\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Route group can not contain `route.ts`?", "description": "Hello!\r\n\r\nAs the title says, I run into this error, when I tried to create a `route.ts` inside a route group:\r\n\r\n```text\r\n- error Error [TypeError]: entries is not iterable\r\n    at getServerCSSForEntries (/<path-to-project>/node_modules/next/dist/server/app-render/get-server-css-for-entries.js:13:25)\r\n    at wrappedRender (/<path-to-project>/node_modules/next/dist/server/app-render/app-render.js:247:88)\r\n    at /<path-to-project>/node_modules/next/dist/server/app-render/app-render.js:1042:16\r\n    at AsyncLocalStorage.run (node:async_hooks:345:14)\r\n    at Object.wrap (/<path-to-project>/node_modules/next/dist/server/async-storage/static-generation-async-storage-wrapper.js:40:24)\r\n    at /<path-to-project>/node_modules/next/dist/server/app-render/app-render.js:1039:85\r\n    at AsyncLocalStorage.run (node:async_hooks:345:14)\r\n    at Object.wrap (</path-to-project>/node_modules/next/dist/server/async-storage/request-async-storage-wrapper.js:77:24)\r\n    at renderToHTMLOrFlight (/<path-to-project>/node_modules/next/dist/server/app-render/app-render.js:1035:67)\r\n    at DevServer.renderHTMLImpl (/<path-to-project>/node_modules/next/dist/server/next-server.js:680:20)\r\n    at /<path-to-project>/node_modules/next/dist/server/next-server.js:669:105\r\n    at NextTracerImpl.trace (/<path-to-project>/node_modules/next/dist/server/lib/trace/tracer.js:86:20)\r\n    at DevServer.renderHTML (/<path-to-project>/node_modules/next/dist/server/next-server.js:669:41)\r\n    at doRender (/<path-to-project>/node_modules/next/dist/server/base-server.js:1030:45)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async cacheEntry.responseCache.get.incrementalCache.incrementalCache (/<path-to-project>/node_modules/next/dist/server/base-server.js:1151:40)\r\n    at async /<path-to-project>/node_modules/next/dist/server/response-cache/index.js:99:36 {\r\n  digest: undefined\r\n}\r\n```\r\n\r\nThis error accours when I created the following file structure:\r\n\r\n```text\r\n- app\r\n  |- (AppLayout)\r\n    |- app\r\n      |- [dynamic1]\r\n        |- reports\r\n          |- [dynamic2]\r\n            |- page.tsx\r\n            |- route.ts\r\n```\r\n\r\nI found a workaround with a following file stucture:\r\n\r\n```text\r\n- app\r\n  |- (AppLayout)\r\n  | |- app\r\n  |   |- [dynamic1]\r\n  |     |- reports\r\n  |       |- [dynamic2]\r\n  |         |- page.tsx\r\n  |- api\r\n    |- app\r\n      |- [dynamic1]\r\n        |- reports\r\n          |- [dynamic2]\r\n            |- route.ts\r\n```\r\n\r\nAm I missing something or the first example is not possible in `next@13.4.1`?\r\nI really hope I don't have to stick with the second example. It's kinda annoying these folders are duplicated.\r\n\r\n"}
{"sentences": "There is a way to create a route that opens a popup in my app?", "description": "Hi Guys, \r\nwith react-router-dom, our login has link, but it opens on a popup, there is a way to do the same with nextjs?\r\n\r\nI need that \"app.com/login\" opens a popup with the form on the screen.\r\n\r\nThanks so much! "}
{"sentences": "Third party scripts in root layout of app folder", "description": "I'm migratig app from Next12 and pages router to Next13 and app router and I'm curious what is the alternative to `_document.tsx`. Before I had all the `beforeInteractive` scripts there but when I'm trying to use that in `layout.tsx`, Next complains about to have those scripts in `_document.tsx`.\r\n\r\nHow can I use something like that in app folder?\r\n\r\n\r\n```jsx\r\n <Script\r\n      defer\r\n      src=\"https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v2.8.0/dist/cookieconsent.js\"\r\n      strategy=\"beforeInteractive\"\r\n      data-cookiecategory=\"necessary\"\r\n/>\r\n```"}
{"sentences": "How to build docker with appDir", "description": "### Summary\r\n\r\nThe [with-docker](https://github.com/vercel/next.js/tree/canary/examples/with-docker) example only shows how to build for `pages` dir but I haven't found and info on how to build for `app` dir. My project uses `src/app`.\r\n\r\nI have tried using the following Dockerfile (adapted from the example)\r\n\r\n```dockerfile\r\nFROM node:18-alpine AS base\r\n\r\nFROM base AS deps\r\nRUN apk add --no-cache libc6-compat\r\nWORKDIR /app\r\n\r\nCOPY package.json package-lock.json* ./\r\nRUN npm ci\r\n\r\nFROM base AS builder\r\nWORKDIR /app\r\nCOPY --from=deps /app/node_modules ./node_modules\r\nCOPY . .\r\n\r\nENV NEXT_TELEMETRY_DISABLED 1\r\n\r\nRUN npm run build\r\n\r\nFROM base AS runner\r\nWORKDIR /app\r\n\r\nENV NODE_ENV production\r\nENV NEXT_TELEMETRY_DISABLED 1\r\n\r\nRUN addgroup --system --gid 1001 nodejs\r\nRUN adduser --system --uid 1001 nextjs\r\n\r\nCOPY --from=builder /app/public ./public\r\n\r\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\r\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\r\n\r\nUSER nextjs\r\n\r\nEXPOSE 3000\r\n\r\nENV PORT 3000\r\n\r\nCMD [\"node\", \"server.js\"]\r\n```\r\nwith the following next.config.js\r\n```javascript\r\nconst nextConfig = {\r\n    output: \"standalone\"\r\n};\r\n```\r\nIt gives the following error when executing `npm run build` at `builder` stage\r\n```\r\nCouldn't find any `pages` or `app` directory. Please create one under the project root\r\n```\r\nSo I have tried creating an empty `pages` directory and I got it to build but when running it, I only get `404`s for every route. I guess that's because It build thinking I was using `pages` instead of `src/app`. Is there any official way to make it work using appDir or am I doing something wrong here?\r\n\r\n### Additional information\r\n\r\nMy project is using `app` dir with `src` dir. So the relevant files are located in `src/app`. It runs ok with `npm run build` - `npm start`.\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Route handler: How to append userId inside request on middlewares", "description": "Hey, I have a middleware that works as authenticator to protect some routes:\r\n\r\n```\r\nexport async function middleware(req: NextRequest) {\r\n  const res = NextResponse.next();\r\n\r\n  const { session } = await getSession();\r\n\r\n  if (!session) {\r\n    return NextResponse.json(\"Not auth\", { status: 400 });\r\n  }\r\n\r\n  // TO DO: append session.user.id to request\r\n\r\n  NextResponse.next();\r\n}\r\n```\r\n\r\nI would like to append inside the request object the `userId` of the current logged user, something like:\r\n\r\n`req.userId = session.user.id`\r\n\r\nIn order to have the userId value inside every protected route\r\n\r\nThanks.\r\n"}
{"sentences": "Best way to style <Link> components using Tailwind", "description": "### Summary\n\nWith Tailwind, `<Link>` components are unstyled by default. I know I could wrap it inside another component to add generic styling, and pass on the props, but I was wondering if there is no better way to just tell Tailwind (or Next.js): whenever you encouter this component, style it like this?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why is there no new \"Who is hiring/wants to be hired\" thread for two months?", "description": "### Summary\n\nLast thread is from May, is this idea abandoned or jobs aren't important any more or job market is completely dead?\r\n\r\nhttps://github.com/vercel/next.js/discussions/49471\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to identify when the next.js hydration finishes hydration on client side?", "description": "We need to change DOM content on certain html elements when the next.js finishes hydration of the page. Is there an event which we can listen to make this change post-hydration? \r\nThank you in advance."}
{"sentences": "Next generates localhost url for opengraph-image", "description": "### Summary\r\n\r\nI have an opengraph-image.jpg file in my app directory for my home page.\r\n\r\nNext is generating a localhost url for my opengraph-image rather than using the production URL, does anyone know how I should resolve this please?\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\nUsing App router\r\nHosted on VPS using docker.\r\n```\r\n"}
{"sentences": "View and modify body in NextJs 12 Middlewares", "description": "Hi, I would like to use Ajv to verify my API request body.\r\nTo do this I would like to use the new Nextjs' feature, Middlewares.\r\nI have read the documents and the reference but have not found how to access the body."}
{"sentences": "Telemetry is catching an error and I cannot know the origin", "description": "### Summary\r\n\r\nwhen doing yarn dev\r\n\r\n```\r\n... A)){E=new Uint8Array(A.buffer.slice(A.byteOffset,A.byteOffset+A.byteLength))}else if(o.isFormDataLike(A)){const e=`----formdata-undici-${Math.random()}`.replace(\".\",\"\").slice(0,32);const t=`--${e}\\r\\nContent-Disposition: form-data`\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \r\n\r\nSyntaxError: Unexpected token '??='\r\n    at wrapSafe (internal/modules/cjs/loader.js:1001:16)\r\n    at Module._compile (internal/modules/cjs/loader.js:1049:27)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)\r\n    at Module.load (internal/modules/cjs/loader.js:950:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:790:12)\r\n    at Module.require (internal/modules/cjs/loader.js:974:19)\r\n    at require (internal/modules/cjs/helpers.js:101:18)\r\n    at Object.<anonymous> (/home/dragonfly/mypro/pawn-path/node_modules/next/dist/telemetry/post-payload.js:17:19)\r\n    at Module._compile (internal/modules/cjs/loader.js:1085:14)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n\r\n```\r\n\r\nhow do I debug this?\r\n\r\nhttps://github.com/vercel/next.js/blob/d8ad0d3cbf69457d3763eaae2ad9b74dbdc27466/packages/next/src/telemetry/post-payload.ts#L6\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "where is the place of using root layout file in electron template?", "description": "### Summary\n\nI use below command created the nextjs with electron template project:\r\n```\r\nnpx create-next-app --example with-electron-typescript electron-nextjs-demo-01\r\n```\r\n\r\nnow the project directories is below:\r\n![image](https://github.com/vercel/next.js/assets/12727582/3a759a34-0a45-446c-a2ca-208bb48ddeda)\r\n\r\nthe default root Layout file is: `renderer/components/Layout.tsx`\r\n\r\nbut I have several questions about it:\r\n\r\nas we know, next.js use page  routing. \r\n\r\n---\r\n\r\nContrast to the next.js web, I can use `pages/_app.tsx` to wrapper the Layout, \r\n![image](https://github.com/vercel/next.js/assets/12727582/b9f1589e-8a9d-4475-aeb2-81cfe02acfc0)\r\n\r\nbut in this case, how to wrapper Layout in the next.js with electron projecy? \r\n\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Improving Style Element Loading Order in Next.js for Enhanced Rendering Stability", "description": "### Summary\n\nHello! I'm developing a plugin for Next.js (SWC) where I check each JSX component for style attributes and write them to a style element within the same component, assigning unique IDs to the styled elements. However, I've encountered an issue. Next.js loads the style elements later than other elements, causing the website to flicker during reloading. Is there a way to make the style elements load earlier?\r\n\r\nI also want to mention that I don't have any other option for my plugin besides writing styles to the style element. If I write them in the style attribute, I can't make them responsive. And I can't write them all to a file because WebAssembly (Wasm) has many restrictions on file read and write operations. If you have any ideas, I would greatly appreciate them. But prioritizing the loading of the style element would be a game-changer for me.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "EROFS: read-only file system, open '/app/.next/package.json'", "description": "### Summary\n\nI am getting EROFS: read-only file system, open '/app/.next/package.json' when deploying nextJS 13 app in a container. I am thinking a read-only file system won't work because we change the .next folder in runtime.\r\nWhat Is the workaround?\r\n\n\n### Additional information\n\n```js\n## Error:\r\n\r\n- ready started server on 0.0.0.0:7442, url: http://localhost:7442\r\n- info Loaded env from /app/.env.development\r\n[Error: EROFS: read-only file system, open '/app/.next/package.json'] {\r\n  type: 'Error',\r\n  errno: -30,\r\n  code: 'EROFS',\r\n  syscall: 'open',\r\n  path: '/app/.next/package.json'\r\n\r\n## dockerfile:\r\n\r\nCOPY . /\r\nWORKDIR /\r\n\r\nRUN chmod +x startup.sh\r\n\r\nENTRYPOINT [\"/startup.sh\"]\r\n\r\n## startup.sh\r\n\r\nif [[ \"$NODE_ENV\" == \"production\" ]]; then\r\n  yarn start\r\nelif [[ \"$NODE_ENV\" == \"development\" ]]; then\r\n  yarn dev\r\n  else\r\n  echo \"Invalid environment specified. Please set the ENVIRONMENT variable to 'production' or 'development'.\"\r\nfi\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Add files to directory during build", "description": "### Summary\n\nI want to automatically add a file to the out directory after building the project, but I found that the file was written during the build process. After the build is completed, the out directory should be overwritten, so my file is gone.\r\n![image](https://github.com/vercel/next.js/assets/49551405/e1163822-6a64-48f3-bd67-592d2aaf1ab0)\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "File Uploader using Route Handlers", "description": "I am very new to next.js. Is it a good idea to build File Handler using Route Handlers to google drive. I have the user upload 100 images at once to google drive folder. My two major concerns are:\r\n\r\n[Payload size limit](https://vercel.com/docs/concepts/limits/overview#serverless-function-payload-size-limit): Since uploading 100 images at once size will definitely greater than 4.5mb\r\n[Execution Timeout](https://vercel.com/docs/concepts/limits/overview#serverless-function-execution-timeout): Uploading 100 images to google drive will take time > 10 seconds.\r\n\r\nTo avoid this, I am thinking of deploying a separate express backend.\r\n\r\nAm I thinking right? \r\n\r\nAppreciate any suggestions!"}
{"sentences": "Memory usage continuously increase under standalone mode", "description": "### Summary\r\n\r\nI upgraded Nextjs from `v12.2` (everything is file)  to `v13.4.7` recently and found that the memory usage of nextjs service have been continuously increasing. The service is overloaded and can't respond the requests when the memory and cpu reach the resource limit.\r\n\r\nMy project is under `standalone` mode and running generated `node server.js` in AWS EKS cluster. \r\n\r\nI observed the memory usage gradually increase from 50MB to 400MB+ via PM2 monitor, and the CPU will reach 70%+ when it's not responding (service is still live at that time).\r\n\r\n![WX20230626-152432@2x](https://github.com/vercel/next.js/assets/90383710/6393051d-a5aa-4509-8538-8860b1dfa119)\r\n\r\nI used Chrome debugger to inspect the service memory. But I have no experience on diagnosing memory problem, spotting nothing helpful information.\r\n\r\n**Comparison with initial heap snapshot (113MB vs 10MB):**\r\n\r\n<img width=\"1514\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/90383710/bfbcefee-08f0-4718-9033-7a7e82bd2b02\">\r\n\r\n**Heap summary:**\r\n\r\n<img width=\"1514\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/90383710/2ccdf3f9-e203-4413-a169-445a20456105\">\r\n\r\n\r\n**Allocation timeline:**\r\n\r\n<img width=\"1514\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/90383710/9827410e-0627-4924-ae86-4c115d535809\">\r\n\r\n**Allocation sampling (Chart)**\r\n\r\n<img width=\"1505\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/90383710/e0b69325-f6f9-4214-8a14-05365306baca\">\r\n\r\n**Allocation sampling (Heavy)**\r\n\r\n<img width=\"1514\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/90383710/fc79593e-5e0a-4eee-b23e-96e2b2d153bd\">\r\n\r\n\r\n\r\nAre there any suggestions (like abnormal memory analyzing or downgrading, etc.) or related issues?\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\n`next info`:\r\n\r\n\r\nOperating System:\r\n      Platform: linux\r\n\r\nBinaries:\r\n      Node: 20.3.0\r\n      npm: 9.6.7\r\n      Yarn: N/A\r\n      pnpm: 8.6.0\r\n    Relevant packages:\r\n      next: 13.4.7\r\n      eslint-config-next: 13.4.6\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.1.3\r\n```\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "[Help] \"use client\" Could not get process.env.NEXT_PUBLIC_APP_ENV", "description": "### Summary\n\nWhen I use \"use client\", I cannot get process.env.NEXT_PUBLIC_APP_ENV.\r\n\r\n<img width=\"949\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/88136242/75d1089c-0c44-4209-b6bf-f1a3576a1dfa\">\r\n\r\n\r\n```json\r\n// [packeage.json] \r\n\r\n  \"dependencies\": {\r\n    \"@headlessui/react\": \"^1.7.15\",\r\n    \"@heroicons/react\": \"^2.0.18\",\r\n    \"@rainbow-me/rainbowkit\": \"^1.0.2\",\r\n    \"@types/node\": \"20.3.1\",\r\n    \"@types/react\": \"18.2.13\",\r\n    \"@types/react-dom\": \"18.2.6\",\r\n    \"autoprefixer\": \"10.4.14\",\r\n    \"clsx\": \"^1.2.1\",\r\n    \"eslint\": \"8.43.0\",\r\n    \"eslint-config-next\": \"13.4.6\",\r\n    \"next\": \"13.4.6\",\r\n    \"next-intl\": \"^2.15.1\",\r\n    \"postcss\": \"8.4.24\",\r\n    \"react\": \"18.2.0\",\r\n    \"react-dom\": \"18.2.0\",\r\n    \"tailwind-merge\": \"^1.13.2\",\r\n    \"tailwindcss\": \"3.3.2\",\r\n    \"typescript\": \"5.1.3\",\r\n    \"viem\": \"^1.1.0\",\r\n    \"wagmi\": \"^1.2.0\"\r\n  }\r\n\r\n```\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "[Next 13.4] Middleware acts like a client component", "description": "Hi, I just upgraded to Next.JS 13.4 (App Router) and created an `src/middleware.ts` file.\r\n\r\nSince I'm using the middleware for validating the user's session, I'm importing `cookies` from `next/headers`. When running, NextJS prints an error (line breaks inserted for legibility):\r\n\r\n```\r\nYou're importing a component that needs next/headers.\r\n\r\nThat only works in a Server Component but one of its parents is marked\r\nwith \"use client\", so it's a Client Component.\r\n\r\n   ,-[/Users/redacted/Developer/redacted/src/middleware.ts:1:1]\r\n 1 | import { cookies } from 'next/headers'\r\n   : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n 2 | import { NextResponse, type NextRequest } from 'next/server'\r\n   `----\r\n\r\nOne of these is marked as a client entry with \"use client\":\r\n  ./src/middleware.ts\r\n```\r\n\r\nBased on the docs[^1], shouldn't middleware run on the server, since it can send a different `NextResponse`?\r\nI'm not entirely sure that this is a bug, but it's certainly surprising behavior.\r\n\r\n---\r\n\r\nDigging a bit deeper, this only seems to happen when sending any kind of HTTP request.\r\n\r\nAt first, I thought that `axios` might be the issue, but replacing it with a `fetch` call yields the same result.\r\nRemoving the request completely makes the middleware work as expected.\r\n\r\nSince server components usually allow requests, this is even more surprising.\r\n\r\n---\r\n\r\n<details>\r\n<summary>If anyone is interested in the code, here's a minimal example</summary>\r\n\r\n```typescript\r\nimport { cookies } from 'next/headers'\r\nimport { NextResponse, type NextRequest } from 'next/server'\r\n\r\nexport async function middleware(request: NextRequest) {\r\n\r\n  // Redirect to login if session cookie is not present\r\n  if (!cookies().has('session')) {\r\n    return NextResponse.redirect(new URL('/login', request.url))\r\n  }\r\n\r\n  // Check session validity with the server\r\n  const session = cookies().get('session')\r\n  const res = await fetch(`https://example.com/session`, {\r\n    method: 'GET',\r\n    headers: {\r\n      'Authorization': `Bearer ${session}`\r\n    },\r\n    cache: 'no-store',\r\n  })\r\n\r\n  // Redirect to login if session is invalid\r\n  if (res.status === 401) {\r\n    return NextResponse.redirect(new URL('/login', request.url))\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n  matcher: '/:path*'\r\n}\r\n```\r\n\r\n</details>\r\n\r\n[^1]: https://nextjs.org/docs/app/building-your-application/routing/middleware"}
{"sentences": "Errors on combination with NodeJs 18/20, Next.js 13.4.6, standalone output and ES Modules", "description": "### Summary\r\n\r\nI am seeing some esmodules errors on following combinations\r\n\r\n- NodeJs 18/20\r\n- Next.js 13.4.6 \r\n    - with standalone output\r\n    - run with server.js in production mode\r\n- ES Modules\r\n    - react-toastify, headless-ui\r\n- Error kind: library errors\r\n   - errors inside library when triggering useRef, useReducer, etc...\r\n  \r\n### Additional information\r\n- Next.js 13.4.4 is okay\r\n- running with `next start` is okay (with warning to use server.js), errors occur only running directly with `node server.js` (which is the point of using standalone output)\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "All pages in app dir throws 'TypeError: createContext only works in Client Components. Add the \"use client\" directive at the top of the file to use it.'", "description": "### Summary\n\nI am moving a NextJS 12 application to a NextJS  13 with app dir. I moved all pages successfully following NextJS upgrade guide here:[( https://beta.nextjs.org/docs/upgrade-guide)] But now that I'm trying to use Next's new fetch api, I 'm getting a trouble. ALL PAGES I was using getStaticProps are throwing me an error `'TypeError: createContext only works in Client Components. Add the \"use client\" directive at the top of the file to use it.'` when I use the new fetch api, but I'm not using a context in it.\r\n\r\n\r\nThis is my component inside app dir =>\r\n\r\n```\r\nimport { BlogAdCard } from '@components/Blog/BlogAdCard'\r\n\r\nimport { motion } from 'framer-motion'\r\nimport Footer from '@components/Footer'\r\n\r\ninterface AdProps {\r\n  id: number\r\n  attributes: {\r\n    thumbnail: {\r\n      data: {\r\n        attributes: {\r\n          formats: {\r\n            thumbnail: {\r\n              url: string\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    title: string\r\n    excerpt: string\r\n    createdAt: Date\r\n    updatedAt: Date\r\n    publishedAt: Date\r\n    slug: string\r\n    callToAction: string\r\n  }\r\n}\r\nasync function getBlogAds() {\r\n  const res = await fetch(\r\n    'apiUrlPlaceholder',\r\n    { next: { revalidate: 60 * 60 * 6 } },\r\n  )\r\n  const blogAds = await res.json()\r\n\r\n  return blogAds\r\n}\r\n\r\nexport default async function Blog() {\r\n  const blogAds: AdProps[] = await getBlogAds()\r\n\r\n  return (\r\n    <div className=\"max-w-screen min-h-screen w-full bg-blueBurBg bg-left-bottom bg-no-repeat\">\r\n      <div className=\"max-w-[1120px] w-full mx-auto pt-14\">\r\n        <header className=\"w-full flex flex-col items-center\">\r\n          <h1 className=\"font-aldrich text-[1.5rem] lg:text-[3.5rem] uppercase\">\r\n            BLOG\r\n          </h1>\r\n          <p className=\"text-center text-white text-2xl mt-6\">\r\n            Curated articles by our experts\r\n          </p>\r\n        </header>\r\n        <motion.ul\r\n          initial=\"hidden\"\r\n          animate=\"visible\"\r\n          className=\"w-full mt-14 flex flex-wrap gap-8\"\r\n        >\r\n          {blogAds?.map(({ attributes, id }) => {\r\n            return <BlogAdCard key={id} id={id} attributes={attributes} />\r\n          })}\r\n        </motion.ul>\r\n      </div>\r\n      <Footer />\r\n    </div>\r\n  )\r\n}\r\n```\n\n### Additional information\n\n```js\nIn my app/layout.tsx I'm using two contexts with 'use client' on its top.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "ISR and On demande revalidation", "description": "### Summary\n\ni'm wokring with Next 13.4.6 but never could achieve ISR with OnDemand revalidation,\r\nnot sure if it's because a bug in Next or i didn't implement it in right way\r\n\r\ncan you help me please achieve ISR\r\nhere is my repo https://github.com/nabildroid/tempocach\r\nwhen you visit /site/hello it get cached\r\nbut wen calling the API /api/reva then revisit multiple time /site/hello, it never get revalidated\n\n### Additional information\n\n_No response_\n\n### Example\n\nhere is my repo https://github.com/nabildroid/tempocach"}
{"sentences": "How to build NextJS using Docker and separated backend under VPN restricted access.", "description": "### Summary\r\n\r\nHello!\r\n\r\nExisting infrastructure:\r\n- nginx\r\n- backend\r\n- frontend\r\n\r\nFrom frontend I'm sending server side request to `nginx:80` thats proxied to backend throw VPN access.\r\nProblem is, when I'm starting `next build` on `^13.4.5`, I gave following error:\r\n\r\n```shell\r\nError occurred prerendering page \"/some-page\". \r\nRead more: https://nextjs.org/docs/messages/prerender-error\r\nThats failing prerender each page what has fetch function.\r\n```\r\n\r\nCould you help me ?\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\nnext^13.4.5\r\nswr\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Modify request objects within middleware function", "description": "I'm learning about the new middleware feature in Nextjs 12. One thing I've been unable to figure out is modifying request objects within a middleware. Is this currently possible? For example, If I want to append a custom header to all apis, can I have a middleware that appends this custom header to the request object before it gets to the API? For this use case, the value of the header is within the request object so middleware seems like a good solution. I've tried the following, which doesn't work (I think this approach usually works with `express`):\r\n\r\n```\r\nimport { NextResponse, NextRequest } from 'next/server'\r\n\r\nexport function middleware(req: NextRequest) {\r\n  req.headers.append('x-custom-header', '123');\r\n  NextResponse.next();\r\n}\r\n```\r\n\r\n\r\n\r\n"}
{"sentences": "About errors using Analytics. Next.js(/app)", "description": "### Summary\n\n<img width=\"670\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/103573547/5c321bc9-a9cb-4b28-98c1-b23f6fe160b5\">\r\n\r\nI'm using Vercel Analytics, and I'm getting these build errors.\r\n\r\n<img width=\"502\" alt=\"image\" src=\"https://github.com/vercel/next.js/assets/103573547/b52a4a00-770e-4b31-aa48-7eefd1c846f0\">\r\n\r\nShouldn't I use the Analytics component in this way?\r\nI'm a beginner and need help. thx.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "useRouter returns undefined locale settings", "description": "Hi everyone!\r\n\r\nI have been having trouble switching languages using next-translate as a localization library through the new 10.0.1 routing features as the ServerRouter return object from useRouter returns undefined parameters for the locales.\r\nThe next-config.js file has been set up for i18n according to the library examples, so I suppose the problem does not origin from there.\r\n\r\nnext-config.js:\r\n\r\n    module.exports = {\r\n\t    i18n: {\r\n\t\t    locales: [\"en\", \"ja-JP\"],\r\n\t\t    defaultLocale: \"en\",\r\n\t    },\r\n    };\r\n\r\n\r\nThis is the response I get when logging router from useRouter():\r\n\r\n    ServerRouter {\r\n    route: '/',\r\n    pathname: '/',\r\n    query: {},\r\n    asPath: '/',\r\n    basePath: '',\r\n    events: undefined,\r\n    isFallback: false,\r\n    locale: undefined,\r\n    locales: undefined,\r\n    defaultLocale: undefined\r\n}\r\n\r\nand here is the component I am trying to use to switch languages:\r\n\r\n    import Link from \"next/link\";\r\n    import useTranslation from \"next-translate/useTranslation\";\r\n    import i18nConfig from \"../../i18n.json\";\r\n    import { useRouter } from \"next/router\";\r\n    const { locales } = i18nConfig;\r\n\r\n    function ChangeLanguage() {\r\n\tconst { t, lang } = useTranslation();\r\n\tconst router = useRouter();\r\n\t\r\n    return (\r\n\t\t<>\r\n\t\t\t{locales.map((lng) => {\r\n\t\t\t\tif (lng === lang) return null;\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Link href=\"/\" locale={lng} key={`btn-change-${lng}`}>\r\n\t\t\t\t\t\t{t(`layout:language-name-${lng}`)}\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t);\r\n\t\t\t})}\r\n\t\t</>\r\n\t    );\r\n    }\r\n\r\nI tried both using Link and useRouter with the same results.\r\nBefore thinking about a bug I was wondering if someone had similar experiences.\r\n\r\nThank you for your time and have a great day everybody!"}
{"sentences": "async RSC Streaming Content after </html> - Abuse of standards?", "description": "When an async RSC uses Suspense, the streamed content (div, script) gets inserted after the &lt;/html&gt; closing tag. This is technically an abuse of standards, as there shouldn't be content there. Is it dangerous to bet on browsers being non-standards-compliant for core functionality?\r\nFurther, I'm trying to capture these insertions for logging and debugging, and I can't seem to catch them. Neither MutationObserver nor DOMNodeInserted get fired when content is inserted after &lt;/html&gt;.\r\nThis seems troubling to me. Isn't there a better way that doesn't break standards?"}
{"sentences": "PageProps not getting updated on client side navigation", "description": "I noticed this behavior with my Nextjs app (ISR). let's say a user lands on the homepage, and then navigates to the about-us page(using Nextjs Link), on the first visit I can see a fetch request in the Network tab for the about-us page (about-us.json), but after that however many times the user change routes, that fetch call is not made again, this way unless the user does a full reload of the website, the user will not see the updated about-us page.\r\n**Updating the user's app without having the user reload the full website** is a critical requirement for my SPA, how can I go about handling this situation? "}
{"sentences": "v13.4.4 socket error", "description": "### Summary\n\nWhen I upgrade from v13.4.3 to v13.4.4 I get a websocket error and the server terminates when I try to load any page.\r\n\r\nThe terminal error message shows:\r\n```bash\r\nnode:events:491\r\n      throw er; // Unhandled 'error' event\r\n      ^\r\n\r\nError: read ECONNRESET\r\n    at TCP.onStreamRead (node:internal/stream_base_commons:217:20)\r\nEmitted 'error' event on Socket instance at:\r\n    at Socket.onerror (node:internal/streams/readable:785:14)\r\n    at Socket.emit (node:events:513:28)\r\n    at emitErrorNT (node:internal/streams/destroy:151:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:116:3)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  errno: -54,\r\n  code: 'ECONNRESET',\r\n  syscall: 'read'\r\n}\r\n\r\nNode.js v18.16.0\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nBrowser client says `WebSockets request was expected`\r\n\r\n<img width=\"580\" alt=\"Screenshot 2023-06-07 at 2 08 15 PM\" src=\"https://github.com/vercel/next.js/assets/5669143/bf21ae4a-1128-4e31-988c-bf98841a3c88\">\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "headers key name that contains underscore is missing", "description": "setting header with a key name that contains underscore is missing.\r\n\r\n```\r\nimport ky from \"ky\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nasync function Page() {\r\n  const refreshToken = cookies().get(\"refresh_token\").value;\r\n  const accessToken = cookies().get(\"access_token\").value;\r\n\r\n  const response = await ky(\r\n    `[API url]`,\r\n    {\r\n      retry: 10,\r\n      hooks: {\r\n        beforeRequest: [\r\n          (request) => {\r\n            request.headers.set(\r\n                \"access-token\",\r\n              cookies().get(\"access_token\").value\r\n            );\r\n            request.headers.set(\r\n              \"refresh_token\",\r\n              cookies().get(\"refresh_token\").value\r\n            );\r\n            request.headers.set(\"x-test-code\", \"cksdn1\");\r\n            request.headers.set(\"x_test_code\", \"cksdn2\");\r\n          },\r\n        ],\r\n      },\r\n    }\r\n  ).json();\r\n  console.log(\"response\", response);\r\n  return <>test</>;\r\n}\r\n\r\nexport default Page;\r\n```\r\n<img width=\"724\" alt=\"스크린샷 2023-06-07 오후 8 59 49\" src=\"https://github.com/vercel/next.js/assets/109129436/4a10e86b-03be-4e81-a2df-50deec1e1433\">\r\n\r\nas you can see above the image, a key which it contains underscore in key name is all missing. Is this intended?\r\n\r\n"}
{"sentences": "Hide Navbar and footer for the Login and Registration page", "description": "I am using _app.js to so that i can diplay navbar and footer to all the pages but i want to disable the for the login page and registration page \r\n \r\n_app.js\r\n`import { useRouter } from 'next/router';`\r\n`function Myapp({Component, pageProps}){`\r\n`const router = useRouter();`\r\n  `const { asPath } = router;`\r\n  `const noNav =  ['/login', '/Registration'];`\r\n  `return(`\r\n   `       {noNav.includes(asPath) ? null : <Nav />}`\r\n  `          <Component {...pageProps} />`\r\n `         {noNav.includes(asPath) ? null : <Footer />}`\r\n`);`\r\n`}`\r\n\r\nThe above example does does hide the nav and footer but \r\nthe issure is with if the path is `localhost/login?sometext` its displaying the navbar \r\nHelp willappreciated 🙏"}
{"sentences": "Why the changes made are not taking effect in nextjs?", "description": "I installed the latest version of nodejs and using vscode. I'm on a new pc. When I was working with nextjs before, and whenever I made any changes in the code, the localhost representation was instantaneous with a one or two seconds delay.\r\n\r\nBut now, no matter the changes I make, it doesn't affect the localhost representation. I created a project using 'npx create-next-app new-app' and started the local server 'npm run dev'. \r\n\r\nI also tried deleting the .next folder and rebuilding the project 'npm run build'. Then starting the server again. Still, the changes made in the code doesn't take effect.\r\n\r\nWhat am I doing wrong?"}
{"sentences": "How to disable redirect on browser when i have an error on my code on nextjs?", "description": "### Summary\n\nHello I try next js today but it's such a hassle because already when i have an error in my code next js switch immediately on my browser for show error but I just haven’t finished writing my code. We can tell a nextjs not to display the error on the browser directly\r\n\r\nI would like it to react and not open the browser when I have an error. I tried to disable eslint and typescript in strict mode but I did not succeed and I found nothing on the internet\r\n\r\nNext js is good but just this system makes me want to stop using it\r\n\r\nThank you for your help\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Type for API route handlers does not exist", "description": "Previously we had `NextApiHandler`, but that doesn't work with the new route handlers from the `app` directory. I made one myself and I'm here to share again!\r\n\r\n```ts\r\nexport type ApiHandler = (req: Request) => Promise<NextResponse> | NextResponse;\r\n```\r\n\r\nSync usage:\r\n\r\n```ts\r\nexport const GET: ApiHandler = (req) => {\r\n  return NextResponse.json(\"hi, you've surfed to a sync api route\");\r\n};\r\n```\r\n\r\nAsync usage:\r\n\r\n```ts\r\nexport const GET: ApiHandler = async (req) => {\r\n  const resp = await fetch(\"https://jsonplaceholder.typicode.com/users\");\r\n  const json = await resp.json();\r\n\r\n  return NextResponse.json(json);\r\n};\r\n```"}
{"sentences": "Error: Hydration failed because the initial UI does not match what was rendered on the server.", "description": "### Summary\r\n\r\nI initialized the project using ```npx create-next-app@latest``` and wrote a very simple structure in src/page.tsx. I don't know why there is an error\r\n ```Error: Hydration failed because the initial UI does not match what was rendered on the server.``` after executing ```yarn run dev```.\r\n\r\nI just need to replace ```<section>``` with ```<div>``` and it works fine, which confuses me a lot...\r\n\r\n\r\n![image](https://github.com/vercel/next.js/assets/66027308/d794bc6a-eaf8-4c24-9e41-ed7a8977ef1c)\r\n\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n```jsx\r\n// Error\r\nexport default function Home() {\r\n  return (<section>\r\n        <p>123</p>\r\n      </section>\r\n  )\r\n}\r\n```\r\n\r\n\r\n```jsx\r\n//  work\r\nexport default function Home() {\r\n  return <div>\r\n    <p>123</p>\r\n  </div>\r\n}\r\n```\r\n_No response_"}
{"sentences": "Cannot use server actions in same file?", "description": "### Summary\r\n\r\nNot if this is a bug or not (in which case I'll open an issue), but I can't seem to use server actions in the same file. I need to import them from a different file.\r\n\r\n### Additional information\r\n\r\n```js\r\nCode:\r\n\r\n\"use server\";\r\n\r\nexport default async function() {\r\n  async function createGame(formData) {\r\n    \"use server\";\r\n    const obj = Object.fromEntries(formData);\r\n    const gameId = obj[\"game\"];\r\n    console.log(gameId);\r\n  }\r\n\r\n  return (\r\n    <>\r\n        {[{id: 1}, {id: 2}, {id: 3}].map((item) => (\r\n        <form action={createGame}>\r\n          <button\r\n            name=\"game\"\r\n            value={item.id}\r\n            type=\"submit\"\r\n            key={item.id}\r\n            className=\"p-4 hover:bg-gray-100 rounded-lg cursor-pointer\"\r\n          >\r\n          </button>\r\n        </form>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n```\r\n\r\n\r\n### Example\r\n\r\nhttps://github.com/vedantroy/nextjs-bug-reproduction-2"}
{"sentences": "NextJs 13.4.0 has two new processes (jest-worker/processChild) running in NODE_ENV=production", "description": "### Summary\n\nNextJs 13.4.0 has two new processes running in NODE_ENV=production. Is that intentional?\r\n\r\n![image](https://user-images.githubusercontent.com/1001175/236312679-4f46e5a1-6aaa-43c2-8a4c-18fac236c29c.png)\r\n\r\nRelated code\r\n\r\n```js\r\n              addToTracedFiles(\r\n                '',\r\n                require.resolve('next/dist/compiled/jest-worker/processChild')\r\n              )\r\n              addToTracedFiles(\r\n                '',\r\n                require.resolve('next/dist/compiled/jest-worker/threadChild')\r\n              )\r\n            }\r\n```\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How do I password protect a page (using basic HTTP auth) in the app router?", "description": "### Summary\n\nI want to password protect a random route in the app router. I don't want anything fancy, like Google login, etc.\r\nI just want to use simple HTTP-based authentication.\r\n\r\nWhat is the easiest way to do this?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error on every first line.", "description": "I setup my next app using create-next-app@latest whenever i am opening any file then an error showed up on very first line in every opened file even if i created new file facing the same issue but project working totally fine even with this error, anyone here who is facing the same error."}
{"sentences": "Next Image: 400 INVALID_IMAGE_OPTIMIZE_REQUEST on deployment", "description": "### Summary\n\nI am hosting some images on Google drive and then displaying it using the Image component. I configured the remotePatterns in the next.config.js file as follows, which works locally in development and build, but not when deployed on Vercel, where there is a 502 error for [GET] /_next/image every time an image is requested.\r\n\r\n``` \r\nremotePatterns: [\r\n\t{\r\n\t\tprotocol: 'https',\r\n\t\thostname: 'drive.google.com',\r\n\t\tport: '',\r\n\t\tpathname: '/**',\r\n\t}\r\n],\r\n```\r\n\r\nHere is an example of a source I would pass to the Image component: \r\nhttps://drive.google.com/uc?id=1tuRp0Bwu2Rrp8bJNwiv0RgNUACl5RS4o\r\n\r\nwhich shows up as `src=\"/_next/image?url=https%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D1tuRp0Bwu2Rrp8bJNwiv0RgNUACl5RS4o&amp;w=640&amp;q=75\"` in the source code.\r\n\r\nIf I put my domain URL before the source, I then see the 400: BAD_REQUEST: INVALID_IMAGE_OPTIMIZE_REQUEST\r\n\r\nIs there a specific way I have to configure to get it to work when deployed as well? \n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Security headers missed in home page (index) but in subpages it's OK", "description": "I have the security headers in the next.config.js file and it's good; I look in the network tabs but all security headers is missed; when I reach /about or /contact there's the security headers doing great!!!\r\n\r\n**response headers at HOME page**\r\nCache-Control: no-store, must-revalidate\r\nConnection: keep-alive\r\nContent-Encoding: gzip\r\nContent-Type: text/html; charset=utf-8\r\nDate: Fri, 03 Feb 2023 20:35:28 GMT\r\nETag: \"7yquv2esn7d1h9\"\r\nKeep-Alive: timeout=5\r\nTransfer-Encoding: chunked\r\nVary: Accept-Encoding\r\nx-nextjs-cache: MISS\r\nX-Powered-By: Next.js\r\n\r\n**security headers in other subpage**\r\nCache-Control: no-store, must-revalidate\r\nConnection: keep-alive\r\nContent-Encoding: gzip\r\nContent-Security-Policy: default-src 'self'; script-src 'self'; child-src lac-eroticvacaction-ui-rich1n-lacapps.vercel.app/; style-src 'self' lac-eroticvacaction-ui-rich1n-lacapps.vercel.app/; font-src 'self';\r\nContent-Type: text/html; charset=utf-8\r\nDate: Fri, 03 Feb 2023 20:35:50 GMT\r\nKeep-Alive: timeout=5\r\nPermissions-Policy: camera=(), microphone=(), geolocation=()\r\nReferrer-Policy: origin-when-cross-origin\r\nTransfer-Encoding: chunked\r\nVary: Accept-Encoding\r\nX-Content-Type-Options: nosniff\r\nX-Frame-Options: DENY\r\nX-Powered-By: Next.js\r\n"}
{"sentences": "Is everyone supposed to be able to upgrade to Next JS 13 right now?", "description": "### Summary\r\n\r\nLooking over the summary it seems like the biggest things are in beta and there's some breaking changes. Is everyone supposed to be able to move over? Or do we kind of have to wait if we're using packages like Emotion/Tailwind/Chakra-UI. I tried upgrading and running the codemods but it didn't really do anything.\r\n\r\nI'm getting an error with the following:\r\n\r\n`yarn build\r\nuncaughtException /home/dev/Documents/mylinks/node_modules/next/dist/compiled/undici/index.js:1\r\n(()=>{var __webpack_modules__={1900:(A,e,t)=>{\"use strict\";const{parseContentType:s}=t(4318);function getInstance(A){const e=A.headers;const t=s(e[\"content-type\"]);if(!t)throw new Error(\"Malformed content type\");for(const s of o){const o=s.detect(t);if(!o)continue;const r={limits:A.limits,headers:e,conType:t,highWaterMark:undefined,fileHwm:undefined,defCharset:undefined,defParamCharset:undefined,preservePath:false};if(A.highWaterMark)r.highWaterMark=A.highWaterMark;if(A.fileHwm)r.fileHwm=A.fileHwm;r.defCharset=A.defCharset;r.defParamCharset=A.defParamCharset;r.preservePath=A.preservePath;return new s(r)}throw new Error(`Unsupported content type: ${e[\"content-type\"]}`)}const o=[t(6104),t(8506)].filter((function(A){return typeof A.detect===\"function\"}));A.exports=A=>{if(typeof A!==\"object\"||A===null)A={};if(typeof A.headers!==\"object\"||A.headers===null||typeof A.headers[\"content-type\"]!==\"string\"){throw new Error(\"Missing Content-Type\")}return getInstance(A)}},6104:(A,e,t)=>{\"use strict\";const{Readable:s,Writable:o}=t(2781);const r=t(6542);const{basename:i,convertToUTF8:n,getDecoder:g,parseContentType:C,parseDisposition:E}=t(4318);const Q=Buffer.from(\"\\r\\n\");const I=Buffer.from(\"\\r\");const B=Buffer.from(\"-\");function noop(){}const a=2e3;const c=16*1024;const h=0;const l=1;const u=2;class HeaderParser{constructor(A){this.header=Object.create(null);this.pairCount=0;this.byteCount=0;this.state=h;this.name=\"\";this.value=\"\";this.crlf=0;this.cb=A}reset(){this.header=Object.create(null);this.pairCount=0;this.byteCount=0;this.state=h;this.name=\"\";this.value=\"\";this.crlf=0}push(A,e,t){let s=e;while(e<t){switch(this.state){case h:{let o=false;for(;e<t;++e){if(this.byteCount===c)return-1;++this.byteCount;const t=A[e];if(f[t]!==1){if(t!==58)return-1;this.name+=A.latin1Slice(s,e);if(this.name.length===0)return-1;++e;o=true;this.state=l;break}}if(!o){this.name+=A.latin1Slice(s,e);break}}case l:{let o=false;for(;e<t;++e){if(this.byteCount===c)return-1;++this.byteCount;const t=A[e];if(t!==32&&t!==9){s=e;o=true;this.state=u;break}}if(!o)break}case u:switch(this.crlf){case 0:for(;e<t;++e){if(this.byteCount===c)return-1;++this.byteCount;const t=A[e];if(y[t]!==1){if(t!==13)return-1;++this.crlf;break}}this.value+=A.latin1Slice(s,e++);break;case 1:if(this.byteCount===c)return-1;++this.byteCount;if(A[e++]!==10)return-1;++this.crlf;break;case 2:{if(this.byteCount===c)return-1;++this.byteCount;const t=A[e];if(t===32||t===9){s=e;this.crlf=0}else{if(++this.pairCount<a){this.name=this.name.toLowerCase();if(this.header[this.name]===undefined)this.header[this.name]=[this.value];else this.header[this.name].push(this.value)}if(t===13){++this.crlf;++e}else{s=e;this.crlf=0;this.state=h;this.name=\"\";this.value=\"\"}}break}case 3:{if(this.byteCount===c)return-1;++this.byteCount;if(A[e++]!==10)return-1;const t=t`\r\n\r\nWhich unfortunately doesn't say much at all. Definitely interested in knowing if someone else had this same thing come up.\r\n\r\n### Additional information\r\n\r\nI was able to upgrade to React 18 so there is at least that.\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Development server gets stuck at \"Creating an optimized production build\" step", "description": "### Summary\n\nI am trying to set up a Next.js project by following the installation tutorial. I ran npx create-next-app@latest successfully, but when I try to run the development server using npm run dev, the build process gets stuck at the \"Creating an optimized production build\" step:\r\n```powershell\r\n- info Linting and checking validity of types\r\n- info Using wasm build of next-swc\r\n- info Creating an optimized production build ... (it stops here)\r\n\r\n``` \r\nSteps to reproduce:\r\n\r\nRun npx create-next-app@latest to create a new Next.js project.\r\nChange to the project directory with cd <project-name>.\r\nRun npm run dev to start the development server.\r\nExpected behavior: The development server starts successfully and listens for requests.\r\n\r\nActual behavior: The build process gets stuck at the \"Creating an optimized production build\" step, and the server doesn't start.\r\n\r\nEnvironment: \r\nNext.js version: v13.4.3\r\nNode.js version: v18.15.0\r\nnpm version: 9.5.0\r\n  Operating System: Windows 11\r\n\r\n\n\n### Additional information\n\n```js\nI have tried the following steps to resolve the issue, but none of them worked:\r\n\r\nRemoved the /.next folder.\r\nEnsured that the development server is not running in the background.\r\nRemoved both the /.next and /node_modules folders and reinstalled the dependencies.\r\nAny help would be appreciated.\r\n\r\nThere's no error message, it just stops.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "Render different views at the same route based on authentication status?", "description": "I've scoured the docs and haven't found anything claiming to handle a requirement of mine. I've got an app that I would like to render a logged out experience at the root level `/` or render the application if the user is authenticated. \r\n\r\nIs this possible with App Router? Hoping someone can point me in the right direction! :)"}
{"sentences": "[app directory] Routing doesn't work inside not-found.tsx component", "description": "### Summary\r\n\r\nNone of the routing options are working inside the built-in [not-found](https://beta.nextjs.org/docs/api-reference/file-conventions/not-found) component.\r\n\r\n### Additional information\r\n\r\n\r\nNavigate to `/asd` to get redirected to the default `not-found` component. Click on `Back Home` button. Nothing happens.\r\n\r\nI can make the navigation work by using `window.location.href` instead, but this doesn't feel right.\r\n\r\n\r\n\r\n### Example\r\n\r\nhttps://stackblitz.com/edit/vercel-next-js-wjgc8g?file=app%2Fnot-found.tsx"}
{"sentences": "Rust is getting an unknown error.", "description": "### Summary\n\nI developed a web service on Windows using Next.js.\r\nI deploy it to Linux, start it in dev mode, and after a while Rust's fatal error stops the web service.\r\n```rust\r\n- event compiled successfully in 36 ms (79 modules)\r\nthread '<unnamed>' panicked at 'OS can't spawn worker thread: Resource temporarily unavailable (os error 11)', /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-1.25.0/src/runtime/scheduler/multi_thread/worker.rs:365:13\r\nstack backtrace:\r\n   0:     0x7ef6476cf54c - <unknown>\r\n   1:     0x7ef646fc83ae - <unknown>\r\n   2:     0x7ef6476a4694 - <unknown>\r\n   3:     0x7ef6476d0c4f - <unknown>\r\n   4:     0x7ef6476d084f - <unknown>\r\n   5:     0x7ef6476d18eb - <unknown>\r\n   6:     0x7ef6476d13a4 - <unknown>\r\n   7:     0x7ef6476d130c - <unknown>\r\n   8:     0x7ef6476d12e1 - <unknown>\r\n   9:     0x7ef646ea01f2 - <unknown>\r\n  10:     0x7ef64728bd48 - <unknown>\r\n  11:     0x7ef646f3112a - <unknown>\r\n  12:     0x7ef6472a08b0 - <unknown>\r\n  13:     0x7ef646e9c987 - <unknown>\r\n  14:     0x7ef646f403dc - <unknown>\r\n  15:     0x7eff2e7c7c43 - _ZN6v8impl12_GLOBAL__N_123FunctionCallbackWrapper6InvokeERKN2v820FunctionCallbackInfoINS2_5ValueEEE\r\n  16:     0x7eff2ec4df2d - _ZN2v88internal12_GLOBAL__N_119HandleApiCallHelperILb1EEENS0_11MaybeHandleINS0_6ObjectEEEPNS0_7IsolateENS0_6HandleINS0_10HeapObjectEEESA_NS8_INS0_20FunctionTemplateInfoEEENS8_IS4_EENS0_16BuiltinArgumentsE\r\n  17:     0x7eff2ec4e1d3 - _ZN2v88internal21Builtin_HandleApiCallEiPmPNS0_7IsolateE\r\n  18:     0x7eff2ea64439 - Builtins_CEntry_Return1_DontSaveFPRegs_ArgvOnStack_BuiltinExit\r\nfatal runtime error: failed to initiate panic, error 5\r\n```\r\n\r\nI don't know if it's relevant, but other than that, using next build fails to spawn.\r\n```javascript\r\n> bot@0.1.0 build\r\n> next build\r\n\r\n- info Loaded env from /home/secret_path/secret_path/secret_path/secret_path/.env\r\n- info Linting and checking validity of types\r\n- info Creating an optimized production build ..<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\n\r\n🌼 daisyUI components 2.51.6  https://daisyui.com\r\n  ✔︎ Including:  base, components, 29 themes, utilities\r\n  ❤︎ Support daisyUI:  https://opencollective.com/daisyui\r\n\r\n- info Creating an optimized production build .<w> [webpack.cache.PackFileCacheStrategy] Caching failed for pack: Error: Unable to snapshot resolve dependencies\r\n- info Creating an optimized production build\r\n- info Compiled successfully\r\nuncaughtException Error: spawn /home/secret_path/miniconda3/bin/node EAGAIN\r\n    at ChildProcess._handle.onexit (node:internal/child_process:283:19)\r\n    at onErrorNT (node:internal/child_process:476:16)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  errno: -11,\r\n  code: 'EAGAIN',\r\n  syscall: 'spawn /home/secret_path/miniconda3/bin/node',\r\n  path: '/home/secret_path/miniconda3/bin/node',\r\n  spawnargs: [\r\n    '/home/secret_path/secret_path/secret_path/secret_path/node_modules/next/dist/compiled/jest-worker/processChild.js'\r\n  ]\r\n}\r\n- info Collecting page data .\r\n```\r\n\r\nI don't know the cause because the error is inside Rust or the package\n\n### Additional information\n\n```js\nOperating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #164~18.04.1-Ubuntu SMP Tue Apr 4 00:20:20 UTC 2023\r\n    Binaries:\r\n      Node: 18.13.0\r\n      npm: 9.6.7\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.4.3\r\n      eslint-config-next: 13.4.3\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.0.4\r\n\r\nwarn  - Latest canary version not detected, detected: \"13.4.3\", newest: \"13.4.4-canary.1\".\r\n        Please try the latest canary version (`npm install next@canary`) to confirm the issue still exists before creating a new issue.\r\n        Read more - https://nextjs.org/docs/messages/opening-an-issue\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "not-found.tsx <Link> not working", "description": "### Summary\n\nI'm experiencing this weird behaviour what in my `not-found.tsx` `<Link>` components are not working.\r\n\r\nThis is actually not all the time, but for only for pages that really dont exist. For example `/this-page-does-not-exist`. If I go to `/this-page-exists` and in there I use the `notFound()` method, the NotFound page is displayed, but this time, links are working.\r\n\r\nMaybe related to this: Also the `meta` viewport is missing under the exact same condition (I added it now to the root layout as a workaround).\r\n\r\nSeems like `notFound()` pages work differently from `/reallydontexist` pages.\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error: Minified React error #321", "description": "Hello ! \r\n\r\nI got the problem why the gtag implementation. First of all the Gtag does not work (obvious) and my complilator throw me \r\n\r\n> Error: Minified React error #321  \r\n\r\n[more informations](https://stackoverflow.com/questions/62026031/useeffect-error-minified-react-error-321)\r\n\r\nAs I explain in the stack overFlow thread I tried to do the same example as Zeit with typeScript\r\n\r\n// pages/index.tsx\r\n\r\n`import Head from \"next/head\";`\r\n`import { landingPagePoleList } from \"../XXX/XXX/landingPage\";`\r\n`import LandingPage from \"../../XXX/XXX//component/LandingPage\";`\r\n`import { GetStaticProps } from \"next\";`\r\n`import { IPoleList } from \"../components/LandingPage/../XXX/XXX//typeScriptInclude\";`\r\n``\r\n`export const getStaticProps: GetStaticProps = async () => {`\r\n  `const landingPagePoleData: IPoleList = await landingPagePoleList();`\r\n  `return {`\r\n    `props: {`\r\n      `landingPagePoleData,`\r\n    `},`\r\n  `};`\r\n`};`\r\n``\r\n`export default function HomePage({ landingPagePoleData }) {`\r\n  `return (`\r\n    `<div>`\r\n      `<Head>`\r\n        `<title>Next APP</title>`\r\n        `<link`\r\n          `rel=\"shortcut icon\"`\r\n          `href=\"https://XXX/favicon_walter_color.png\"`\r\n        `/>`\r\n      `</Head>`\r\n      `<LandingPage landingPagePoleData={landingPagePoleData} />`\r\n    `</div>`\r\n  `);`\r\n`}`\r\n\r\n\r\n// pages/_app.ts\r\n`import Router from 'next/router';`\r\n\r\n`import React, { useEffect, ReactElement } from 'react';`\r\n\r\n`import { AppProps } from 'next/app';`\r\n`import '../CSS/index.css';`\r\n`import * as gtag from '../lib/gtag';`\r\n`import '@brainhubeu/react-carousel/lib/style.css';`\r\n\r\n`export default function  App({ Component, pageProps }: AppProps): ReactElement {`\r\n`\tuseEffect(() => {`\r\n`\t\tconst handleRouteChange = (url: string) => {`\r\n`\t\t\tgtag.pageview(url);`\r\n`\t\t};`\r\n`\t\tRouter.events.on('routeChangeComplete', handleRouteChange);`\r\n`\t\treturn () => {`\r\n`\t\t\tRouter.events.off('routeChangeComplete', handleRouteChange);`\r\n`\t\t};`\r\n`\t}, []);`\r\n\r\n`\treturn <Component {...pageProps} />;`\r\n`}`\r\n\r\npackage.json\r\n>{\r\n  \"name\": \"showcase-frontend\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@brainhubeu/react-carousel\": \"^1.15.3\",\r\n    \"@emotion/styled\": \"^10.0.27\",\r\n    \"@emotion/styled-base\": \"^10.0.31\",\r\n    \"@fortawesome/fontawesome-svg-core\": \"^1.2.28\",\r\n    \"@fortawesome/free-solid-svg-icons\": \"^5.13.0\",\r\n    \"@fortawesome/react-fontawesome\": \"^0.1.9\",\r\n    \"@kunukn/react-collapse\": \"^2.2.8\",\r\n    \"axios\": \"^0.19.2\",\r\n    \"dotenv\": \"^8.2.0\",\r\n    \"import-jsx\": \"^4.0.0\",\r\n    \"isomorphic-unfetch\": \"^3.0.0\",\r\n    \"next\": \"^9.4.1\",\r\n    \"react\": \"^16.13.1\",\r\n    \"react-dom\": \"^16.13.1\",\r\n    \"react-router-dom\": \"^5.2.0\",\r\n    \"react-spring\": \"^8.0.27\",\r\n    \"request\": \"^2.79.0\",\r\n    \"sitemap\": \"^6.1.4\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/node\": \"^14.0.1\",\r\n    \"@types/react\": \"^16.9.35\",\r\n    \"globby\": \"^11.0.0\",\r\n    \"prettier\": \"^2.0.5\",\r\n    \"typescript\": \"^3.9.2\"\r\n  }\r\n}\r\n\r\n\r\nAt the 'next build' that's the error throwed \r\n\r\n>Automatically optimizing pages .(node:763) ExperimentalWarning: The fs.promises API is experimental\r\n(node:762) ExperimentalWarning: The fs.promises API is experimental\r\n(node:761) ExperimentalWarning: The fs.promises API is experimental\r\nAutomatically optimizing pages .Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:10945:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:10950:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:7133:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:1023:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:1026:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:1031:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:1031:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:1041:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/index.js:899:16)\r\n    Error occurred prerendering page \"/\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nAutomatically optimizing pages ..Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21744:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21749:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:14938:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:899:16)\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21744:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21749:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:14938:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:899:16)\r\n    Error occurred prerendering page \"/XXX/XXX/syndic-copropriete\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nError occurred prerendering page \"/XXX/XXX/aides-renovation-energetique\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nAutomatically optimizing pages ..Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21744:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:21749:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:14938:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/[formationUrl]/[courseCode].js:899:16)\r\n    Error occurred prerendering page \"/XXX\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21165:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21170:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:14443:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:899:16)\r\n    Error occurred prerendering page \"/XXX/inscription\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nAutomatically optimizing pages .Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21165:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21170:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:14443:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:899:16)\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21165:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:21170:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:14443:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/inscription.js:899:16)\r\n    Error occurred prerendering page \"/XXX/inscription\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20913:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20918:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:14649:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:899:16)\r\n    Error occurred prerendering page \"/XXX/merci\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nError occurred prerendering page \"/XXX/inscription\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:6809:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:6814:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:4227:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:907:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:910:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:915:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:915:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:925:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:461:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/_error.js:783:16)\r\n    Error occurred prerendering page \"/404\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nAutomatically optimizing pages ..Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20913:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20918:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:14649:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:899:16)\r\n    Error occurred prerendering page \"/XXX/merci\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\nAutomatically optimizing pages ...Error: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n    at Z (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20913:404)\r\n    at module.exports.viRO.exports.useEffect (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:20918:356)\r\n    at App (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:14649:29)\r\n    at d (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1114:498)\r\n    at $a (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1117:16)\r\n    at a.b.render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:476)\r\n    at a.b.read (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1122:18)\r\n    at renderToString (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:1132:364)\r\n    at render (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:577:16)\r\n    at Object.renderPage (/XXX/XXX/XXX/XXX/.next/serverless/pages/[domainCode]/merci.js:899:16)\r\n    Error occurred prerendering page \"/XXX/merci\". Read more: https://err.sh/next.js/prerender-error\r\nError: Minified React error #321; visit https://reactjs.org/docs/error-decoder.html?invariant=321 for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\r\n> Build error occurred\r\nError: Export encountered errors\r\n    at _default (/usr/local/lib/node_modules/next/dist/export/index.js:19:1164)\r\n    at process._tickCallback (internal/process/next_tick.js:68:7)\r\nAutomatically optimizing pages .%                                                            \r\n\r\nI would like to understand what wrong... can someone help me to understand what I missed ?"}
{"sentences": "In the React Native Web example project, how do I set pageProps for each page", "description": "### Summary\r\n\r\nIn the React Native Web example project, how do I set pageProps for each page\r\n\r\n[with-react-native-web](https://github.com/vercel/next.js/tree/canary/examples/with-react-native-web)\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "draftMode() not working in localhost (next dev)", "description": "I have followed all steps in the [docs](https://nextjs.org/docs/app/building-your-application/configuring/draft-mode) but its not working in localhost. I have found this note as well.\r\n\r\n```\r\nNote: To test Draft Mode locally over HTTP, your browser will need to allow third-party cookies and local storage access.\r\n```\r\n\r\nI have checked in Chrome and it already allows third party cookies and localstorage. But when I check `isEnabled` its still false and I cannot see any cookie with `__prerender_bypass `\r\n\r\nAny help?"}
{"sentences": "npx create-next-app@latest failed!", "description": "### Summary\n\nIt always throw \"No matching version found for @next/env@13.4.2.\" when I run `npx create-next-app@latest`, please help!\n\n### Additional information\n\n```js\nnpx create-next-app@latest                                              ✔  5849  16:41:03\r\nNeed to install the following packages:\r\n  create-next-app@13.4.2\r\nOk to proceed? (y) y\r\n✔ What is your project named? … say-to-libai-ai\r\n✔ Would you like to use TypeScript with this project? … No / Yes\r\n✔ Would you like to use ESLint with this project? … No / Yes\r\n✔ Would you like to use Tailwind CSS with this project? … No / Yes\r\n✔ Would you like to use `src/` directory with this project? … No / Yes\r\n✔ Use App Router (recommended)? … No / Yes\r\n✔ Would you like to customize the default import alias? … No / Yes\r\n✔ What import alias would you like configured? … @/*\r\nCreating a new Next.js app in /Users/moose/Projects/2023/say-to-libai-ai.\r\n\r\nUsing npm.\r\n\r\nInitializing project with template: app\r\n\r\n\r\nInstalling dependencies:\r\n- react\r\n- react-dom\r\n- next\r\n- typescript\r\n- @types/react\r\n- @types/node\r\n- @types/react-dom\r\n- eslint\r\n- eslint-config-next\r\n\r\nnpm ERR! code ETARGET\r\nnpm ERR! notarget No matching version found for @next/env@13.4.2.\r\nnpm ERR! notarget In most cases you or one of your dependencies are requesting\r\nnpm ERR! notarget a package version that doesn't exist.\r\n\r\nnpm ERR! A complete log of this run can be found in: /Users/moose/.npm/_logs/2023-05-12T08_47_26_575Z-debug-0.log\r\n\r\nAborting installation.\r\n  npm install --save-exact --save react react-dom next typescript @types/react @types/node @types/react-dom eslint eslint-config-next has failed.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "got the error [ERR_INTERNAL_ASSERTION]: TypeError [ERR_INVALID_THIS]: Value of \"this\" must be of type EventTarget", "description": "### Summary\r\n\r\ni'm using App Router in NextJS.\r\ni just try logging Request(or NextRequest) object in API Router.\r\n\r\nbut i got the error when i just call the \r\n`console.log(request)`\r\n\r\n```\r\n- error Error [ERR_INTERNAL_ASSERTION]: TypeError [ERR_INVALID_THIS]: Value of \"this\" must be of type EventTarget\r\n    at new NodeError (node:internal/errors:387:5)\r\n    at EventTarget.[nodejs.util.inspect.custom] (node:internal/event_target:759:13)\r\n    at formatValue (node:internal/util/inspect:806:19)\r\n    at formatProperty (node:internal/util/inspect:1939:11)\r\n    at formatRaw (node:internal/util/inspect:1055:9)\r\n    at formatValue (node:internal/util/inspect:841:10)\r\n    at inspect (node:internal/util/inspect:365:10)\r\n    at formatWithOptionsInternal (node:internal/util/inspect:2292:40)\r\n    at formatWithOptions (node:internal/util/inspect:2154:10)\r\n    at console.value (node:internal/console/constructor:339:14)\r\n    at console.log (node:internal/console/constructor:376:61)\r\n    at GET (webpack-internal:///(sc_server)/./src/app/api/route.ts:8:13)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:244:43)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:109:36)\r\n    at NoopContextManager.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:360:30)\r\n    at ContextAPI.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:30:58)\r\n    at NoopTracer.startActiveSpan (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:953:34)\r\n    at ProxyTracer.startActiveSpan (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:993:36)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:98:107)\r\n    at NoopContextManager.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:360:30)\r\n    at ContextAPI.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:30:58)\r\n    at NextTracerImpl.trace (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:98:32)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:232:53)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at Object.wrap (webpack-internal:///(sc_server)/./node_modules/next/dist/server/async-storage/static-generation-async-storage-wrapper.js:39:24)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:186:97)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at Object.wrap (webpack-internal:///(sc_server)/./node_modules/next/dist/server/async-storage/request-async-storage-wrapper.js:77:24)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:185:75)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at AppRouteRouteModule.execute (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:182:56)\r\n    at AppRouteRouteModule.handle (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:333:41)\r\n    at RouteHandlerManager.handle (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/future/route-handler-managers/route-handler-manager.js:28:29)\r\n    at doRender (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:936:58)\r\n    at cacheEntry.responseCache.get.incrementalCache.incrementalCache (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:1162:34)\r\n    at /Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/response-cache/index.js:99:42\r\n    at ResponseCache.get (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/response-cache/index.js:149:11)\r\n    at DevServer.renderToResponseWithComponentsImpl (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:1081:53)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\nThis is caused by either a bug in Node.js or incorrect usage of Node.js internals.\r\nPlease open an issue with this stack trace at https://github.com/nodejs/node/issues\r\n\r\n    at new NodeError (node:internal/errors:387:5)\r\n    at Function.fail (node:internal/assert:20:9)\r\n    at handleMaxCallStackSize (node:internal/util/inspect:1550:10)\r\n    at formatRaw (node:internal/util/inspect:1063:12)\r\n    at formatValue (node:internal/util/inspect:841:10)\r\n    at inspect (node:internal/util/inspect:365:10)\r\n    at formatWithOptionsInternal (node:internal/util/inspect:2292:40)\r\n    at formatWithOptions (node:internal/util/inspect:2154:10)\r\n    at console.value (node:internal/console/constructor:339:14)\r\n    at console.log (node:internal/console/constructor:376:61)\r\n    at GET (webpack-internal:///(sc_server)/./src/app/api/route.ts:8:13)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:244:43)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:109:36)\r\n    at NoopContextManager.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:360:30)\r\n    at ContextAPI.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:30:58)\r\n    at NoopTracer.startActiveSpan (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:953:34)\r\n    at ProxyTracer.startActiveSpan (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:993:36)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:98:107)\r\n    at NoopContextManager.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:360:30)\r\n    at ContextAPI.with (webpack-internal:///(sc_server)/./node_modules/next/dist/compiled/@opentelemetry/api/index.js:30:58)\r\n    at NextTracerImpl.trace (webpack-internal:///(sc_server)/./node_modules/next/dist/server/lib/trace/tracer.js:98:32)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:232:53)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at Object.wrap (webpack-internal:///(sc_server)/./node_modules/next/dist/server/async-storage/static-generation-async-storage-wrapper.js:39:24)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:186:97)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at Object.wrap (webpack-internal:///(sc_server)/./node_modules/next/dist/server/async-storage/request-async-storage-wrapper.js:77:24)\r\n    at eval (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:185:75)\r\n    at AsyncLocalStorage.run (node:async_hooks:330:14)\r\n    at AppRouteRouteModule.execute (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:182:56)\r\n    at AppRouteRouteModule.handle (webpack-internal:///(sc_server)/./node_modules/next/dist/server/future/route-modules/app-route/module.js:333:41)\r\n    at RouteHandlerManager.handle (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/future/route-handler-managers/route-handler-manager.js:28:29)\r\n    at doRender (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:936:58)\r\n    at cacheEntry.responseCache.get.incrementalCache.incrementalCache (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:1162:34)\r\n    at /Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/response-cache/index.js:99:42\r\n    at ResponseCache.get (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/response-cache/index.js:149:11)\r\n    at DevServer.renderToResponseWithComponentsImpl (/Users/riky/Documents/workspace/nextjs-sample/node_modules/next/dist/server/base-server.js:1081:53)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5) {\r\n  code: 'ERR_INTERNAL_ASSERTION'\r\n}\r\n```\r\n\r\nI also tried changing the nodejs version, but the same problem occurs. \r\n`v16.14.2`\r\n`v16.20.0`\r\n\r\nany ideas?\r\n\r\n### Additional information\r\n\r\n```js\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.4.0: Mon Mar  6 21:00:41 PST 2023; root:xnu-8796.101.5~3/RELEASE_ARM64_T8103\r\n    Binaries:\r\n      Node: 16.20.0\r\n      npm: 8.19.4\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.4.2\r\n      eslint-config-next: 13.4.2\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.0.4\r\n```\r\n\r\n\r\n### Example\r\n\r\n\r\n`/src/app/api/route.ts`\r\n```\r\nimport { NextApiHandler } from 'next';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  console.log(request);\r\n\r\n  return NextResponse.json({ hello: 'world' });\r\n}\r\n```\r\n"}
{"sentences": "Get the original page route in components.", "description": "### Summary\n\nHi,\r\n\r\nI'm writing an application in Next v12.\r\nI'd like to get the original page route in components.\r\nFor example, when rendering `pages/blog/[slug].ts` I would like to get `\"blog/[slug]\"` not the actual path `blog/a`.\r\nIs there any way to do so? \r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Why is HMR being called on production?", "description": "I don't know why but since updating NextJS to latest (`12.2.4`) it's decided to start calling HMR on our production environment?\r\n\r\n<img width=\"558\" alt=\"Screenshot 2022-08-10 at 15 46 07\" src=\"https://user-images.githubusercontent.com/3974301/183932949-e4944d59-f828-4780-9085-d61040ce3661.png\">\r\n\r\nI am convinced there is a memory leak in NextJS somewhere. I also noticed crazy increases in memory usage causing our app to crash?\r\n\r\n<img width=\"637\" alt=\"Screenshot 2022-08-10 at 15 51 56\" src=\"https://user-images.githubusercontent.com/3974301/183934905-f92b3f52-f68c-4fca-b632-d2fd1de19cbb.png\">\r\n\r\n"}
{"sentences": "keepAliveTimeout with standalone output", "description": "this is taken from the doc, it is unclear how we can use this option when running with a `output: 'standalone'` build.\r\nI'm starting up the production server with `CMD [\"node\", \"server.js\"]`\r\n\r\n---\r\n\r\n<img width=\"663\" alt=\"Screen Shot 2023-05-07 at 23 13 22\" src=\"https://user-images.githubusercontent.com/12844/236702829-2d807be5-b838-425e-bf12-fa390d2619be.png\">\r\n\r\n"}
{"sentences": "Server Component set & delete cookies", "description": "Is there a way to delete or set cookies in server components yet? without a middleware or server actions?"}
{"sentences": "Since I upgraded to Next 13, using jose jwtVerify inside the nextjs middleware is causing an error called ERR_JWS_INVALID.", "description": "### Summary\n\nwhen using this line of code\r\n\r\n` const userToken = req?.cookies.get('user_token')`\r\n` const decoded = await verify(userToken, process.env.JWT_KEY)`\r\n`console.log(decoded)`\r\n\r\nReturns this \r\n` [JWSInvalid: Compact JWS must be a string or Uint8Array] {`\r\n`  code: 'ERR_JWS_INVALID',`\r\n`  name: 'JWSInvalid'`\r\n`}`\r\n\r\nIf instead of using userToken inside the verify function, like this: \r\n` const decoded = await verify(userToken.value, process.env.JWT_KEY)`\r\n\r\nIt works just fine, but it was not like that when I was using nextjs 12\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Nextjs Image component stops working when configuring basePath", "description": "### Run `next info` (available from version 12.0.8 and up)\r\n\r\n      Operating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n    Binaries:\r\n      Node: 17.3.0\r\n      npm: 8.3.0\r\n      Yarn: 1.22.4\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 12.0.10\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n\r\n### What version of Next.js are you using?\r\n\r\n12.0.10\r\n\r\n### What version of Node.js are you using?\r\n\r\n17.3.0\r\n\r\n### What browser are you using?\r\n\r\nChrome\r\n\r\n### What operating system are you using?\r\n\r\nmacOS\r\n\r\n### How are you deploying your application?\r\n\r\nnext start / next dev\r\n\r\n### Describe the Bug\r\n\r\nAdding basePath to nextjs config, seems to make the public folder assets unavailable.\r\nThe basePath prefix is added, but the images are not shown.\r\n\r\nThe attached github repo is a created nextjs from docs `yarn create next-app --typescript` + added a one liner of basePath\r\nhttps://github.com/omerman/nextjs-image-basePath-bug\r\n**As you can see in this repo, the vercel icon at the bottom of the page does not show**\r\n\r\n### Expected Behavior\r\n\r\nThe basePath should work well with Image component\r\n\r\n### To Reproduce\r\n\r\nAs mentioned, \r\n1. `yarn create next-app --typescript`\r\n2. added a one liner of basePath\r\n3. run the app in either dev or prod mode (build & start)\r\n\r\n\r\nSee https://github.com/omerman/nextjs-image-basePath-bug\r\n**As you can see in this repo, the vercel icon at the bottom of the page does not show**"}
{"sentences": "Set cookies in server actions", "description": "### Summary\n\nAccording this [docs](https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options) we can use set() method in server actions, but we can not.\r\nI have an error Property 'set' does not exist on type 'ReadonlyRequestCookies'\r\nbug?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Vercel deployment with sanity: Cannot find module 'sanity' or its corresponding type declarations.", "description": "Anyone got an idea why I have this issue?\r\n<img width=\"1201\" alt=\"SCR-20221230-qvx\" src=\"https://user-images.githubusercontent.com/32783686/210101252-1f9ea30b-0701-4e95-807c-0eb832b1e05a.png\">\r\n"}
{"sentences": "Can I buy Next.js merch?", "description": "hey! where can i buy those awesome items that were on the keynote background? namely the bug black triangle and the coffe mug with the next (vercel?) logo?\r\n\r\nthanks!"}
{"sentences": ".env.local is not reading any vaule", "description": "### Summary\n\ni dont know why me .env.local file is not reading any vaule\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "from nextjs 13.3.0 to 13.3.1-canary.11 socket.io not working", "description": "### Summary\r\n\r\nWith the same code, socket IO only works on Nextjs version 13.2.4. As for any other version that shows error number 404 for the page http://localhost:3000/socket.io/?EIO= I hope to solve the problem quickly and see the following code: https://github.com/flipUp02/nextjs-socket.io\r\n\r\n\r\n13 3 1-canary 11\r\n![13 3 1-canary 11](https://user-images.githubusercontent.com/80167896/232636454-a9a9ddd4-2a7b-4e58-a32a-716b129a5004.png)\r\n\r\n\r\n13.2.4\r\n![13 2 4](https://user-images.githubusercontent.com/80167896/232636520-d54ae6e3-fcb9-4e5a-81f5-88d324588281.png)\r\n\r\nplease fix this\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nhttps://github.com/flipUp02/nextjs-socket.io"}
{"sentences": "NextJS 13.3.0 breaks the Socket.io implementation", "description": "### Summary\n\nI have a working Socket.io implementation in NextJS 13.0.6 but when I updated the project to the new 13.3.0 version my front end does not connect to my socket.io server any more and I don't know why...\r\nI am Including my the 3 files that I am using, index.tsx the main page of the project, socket.ts wich gos into pages/api and the custom typescript types. The git repo that I linked is using NextJS version 13.0.6 so you might want to change it to 13.3.0.\r\n\r\nThank you for your help :D\r\n\n\n### Additional information\n\n```js\nindex.tsx:\r\n\r\nimport Head from \"next/head\";\r\nimport styles from \"@/styles/Home.module.css\";\r\nimport { useEffect } from \"react\";\r\nimport { io, type Socket } from \"socket.io-client\";\r\nimport type {\r\n  ServerToClientEvents,\r\n  ClientToServerEvents,\r\n} from \"@/types/socketCustomTypes\";\r\nimport { Button } from \"@mui/material\";\r\n\r\nlet socket: Socket<ServerToClientEvents, ClientToServerEvents> | null = null;\r\n\r\nexport default function Home(): JSX.Element {\r\n  useEffect(() => {\r\n    if (!socket) {\r\n      void fetch(\"/api/socket\");\r\n      socket = io();\r\n\r\n      socket.on(\"connect\", () => {\r\n        console.log(\"connected\");\r\n      });\r\n\r\n      socket.on(\"hello\", (msg: string) => {\r\n        console.log(\"hello\", msg);\r\n      });\r\n\r\n      socket.on(\"userServerConnection\", () => {\r\n        console.log(\"a user connected (client)\");\r\n      });\r\n\r\n      socket.on(\"userServerDisconnection\", (socketid: string) => {\r\n        console.log(socketid);\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      if (socket) {\r\n        socket.disconnect();\r\n        socket = null;\r\n      }\r\n    };\r\n  }, []);\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>Online chatrooms</title>\r\n        <meta name=\"description\" content=\"Generated by create next app\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n        <link rel=\"icon\" href=\"/favicon.ico\" />\r\n      </Head>\r\n      <main className={styles.main}>\r\n        <Button\r\n          variant=\"contained\"\r\n          onClick={() => socket?.emit(\"hello\", \"kitty\")}\r\n        >\r\n          Send Hello {'\"'}Kitty{'\"'}\r\n        </Button>\r\n        <Button variant=\"contained\">Create a chatroom</Button>\r\n        <Button variant=\"contained\">Join a chatroom</Button>\r\n      </main>\r\n    </>\r\n  );\r\n}\r\n\r\nsocket.ts:\r\n\r\nimport { Server } from \"socket.io\";\r\nimport type { NextApiRequest } from \"next\";\r\nimport type {\r\n  NextApiResponseWithSocket,\r\n  ServerToClientEvents,\r\n  ClientToServerEvents,\r\n} from \"@/types/socketCustomTypes\";\r\n\r\nconst ioHandler = (req: NextApiRequest, res: NextApiResponseWithSocket) => {\r\n  if (!res.socket.server.io) {\r\n    console.log(\"*First use, starting socket.io\");\r\n\r\n    const io = new Server<ClientToServerEvents, ServerToClientEvents>(\r\n      res.socket.server\r\n    );\r\n\r\n    io.on(\"connection\", (socket) => {\r\n      socket.broadcast.emit(\"userServerConnection\");\r\n      socket.on(\"hello\", (msg) => {\r\n        socket.emit(\"hello\", msg);\r\n      });\r\n      socket.on(\"disconnect\", () => {\r\n        console.log(\"A user disconnected\");\r\n        socket.broadcast.emit(\"userServerDisconnection\", socket.id);\r\n      });\r\n    });\r\n\r\n    res.socket.server.io = io;\r\n  } else {\r\n    console.log(\"socket.io already running\");\r\n  }\r\n  res.end();\r\n};\r\n\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n};\r\n\r\nexport default ioHandler;\r\n\r\ncustom types:\r\n\r\nimport type { Server as HTTPServer } from \"http\";\r\nimport type { NextApiResponse } from \"next\";\r\nimport type { Socket as NetSocket } from \"net\";\r\nimport type { Server as IOServer } from \"socket.io\";\r\n\r\nexport interface SocketServer extends HTTPServer {\r\n  io?: IOServer | undefined;\r\n}\r\n\r\nexport interface SocketWithIO extends NetSocket {\r\n  server: SocketServer;\r\n}\r\n\r\nexport interface NextApiResponseWithSocket extends NextApiResponse {\r\n  socket: SocketWithIO;\r\n}\r\n\r\nexport interface ServerToClientEvents {\r\n  userServerConnection: () => void;\r\n  hello: (msg: string) => void;\r\n  userServerDisconnection: (socketid: string) => void;\r\n}\r\n\r\nexport interface ClientToServerEvents {\r\n  hello: (msg: string) => void;\r\n  userServerConnection: () => void;\r\n  userServerDisconnection: (socketid: string) => void;\r\n}\n```\n\n\n### Example\n\nhttps://github.com/CasimirColas/online-chatrooms"}
{"sentences": "[app beta] How to show the \"loading.js\" while \"page.js\" fetches?", "description": "### Summary\r\n\r\nI have this simple file structure, im trying to simulate the loading.\r\n\r\napp/\r\n---`layout.tsx`\r\n---`page.tsx`\r\n---characters/\r\n------`layout.tsx`\r\n------`page.tsx`\r\n------`loading.tsx`\r\n\r\nlayout.tsx\r\n```tsx \r\ntype Params = {\r\n  children: React.ReactNode;\r\n};\r\n\r\nexport default function CharactersLayout({ children }: Params) {\r\n  return (\r\n    <div>\r\n      Characters list\r\n      <div>{children}</div>\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\n\r\npage.tsx\r\n```tsx\r\nfunction simulateServerResponse<T>(delay: number, data: T): Promise<T> {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve(data);\r\n    }, delay);\r\n  });\r\n}\r\n\r\nexport default async function CharactersList() {\r\n  const data = await simulateServerResponse(5000, {\r\n    chars: [1, 2, 3, 4, 5, 6, 7, 8],\r\n  });\r\n\r\n  return <div>A list of characters {data.chars}</div>;\r\n}\r\n```\r\n\r\nloading.tsx\r\n```tsx\r\nexport default function CharactersLoading() {\r\n  return <div>loading...</div>;\r\n}\r\n\r\n```\r\n\r\nBut when going to the `/characters` path, the site starts loading without showing the loading component.\r\nThe site changed from `app/page.tsx` directly to `app/characters/page.tsx` skipping the loading.\r\n![image](https://user-images.githubusercontent.com/43274372/230735912-282d6d79-d399-42d8-b8d3-8eb9950a7734.png)\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "GCP deployment - Module not found: Can't resolve '@public/badge/badge-xxl-execellent.png', for png/svg file", "description": "### Summary\n\nHey, everyone! Can someone help me with this, I've been stuck with this error since morning, couldn't understand what is happening. I'm deploying my next js application through gcp cloud build and Firebase, and for some reason, build fails and logs the error like this for images like png/svg - \r\n\r\n```Module not found: Can't resolve '@public/badge/badge-xxl-execellent.png'```\r\n\r\n![image](https://user-images.githubusercontent.com/78067517/235216019-1a298702-1f43-44c6-95bd-bf28c3267e25.png)\r\n![image](https://user-images.githubusercontent.com/78067517/235217153-e0812ed8-27eb-43e5-889a-1d2f5adf0b84.png)\r\n\r\n\r\nEven though I have all these images inside my public folder and all works fine in local server. This error comes while deployment which makes the deployment fails. \r\n\r\nThe log message also states - ``` Build failed because of webpack errors; Error ID: 1a2262f3 ```, and I don't have such webpack configuration in my project.\r\n\r\nHere is my ```next.config.js``` file - \r\n\r\n```\r\n/** @type {import('next').NextConfig} */\r\n\r\nmodule.exports = {\r\n    reactStrictMode: true,\r\n    swcMinify: false,\r\n    distDir: \".next\",\r\n    images: {\r\n        domains: [\r\n            \"storage.googleapis.com\",\r\n            \"firebasestorage.googleapis.com\",\r\n            \"crunchbase-production-res.cloudinary.com\",\r\n            \"lh3.googleusercontent.com\",\r\n        ],\r\n    },\r\n};\r\n\r\n```\r\n\r\nThat's the ```tsconfig.json``` - \r\n\r\n```\r\n{\r\n\t\"compilerOptions\": {\r\n\t\t\"target\": \"es6\",\r\n\t\t\"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\r\n\t\t\"allowJs\": true,\r\n\t\t\"skipLibCheck\": true,\r\n\t\t\"strict\": true,\r\n\t\t\"forceConsistentCasingInFileNames\": true,\r\n\t\t\"noEmit\": true,\r\n\t\t\"esModuleInterop\": true,\r\n\t\t\"module\": \"esnext\",\r\n\t\t\"moduleResolution\": \"node\",\r\n\t\t\"resolveJsonModule\": true,\r\n\t\t\"isolatedModules\": true,\r\n\t\t\"jsx\": \"preserve\",\r\n\t\t\"incremental\": true,\r\n\t\t\"baseUrl\": \".\",        \r\n\t\t\"paths\": {\r\n\t\t\t\"@components/*\": [\"components/*\"],\r\n\t\t\t\"@styles/*\": [\"styles/*\"],\r\n\t\t\t\"@public/*\": [\"public/*\"],\r\n\t\t\t\"@services/*\": [\"services/*\"],\r\n\t\t\t\"@config/*\": [\"config/*\"],\r\n\t\t\t\"@HOC/*\": [\"HOC/*\"],\r\n\t\t\t\"@Context/*\": [\"Context/*\"],\r\n\t\t\t\"@api/*\": [\"api/*\"]\r\n\t\t}\r\n\t},\r\n\t\"include\": [\r\n\t\t\"next-env.d.ts\",\r\n\t\t\"**/*.ts\",\r\n\t\t\"**/*.tsx\",\r\n\t\t\"Context/UserContext.js\",\r\n\t\t\"global.d.ts\",\r\n\t\t\"config/admin-config.js\"\r\n\t],\r\n\t\"exclude\": [\"./node_modules\"]\r\n}\r\n```\r\n\r\nI'm using the latest next.js and react.js version - \r\n\r\n```\r\n\"next\": \"^13.1.2\",    \r\n\"react\": \"^18.2.0\",   \r\n\"react-dom\": \"^18.2.0\",    \r\n\"react-router-dom\": \"^6.0.1\",\r\n\r\n\r\n// dev dependencies\r\n \"devDependencies\": {\r\n        \"@types/node\": \"16.11.10\",\r\n        \"@types/react\": \"^18.0.18\",\r\n        \"@types/react-dom\": \"^18.0.6\",\r\n        \"eslint\": \"8.20.0\",\r\n        \"eslint-config-next\": \"^13.1.2\"\r\n    },\r\n```\r\n\r\nPlease can someone help me on this and make me understand why it is happening? \n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "NEXT_PUBLIC_VERCEL_URL for auto deploy on Vercel", "description": "### Summary\r\n\r\nHello, I don't understand how can I use `NEXT_PUBLIC_VERCEL_URL` in my application? The [documentation](https://vercel.com/docs/concepts/projects/environment-variables/system-environment-variables#framework-environment-variables) states that this variable is automatically available. However, I am getting undefined in the browser.\r\n\r\nI also tried specifying `next.config.js` as `env`, but that doesn't work either:\r\n```js\r\n// next.config.js\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  experimental: {\r\n    appDir: true,\r\n  },\r\n  output: 'standalone',\r\n  swcMinify: true,\r\n  env: {\r\n    NEXT_PUBLIC_VERCEL_URL: process.env.VERCEL_URL,\r\n  },\r\n}\r\n\r\nmodule.exports = nextConfig\r\n```\r\n\r\nIn my code it works only for server rendering, but \"undefined\" type for client:\r\n```js\r\n// configs/index.ts\r\nexport const VERCEL_URL = process.env.VERCEL_URL ?? process.env.NEXT_PUBLIC_VERCEL_URL\r\n```\r\n\r\nI also tried to specify in .env.production. In such a case, I get an empty string \"\" instead of the expected VERCEL_URL:\r\n```env\r\n# .env.production\r\nNEXT_PUBLIC_VERCEL_URL=${VERCEL_URL}\r\n```\r\n\r\nIdeally, I would like to automatically receive the current url both on the server and on the client, without manually specifying this information somewhere.\r\n\r\nNow for deployment, I manually execute the commands `vercel build` and `vercel deploy --prebuilt`. But I also have a config for github actions to trigger the deployment automatically. In this case, I can not manually change VERCEL_URL somewhere. I need link for every deploy (not only production and preview links).\r\n\r\nI would be grateful for any ideas and tips. \r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Example\r\n\r\nhttps://github.com/paqstd-dev/vercel-public-url-implementation"}
{"sentences": "How to instantly refetch dynamic data in Next.js 13", "description": "### Summary\n\nWhat is the best way to instantly refetch dynamic data in Next.js 13?\r\n\r\nFor example, if you want to show two of the same lists of todos from a database and a button that adds a todo to the database, all on the same page. How to make sure that if you add a todo, the lists are instantly refreshing? You can save the todos locally, add the new todo to the locally saved todos and map over the local todos to show the lists, but isn't there a better way?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "`assetPrefix` returns 404 for` _next/*` files.", "description": "## Goal\r\n\r\n**Serve `_next/static` and other `_next/*` files with `assetPrefix:'${country}` which is being passed from `.env` file.**\r\n\r\n##Package.json\r\n\r\n```\r\n\"build\": \"next build\",\r\n\"analyze\": \"ANALYZE=true yarn build\",\r\n\"start\": \"next start\",\r\n\"dev\": \"yarn clean && concurrently \\\"yarn dev:pc\\\" \\\"yarn dev:sp\\\" -n \\\"pc,sp\\\" -c \\\"green.dim,yellow.dim\\\"\",\r\n\"dev:pc\": \"UA=pc next dev -p 3000\",\r\n\"dev:sp\": \"UA=sp next dev -p 3002\",\r\n\"debug\": \"NODE_OPTIONS='--inspect' next dev\",\r\n```\r\n## Background\r\nI am migrating from using express custom server to **not using one.** \r\n**Nextjs Version**: 9.5.2\r\n**Local server**: `yarn dev` OR `yarn build && yarn start`\r\n\r\n## Problem\r\nFor **images**, it works fine\r\n```\r\n <Image\r\n    src={`/${country}/static/images/download-1.png`}\r\n    alt={\"download-1\"}\r\n/>\r\n```\r\n\r\nBut, on the network call for `_next` files, I **get 404.**\r\n\r\n![image](https://user-images.githubusercontent.com/45579756/92449826-92c6b900-f1f5-11ea-9b7e-9a2d2ed00692.png)\r\n\r\n**Doesn't work =>** `http://dev.gu-global.com/jp/_next/static/chunks/pages/_app.js?ts=1599552331624`\r\n**Works ==>** `http://dev.gu-global.com/_next/static/chunks/pages/_app.js?ts=1599552331624`\r\n\r\nHere, If I remove the country(jp), it works. (I do like to point out that with an nginx configuration, I can make it work. But I would like not to use nginx for this.)\r\n\r\n## Question\r\n1) If I add assetPrefix, its supposed to add the prefix and fetch the file without further configurations, right?\r\n\r\nCould someone help with this? Or if you need more info, lemme know.\r\ncc: @timneutkens \r\n"}
{"sentences": "How to use built-in fetch in tests?", "description": "Following https://nextjs.org/blog/next-9-4#improved-built-in-fetch-support announcement about built-in fetch support, I removed my usage of `isomorphic-unfetch`.\r\n\r\nBut, in my test files, `fetch` isn't available.\r\n\r\nHow would you fix that? How can I load the built-in Next.js `fetch` module?"}
{"sentences": "next/image hostname error", "description": "I get the following error using an image with an absolute url: `Invalid src prop ({REDACTED URL}) on 'next/image', hostname is not configured under images in your 'next.config.js'`.\r\n\r\nNothing in the doc mentions how to configure that. Any hints ?\r\n\r\nAnd congrats on the v10 release !\r\n"}
{"sentences": "Uploading file through router API for multi tenancy", "description": "### Summary\n\nI have problem with multi tenancy and sending file through api router. \r\n\r\nWhen I try to upload a file to \"/api/hello.ts\"\r\nmy network hangs in \"pending\" status and I don't get any response. I don't even get into the hello.ts file.\r\n\r\nWhen I try to upload the same request using \"postman\" I got a response.\r\n\r\nI am trying to upload a 1.5MB file. I added the config to hello.ts to upload big file 25mb\r\n\r\nI am using version 12.3.1. I also tried to do it on version 13 and it works there.\r\n\r\nAlso if I remove middleware.ts everything works fine.\r\n\r\nIf i uploading small file 12b it is works\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://codesandbox.io/p/sandbox/dank-dust-026e43?file=%2Fpages%2F_sites%2F%5BsiteBrandId%5D%2Findex.tsx"}
{"sentences": "How can I use app dir to perform the same behavior as getServerSideProps?", "description": "### Summary\n\nI read on [this page](https://beta.nextjs.org/docs/api-reference/fetch) that adding the ```{ cache: 'no-store' }``` option to fetch would result in the same behavior as getServerSideProps, but when deployed, SSR did not work.\r\nOn the localhost, fetch was running on every request.\r\nHere is the code, am I missing something to do SSR?\r\n```tsx\r\nexport default async function Search({ searchParams }) {\r\n  const query = searchParams.q;\r\n  const res = await fetch(\r\n    `${process.env.NEXT_PUBLIC_APP_URL}/search/api?q=${query}`,\r\n    {\r\n      cache: \"no-store\",\r\n    }\r\n  );\r\n  const { data } = await res.json();\r\n\r\n  return (\r\n    <div>\r\n      {data.length > 0 && (\r\n        <ul>\r\n          {data.map((d) => {\r\n            const { id, title } = d;\r\n            return <li key={id}>{title}</li>;\r\n          })}\r\n        </ul>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n```\n\n### Additional information\n\n```js\nThe version of Next.js I am using is 13.3.1-canary.4.\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "How can I write stream or buffer to client in route in appdir?", "description": "### Summary\n\nI cannot find a way to write buffer data to client through https://beta.nextjs.org/docs/api-reference/response\r\nI want write buffer or stream to client. \r\nIs there a way or am I missing something?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Prevent a XML file in the public folder from being wrapped in HTML", "description": "### Summary\n\nI've created a sitemap.xml file and added it to the public folder of my project. However, when I access it and inspect the code I can see it's wrapped in HTML. For that same reason Google is not accepting the URL saying it's in HTML instead of XML.\r\n\r\nSo the question is: How to ensure the file is shown in XML instead of HTML?\n\n### Additional information\n\n_No response_\n\n### Example\n\nhttps://www.surfphotosmate.com.au/sitemap.xml"}
{"sentences": "next.js app deployment errror", "description": "### Summary\n\nI changed a bunch of things in my app, but the most noteworthy is that I added user authentication using Firebase, which is what I assume caused the issue.\r\nI'm also using GraphQL for blogs, had an issue with that before, but resolved it.\r\nNothing else should cause this issue should it?\r\n\r\nThis is my github repo: https://github.com/AhmadNasser04/LBS\r\nThis is the link to the currently deployed version: https://lbs-one.vercel.app/\r\nImage of Error: https://gyazo.com/6d722499dbfd57affbf5c9b255cb1102\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Redirect based on users ip", "description": "I've got a project I've built out in next js and the client has just told me that we can't have the site viewable by visitors from certain locations, due to no compete agreement. \r\n\r\nIs there a way I can put a hard redirect from the host 'Vercel' so anyone making a request in say 'france' will be redirected to the French site? \r\n\r\nOr do I need to send a request from server side to an IP lookup API and then feed that into a context on the client? \r\n\r\nIdeally looking for the most simple solution. I would like to keep all SSG pages for optimal speed if possible. \r\n\r\nMany thanks in advance "}
{"sentences": "OG tags are not working with dynamic content", "description": "OG tags used by Facebook and Twitter when sharing page are not working\r\n\r\n## To Reproduce\r\n\r\nI tried two things. Using ```next-seo``` library to set OG tags. Thing is that dynamic content in OG tags is not displayed at all using ```next-seo```. Currently I don't have sample code for ```next-seo``` but I used same one that is displayed in [DOCS](https://www.npmjs.com/package/next-seo). \r\n\r\nNext I tried with ```Head``` from ```next/head``` but it doesn't seem to work\r\n\r\n```jsx\r\n<Head>\r\n  <title>{review.title}</title>\r\n  <meta name=\"description\" content={review.review.pageDescription}/>\r\n  <meta name=\"og:url\" content={`https://website.com${router.asPath}`}/>\r\n  <meta name=\"og:title\" content={review.title}/>\r\n  <meta name=\"og:description\" content={review.content.slice(0, 50)}/>\r\n  <meta name=\"og:image\" content={review.featuredImage.sourceUrl}/>\r\n  <meta name=\"og:site_name\" content='site_name'/>\r\n</Head>\r\n```\r\n\r\n## Expected behavior\r\n\r\n```<meta>``` should look like this \r\n ```html\r\n<meta property=\"og:image\" content=\"https://website.com/images/image.jpg/>\r\n```\r\nbut instead it looks like this \r\n```html\r\n<meta property=\"og:image\"/>\r\n```\r\n\r\n## Screenshots\r\n\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n## System information\r\n\r\n- OS: Windows\r\n- Version of Next.js: 9.3\r\n- Version of Node.js: 12.16.1\r\n\r\n## Additional context\r\n\r\nAdd any other context about the problem here.\r\n"}
{"sentences": "Release in 6-12 months - App or Pages?", "description": "### Summary\n\nIf I start a new project today that will take between 6 to 12 months to develop. Should I go for pages that is stable now or the app router that is currently in beta?\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Where does NextJS store statically generated pages?", "description": "I read in the official NextJS tutorial that NextJS generates HTML files from my pages at build time and stores them so that they can be sent immediately to clients when they are requested for (static generation).\r\n\r\nWhere does NextJS store these completed HTML pages? Is there any way I can find them to see what they look like?"}
{"sentences": "load js file from public folder", "description": "### Summary\n\nHello!\r\nThe question is, how can I import js files from a public folder?\r\n\r\nMy actions:\r\n\r\n1) using the webpack plugin I copy the files I need\r\n_(when I start the project, I see the files I need in the folder .next/public/worky)_\r\n```\r\nconfig.plugins.push(new CopyPlugin({\r\n     patterns: [\r\n           {\r\n               from: \"./node_modules/worky/src\",\r\n               to: \"./public/worky\",\r\n           },\r\n      ],\r\n}))\r\n```\r\n\r\n2) I try to load the script using `<Script />` from (next/script)\r\n\r\n3) always get 404 file\r\n\r\n\n\n### Additional information\n\n```js\n\"next\": \"^13.1.6\",\n```\n\n\n### Example\n\n_No response_"}
{"sentences": "cant access dynamically uploaded images without dev or build", "description": "I am making a blog like dev.to where most of the stuff is dynamic especially images. The WYSIWYG editor uploads the images through \"/api/\" based route to the \"public\" folder. \r\n\r\nNow , in **dev** mode, when i upload the image, its fine, accessible but then when i run the app after building it using `npm run build` and then try to upload image using WYSIWYG editor, the app shows 404 on accessing the newly uploaded image. What could be the reason ? i am doing SSR only.\r\n\r\nHowever, now after uploading the image, if i then rebuild my app, i can then access the image. Is this normal ?"}
{"sentences": "Api route can't serve files after upgrading Ubuntu and docker", "description": "### Summary\n\nI am not sure where to ask.  This can be related to docker / OS itself.   I am hoping someone had similar issues in the past.\r\n\r\nI have 2 servers.  Ubuntu 20 and Ubuntu 22.   Since I installed Ubuntu 22 later, docker and docker compose are newer versions (as the descriptions below).\r\n\r\nWhen I do run the EXACT same `/pages/api/pdf.ts` file, on Ubuntu 20, I get the PDF on my browser.  However on Ubuntu 22, I get empty JSON data `{}` coming back from the server.\r\n\r\n<img width=\"672\" alt=\"Screenshot 2023-03-28 at 14 28 33\" src=\"https://user-images.githubusercontent.com/809378/228137117-73b280b8-f08b-4346-9366-35b81d0a2591.png\">\r\n\r\nSince I am using docker, it's based on the same image, same package versions, and same everything, except the docker and OS.\r\n\r\nCan anybody take a guess where to look to find the cause?\r\n\r\n### client\r\n```\r\nOSX 13.2.1 (22D68)\r\n\r\nGoogle chrome\r\nVersion 111.0.5563.64 (Official Build) (arm64)\r\n```\r\n\r\n### Dockerfile\r\n```\r\nFROM node:lts-alpine\r\nENV LANG C.UTF-8\r\nRUN apk update && apk upgrade\r\nWORKDIR /app\r\n```\r\n\r\n### package.json\r\n```\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"next\",\r\n  },\r\n  \"dependencies\": {\r\n    \"next\": \"^13.2.4\",\r\n    \"react\": \"^18.2.0\",\r\n    \"react-dom\": \"^18.2.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/node\": \"18.15.10\",\r\n    \"@types/react\": \"18.0.30\",\r\n    \"typescript\": \"5.0.2\"\r\n  }\r\n}\r\n```\r\n\r\n### /pages/api/pdf.ts\r\n```ts\r\nimport type { NextApiRequest, NextApiResponse } from \"next\"\r\n\r\nexport default async (req: NextApiRequest, res: NextApiResponse) => {\r\n  try {\r\n    return fetch(\r\n      \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\"\r\n    ).then((response) => {\r\n      res.setHeader(\"Content-Type\", \"application/pdf\")\r\n      res.send(response.body)\r\n    })\r\n  } catch (e) {\r\n    console.log(\"e:\", e)\r\n    res.status(404).end()\r\n  }\r\n}\r\n```\r\n\r\n## Environment that works (A)\r\n```\r\n$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 20.04.4 LTS\r\nRelease:        20.04\r\nCodename:       focal\r\n\r\n$ docker -v\r\nDocker version 20.10.17, build 100c701\r\n\r\n$ docker-compose -v\r\ndocker-compose version 1.29.1, build c34c88b2\r\n```\r\n\r\n\r\n## Environment that doesn't work (B)\r\n```\r\n$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 22.04.2 LTS\r\nRelease:        22.04\r\nCodename:       jammy\r\n\r\n$ docker -v\r\nDocker version 23.0.1, build a5ee5b1\r\n\r\n$ docker compose version\r\nDocker Compose version v2.16.0\r\n```\r\n\r\n\r\n# When it works (env A)\r\n<img width=\"1437\" alt=\"Screenshot 2023-03-28 at 14 30 08\" src=\"https://user-images.githubusercontent.com/809378/228137349-84fdedb4-76c9-4234-b72d-db3221b0628a.png\">\r\n\r\n# When it doesn't work (env B)\r\n<img width=\"1404\" alt=\"Screenshot 2023-03-28 at 14 12 31\" src=\"https://user-images.githubusercontent.com/809378/228135817-9390bf3f-5b01-40e8-944e-08f38886078b.png\">\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "How to Redirect in getStaticProps", "description": "Hi, I need to check the existence of a JWT token to navigate the user to the correct route. I put my token validation stuff in `getStaticProps` function. How can I redirect the user to another route in `getStaticProps` function? I have tried this, but it's not working:\r\n\r\n```ts\r\nasync (context: NextPageContext): Promise<{ props: { token: string } }> => {\r\n  const { token } = nextCookies(context);\r\n  console.log(context) // {}\r\n  if (!token) {\r\n    if (typeof window === 'undefined') {\r\n      // ❌ I get no 'res' key on context for redirection so this throws an error\r\n      context.res.writeHead(302, { Location: '/phone-get' });\r\n      context.res.end();\r\n    } else {\r\n      /* ❌\r\n        this wouldn't work as well. Because the router is not available here.\r\n        The next router only works on the client side\r\n      */\r\n      Router.replace('/phone-get');\r\n    }\r\n  }\r\n\r\n  return {\r\n    props: { token },\r\n  };\r\n};\r\n```"}
{"sentences": "Next.js does respect revalidate config with i18n features enabled", "description": "Hi,\r\n\r\nWe have an index page running on `pages/index.tsx`, it returns props from an API call and has revalidate set to 1. Furthermore, we have `i18n` configuration in `next.config.js`. Apart from that, we include `styled-components` in `_document.tsx` like in the official example and add some metatags in `_app.tsx`.\r\n\r\nWe want the index page revalidate every second, regardless of locale config. Though, the revalidate prop is not respected and ISR is disabled. Removing the `i18n` config from `next.config.js` resolves the issue.\r\n\r\nAnyone who has a clue as to why this is happening? Any help is welcome.\r\n\r\nThe `next` version is `next@10.0.7`.\r\n\r\nExample build output `next build`:\r\n\r\n```\r\n[build:production:next    ] Page                                                           Size     First Load JS\r\n[build:production:next    ] ┌ ● /                                                          16.5 kB        85.8 kB\r\n[build:production:next    ] ├   /_app                                                      0 B            66.4 kB\r\n[build:production:next    ] ├ ○ /404                                                       3.16 kB        72.5 kB\r\n[build:production:next    ] └ ○ /error-test                                                3.66 kB        70.1 kB\r\n[build:production:next    ] + First Load JS shared by all                                  66.4 kB\r\n[build:production:next    ]   ├ chunks/7eb20d293fe09a336fbe2e7d38614e86d1beb4b2.f3072d.js  13.8 kB\r\n[build:production:next    ]   ├ chunks/framework.abffcf.js                                 41.8 kB\r\n[build:production:next    ]   ├ chunks/main.c52244.js                                      6.76 kB\r\n[build:production:next    ]   ├ chunks/pages/_app.c9a0a7.js                                2.95 kB\r\n[build:production:next    ]   └ chunks/webpack.9efddc.js                                   1.19 kB\r\n[build:production:next    ] \r\n[build:production:next    ] λ  (Server)  server-side renders at runtime (uses getInitialProps or getServerSideProps)\r\n[build:production:next    ] ○  (Static)  automatically rendered as static HTML (uses no initial props)\r\n[build:production:next    ] ●  (SSG)     automatically generated as static HTML + JSON (uses getStaticProps)\r\n[build:production:next    ]    (ISR)     incremental static regeneration (uses revalidate in getStaticProps)\r\n[build:production:next    ] \r\n```\r\n\r\n\r\nExample code:\r\n```js\r\nmodule.exports = {\r\n  i18n: {\r\n    // @TODO: determine URL structure\r\n    locales: [\r\n      'en',\r\n      'nl-nl',\r\n      'nl-be',\r\n      'fr-be',\r\n      'fr-fr',\r\n    ],\r\n    defaultLocale: 'en',\r\n  },\r\n};\r\n```\r\n\r\n```ts\r\n\r\nexport default function Homepage(props: { homepage: HomepageQuery }) {\r\n  const localeIdentifier = useLocaleIdentifier();\r\n  const localeIdentifiersByRegion = useRegionalLocaleIdentifiers();\r\n  const t = useKlot();\r\n\r\n  return (\r\n    <>\r\n      <H1>{(props.homepage as any).homepage.entity.title}</H1>\r\n\r\n      <LanguageSwitch />\r\n\r\n      <h2>Translation test</h2>\r\n      <h3>{t('Optical fiber')}</h3>\r\n\r\n      <h2>Internationalization test</h2>\r\n      <h3>Short date: {formatDate(new Date(), localeIdentifier.locale)}</h3>\r\n      <h3>Time: {formatTime(new Date(), localeIdentifier.locale)}</h3>\r\n      <h3>Currency: {formatCurrency(89.99, localeIdentifier.locale)}</h3>\r\n\r\n      <h2>Current locale</h2>\r\n      <pre>{JSON.stringify(localeIdentifier, null, 4)}</pre>\r\n\r\n      <h2>Locales</h2>\r\n      <pre>{JSON.stringify(localeIdentifiersByRegion, null, 4)}</pre>\r\n    </>\r\n  );\r\n}\r\n\r\nexport async function getStaticProps() {\r\n  const url = resolveApiUrl(new URL(getOrigin()));\r\n\r\n  const sdk = createGraphqlRequestSdk(url);\r\n\r\n  const homepage = await sdk.Homepage();\r\n\r\n  return {\r\n    revalidate: 1,\r\n    props: {\r\n      homepage,\r\n    },\r\n  };\r\n};\r\n```\r\n"}
{"sentences": "Timezone is not correct for Asia/Tehran", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #1 SMP PREEMPT_DYNAMIC Sun Feb 26 00:13:26 UTC 2023\r\n    Binaries:\r\n      Node: 16.17.1\r\n      npm: 8.15.0\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.2.4\r\n      eslint-config-next: 13.2.4\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nInternationalization (i18n)\n\n### Link to the code that reproduces this issue\n\nhttps://github.com/amirsarfar/nextjs-timezone-issue-reproduction-app\n\n### To Reproduce\n\nJust go to index and refresh\n\n### Describe the Bug\n\n![image](https://user-images.githubusercontent.com/36067291/227476148-0f60a53b-10c2-4382-8c6c-384569bfa156.png)\r\n\n\n### Expected Behavior\n\nThe timezone (Asia/Tehran) was previously a daylight saving timezone (+4:30 in summer and +3:30 in winter) but it has changed this year and is only +3:30.\r\n\r\nThe server should be updated too and both client and server should be +3:30\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_"}
{"sentences": "Nextjs dynamic route page return 403 Forbidden error for only one specific user dynamic route", "description": "I have my route defined as `patients/[userID].tsx` in pages dir. \r\n\r\nWhen I tried to access one of the specific active userID (eg. patients/7917067d) it gave `403 Forbidden` error in prod only, In dev, it is working fine.\r\n\r\nFYI, when I enter the wrong userId it gives 404 which is correct behaviour but don't know why only this userId which is correct gives a 403 error.\r\n\r\n**NOTE: I am using Static Generation with Client-side data fetching**\r\n\r\n![Screenshot from 2023-01-31 17-30-38](https://user-images.githubusercontent.com/78585850/215760036-2edf9ea3-024c-474f-931b-64078945c278.png)\r\n\r\nEDITED:\r\n\r\nThere is a sentry error also which I think relates to the same problem:\r\n\r\n![Screenshot from 2023-01-31 19-18-11](https://user-images.githubusercontent.com/78585850/215778593-dfe9084c-c420-401c-beb8-543ce16212be.png)\r\n\r\n\r\n"}
{"sentences": "Params is undefined when hosting on Vercel.", "description": "### Summary\r\n\r\nWhen I run yarn dev && yarn start it works as expected the path \"/1/...\" makes params.organizationID return \"1\", but when I host it on Vercel params is always empty.  \r\n\r\nnext version:     \"next\": \"13.2.4\",\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\napp/[organizationID]/layout.tsx\r\n\r\nimport { ID } from \"@/types\";\r\nimport { Sidebar } from \"@/ui/Sidebar\";\r\nexport const dynamic = \"force-dynamic\";\r\n\r\nexport default async function OrganizationLayout({\r\n  children,\r\n  params: { organizationID },\r\n}: {\r\n  children: React.ReactNode;\r\n  params: { organizationID: ID };\r\n}) {\r\n  return (\r\n    <>\r\n      {/* @ts-expect-error Server Component */}\r\n      <Sidebar organizationID={organizationID} />\r\n      <div className=\"pl-256\">\r\n        <h1>org id: {organizationID}</h1>\r\n        <h1>serch id: {JSON.stringify(searchParams)}</h1>\r\n        {children}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n```\r\n\r\n\r\n### Example\r\n\r\n_No response_"}
{"sentences": "Change body background dynamically in css", "description": "Let's say I have a page called `warnings/[id].js`, I would like to make the `body {background: red}` in my css for this page only. Apparently, I can not add it to the global css file included in `_app.js` because I only want one page to be red. And I can not use `body` in my module.css files since:\r\n\r\n```\r\nSyntax error: Selector \"body\" is not pure (pure selectors must contain at least one local class or id)\r\n```\r\n\r\nSo I would like nextjs to support change global css in module css files. Maybe like \r\n\r\n```css\r\n:global body {\r\n    background: red;\r\n}\r\n```\r\n\r\n## Footnotes\r\n\r\nQ: Why do I have to change body background, why not the container `div`?\r\n\r\nA: overscrolling in macOS and iOS browsers will reveal body background, see https://stackoverflow.com/a/42264959/1061155\r\n\r\n\r\n\r\n"}
{"sentences": "Rendering twice server side infos", "description": "### Summary\r\n\r\nI'm trying to update my Next **12** to **13**, so I following the upgrade guide on docs, but after upgrade React to **18** the pages are rendering twice the content. It seems to render the server components first and then render the right component with data fetching, getting duplicated, but with the first render without the data.\r\n\r\neg:\r\n![screencapture-headless-local-3000-2023-03-20-12_15_23](https://user-images.githubusercontent.com/13246770/226487293-ed491557-3403-4ea7-ad74-73a6ac505328.png)\r\n\r\n\r\n### Additional information\r\n\r\n```js\r\ninfo\r\n  Operating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 22.3.0: Mon Jan 30 20:42:11 PST 2023; root:xnu-8792.81.3~2/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 16.18.0\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: 7.29.1\r\n    Relevant packages:\r\n      next: 13.2.4\r\n      eslint-config-next: 13.2.4\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n```\r\n\r\n```typescript\r\n// pages/index.tsx\r\n\r\nexport const getStaticProps: GetServerSideProps = async () => {\r\n  const { result, hasError, errors } = await HomeService.getHomePage()\r\n  const { slots, title, description } = result || {}\r\n\r\n  const FIVE_MINUTES_IN_SECONDS = 60 * 5\r\n\r\n  if (hasError) {\r\n    return {\r\n      notFound: true,\r\n      revalidate: ON_REQUEST_ERROR_REVALIDATE_TIME_IN_SECONDS,\r\n    }\r\n  }\r\n\r\n  return {\r\n    props: {\r\n      slots,\r\n      title,\r\n      description,\r\n    },\r\n    revalidate: FIVE_MINUTES_IN_SECONDS,\r\n  }\r\n}\r\n\r\nexport default function Home({ slots, title, description }: HomePageProps) {\r\n  return (\r\n    <>\r\n      <Head title={title} description={description} />\r\n      <HomePage slots={slots} />\r\n    </>\r\n  )\r\n}\r\n```\r\n\r\n```typescript\r\n// pages/_document.tsx\r\n\r\nimport { ServerStyleSheet } from 'styled-components'\r\n\r\nexport default class MyDocument extends Document {\r\n  static async getInitialProps(\r\n    ctx: DocumentContext,\r\n  ): Promise<DocumentInitialProps> {\r\n    const sheet = new ServerStyleSheet()\r\n    const originalRenderPage = ctx.renderPage\r\n\r\n    try {\r\n      ctx.renderPage = () =>\r\n        originalRenderPage({\r\n          enhanceApp: (App) => (props) =>\r\n            sheet.collectStyles(<App {...props} />),\r\n        })\r\n\r\n      const initialProps = await Document.getInitialProps(ctx)\r\n      return {\r\n        ...initialProps,\r\n        styles: (\r\n          <>\r\n            {initialProps.styles}\r\n            {sheet.getStyleElement()}\r\n          </>\r\n        ),\r\n      }\r\n    } finally {\r\n      sheet.seal()\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Html lang=\"pt-br\">\r\n        <Head>\r\n          <meta charSet=\"utf8\" />\r\n        </Head>\r\n        <Main />\r\n        <NextScript />\r\n      </Html>\r\n    )\r\n  }\r\n}\r\n```\r\n\r\n```typescript\r\n// pages/_app.tsx\r\nfunction MyApp({ Component, pageProps: { ...pageProps } }: AppProps) {\r\n  function renderContent() {\r\n    return (\r\n      <ThemeProvider theme={themeProperties}>\r\n        <GlobalStyles />\r\n          <Component {...pageProps} />\r\n      </ThemeProvider>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <meta\r\n          name=\"viewport\"\r\n          content=\"width=device-width, initial-scale=1, maximum-scale=1.0\"\r\n        />\r\n      </Head>\r\n      {renderContent()}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default MyApp\r\n\r\n```\r\n"}
{"sentences": "Error running nextjs", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nnpm run dev                           \r\n> dev                                                                                                                          > next dev\r\n\r\n/data/data/com.termux/files/home/Fomundi/Cursos/nextjs/nextFolder/node_modules/next/dist/cli/next-dev.js:362\r\n            showAll: args[\"--show-all\"] ?? false,\r\n                                         ^\r\n\r\nSyntaxError: Unexpected token '?'\r\n    at wrapSafe (internal/modules/cjs/loader.js:915:16)\r\n    at Module._compile (internal/modules/cjs/loader.js:963:27)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1027:10)\r\n    at Module.load (internal/modules/cjs/loader.js:863:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:708:14)\r\n    at Module.require (internal/modules/cjs/loader.js:887:19)\r\n    at require (internal/modules/cjs/helpers.js:74:18)\r\n    at Object.dev (/data/data/com.termux/files/home/Fomundi/Cursos/nextjs/nextFolder/node_modules/next/dist/lib/commands.js:10:30)\r\n    at Object.<anonymous> (/data/data/com.termux/files/home/Fomundi/Cursos/nextjs/nextFolder/node_modules/next/dist/bin/next:141:28)\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nApp directory (appDir: true)\n\n### Link to the code that reproduces this issue\n\nnpm install next and npm run dev\n\n### To Reproduce\n\nI show everything in the code that I put\n\n### Describe the Bug\n\nI show everything in the code that I put\n\n### Expected Behavior\n\nI show everything in the code that I put\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_"}
{"sentences": "Is it possible to serve __NEXT_DATA__ from a separate file instead of embedding it in the HTML page?", "description": "So there is a page in the app I am working on that is producing around 2.5MB uncompressed JSON payload from `getStaticProps`. The loading speed is quite good so I paid no attention to it, however, I found out that some crawlers (e.g. Twitterbot) will not crawl a page that exceeds a certain size so this would make features like link preview not working. If I understand correctly __NEXT_DATA__ is used for hydration, hence, those crawlers have no used for it. \r\n\r\nSo this makes me wonder if moving this __NEXT_DATA__ out of the HTML and serve it from a separate file (e.g. <script src=\"/pages/index/next-data.json\">) instead would be useful for such cases and also wonder if there is a way to do this already?"}
{"sentences": "http-proxy-middleware can't handle POST request in next.js", "description": "> next.js version: 9.3.1-canary.1\r\n\r\nI want to build middle tier server with next.js, so it must proxy all request with `api/*`.\r\n\r\nTo achieve this, I add file `pages/api/[...args].js` to an empty project, and write these simple code:\r\n\r\n```js\r\nimport { createProxyMiddleware } from \"http-proxy-middleware\";\r\nexport default createProxyMiddleware({\r\n  target: \"http://yuanjin.tech:5100\", //the data server\r\n  changeOrigin: true\r\n});\r\n```\r\n\r\nAfter testing, all get requests works well, but all POST requests has problems\r\n\r\n```shell\r\n# get request workds well\r\nGET http://localhost:3000/api/movie\r\n```\r\n\r\n```shell\r\n# post request has problems\r\nPOST http://localhost:3000/api/user/login\r\nBODY loginId=xxx&loginPwd=xxx\r\n\r\n# console info\r\nAPI resolved without sending a response for /api/user/login, this may result in stalled requests.\r\n```\r\n\r\nWhen this error occurs, my data server does not actually receive any requests\r\n\r\nThen i have found any request with body has same problem, even GET request\r\n\r\nI don't know why the proxy request can't reach the data server, did i miss something?\r\n\r\n\r\n\r\n"}
{"sentences": "How to make Next.js page render on Client-side and totally ignore it on Server-side?", "description": "Suppose I have `src/pages/video` page & I have many components on this page which require `window` and `document` and a lot of browser stuff and I don't benefit from Server-side rendering on this page, I just don't need it.\r\n\r\nHow to tell Next.js to Ignore this page on server to not prefetch or render it there."}
{"sentences": "gRPC in Next.js", "description": "i tried grpc-web i got an error stating `ReferenceError: XMLHttpRequest ` is not defined  it did not work,\r\n I tried grpc-node it also did not work \r\nis there a way to get grpc working in next js "}
{"sentences": "Invalid hook call in getServerSideProps", "description": "```\r\nexport const getServerSideProps: GetServerSideProps = async (context) => {\r\n  const { isLoading, error, data } = useQuery('repoData', () =>\r\n    fetch(\r\n      'https://api.github.com/repos/tannerlinsley/react-query'\r\n    ).then((res) => res.json())\r\n  )\r\n  console.log({ data })\r\n\r\n  return {\r\n    props: {\r\n      data,\r\n    },\r\n  }\r\n}\r\n```\r\n\r\n\r\nI went through the discussion but still cannot find the answer that actually solving this problem."}
{"sentences": "Jest with Fetch and msw", "description": "Good morning,\r\n\r\nI'm trying to use `msw` to mock actual endpoint calls through `jest` from within an API route and I'm receiving `fetch is not defined`. If I try actually running the application, `fetch` is available. Anyone have a quick way to make sure jest has `fetch` available for use when running tests?\r\n\r\nThanks!"}
{"sentences": "Why does Next think my route is dynamic?", "description": "### Summary\r\n\r\nI have converted my site to the new app router in Next 13. Next says the root route (`/`) is dynamic:\r\n\r\n```\r\nRoute (app)                                      Size     First Load JS\r\n┌ λ /                                            183 B          78.6 kB\r\n├ ● /clanky/[...path]                            3.38 kB        81.8 kB\r\n├   ├ /clanky/2015/01/editorial.html\r\n├   ├ /clanky/2015/10/zpravodajsky-prehled.html\r\n├   ├ /clanky/2015/10/kundera-ondracek.html\r\n├   └ [+1577 more paths]\r\n└ ○ /podcast                                     173 B          73.8 kB\r\n+ First Load JS shared by all                    68.1 kB\r\n  ├ chunks/679-d3b9fe369b7ba3be.js               65.8 kB\r\n  ├ chunks/main-app-5ddea14a8cd46ed8.js          206 B\r\n  └ chunks/webpack-0b96a1340910f66f.js           2.1 kB\r\n\r\nλ  (Server)     server-side renders at runtime (uses getInitialProps or getServerSideProps)\r\n```\r\n\r\nBut I don’t use `getInitialProps` nor `getServerSideProps` and the route should be fully static. I tried adding an explicit config to the page or the layout:\r\n\r\n```\r\nexport const dynamic = \"force-static\";\r\n```\r\n\r\n…but nothing changed, I can still see the `λ` marker next to the `/` route. The code [is here](https://github.com/Ohlasy/web). What am I doing wrong?\r\n"}
{"sentences": "Potential Vercel.com Google Indexing Issues", "description": "I think I might have found an issue with http://vercel.com but I couldn't find any appropriate place to report it!\r\n\r\nI was trying to find the http://vercel.com/design page **via google** as I couldn't remember the domain but I couldn't find it, so I tried the following google searches:\r\n\r\n* site:http://vercel.com (Many results)\r\n* site:http://vercel.com/design (0 Results)\r\n* \"design\" site:http://vercel.com (0 Results)\r\n\r\n*Quotes (\"\") around a keyword mean must include.*\r\n\r\nAlso tried\r\n\r\nsite:http://vercel.com/home (0 Results)\r\n\r\nIt seems like some pages on vercel.com aren't indexed by Google which seems to be unintentional. Pages like vercel.com/docs are indexed but pages like vercel.com/home or vercel.com/design aren't.\r\n\r\n#### Reproducing\r\n\r\nUse google with the following keywords:\r\n\r\n* site:http://vercel.com/design\r\n* \"design\" site:http://vercel.com\r\n* site:http://vercel.com/home\r\n\r\n*Expected* to see results for the relevant pages but got 0 results."}
{"sentences": "The provided export path doesn't match the page.", "description": "Hi everyone 👋, I am new to Next. I have a page with dynamic routes as below:\r\n- Homepage with a list of posts: `index.js`\r\n- Detail page: `post/[slug].js`\r\n\r\nWhen I run it on the dev server, its all work nicely. But when I try to run `next export`, it keeps showing:\r\n`The provided export path '/post' doesn't match the '/post/[slug]' page.`\r\n\r\nIs there any config I should set or anything else I am missing? \r\nAppreciate any help 🙏.\r\n"}
{"sentences": "Next 12.x build - performance drop with cold starts", "description": "Hello guys\r\n\r\nWe run our app using AWS Lambda. Prior Next 12.x we were using \"serverless\" build target. This was deprecated with Next 12.x and \"standalone\" build is now the default one with serverless no longer supported. \r\n\r\n**However we noticed significant response time increase in cold starts - and also when lambdas are scaling (again cold start).** \r\n\r\nWe tried to perf our code and found out that the line `const NextServer = require('next/dist/server/next-server').default` takes almost `~350ms` to execute. \r\n\r\nOur code to handle the requests on servless looks more or less like this \r\n```\r\n// ...\r\n\r\n// This line is heavy \r\nconst NextServer = require('next/dist/server/next-server').default\r\n\r\nconst handle = new NextServer({\r\n    hostname: 'localhost',\r\n    port: port,\r\n    dir: path.resolve(__dirname, '..'),\r\n    dev: false,\r\n    conf: config,\r\n  }).getRequestHandler()\r\n\r\nhandle(req, res)\r\n// ...\r\n```\r\n\r\n**We are wondering:**\r\n- Is the next-server in the /dist/ folder correctly compiled? Tree Shaking and everything applied? \r\n- Are we running our server incorrectly? \r\n- Is there way to still use serverless build with Next 12? "}
{"sentences": "Production build not working", "description": "### Summary\r\n\r\nI have a next js project which works perfectly fine on localhost but doesn't work in production. \r\n\r\n### Additional information\r\n[GitHub url](https://github.com/im-ghost/apish)\r\n[production buil](https://63fe55451ecc1c26b51af4af--majestic-tapioca-dcc79c.netlify.app/)\r\n\r\n"}
{"sentences": "Dialog Routing approach with /app/ dir", "description": "I'm using the most recent version of Next JS, and I'd like to see if there's a way to achieve \"Dialog/Modal\" routing where the current route stays the same and when the \"Dialog/Modal\" opens, I should have a routing approach without changing the url."}
{"sentences": "DUPLICATE: Metadata in client side components as of version 13.2", "description": "The new [Metadata API](https://beta.nextjs.org/docs/api-reference/metadata) does not support client components: \"Both static and dynamic metadata through generateMetadata are only supported in Server Components.\" \r\n\r\nWhat is the recommended way to implement metadata on client side components given the new API and the deprecation of head.js? \r\n"}
{"sentences": "Is there a hard limit to number of static pages vercel edge network (CDN) can allow?", "description": "I understand there is a cache response size limit of 10mb (see image below) but aside from this I can't find anywhere that suggest Vercel CDN has a defined limit for total number of pages (or total size) \"cache-able\" on the Edge Network.\r\n\r\nCan anyone please advise if Vecel Edge Network actually allows caching millions of static pages (without any limitation)? Thanks!\r\n\r\n![image](https://user-images.githubusercontent.com/67973499/216837541-f046b95b-36d6-49f8-82df-ee261fdfaf25.png)\r\n"}
{"sentences": "Clean build yields: warn  - You are using a non-standard \"NODE_ENV\" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env", "description": "I created a brand new nextjs project using `npx create-next-app@latest .`.\r\n\r\nWithout changing anything I invoked `yarn next build`. It outputs:\r\n\r\n> warn  - You are using a non-standard \"NODE_ENV\" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env\r\n\r\n1) Reading through some github comments and the contents under the link above, my understanding is that `next build` should always use `production`. So my first question is: Why does the build script even complain here?\r\n\r\n2) Since the warning did not even mention WHAT NODE_ENV is set I added a debug output to `next.config.js`: `console.log('DBG_NODE_ENV', process.env.NODE_ENV);` The output was `DBG_NODE_ENV development` during build process. While  indeed `development` != `production` it's still a valid env value?\r\n\r\n3) Trying to set the NODE_ENV in the package.json build command (for example: `\"build\": \"cross-env NODE_ENV=production next build\",`) also didn't change anything.\r\n\r\nI am completely lost. How do I get rid of the warn message and have nextjs actually build with NODE_ENV=production? \r\n"}
{"sentences": "Firebase middleware for authentication", "description": "Hi there!\r\n\r\nI planned on using Firebase + Next.js Middlewares to check for user authentication.\r\nBut when I try to do something like this:\r\n\r\n```ts\r\nimport type { NextRequest } from \"next/server\";\r\nimport { NextResponse } from \"next/server\";\r\nimport { auth } from \"../../lib/firebase/admin\";\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  if (req.nextUrl.href.startsWith(\"/api/login\")) {\r\n    const response = NextResponse.next();\r\n\r\n    const cookie = await auth.createSessionCookie(req.headers.get(\"token\"), {\r\n      expiresIn: 9999999,\r\n    });\r\n\r\n    response.cookie(\"token\", cookie, {\r\n      httpOnly: true,\r\n      sameSite: \"strict\",\r\n      secure: process.env.NODE_ENV === \"production\",\r\n    });\r\n  }\r\n\r\n  const user = await auth.verifySessionCookie(req.cookies.token);\r\n  return NextResponse.next();\r\n}\r\n```\r\n\r\nI get the following error:\r\n\r\n<img width=\"1028\" alt=\"CleanShot 2022-01-23 at 22 26 20@2x\" src=\"https://user-images.githubusercontent.com/36263538/150698601-c30d5e3e-a8d0-4cf4-90e6-897377b0fe74.png\">\r\n\r\nI've tried to install `http2` but other old packages (`dns`, `net`, `tls`) keep popping up with the same error.\r\nIs the Firebase admin SDK incompatible with Next.js middleware?\r\n"}
{"sentences": "@next/font is not always loading fonts", "description": "\r\nhttps://user-images.githubusercontent.com/19279947/212365304-afa21f7c-0094-40cc-a19e-8919fd9809a5.mov\r\n\r\nThis happens when the page reloads. Sometimes the font is loaded, and sometimes it's not. \r\n\r\nHere is the code.\r\n\r\n```jsx\r\nimport { Nunito } from \"@next/font/google\";\r\n\r\nconst nunito = Nunito({ subsets: [\"latin\"], weight: [\"400\", \"500\", \"600\"] });\r\n\r\nconst Layout = ({ children }) => {\r\n  return (\r\n    <>\r\n      <main className={\"main\" + \" \" + nunito.className}>\r\n        <Header />\r\n        {children}\r\n        <Footer />\r\n      </main>\r\n    </>\r\n  );\r\n};\r\n```\r\nAny idea why is this happening? I am on the latest `NextJS` version."}
{"sentences": "External links and `typedRoutes: true` – what's the best way to handle them?", "description": "Hi,\r\n\r\nI've just turned on `typedRoutes: true`, really like it so far.\r\n\r\nI was wondering what people are doing about external links? They error at the moment as there's no corresponding type for them. I'm doing this sort of thing at the moment:\r\n\r\n```jsx\r\n{/* @ts-expect-error: External link upsets Next typedRoutes */}\r\n<Link href=\"https://wolstenhol.me\" className={cx(linkClasses)}>\r\n  External link\r\n</Link>\r\n```\r\n\r\nIf there's a nicer way of handling it, or if this approach is OK, then should we add this to [the docs](https://beta.nextjs.org/docs/configuring/typescript#statically-typed-links)?\r\n"}
{"sentences": "13.2.x increased latency on page requests", "description": "Hi, I noticed a big latency spike for standard pages. On 13.1.x my page loads are ~50ms. On 13.2.x, they are now ~250-350ms, even through `Link` navigations. Anyone else experiencing this?\r\n\r\nAdditional context: I'm deployed to AWS lambda and using standalone mode.\r\n\r\nRelevant ticket: https://github.com/vercel/next.js/issues/46419\r\nPR with fix: https://github.com/vercel/next.js/pull/46420"}
{"sentences": "Prettier integration doesn't seem to work", "description": "### Run `next info` (available from version 12.0.8 and up)\n\n```\r\n    Operating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 21.1.0: Wed Oct 13 17:33:23 PDT 2021; root:xnu-8019.41.5~1/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 16.13.0\r\n      npm: 8.1.0\r\n      Yarn: 1.22.17\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 12.0.8\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n```\n\n### What version of Next.js are you using?\n\n12.0.8\n\n### What version of Node.js are you using?\n\n16.13.0\n\n### What browser are you using?\n\nN/A\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\nN/A\n\n### Describe the Bug\n\nStarting with a vanilla `create-next-app` project (reproduced using `--typescript` and regular javascript) and following the documented integration guide [here](https://nextjs.org/docs/basic-features/eslint#prettier) running `next lint` reports no issues when an obvious formatting error is present in any source code.\r\n\r\nreproduced in `next@12.0.9-canary.0` and using `--no-cache` with `next lint`.\r\n\n\n### Expected Behavior\n\nprettier errors should surface when using `next lint`\n\n### To Reproduce\n\n```\r\nnpx create-next-app my-app\r\ncd my-app\r\nnpm install --save-dev eslint-config-prettier prettier\r\necho '{ \"extends\": [\"next/core-web-vitals\", \"prettier\"] }' > .eslintrc.json\r\necho '   const foo = 123' > pages/test.js\r\nnpm run lint --no-cache\r\n```"}
{"sentences": "Are database client instances shared between API routes?", "description": "I am attempting to limit the number of prisma clients created. \r\n\r\nI follow Prisma recommendation of [instantiating a single client](https://www.prisma.io/docs/guides/database/troubleshooting-orm/help-articles/nextjs-prisma-client-dev-practices) and import it into API routes.\r\n\r\nBut when I run the webpack analyzer, it looks like each API route is bundling a unique prisma client module. Does this mean each API route is also instantiating a new client?\r\n\r\nI am mostly using edge functions with the pages directory. \r\n\r\nMaybe the new app directory and server components would help.\r\n\r\nThanks!"}
{"sentences": "any way for cache api response?", "description": "i have an API route to print some information, the remote data will change at every hour, but i can't find way to cache the API's response in one hour in server-side memory. client cache not useful.\r\n```ts\r\nimport {PageConfig} from 'next';\r\nimport {NextRequest,NextResponse} from 'next/server';\r\n\r\nconst handler = async function(request:NextRequest) : Promise<NextResponse> {\r\n  const response:Response = await fetch('http://10.1.2.3/data');\r\n  const data:unknown = await response.json();\r\n  const responseHeaders:HeadersInit = {'content-type':'application/json','cache-control':'public,max-age=3600'};\r\n  return new NextResponse(JSON.stringify(data),{headers:responseHeaders});\r\n}\r\n\r\nexport default handler;\r\n\r\nexport const config:PageConfig = {runtime:'edge'};\r\n```"}
{"sentences": "Fetching data from API endpoint from within the middleware.", "description": "Hi, I'm trying to implement the permanent redirects managed from CMS. I wanted to use a custom endpoint to fetch, cache, and refresh the list of redirects, and then fetch the cached list of redirects in middleware. Simple, and effective. The problem is that fetching data from the custom API endpoint from within the middleware works only in dev. After building the app (yarn build -> yarn start) the fetch throws the error: connect ECONNREFUSED ::1:3000. Does anyone know what is the reason for that and how to combat that issue?"}
{"sentences": "Statically exporting a Next.js application via `next export` disables API routes and middleware.", "description": "I receive the following error everytime I build my project using `next build`. I'm not using `next export`.\r\n```\r\nStatically exporting a Next.js application via `next export` disables API routes and middleware.\r\nThis command is meant for static-only hosts, and is not necessary to make your application static.\r\nPages in your application without server-side data dependencies will be automatically statically exported by `next build`, including pages powered by `getStaticProps`.\r\n```\r\n\r\nIs there anything else or a bad practice that would lead to this warning? \r\n\r\nHow can I see which pages were exported instead of built? There is no `out` directory.\r\n\r\n```js\r\n// next.config.js\r\n\r\nconst nextConfig = {\r\n  i18n,\r\n  reactStrictMode: true,\r\n  images: {\r\n    dangerouslyAllowSVG: true,\r\n    contentSecurityPolicy: \"default-src 'self'; script-src 'none'; sandbox;\",\r\n  },\r\n  async redirects() {\r\n    return [\r\n      ...\r\n    ]\r\n  },\r\n}\r\n```\r\n\r\n```\r\n    Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #1 SMP Wed Nov 23 01:01:46 UTC 2022\r\n    Binaries:\r\n      Node: 18.14.1\r\n      npm: 9.3.1\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.1.6\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n```"}
{"sentences": "Failing to deploy on Vercel", "description": "Hi,\r\nI have a  simple NextJS project. I'm using Vercel to deploy and host it. However, on deploy I am getting the below error when deploying to Preview environment:\r\n\r\n[19:47:19.495] Running build in San Francisco, USA (West) – sfo1\r\n[19:47:21.886] Cloning completed: 2.348s\r\n[19:47:22.067] Running \"vercel build\"\r\n[19:47:22.627] Vercel CLI 28.16.2\r\n[19:47:22.928] Installing dependencies...\r\n[19:47:30.559] \r\n[19:47:30.560] added 30 packages in 7s\r\n[19:47:30.560] \r\n[19:47:30.560] 1 package is looking for funding\r\n[19:47:30.560]   run `npm fund` for details\r\n[19:47:30.578] Detected Next.js version: 13.1.4\r\n[19:47:30.580] Detected `package-lock.json` generated by npm 7+...\r\n[19:47:30.581] Running \"npm run build\"\r\n[19:47:30.985] \r\n[19:47:30.985] > cabanasofiaevelyn@1.0.0 build\r\n[19:47:30.985] > next build\r\n[19:47:30.985] \r\n[19:47:31.518] Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n[19:47:31.518] This information is used to shape Next.js' roadmap and prioritize features.\r\n[19:47:31.519] You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n[19:47:31.519] https://nextjs.org/telemetry\r\n[19:47:31.519] \r\n[19:47:31.682] info  - Linting and checking validity of types...\r\n[19:47:31.993] info  - Creating an optimized production build...\r\n[19:47:38.979] info  - Compiled successfully\r\n[19:47:38.980] info  - Collecting page data...\r\n[19:47:39.354] Error: @next/font/google failed to run or is incorrectly configured.\r\n[19:47:39.354] \r\n[19:47:39.354] Read more: https://nextjs.org/docs/basic-features/font-optimization\r\n[19:47:39.354]     at Object.<anonymous> (/vercel/path0/node_modules/@next/font/google/index.js:15:7)\r\n[19:47:39.354]     at Module._compile (node:internal/modules/cjs/loader:1159:14)\r\n[19:47:39.354]     at Module._extensions..js (node:internal/modules/cjs/loader:1213:10)\r\n[19:47:39.355]     at Module.load (node:internal/modules/cjs/loader:1037:32)\r\n[19:47:39.355]     at Module._load (node:internal/modules/cjs/loader:878:12)\r\n[19:47:39.355]     at Module.require (node:internal/modules/cjs/loader:1061:19)\r\n[19:47:39.355]     at require (node:internal/modules/cjs/helpers:103:18)\r\n[19:47:39.355]     at 5297 (/vercel/path0/.next/server/pages/_app.js:76:18)\r\n[19:47:39.355]     at __webpack_require__ (/vercel/path0/.next/server/webpack-runtime.js:25:42)\r\n[19:47:39.355]     at /vercel/path0/.next/server/pages/_app.js:20:75\r\n[19:47:39.356] \r\n[19:47:39.356] > Build error occurred\r\n[19:47:39.359] Error: Failed to collect page data for /\r\n[19:47:39.359]     at /usr/local/share/.config/yarn/global/node_modules/next/dist/build/utils.js:960:15\r\n[19:47:39.359]     at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {\r\n[19:47:39.359]   type: 'Error'\r\n[19:47:39.359] }\r\n[19:47:39.404] Error: Command \"npm run build\" exited with 1\r\n\r\nIt was working before, but I don't know what made it to start failing as I haven't changed anything related to fonts and I'm using the @next/font/google according to the documentation.\r\nThe build is working locally when I run `npm run build`\r\n\r\nCan someone help me please?\r\n\r\n\r\n"}
{"sentences": "Deploy failing on Vercel", "description": "I have a very simple React app: https://github.com/ijsamuel/jam. I'm using Vercel to deploy and host the application. However, on deploy I am getting the below error. I've googled for this error and not getting anything. I've cleared my npm cache and fixed uppercasing, but still getting the same error. Appreciate any help!\r\n\r\nRunning build in San Francisco, USA (West) – sfo1\r\nCloning github.com/ijsamuel/jam (Branch: main, Commit: b8728f5)\r\nSkipping build cache, deployment was triggered without cache.\r\nCloning completed: 802.191ms\r\nRunning \"vercel build\"\r\nVercel CLI 28.16.2\r\nInstalling dependencies...\r\nyarn install v1.22.17\r\n[1/4] Resolving packages...\r\n[2/4] Fetching packages...\r\n[3/4] Linking dependencies...\r\n[4/4] Building fresh packages...\r\nsuccess Saved lockfile.\r\nDone in 7.12s.\r\nDetected Next.js version: 10.0.8\r\nRunning \"yarn run build\"\r\nyarn run v1.22.17\r\n$ next build\r\nnode:internal/errors:484\r\n    ErrorCaptureStackTrace(err);\r\n    ^\r\nError [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath './lib/parser' is not defined by \"exports\" in /vercel/path0/node_modules/next/node_modules/postcss/package.json\r\n    at new NodeError (node:internal/errors:393:5)\r\n    at throwExportsNotFound (node:internal/modules/esm/resolve:358:9)\r\n    at packageExportsResolve (node:internal/modules/esm/resolve:668:3)\r\n    at resolveExports (node:internal/modules/cjs/loader:529:36)\r\n    at Module._findPath (node:internal/modules/cjs/loader:569:31)\r\n    at Module._resolveFilename (node:internal/modules/cjs/loader:981:27)\r\n    at Module._load (node:internal/modules/cjs/loader:841:27)\r\n    at Module.require (node:internal/modules/cjs/loader:1061:19)\r\n    at require (node:internal/modules/cjs/helpers:103:18)\r\n    at 552 (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:11590)\r\n    at __nccwpck_require__ (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:11735)\r\n    at 270 (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:400)\r\n    at __nccwpck_require__ (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:11735)\r\n    at 327 (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:260)\r\n    at __nccwpck_require__ (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:11735)\r\n    at 845 (/vercel/path0/node_modules/next/dist/compiled/postcss-scss/scss-syntax.js:1:3733) {\r\n  code: 'ERR_PACKAGE_PATH_NOT_EXPORTED'\r\n}\r\nNode.js v18.12.1\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nError: Command \"yarn run build\" exited with 1"}
{"sentences": "How to get SSR with appdir ?", "description": "Hey there,\r\n\r\nSwitching to the new `appdir` structure, I'm losing the SSR I got with the `pages` folder. I guess I did something wrong when wrapping with Client Components ?\r\n\r\nWith appdir, my HTML code looks like that when I check it:\r\n```html\r\n<!DOCTYPE html>\r\n<html id=\"__next_error__\">\r\n  <head>\r\n    <script src=\"/_next/static/chunks/polyfills.js\" nomodule=\"\"></script>\r\n  </head>\r\n  <body>\r\n    <script src=\"/_next/static/chunks/webpack.js\" async=\"\"></script>\r\n    <script src=\"/_next/static/chunks/main-app.js\" async=\"\"></script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nWith javascript afterwards : \r\n`<script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,\"M1:{\\\"id\\\":\\\"./node_modules/next/dist/client/components/app-router.js\\\",\\\"name\\\":\\\"\\\",\\\"chunks\\\":[\\\"app-client-internals:app-client-internals\\\"],\\\"async\\\":false}\\nM2:{\\\"id\\\":\\\"./app/providers.jsx\\\",\\\"name\\\":\\\"Providers\\\",\\\"chunks\\\":[\\\"app/layout:app/layout\\\"],\\\"async\\\":false}\\nM3:{\\\"id\\\":\\\"./node_modules/next/dist/client/components/layout-router.js\\\",\\\"name\\\":\\\"\\\",\\\"chunks\\\":[\\\"app-client-internals:app-client-internals\\\"],\\\"async\\\":false}\\nM4:{\\\"id\\\":\\\"./node_modules/next/dist/client/components/render-from-template-context.js\\\",\\\"name\\\":\\\"\\\",\\\"chunks\\\":[\\\"app-cl\"])</script><script>self.__next_f.push([1,\"ient-internals:app-client-internals\\\"],\\\"async\\\":false}\\n\"])</script><script>self.__next_f.push([1,\"J0:[\\\"$\\\",\\\"@1\\\",null,{\\\"assetPrefix\\\":\\\"\\\",\\\"initialCanonicalUrl\\\":\\\"/posts/teslas-biggest-threat\\\",\\\"initialTree\\\":[\\\"\\\",{\\\"children\\\":[\\\"posts\\\",{\\\"children\\\":[[\\\"postURL\\\",\\\"teslas-biggest-threat\\\",\\\"oc\\\"],{\\\"children\\\":[\\\"\\\",{}]}]}]},null,null,true],\\\"initialHead\\\":[\\\"$\\\",\\\"title\\\",null,{\\\"children\\\":\\\"My TEST Next.js App\\\"}],\\\"children\\\":[[],[[\\\"$\\\",\\\"link\\\",\\\"0\\\",{\\\"rel\\\":\\\"stylesheet\\\",\\\"href\\\":\\\"/_next/static/css/app/layout.css?ts=1676839989010\\\",\\\"precedence\\\":\\\"high\\\"}]],[\\\"$\\\",\\\"html\\\",null,{\\\"lang\\\":\\\"en\\\",\\\"data-test\\\":\\\"test\\\",\\\"children\\\":[\\\"$\\\",\\\"body\\\",null,{\\\"children\\\":[[\\\"$\\\",\\\"p\\\",null,{\\\"children\\\":\\\"okkk\\\"}],[\\\"$\\\",\\\"@2\\\",null,{\\\"langHeaders\\\":\\\"fr-FR\\\",\\\"children\\\":[\\\"$\\\",\\\"@3\\\",null,{\\\"parallelRouterKey\\\":\\\"children\\\",\\\"segmentPath\\\":[\\\"children\\\"],\\\"hasLoading\\\":false,\\\"template\\\":[\\\"$\\\",\\\"@4\\\",null,{}],\\\"notFound\\\":[\\\"$\\\",\\\"div\\\",null,{\\\"style\\\":{\\\"fontFamily\\\":\\\"-apple-system, BlinkMacSystemFont, Roboto, \\\\\\\"Segoe UI\\\\\\\", \\\\\\\"Fira Sans\\\\\\\", Avenir, \\\\\\\"Helvetica Neue\\\\\\\", \\\\\\\"Lucida Grande\\\\\\\", sans-serif\\\",\\\"height\\\":\\\"100vh\\\",\\\"textAlign\\\":\\\"center\\\",\\\"display\\\":\\\"flex\\\",\\\"flexDirection\\\":\\\"column\\\",\\\"alignItems\\\":\\\"center\\\",\\\"justifyContent\\\":\\\"center\\\"},\\\"children\\\":[[\\\"$\\\",\\\"head\\\",null,{\\\"children\\\":[\\\"$\\\",\\\"title\\\",null,{\\\"children\\\":\\\"404: This page could not be found.\\\"}]}],[\\\"$\\\",\\\"div\\\",null,{\\\"children\\\":[[\\\"$\\\",\\\"style\\\",null,{\\\"dangerouslySetInnerHTML\\\":{\\\"__html\\\":\\\"\\\\n            body { margin: 0; color: #000`\r\n\r\nIf you check, you'll see my components in this code.\r\n\r\nIf I add a component back in `pages` folder, I get it in the direct HTML, like you would expect.\r\n\r\nI wanted to know if it is normal, or if I did something wrong. I wrapped my app in contexts, could it be the reason ? When adding just a `<p>test</p>` tag in the root layout of `appdir`, it still doesn't display in the html. I don't know where to look :)\r\n\r\nThank you,\r\nYoann"}
{"sentences": "SWC won't compile dependencies", "description": "version: next 13.1.6\r\n\r\nI use pixi.js dependency. and also set the .swcrc targets\r\n\r\n```json\r\n{\r\n  \"env\": {\r\n    \"targets\": {\r\n      \"chrome\": \"68\"\r\n    },\r\n  }\r\n}\r\n```\r\n\r\nBut the compilation still occurs `Nullish coalescing operator (??)`\r\n\r\nOnly dependencies will happen\r\n\r\nAlso tried [Module Transpilation](https://nextjs.org/docs/advanced-features/compiler#module-transpilation). but the result is the same\r\n"}
{"sentences": "Error: Unexpected token 'export' when using Jest in NextJS", "description": "I'm trying to write a test case in a NextJS application using Jest. On running the test, below error occurs:\r\n```\r\n/Users/abhajan/Work/Tusk/tusk-app/node_modules/uuid/dist/esm-browser/index.js:1\r\n    ({\"Object.<anonymous>\":function(module,exports,require,__dirname,__filename,jest){export { default as v1 } from './v1.js';\r\n                                                                                      ^^^^^^\r\n\r\n    SyntaxError: Unexpected token 'export'\r\n\r\n      10 | import { useAccount, useBalance, useNetwork, useProvider } from \"wagmi\";\r\n      11 | import Web3 from \"web3\";\r\n    > 12 |\r\n         | ^\r\n      13 | export default function BlockchainInfo() {\r\n      14 |   // TODO: Check if user is authenticated first\r\n      15 |   return (\r\n\r\n      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1422:14)\r\n      at Object.<anonymous> (node_modules/rpc-websockets/dist/lib/server.js:40:13)\r\n      at Object.<anonymous> (node_modules/rpc-websockets/dist/index.js:30:38)\r\n      at Object.<anonymous> (node_modules/@solana/web3.js/lib/index.cjs.js:15:21)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/sol-utils/src/dataTypes/SolAddress/SolAddress.ts:2:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/sol-utils/src/dataTypes/SolAddress/index.ts:1:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/sol-utils/src/dataTypes/index.ts:1:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/sol-utils/src/index.ts:1:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/auth/src/methods/requestMessage.ts:1:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/auth/src/MoralisAuth.ts:2:1)\r\n      at Object.<anonymous> (node_modules/@moralisweb3/auth/src/index.ts:1:1)\r\n      at Object.<anonymous> (node_modules/moralis/src/index.ts:3:1)\r\n      at Object.<anonymous> (components/blockchain-info/index.tsx:12:55)\r\n      at Object.<anonymous> (pages/index.tsx:10:62)\r\n      at Object.<anonymous> (__tests__/index.test.tsx:7:53)\r\n```\r\n\r\nBelow is the setup of config in `jest.config.js`: \r\n```\r\n// jest.config.js\r\nconst nextJest = require('next/jest');\r\n\r\nconst createJestConfig = nextJest({\r\n  // Provide the path to your Next.js app to load next.config.js and .env files in your test environment\r\n  dir: './',\r\n});\r\n\r\n// Add any custom config to be passed to Jest\r\n/** @type {import('jest').Config} */\r\nconst customJestConfig = {\r\n  // Add more setup options before each test is run\r\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\r\n  // if using TypeScript with a baseUrl set to the root directory then you need the below for alias' to work\r\n  moduleDirectories: ['node_modules', '<rootDir>/'],\r\n  testEnvironment: 'jest-environment-jsdom',\r\n  transformIgnorePatterns: ['node_modules/(?!uuid)/'],\r\n};\r\n\r\n// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async\r\nmodule.exports = createJestConfig(customJestConfig);\r\n```\r\n\r\nBelow is the test file for `index.test.tsx`: \r\n```\r\nimport { render } from '@testing-library/react';\r\nimport Home from 'pages/index';\r\nimport '@testing-library/jest-dom';\r\n\r\ndescribe('Home', () => {\r\n  it('renders homepage unchanged', () => {\r\n    const { container } = render(<Home />);\r\n    expect(container).toMatchSnapshot();\r\n  });\r\n});\r\n```\r\n\r\nOn running the test file, the below error occurs:\r\n```\r\nDetails:\r\n\r\n    /Users/abhajan/Work/Tusk/tusk-app/node_modules/uuid/dist/esm-browser/index.js:1\r\n    ({\"Object.<anonymous>\":function(module,exports,require,__dirname,__filename,jest){export { default as v1 } from './v1.js';\r\n                                                                                      ^^^^^^\r\n\r\n    SyntaxError: Unexpected token 'export'\r\n```\r\n\r\nNot sure if the regex pattern in `transformIgnorePatterns` is correct or not. Any kind of help is appreciated :)"}
{"sentences": "App breaks after migrating to v13", "description": "Hello,\r\nI have my codebase running perfectly on Nextjs 12, but if I upgrade to the version 13 I can't print any page. The node process just breaks. I'm on nodejs 18.13.0.\r\n\r\nI didn't switch to the experimental \"appDir\" and stayed on the \"pages\" folder. I have Redux set up on the _app.js, where I also included some logic to run on the front-end.\r\n\r\nI tried to add \"use client\" on top of the files of components used it this page, but doesn't seem to help much. The project I'm working on is already quite big so I can't start fresh and re-import everything. It looks like it's a client/server component error, yet it should be compatible according Nextjs doc as I didn't moved to the experimental \"appDir\".\r\n\r\nHere is the output in the console\r\n\r\n```\r\n$ next dev -p 3002\r\nready - started server on 0.0.0.0:3002, url: http://localhost:3002\r\ninfo  - Loaded env from C:\\Users\\micro\\www\\admin\\.env.development\r\ninfo  - Loaded env from C:\\Users\\micro\\www\\admin\\.env\r\nevent - compiled client and server successfully in 10.2s (3534 modules)\r\nwait  - compiling...\r\nevent - compiled successfully in 2.1s (3325 modules)\r\nwait  - compiling /test (client and server)...\r\nevent - compiled client and server successfully in 521 ms (3537 modules)\r\nnode:internal/child_process:821\r\n        handle.setSimultaneousAccepts(true);\r\n               ^\r\n\r\nTypeError: handle.setSimultaneousAccepts is not a function\r\n    at target._send (node:internal/child_process:821:16)\r\n    at target.send (node:internal/child_process:738:19)\r\n    at sendHelper (node:internal/cluster/utils:28:15)\r\n    at send (node:internal/cluster/primary:348:10)\r\n    at node:internal/cluster/primary:314:5\r\n    at SharedHandle.add (node:internal/cluster/shared_handle:30:3)\r\n    at queryServer (node:internal/cluster/primary:308:10)\r\n    at Worker.onmessage (node:internal/cluster/primary:254:5)\r\n    at ChildProcess.onInternalMessage (node:internal/cluster/utils:49:5)\r\n    at ChildProcess.emit (node:events:525:35)\r\n\r\nNode.js v18.13.0\r\nerror Command failed with exit code 1.\r\n```\r\n\r\nWhere am I wrong? I could understand having an error on the browser, not directly on the console like that..."}
{"sentences": "beforeInteractive Script in import", "description": "I have some `<Script>`s using `strategy=\"beforeInteractive\"`. To keep my code organized, I'd like to separate them into their own files, rather than inline in `_document.tsx`. My code looks like this:\r\n```tsx\r\n// pages/_document.tsx\r\nimport {Html, Head, Main, NextScript} from \"next/document\";\r\n\r\nimport {ThirdPartyScript} from \"../components/tags/ThirdParty\";\r\n\r\nexport default function Document() {\r\n  return (\r\n    <Html>\r\n      <Head>\r\n        <link rel=\"shortcut icon\" href=\"/favicon.ico\" />\r\n        <ThirdPartyScript />\r\n      </Head>\r\n      <body>\r\n        <Main />\r\n        <NextScript />\r\n      </body>\r\n    </Html>\r\n  );\r\n}\r\n\r\n// components/tags/ThirdParty.tsx\r\nimport Script from \"next/script\";\r\n\r\nexport function ThirdPartyScript() {\r\n  return (\r\n    <Script strategy=\"beforeInteractive\">\r\n      {/* long inline script */}\r\n    </Script>\r\n  );\r\n}\r\n```\r\n\r\nThis is giving me a warning\r\n\r\n> `next/script`'s `beforeInteractive` strategy should not be used outside of `pages/_document.js`. See: [@next/next/no-before-interactive-script-outside-document](https://nextjs.org/docs/messages/no-before-interactive-script-outside-document).\r\n\r\nIs it safe to disable the lint warning in this case, since it actually is getting rendered into `_document.tsx`? Or is Next doing some magic where it needs to directly appear in `_document.tsx`, not imported?"}
{"sentences": "Tailwind CSS stopped working when I switched to using the `/app` directory", "description": "I made a new next project yesterday using create t3 app, and after I changed it to use the new beta `/app` directory, tailwind stopped providing css. Does anyone know how to fix this?\r\n\r\n\r\n```ts\r\n// tailwind.config.cjs\r\n/** @type {import('tailwindcss').Config} */\r\nmodule.exports = {\r\n    content: [ './src/**/*.{js,ts,jsx,tsx}' ],\r\n    theme: {\r\n        extend: {\r\n            colors: {\r\n            },\r\n        },\r\n    },\r\n    plugins: [],\r\n}\r\n```\r\n\r\n```ts\r\n// package.json\r\n{\r\n    \"dependencies\": {\r\n        \"lodash\": \"^4.17.21\",\r\n        \"next\": \"13.1.6\",\r\n        \"react\": \"18.2.0\",\r\n        \"react-dom\": \"18.2.0\",\r\n        \"zod\": \"^3.20.2\"\r\n    },\r\n    \"devDependencies\": {\r\n        \"@types/lodash\": \"^4.14.191\",\r\n        \"@types/node\": \"^18.11.18\",\r\n        \"@types/react\": \"^18.0.26\",\r\n        \"@types/react-dom\": \"^18.0.10\",\r\n        \"@typescript-eslint/eslint-plugin\": \"^5.47.1\",\r\n        \"@typescript-eslint/parser\": \"^5.47.1\",\r\n        \"autoprefixer\": \"^10.4.7\",\r\n        \"eslint\": \"^8.30.0\",\r\n        \"eslint-config-next\": \"13.1.6\",\r\n        \"postcss\": \"^8.4.14\",\r\n        \"tailwindcss\": \"^3.2.0\",\r\n        \"typescript\": \"^4.9.4\"\r\n    },\r\n    \"ct3aMetadata\": {\r\n        \"initVersion\": \"7.5.1\"\r\n    }\r\n}\r\n```\r\n\r\nfile structure:\r\n![image](https://user-images.githubusercontent.com/31667350/219142174-12c22570-23c6-4d7f-b59f-3dcf52fc00f6.png)\r\n"}
{"sentences": "[v13] generateMetadata not having any props, am i missing any configuration?", "description": "![image](https://user-images.githubusercontent.com/86401710/218667416-4b1fa4d8-8e54-46f4-82ec-62f797e9ee4e.png)\r\n"}
{"sentences": "Static routes don't take precedence over dynamic routes (Nextjs 13.1.5)", "description": "I have a dynamic route like `/app/admin/[section]/page.jsx` and a static route like `/app/admin/settings.jsx`.\r\n\r\nContent of the file `/app/admin/[section]/page.jsx `:\r\n```jsx\r\nexport default function Page() {\r\n  return 'dynamic route'\r\n}\r\n```\r\n\r\nContent of the file `/app/admin/settings.jsx`:\r\n```jsx\r\nexport default function Page() {\r\n  return 'static route'\r\n}\r\n```\r\n\r\nHitting the url `/admin/settings` I would expect to receive the contents of the `settings.jsx` file, but instead it fall into the dynamic route.\r\n\r\nThis is the folder structure:\r\n![image](https://user-images.githubusercontent.com/13695638/219050858-a1c0b7ce-1503-44e0-8fea-a0b29a3bf4a6.png)\r\n\r\nAnd this is the result if hit localhost:3000/admin/settings:\r\n![image](https://user-images.githubusercontent.com/13695638/219050918-823bb7e4-0525-4e83-bd17-58e1b38b2c46.png)\r\n\r\nA different behavior is described [in the documentation](https://nextjs.org/docs/routing/dynamic-routes#caveats):\r\n```\r\nPredefined routes take precedence over dynamic routes, and dynamic routes over catch all routes. Take a look at the following examples:\r\npages/post/create.js - Will match /post/create\r\npages/post/[pid].js - Will match /post/1, /post/abc, etc. But not /post/create\r\npages/post/[...slug].js - Will match /post/1/2, /post/a/b/c, etc. But not /post/create, /post/abc\r\n```\r\n\r\nI'm using Nextjs 13.1.5."}
{"sentences": "TypeError: Cannot read properties of undefined (reading 'compat')", "description": "package versions used :\r\n    \"@mui/lab\": \"^5.0.0-alpha.90\",\r\n    \"@mui/material\": \"^5.9.0\",\r\n    \"@mui/styles\": \"^5.9.0\",\r\n    \"@emotion/react\": \"^11.10.5\",\r\n    \"@emotion/styled\": \"^11.10.5\",\r\n    \"next\": \"12.2.2\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n\r\nI don't know what is causing this error but I'm not able to see my pages whenever I start my server I get the above error message. I'm attaching a simple 404 page code from my codebase\r\n\r\n```\r\nimport { motion } from \"framer-motion\";\r\nimport Link from \"next/link\";\r\n// material\r\nimport { styled } from \"@mui/material/styles\";\r\nimport { Box, Button, Typography, Container } from \"@mui/material\";\r\n// components\r\nimport { MotionContainer, varBounceIn } from \"../src/components/animate\";\r\nimport Page from \"../src/components/Page\";\r\nimport { PageNotFoundIllustration } from \"../src/assets\";\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nconst RootStyle = styled(Page)(({ theme }) => ({\r\n  display: \"flex\",\r\n  minHeight: \"100%\",\r\n  alignItems: \"center\",\r\n  paddingTop: theme.spacing(5),\r\n  paddingBottom: theme.spacing(10),\r\n}));\r\n\r\n// ----------------------------------------------------------------------\r\n\r\nexport default function Page404() {\r\n  return (\r\n    <RootStyle title=\"404 Page Not Found | aarnâ\">\r\n      <Container>\r\n        <MotionContainer initial=\"initial\" open>\r\n          <Box sx={{ maxWidth: 480, margin: \"auto\", textAlign: \"center\" }}>\r\n            <motion.div variants={varBounceIn}>\r\n              <Typography variant=\"h3\" paragraph>\r\n                sorry, page not found!\r\n              </Typography>\r\n            </motion.div>\r\n            <Typography sx={{ color: \"text.secondary\" }}>\r\n              sorry, we couldn't find the page you're looking for. perhaps\r\n              you've mistyped the URL? be sure to check your spelling.\r\n            </Typography>\r\n\r\n            <motion.div variants={varBounceIn}>\r\n              <PageNotFoundIllustration\r\n                sx={{ height: 260, my: { xs: 5, sm: 10 } }}\r\n              />\r\n            </motion.div>\r\n\r\n            <Link href=\"/\">\r\n              <Button\r\n                size=\"large\"\r\n                variant=\"contained\"\r\n                sx={{ textTransform: \"none\" }}\r\n              >\r\n                go to home\r\n              </Button>\r\n            </Link>\r\n          </Box>\r\n        </MotionContainer>\r\n      </Container>\r\n    </RootStyle>\r\n  );\r\n}\r\n```\r\n\r\nAny feedback is much appreciated. Urgent help required as my production is down."}
{"sentences": "next/image lazy loading and fade in animation", "description": "Is there a way to get loading information about next/image component, in order to create lazy load animations, like fade in?"}
{"sentences": "Next js & Next Auth - \"sign in with the same account you used originally\" while using same provider", "description": "Hello there!\r\n\r\nI've just updated my [...nextauth].js to be able to assign a \"role\" at sign-up for each user through req.cookies.role.\r\nHowever, now, it seems that for each new user that I create, I get the error '\"sign in with the same account you used originally\" while using same provider' when I try to re sign-in using the same Provider (Google).\r\n\r\nI don't understand where the error comes from... Does it consider it as a \"different provider\" because the first time (sign up) I have added \"role\" in query and when coming back (sign in) I am not passing any role if the user already exists? Trying to find a rational explanation... 😅\r\n\r\nHere's my ...nextauth.js:\r\n\r\n`import NextAuth from \"next-auth\";\r\nimport GoogleProvider from \"next-auth/providers/google\";\r\nimport { MongoDBAdapter } from \"@next-auth/mongodb-adapter\";\r\nimport clientPromise from \"../../../lib/mongodb\";\r\nimport EmailProvider from \"next-auth/providers/email\";\r\nimport { MongoClient } from \"mongodb\";\r\n\r\n\r\nfunction auth(req, res) {\r\n  return NextAuth(req, res, authOptions(req, res));\r\n}\r\n\r\nexport function authOptions(req, res) {\r\n  return {\r\n    providers: [\r\n      GoogleProvider({\r\n        clientId: process.env.GOOGLE_CLIENT_ID,\r\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n      }),\r\n\t\t\tEmailProvider({\r\n\t\t\t\tserver: {\r\n\t\t\t\t\thost: process.env.EMAIL_SERVER_HOST,\r\n\t\t\t\t\tport: process.env.EMAIL_SERVER_PORT,\r\n\t\t\t\t\tauth: {\r\n\t\t\t\t\t\tuser: process.env.EMAIL_SERVER_USER,\r\n\t\t\t\t\t\tpass: process.env.EMAIL_SERVER_PASSWORD,\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tfrom: process.env.EMAIL_FROM,\r\n\t\t\t}),\r\n    ],\r\n\t\tsecret: process.env.NEXTAUTH_SECRET,\r\n\t\tpages: {\r\n\t\t\tsignOut: \"/auth/signout\",\r\n\t\t\terror: \"/auth/error\", // Error code passed in query string as ?error=\r\n\t\t},\r\n    callbacks: {\r\n      async session({ session, user, token }) {\r\n\t\t\t\tsession.user._id = user.id;\r\n        const client = await clientPromise;\r\n\r\n        const db = client.db(\"main\");\r\n        const usersCollection = db.collection(\"users\");\r\n        const existingUser = await usersCollection.findOne({\r\n          email: session.user.email,\r\n        });\r\n\r\n        if (!existingUser) {\r\n          session.user.role = req.cookies.role;\r\n        }\r\n        const updateData = async () => {\r\n          if (existingUser && !existingUser.role) {\r\n            await usersCollection.updateOne(\r\n              { email: session.user.email },\r\n              { $set: { role: \"talent\" } }\r\n            );\r\n\r\n            session.user.role = await existingUser.role;\r\n          } else if (existingUser && existingUser.role) {\r\n            session.user.role = await existingUser.role;\r\n          }\r\n        };\r\n\r\n        updateData();\r\n        return session;\r\n      },\r\n\t\t\tasync signIn({ user, account, profile, email, credentials }) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n    },\r\n    adapter: MongoDBAdapter(clientPromise),\r\n  };\r\n}\r\nexport default auth;\r\n`\r\n\r\nThanks for your help!"}
{"sentences": "cb.apply is not a function", "description": "I am facing an issue when installing next.js on Win10 OS\r\n- Node version 15.4.0 ( installed with nodist ) \r\n- Npm  version 7.7.6\r\nThere are full text about error.\r\n`PS C:\\xxx> npx create-next-app nextjs-blog`\r\n`npm ERR! cb.apply is not a function`\r\n`Install for [ 'create-next-app@latest' ] failed with code 1`\r\n\r\nPlease let me know how to fix it."}
{"sentences": "How To Fix NODE_ENV value in my environment.", "description": "Whenever I run `npm run dev` i am getting this Warning message. How to fix it.\r\n\r\n![image](https://user-images.githubusercontent.com/58598919/217294350-d2286bdb-aa3d-4f81-b002-1dc7f87c7cc4.png)\r\n"}
{"sentences": "Error updating Next.js to versions above 13.0", "description": "**next-auth: 4.19 works fine in next: 13.0**\r\n**but updating Next.js to versions above ^13.0 throws this error:**\r\n\r\n![Ativo 3](https://user-images.githubusercontent.com/67167087/217079338-cf480675-7ca6-4a60-8b94-244f69e70576.png)\r\n![error1](https://user-images.githubusercontent.com/67167087/217074869-5ba66a9d-27f3-4c59-b51f-222aede3f429.png)\r\n![error2](https://user-images.githubusercontent.com/67167087/217074890-ab4c665a-b35a-4a32-b3bd-6f5fcd8dfa4b.png)\r\nI have no idea how to solve it, please help me I'm at your disposal."}
{"sentences": "e.stopPropagation doesn't work inside nextjs Link component", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n____\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\n_No response_\n\n### Link to the code that reproduces this issue\n\nhttps://github.com/zwelhtetyan/tiktok\n\n### To Reproduce\n\n_____\n\n### Describe the Bug\n\n![Screenshot from 2023-02-02 16-15-26](https://user-images.githubusercontent.com/89287841/216292369-8286a452-a59d-48e7-b133-473c94049ec6.png)\r\n\n\n### Expected Behavior\n\nshouldn't go back to index route when click button that stop propagation\n\n### Which browser are you using? (if relevant)\n\nchrome\n\n### How are you deploying your application? (if relevant)\n\n_No response_"}
{"sentences": "why does getSession return null on my Ubuntu server?", "description": "I get the user id from session in `getServersidesprops` and use the id to get the data on the server side and return the props to my page component. I have the following in my file.\r\n\r\n```\r\nimport { getSession } from 'next-auth/react';\r\n\r\n.....\r\nexport async function getServerSideProps(context) {\r\n    .................\r\n    const session = await getSession(context);\r\n    .................\r\n}\r\n```\r\nOn my remote server, session is null. My server is on Ubuntu 20. However, on my localhost and the server of Onrender, session has an expected value returned from getSession method. What is reason this is happening?\r\n\r\nthe following is part of the error message\r\n```\r\n  url:  '<based_url>/api/auth/session',\r\n  message: 'Unexpected token < in JSON at position 0'\r\n```\r\n"}
{"sentences": "What is refractor lang package", "description": "Hi, I did a bundle analyze scan on my Next.js app.   One of the biggest chunks is from node_modules the refractor > lang module.\r\n\r\nIt seems Next.js is adding this,  is there a way to remove this?  or is this a necessary thing?\r\n\r\n<img width=\"1410\" alt=\"image\" src=\"https://user-images.githubusercontent.com/8095506/189706636-4f5eb4cf-8a9d-4a31-96c6-c53f8f0db5b0.png\">\r\n"}
{"sentences": "Next js App Directory Locale and BasePath Change", "description": "I'm following a guide provided by next js to implement Internationalization. how can i update by basePath e.g. if i have language switcher and my default locale is en and my path will become localhost:3000/en and by switching it to fr i want my basePath to update to localhost:3000/fr like that so that whenever i open a new page lets say about-us my basePath should start from localhost:3000/fr instead of localhost:3000/en which is a default one. "}
{"sentences": "For one page", "description": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 21.6.0: Sun Nov  6 23:31:16 PST 2022; root:xnu-8020.240.14~1/\r\nBinaries:\r\n      Node: 16.18.1\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/\r\nRelevant packages:\r\n      next: 12.3.4\r\n      eslint-config-next: 12.3.4\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\nStatic HTML Export (next export)\r\n\r\n### Link to the code that reproduces this issue\r\n\r\n---\r\n\r\n### To Reproduce\r\n\r\nStarting a project with `yarn dev` or exporting it and putting as a static page\r\n\r\n### Describe the Bug\r\n\r\nEven after I add the below meta line to my head tag for the `_app` or individual pages, there is some weird empty space on the side. Interestingly, when I check in the dev tools, this space seems not to be a part of the HTML element.\r\n<img width=\"957\" alt=\"Screenshot 2023-01-25 at 09 55 38\" src=\"https://user-images.githubusercontent.com/31480935/214521523-785f9738-4e7f-4c82-a77b-ba185b2216ae.png\">\r\n<img width=\"928\" alt=\"Screenshot 2023-01-25 at 09 56 00\" src=\"https://user-images.githubusercontent.com/31480935/214521537-94f1103a-7d16-46cc-9d63-2befd7a5c0fc.png\">\r\n\r\n```html\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n```\r\n\r\nInitially, the page is zoomed in so that this space is not visible, but one can scroll through it or zoom out. I tried adding the below overscroll-behavior to global CSS, but it did not help; still, scrolling to the side and zooming out are possible.\r\n```css\r\n// global.css\r\n@tailwind base;\r\n@tailwind components;\r\n@tailwind utilities;\r\n\r\nhtml,\r\nbody {\r\n  padding: 0;\r\n  margin: 0;\r\n  overscroll-behavior: none;\r\n  background-color: #000000;\r\n}\r\n```\r\n\r\nI am not able to replicate the same issue on any other pages that I have created. \r\n\r\n### Expected Behavior\r\n\r\nThe page is built properly\r\n\r\n### Which browser are you using? (if relevant)\r\n\r\nFirefox\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\nCloudflare Pages, yarn dev"}
{"sentences": "nextjs server always return string for binary data", "description": "Hi, \r\n\r\nI have a image sent from nextjs server as response for http post request. Below is the sample code i use to send the data from nextjs server. \r\n\r\n  let buff = Buffer.from(data as any)  // data as an uint8array from a png image. \r\n  res.status(200).send(buff);\r\n\r\n1. it seems the buffer payload in browser, returned from server, is always of type \"string\", sth like the attached picture shows: \r\n\r\n![Screenshot from 2023-01-29 06-09-26](https://user-images.githubusercontent.com/455617/215331845-9303cd5e-4c94-4d5b-b6d6-48f687fa2889.png)\r\n \r\nWhy nextjs server cannot return raw byte array but need to use string encoding ?   It seems to be nodejs might not have this limitation ? \r\n \r\nThanks in advance for your help, \r\n\r\n\r\n\r\n\r\n\r\n "}
{"sentences": "Fetch to local API endpoint does not fire", "description": "I'm attempting to call an API endpoint located at 'src/pages/api/forwardRequest' via a fetch request being called from a useSWR fetcher (getAccount). useSWR is properly calling the fetcher periodically, but the fetch request itself is _not_ firing, or at least it's getting stuck in some sort of limbo. \r\n\r\nThe endpoint itself isn't being hit at all, oddly.\r\n\r\nAll the relevant code here in CodeSandbox: https://codesandbox.io/p/sandbox/frosty-matan-5kveoh "}
{"sentences": "How to detect a rewrite in getServerSideProps?", "description": "I'm doing a rewrite in next.config.js like:\r\n```\r\n        {\r\n          source: \"/@:id\",\r\n          destination: \"/foo/:id\",\r\n        },\r\n```\r\nI want to only allow the rewritten URLs, and return a 404 for direct requests to /foo/{id}.  Is it possible to detect the rewrite in `getServerSideProps`?  I see a `_nextDidRewrite` property in `Symbol(NextRequestMeta)`, but that seems like digging where I should not dig.\r\n\r\nAny suggestions here?"}
{"sentences": "Passing data from localStorage to getServerSideProps", "description": "Hello guys! \r\nI have kinda problem with my JWT token, today i tried to shoot an endpoint for my user data, and then i see 401!, what the heck? \r\nOkay, so i investigated, and there is a problem that my axios doesn't have Authorization token attached yet when i render this data.\r\nIs there any way to smuggle a string around whole project, like localStorage, but it needs to be accessible on server side of application ? \r\nCheeeers!!"}
{"sentences": "Can't reach to 404 pages automatically when user go invalid url", "description": "## Issue\r\nWhen user put wrong URL, pages doesnt go 404 pages (neither basic 404 pages of Nex.js) automatically.\r\n\r\n> 404 pages url\r\n\r\n![image](https://user-images.githubusercontent.com/56015532/213411611-e31859ed-b111-4a3f-9815-02f19f630d4c.png)\r\n\r\n> wrong url doesn't show 404 pages\r\n\r\n![image](https://user-images.githubusercontent.com/56015532/213411704-e9574bb5-4a15-43b6-b6e4-c6e44dbf3c35.png)\r\n\r\n## Tried\r\nLocal : delete `.next` folder > yarn build > yarn start \r\nServer : Deploy on AWS / Deploy on vercel \r\n\r\n\r\n## Problem\r\nboth site has same `_404.tsx` and `_error.tsx` and both site has same issue that can't reach to `_404.tsx` when user go to invalid url.\r\n\r\n\r\n## Code (404)\r\n```ts\r\n404.tsx\r\nimport * as React from 'react';\r\nimport { RiAlarmWarningFill } from 'react-icons/ri';\r\n\r\nimport Layout from '@/components/layout/Layout';\r\nimport ArrowLink from '@/components/links/ArrowLink';\r\nimport Seo from '@/components/Seo';\r\n\r\nexport default function NotFoundPage() {\r\n  return (\r\n    <Layout>\r\n      <Seo templateTitle='Not Found' />\r\n\r\n      <main>\r\n        <section className='bg-white'>\r\n          <div className='layout flex min-h-screen flex-col items-center justify-center text-center text-black'>\r\n            <RiAlarmWarningFill\r\n              size={60}\r\n              className='drop-shadow-glow animate-flicker text-red-500'\r\n            />\r\n            <h1 className='mt-8 text-2xl'>Wrong Pages</h1>\r\n          </div>\r\n        </section>\r\n      </main>\r\n    </Layout>\r\n  );\r\n}\r\n\r\n```\r\n\r\n\r\n## Code (Middleware)\r\n``` ts\r\n_app.tsx\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport AOS from 'aos';\r\nimport { SessionProvider } from 'next-auth/react';\r\nimport React, { useEffect } from 'react';\r\nimport { QueryClient, QueryClientProvider } from 'react-query';\r\n\r\nimport '@/styles/aos.scss';\r\nimport '@/styles/globals.css';\r\nimport '@/styles/colors.css';\r\n\r\n// !STARTERCONF This is for demo purposes, remove @/styles/colors.css import immediately\r\n\r\n/**\r\n * !STARTERCONF info\r\n * ? `Layout` component is called in every page using `np` snippets. If you have consistent layout across all page, you can add it here too\r\n */\r\n\r\nconst MyApp = ({\r\n  Component,\r\n  pageProps: { session, ...pageProps },\r\n}: {\r\n  Component: any;\r\n  pageProps: any;\r\n}) => {\r\n  const [queryClient] = React.useState(() => new QueryClient());\r\n\r\n  // AOS animation\r\n  useEffect(() => {\r\n    AOS.init({\r\n      once: true,\r\n      duration: 500,\r\n      easing: 'ease-out-cubic',\r\n    });\r\n  });\r\n\r\n  return (\r\n    // next-auth\r\n    <SessionProvider session={session}>\r\n      {/* infiniteScroll */}\r\n      <QueryClientProvider client={queryClient}>\r\n        {/* PageProps */}\r\n        <Component {...pageProps} />\r\n\r\n        {/* Debug Mode */}\r\n        {/* import { ReactQueryDevtools } from 'react-query/devtools';\r\n        <ReactQueryDevtools initialIsOpen={false} /> */}\r\n      </QueryClientProvider>\r\n    </SessionProvider>\r\n  );\r\n};\r\n\r\nexport default MyApp;\r\n\r\n```\r\n\r\n## Code (config)\r\n```ts\r\nnext.config.js \r\n\r\n/** @type {import('next').NextConfig} */\r\nmodule.exports = {\r\n  compiler: {\r\n    removeConsole: true,\r\n  },\r\n  output: 'standalone',\r\n  eslint: {\r\n    dirs: ['src'],\r\n  },\r\n  exportPathMap: async function (\r\n    defaultPathMap,\r\n    { dev, dir, outDir, distDir, buildId }\r\n  ) {\r\n    return {\r\n      '/': { page: '/' },\r\n    };\r\n  },\r\n  experimental: {\r\n    images: { unoptimized: true },\r\n  },\r\n\r\n  reactStrictMode: true,\r\n\r\n  async rewrites() {\r\n    return [\r\n      {\r\n        source: '/:path*',\r\n        destination: '/:path*',\r\n      },\r\n      {\r\n        source: '/:path*',\r\n        destination: `https://api.cue8949.com/:path*`,\r\n      },\r\n    ];\r\n  },\r\n\r\n  // Uncoment to add domain whitelist\r\n  images: {\r\n    domains: ['image.cue8949.com'],\r\n  },\r\n\r\n  // SVGR\r\n  webpack(config) {\r\n    config.module.rules.push({\r\n      test: /\\.svg$/i,\r\n      issuer: /\\.[jt]sx?$/,\r\n      use: [\r\n        {\r\n          loader: '@svgr/webpack',\r\n          options: {\r\n            typescript: true,\r\n            icon: true,\r\n          },\r\n        },\r\n      ],\r\n    });\r\n\r\n    return config;\r\n  },\r\n};\r\n\r\n```\r\n\r\n\r\nAny Help ? 🙏\r\n\r\n\r\n"}
{"sentences": "Server-side fetch returns a 403 on build", "description": "I'm migrating an app from **create-react-app** to **nextjs**. When fetching an item from the db backend I used the following in the original **create-react-app**:\r\n\r\n    export async function fetchSingleItem(item_id) {\r\n    \r\n    \ttry {\r\n    \r\n    \t\tlet fields = [\r\n    \t\t\t'item_title',\r\n    \t\t\t'item_description',\r\n    \t\t]\r\n    \r\n    \t\tlet url = api_server_url + \"/items/\" + item_id + \"?fields=\" + fields;\r\n    \t\tconst fetchit = await fetch(url);\r\n    \t\tif (!fetchit.ok) {\r\n    \t\t\tthrow \"Sorry, failed to fetch item data, there was some problem\";\r\n    \t\t}\r\n    \t\tconst fetchitjson = fetchit.json();\r\n    \t\treturn fetchitjson;\r\n    \r\n    \t}\r\n    \tcatch(error) {\r\n    \r\n    \t\t..error handling ...\r\n    \t\t\r\n    \t}\r\n    \r\n    }\r\n\r\nThis still works as intended in nextjs as a server-side component when running in *dev* but not in *build*.\r\n\r\nWhen I attempt to *build*, it returns a 403.\r\n\r\nLooking at the [docs][1] (I'm using nextjs13 with experimental 'app' directory) it suggests that using fetch for server-side is fine. I'm not using typescript.\r\n\r\n\r\n### Backend\r\n\r\nThe backend is set up to allow cors and all origins. I still assume this is working as intended as, in the create-react-app, I had no problem running this same function from localhost and on a production server with a different domain.\r\n\r\n\r\n### Question\r\n\r\nI've no idea what's causing fetch to 403 when building, but not when running in *dev*. I've tried various fetch options and none worked. I don't need any additional options when running in *dev* for fetch to pull date as intended, so I'm not sure if that's the problem with *build*.\r\n\r\n\r\n  [1]: https://beta.nextjs.org/docs/data-fetching/fetching"}
{"sentences": "Implement a way to get data on Head and Page from a single database query", "description": "### Describe the feature you'd like to request\r\n\r\nTo start, I want to thank you for the awesome work. I have been enjoying Next.js 13 a lot and all these amazing features that you bring to us.\r\n\r\nExperimenting with the new app directory architecture, I found it very hard to get the same data in `Head.jsx` and `Page.jsx` from a single query from the database.\r\n\r\nIn the following example, I am trying to get the title of the page for the `Head`, and using this title as `h1` as well.\r\n\r\nRight now, this is going to result in two different database queries:\r\n\r\n\r\n### Two separate queries to the Database\r\n```jsx\r\n// head.jsx\r\nimport { getPageInfoFromDatabase } from '../database/index';\r\n\r\nexport default async function Head() {\r\n  // Database query No. 1\r\n  const pageInfo = await getPageInfoFromDatabase();\r\n\r\n  return (\r\n    <>\r\n      <title>{pageInfo.title}</title>\r\n      <meta name=\"description\" content={pageInfo.description} />\r\n      <link rel=\"icon\" href=\"/favicon.ico\" />\r\n    </>\r\n  );\r\n}\r\n```\r\n```jsx\r\n// page.jsx\r\nimport { getPageInfoFromDatabase } from '../database/index';\r\n\r\nexport default async function Home() {\r\n  // Database query No. 2\r\n  const pageInfo = await getPageInfoFromDatabase();\r\n\r\n  return (\r\n    <main>\r\n        <h1>{pageInfo.title}</h1>\r\n        <p>{pageInfo.data} </p>\r\n    </main>\r\n  );\r\n}\r\n```\r\n\r\nI also created a reproduction example that presents query data directly from the page. In the example, it can be tested how the direct call approach results in multiple function call.\r\n\r\nhttps://github.com/Josehower/next-13-data-fetching-demo\r\n\r\n### Describe the solution you'd like\r\n\r\nA possible solution would be either:\r\n\r\n1. A way to communicate between `Head`, `Layout`, and `Page` components so that I can perform a single query to get data on all of them without using an API. Similar to how you can pass props from `_app.js` to the page components\r\n\r\nA possible API for this communication may be this:\r\n```jsx\r\n// layout.jsx\r\nimport { getPageInfoFromDatabase } from '../database/index';\r\n\r\nexport default async function RootLayout({ Head, Page }) {\r\n  const pageInfo = await getPageInfoFromDatabase();\r\n  return (\r\n    <html lang=\"en\">\r\n      <Head pageInfo={pageInfo} />\r\n      <body>\r\n        <Page pageInfo={pageInfo} />\r\n      </body>\r\n    </html>\r\n  );\r\n} \r\n```\r\n\r\n3. Next.js using a similar approach to fetch() [Deduping](https://beta.nextjs.org/docs/data-fetching/fundamentals#automatic-fetch-request-deduping) for direct database/function calls\r\n\r\n\r\n### Describe alternatives you've considered\r\n\r\nI am aware that Next.js perform a [fetch deduping ](https://beta.nextjs.org/docs/data-fetching/fundamentals#automatic-fetch-request-deduping) when `Head` and `Page` perform a fetch to the same URL (API routes for example). This theoretically would solve my issue but will add some unnecessary HTTP request overhead.\r\n\r\n\r\n"}
{"sentences": "My DX is gone because of `Refreshing page data due to server-side change`", "description": "Hi team,\r\n\r\nFor some unknown reason, at random, when I change the code it triggers the `Refreshing page data due to server-side change`. There's no pattern, I can't reproduce nor give examples. It just happens at random and I'm losing my mind over it.\r\n\r\nEven changing just a letter on the code triggers it. Sometimes it doesn't sometimes it does.\r\n\r\nSo the approach I was looking for to try to solve this is to understand better what triggers the so called \"server-side change\".\r\n\r\nDoes anyone can explain to me a little bit of how this message `Refreshing page data due to server-side change` works? I had no luck with Google or Next.js documentation."}
{"sentences": "Nextjs Api routes working in development but failing in production", "description": "I have an api at /pages/api/chatbot which I am posting a request to. \r\n\r\nDevelopment works:\r\n```js\r\nfetch(\"/api/chatbot/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ query }),\r\n    })\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setResponse(data.query)\r\n      })\r\n      .then(() => setLoading(false))\r\n```\r\n\r\nProduction fails however.\r\n```js\r\nfetch(\"https://history-maps.com/api/chatbot/\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ query }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then((data) => {\r\n          setResponse(data.query)\r\n        })\r\n        .then(() => setLoading(false))\r\n```\r\n\r\nI'm getting a post 500 error.\r\n```js\r\nPOST https://history-maps.com/api/chatbot 500\r\n```\r\n\r\nI'm not sure whats wrong."}
{"sentences": "jsonwebtoken 8.5.1 dependecy -  High-severity Vulnerability", "description": "Hi, there are plans for NextJs to update the jsonwebtoken dependency from 8.5.1 to the 9.0.0 that contains the fix to the vulnerabiliy https://github.com/advisories/GHSA-27h2-hvpr-p74q?"}
{"sentences": "Are here any ENV for define between build time / SSR / CSR", "description": "I'm working on something it only run on build time and not run on SSR or CSR.\r\nAny idea? 👀\r\nthanks a lot. "}
{"sentences": "Does Vercel support Next.js APIs from an NX monorepo?", "description": "Does Vercel support deploying Next.js APIs from an NX monorepo? I can get APIs to deploy locally, but they give me 404s on Vercel. I have a [barebones repo](https://github.com/jtlapp/fieldzoo), deployed to Vercel [here](https://fieldzoo.vercel.app/). The [api/test](https://fieldzoo.vercel.app/api/test) API works locally but not on Vercel. Vercel sent me an email confirmation that my API revision was deployed.\r\n\r\n![Screen Shot 2023-01-19 at 09 59 18](https://user-images.githubusercontent.com/138133/213476711-c41ad069-eae4-40e5-adcf-186630ef46b5.png)"}
{"sentences": "Prefetch differences between Next 12.1.5 and Next 13.1.0", "description": "I notice a difference when using `next/link` in how prefetching and client-side hydration works.\r\n\r\nIn 12.1.5 in my project, prefetch requests (visible in the chrome network tab) point to the URL of the page, and in 13.1.0 they point to a different `_next/data` URL.\r\n```\r\nPrefetch request examples:\r\n12.1.5: https://mysite.com/fr/story/723499547279\r\n13.1.0: https://mysite.com/_next/data/7pvRw5C5PsPFLHE2wedVQ/fr/story/723499547279\r\n```\r\n\r\nNote: in Next 13 the prefetch URL is the same as the client-side hydration URL.\r\n\r\nMy project uses the `getServerSideProps` function, so the prefetch in 13.1.0 returns an empty object `{}` because (my understanding) `getServerSideProps` is not called during a prefetch. However, the client-side hydration request returns a `props` object with my fetched data from `getServerSideProps`.\r\n\r\nSo both the prefetch and client-side hydration share the same URL, but prefetch and clientside hydration have different responses. This is an issue for me because I cache (CDN) the prefetch URL, and then I do not have data for the client-side hydration. \r\n\r\nI can fix my cache issue by targeting the `purpose: prefetch` header in my cache layer to create 2 cache objects. \r\n\r\nBut I would like to confirm first that the above observation is an intended change between Next 12 and Next 13 before I change my infra. \r\n\r\n```\r\n    Operating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 21.6.0: Thu Sep 29 20:13:56 PDT 2022; root:xnu-8020.240.7~1/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 16.18.1\r\n      npm: 7.24.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.1.0\r\n      eslint-config-next: 13.1.0\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n```"}
{"sentences": "Next.js Blog Dynamic Routes Tutorial - 404 when visiting `/pages/[id]`", "description": "Hi everyone,\r\n\r\nI've started learning Next.js by following the [starter blog tutorial](https://nextjs.org/learn/basics) but I'm stuck in the [\"Implement getStaticProps\"](https://nextjs.org/learn/basics/dynamic-routes/implement-getstaticprops) section. I'm getting a 404 error whenever I try to visit `localhost:3000/posts/ssr-ssg` or `localhost:3000/posts/pre-rendering`. \r\n\r\nI've triple-checked that `pages/posts/[id].js` and `lib/posts.js` match the files in the [`next-learn`](https://github.com/vercel/next-learn/blob/master/basics/dynamic-routes-step-1/) repo, as suggested by the tutorial's troubleshooting section, but it's still not working. I'm not sure if it's an issue with `getStaticPaths()` or `getStaticProps()` in the `pages/posts/[id].js` file.\r\n\r\nI've uploaded my files to a [public repo](https://github.com/ChromeUniverse/nextjs-blog). I would appreciate it if someone could clone it and take a look.\r\n\r\nThank you."}
{"sentences": "Setting value of textarea element in Next.js with ioredis", "description": "I am trying to set the value of a textarea element to Redis cache, and on page reload the same value will be displayed in the textarea element.\r\n\r\nHow do I fix the following to get what I want?\r\n\r\nThe following code is what I have tried.\r\n```js\r\nimport Redis from \"ioredis\";\r\nimport React, { useState } from \"react\";\r\n\r\n/* ---------------------------------------------------------------------------------------------------------- */\r\n\r\nexport const getServerSideProps = async () => {\r\n  \r\n  // Retrieve API token from Redis\r\n  const redis = new Redis({\r\n    host: \"redis\", // Redis host\r\n    port: \"6379\", // Redis port\r\n  });\r\n\r\n  // Get a key from Redis\r\n  const apiToken = await redis.get(\"apiToken\");\r\n\r\n  // Set a key in Redis\r\n  await redis.set(\"apiToken\", apiToken);\r\n\r\n  // Return both sets of data as props\r\n  return {\r\n    props: {\r\n      apiToken,\r\n    },\r\n  };\r\n};\r\n\r\n/* ---------------------------------------------------------------------------------------------------------- */\r\n\r\nexport default function Dashboard({ apiToken }) {\r\n  const [localApiToken, setApiToken] = useState(apiToken);\r\n\r\n  const handleApiTokenChange = async (e) => {\r\n    // Set the value of the textarea element in the component's state\r\n    setApiToken(e.target.value);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <textarea\r\n        className=\"ai-keyarea\"\r\n        placeholder=\"Paste in your timezone.\"\r\n        required\r\n        rows=\"3\"\r\n        cols=\"45\"\r\n        value={localApiToken}\r\n        onChange={handleApiTokenChange}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ---------------------------------------------------------------------------------------------------------- */\r\n\r\n```\r\nWith:\r\nNextjs Version: `^12.3.2`\r\nReact: `^18.0.0`\r\nReact-dom: `^18.0.0`\r\n\r\nAs to what the following code shows, I have updated the handleApiTokenChange function to set the value of the textarea element in Redis cache. However, when I run the build command, I am getting import errors for packages like dns.\r\n\r\n```js\r\nconst handleApiTokenChange = async (e) => {\r\n  // Set the value of the textarea element in the component's state\r\n  setApiToken(e.target.value);\r\n\r\n  // Set the value of the 'apiToken' key in Redis\r\n  const redis = new Redis({\r\n    host: \"redis\", // Redis host\r\n    port: \"6379\", // Redis port\r\n  });\r\n\r\n  await redis.set(\"apiToken\", e.target.value);\r\n};\r\n\r\n```"}
{"sentences": "Not able to read request headers in API middleware.ts", "description": "I can't get a basic API [middleware auth example](https://nextjs.org/docs/advanced-features/middleware#producing-a-response) working in `middleware.ts`; it's almost copy paste from the doc example but does not compile in `13.1.2`. perhaps I am overlooking something obvious?\r\n\r\n```\r\n// middleware.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { isAuthenticated } from '@lib/auth';\r\n\r\nexport const config = {\r\n  matcher: '/api/:function*',\r\n};\r\n\r\nexport function middleware(request: NextRequest) {\r\n  console.log(request.headers); // TS ERROR: unknown property headers; cannot access directly or via `headers.get()`;\r\n\r\n  if (!isAuthenticated(request)) {\r\n    return new NextResponse( // tried `NextResponse.json() too\r\n      JSON.stringify({ success: false, message: 'authentication failed' }),\r\n      { status: 401, headers: { 'content-type': 'application/json' } } // TS ERROR: ts(ts2345); the signature does not recognise `status` or `headers`\r\n    );\r\n  }\r\n}\r\n```"}
{"sentences": "Error with window.ethereum undefined", "description": "Hello, i'm getting an error: \"TypeError: undefined is not an object (evaluating 'window.ethereum.selectedAddress = undefined')\", but i don't have idea why. Can it be some malicious code from NPM package or something? \r\n\r\n"}
{"sentences": "Can I rename a JS chunk for a page?", "description": "Hi,\r\nI have a page called \"Analytics\" in my next.js app. By default, nextjs generates a JS chunk for each page and this chunk is called \"analytics.js\". The problem is that many ad blockers prevent this chunk from getting loaded. \r\nSo I was hoping I could tell next to use a different chunk name for that specific page. Any idea on how to do that?\r\nThank you"}
{"sentences": "<Link> using map Unhandled Runtime Error", "description": "I'm trying to build md blog preview when I next/link to linking using map it shows error\r\n![image](https://user-images.githubusercontent.com/66258652/212389752-d6b98fff-bb1c-47a0-846d-e537bb00ff80.png)\r\nif I use anchor tag it works file\r\n![image](https://user-images.githubusercontent.com/66258652/212390191-0314d0cd-6de0-4b40-81ab-d165a79120d0.png)\r\n\r\nneed help what is it I'm doing wrong.... "}
{"sentences": "What does disableOptimizedLoading do?", "description": "### Summary\n\nHello 🙂 \r\n\r\nI had a few questions around disableOptimizedLoading. We initially had it set to true when we were using Next11 and now we are using Next12 but in the next12 files(https://github.com/vercel/next.js/blob/v12.2.5/packages/next/server/config-shared.ts#L557),  disableOptimizedLoading is set to false. \r\n\r\nI am not sure if we should set it to true or false now?\r\n\r\nWe have a custom next js configuration.\r\n\r\nThank you very much!\r\n\n\n### Additional information\n\n_No response_\n\n### Example\n\n_No response_"}
{"sentences": "Error handling response: TypeError: Cannot read properties of null (reading '1')", "description": "Hi\r\nI'm creating new nextjs project \r\nBut when I run the project in the phone frame, this log is printed in the console\r\n```js \r\nError handling response: TypeError: Cannot read properties of null (reading '1')\r\n    at chrome-extension://pgjjikdiikihdfpoppgaidccahalehjh/webspeed.js:9:73298\r\n    at chrome-extension://pgjjikdiikihdfpoppgaidccahalehjh/webspeed.js:9:73485\r\n```"}
{"sentences": "Is it possible to disable the pre-rendering in a specific page?", "description": "Hi guys, hope you're well. \r\nI'm trying to make a page in my blog and it needs to **NOT** be pre-rendered in any way. The concept of pre-reder is presented in the tutorial (https://nextjs.org/learn/basics/data-fetching/pre-rendering). \r\nI need that this page assumes a normal React behavior, so the page will not be pre-rendered and the browser of the user will Hydrate the code with local javascript. Is it possible?\r\nThanks guys."}
{"sentences": "Detected Possible Cross-site Scripting on https://example.com/_next/?%3cscRipt%3enetsparker(0x0000BF)%3c%2fscRipt%3e  types urls", "description": "After running Pen test on website with the help of netsparker tool, found  Cross-site Scripting vulnerability on /_next/ URLs,  how we can resolve it ?\r\n\r\n .\r\n![image](https://user-images.githubusercontent.com/42937204/210739667-e51361f5-dddf-4d78-bbcb-44e8131e1d6d.png)\r\n"}
{"sentences": "Are user objects really just limited to \"this\" ?", "description": "Hello, so I wonder if the user object is really limited to: \r\n```js\r\n{\r\n  user: { name: \"\", email: \"\", image: \"\" },\r\n  expires: '2023-02-12T02:13:04.663Z'\r\n}\r\n```\r\n\r\nBecause I wanted to add a \"createdAt\":\r\n![](https://i.imgur.com/GVOSqcB.png)\r\nBut it doesn't work.\r\n\r\nAny idea ?\r\n\r\nRegards."}
{"sentences": "Im not able to replicate getStaticProps flow using next 13", "description": "my app requires to know the timezone and dates (eg. europe-berlin, 2023-01-10).\r\n\r\non next 12 to make sure I was getting faster load times with high dynamic data I created a route based on user timezone, so if I user was from europe-amsterdam I would redirect him to that route including the today's date. The route would be like this\r\n` /europe-amsterdam/2023-01-10.`\r\n\r\nThe today's date the data needs to update every 15 seconds while other dates are static and it will not change.\r\n\r\n\r\nin order to achieve this I was using getStaticProps with a On demand ISR, and on client side I was making fetch calls every 15 seconds. so a user that hit that route will have static data and once it calls the endpoint it revalidates, making every user getting updated data and at same time faster load times because I was not using getServerSideProps.\r\n\r\nI'm trying to migrate to next 13 and Im not able to replicate this logic, it states on docs that dynamic routes will always be on request time and not build time making it not possible to replicate what I had on next12. I did not use GetStaticPaths() so im assuming generateStaticParams its not the way to go.\r\n\r\n only thing I did besides getStaticProps that I did on next12 with it was \r\n \r\n```\r\nexport const getStaticPaths: GetStaticPaths<{ slug: string }> = async () => {\r\n  return {\r\n    paths: [], //indicates that no page needs be created at build time\r\n    fallback: \"blocking\", //indicates the type of fallback\r\n  };\r\n}\r\n;\r\n```\r\n\r\nIm not sure if Im missing something but I would appreciate some guidance on this\r\n"}
{"sentences": "Enable package.json home page output", "description": "I'm creating a next.js project with chakra-ui and I use `yarn build && yarn export` . But when I put\r\n```json\r\n{\r\n  \"homepage\": \"test\"\r\n}\r\n```\r\non package.json, the output resources always `/_next/static`\r\n\r\nI want to, as in the example above, `test/_next/static` or `./_next/static`"}
{"sentences": "Pass a stable and random id from Server to Client Component?", "description": "I'd like to generate a stable and random id in a server component that can be passed to a client component. The client approach, useId(), isn't compatible. Since (to my understanding) server components are stable per route loaded, would a simple crypto.randomUUID() work?"}
{"sentences": "How to run the middleware only once at the first visit?", "description": "In a bilingual website, we implemented redirection with the middleware Geolocation object.  \r\nIt should only run in the first visit to redirect user to the right locale, and ignore all other in-page navigations (selecting another country). To allow users to checkout other countries.   \r\nIn other words it shouldn't run on `<Link />` components or `router.push()`.\r\n\r\nThe middleware looks like this:\r\n\r\n``` js\r\nexport async function middleware(req: NextRequest) {\r\n  if (countryFromURL !== countryFromGeolocation) {\r\n    return NextResponse.redirect(countryFromGeolocation);\r\n  }\r\n}\r\n```\r\n\r\nThere's a dirty solution to add a query param (e.g. `redirection: false`) for all `<Link />`s and `Router.push()`s, but I hope there's a cleaner solution."}
{"sentences": "Tag 'amp-story' is not allowed to have any sibling tags ('body' should only have 1 child).", "description": "```\r\nexport const config = { amp: true }\r\n\r\nexport default function Story() {\r\n\r\n    return (\r\n        \r\n        <amp-story standalone=\"\"\r\n        title=\"Online shop\"\r\n        publisher=\"Test\"\r\n        publisher-logo-src=\"assets/vercel.svg\"\r\n        poster-portrait-src=\"assets/story/open.jpg\"\r\n        >\r\n            <amp-story-page id=\"cover\">\r\n        <amp-story-grid-layer template=\"fill\">\r\n          <amp-img src=\"assets/story/open.jpg\"\r\n              width=\"720\" height=\"1280\"\r\n              layout=\"responsive\">\r\n          </amp-img>\r\n        </amp-story-grid-layer>\r\n        <amp-story-grid-layer template=\"vertical\">\r\n          <h1>online is the best place for next.js</h1>\r\n          <p>viewed</p>\r\n        </amp-story-grid-layer>\r\n      </amp-story-page>\r\n\r\n      <amp-story-page id=\"page1\">\r\n        <amp-story-grid-layer template=\"vertical\">\r\n          <h1>Cats</h1>\r\n          <amp-img src=\"assets/story/phone.jpg\"\r\n              width=\"720\" height=\"1280\"\r\n              layout=\"responsive\">\r\n          </amp-img>\r\n          <q>text </q>\r\n        </amp-story-grid-layer>\r\n      </amp-story-page>\r\n      \r\n        <style jsx> { \r\n        `\r\n        h1 {\r\n          font-weight: bold;\r\n          font-size: 2.875em;\r\n          font-weight: normal;\r\n          line-height: 1.174;\r\n          color: #fff;\r\n        }\r\n        `\r\n        }</style>\r\n\r\n        </amp-story>\r\n   \r\n        )\r\n}\r\n\r\n```\r\n\r\ngives this error, (ps. `https://err.sh/zeit/next.js/amp-export-validation` link is not working)\r\n\r\n```\r\nerror  Tag 'amp-story' is not allowed to have any sibling tags ('body' should only have 1 child).  https://amp.dev/documentation/components/amp-story\r\n19:31:29.392  \r\n> Build error occurred\r\n19:31:29.392  \r\nError: AMP Validation caused the export to fail. https://err.sh/zeit/next.js/amp-export-validation\r\n19:31:29.392  \r\n    at _default (/zeit/6629939c/node_modules/next/dist/export/index.js:19:1036)\r\n19:31:29.392  \r\n    at runMicrotasks (<anonymous>)\r\n19:31:29.392  \r\n    at processTicksAndRejections (internal/process/task_queues.js:94:5)\r\n19:31:29.392  \r\n    at async build (/zeit/6629939c/node_modules/next/dist/build/index.js:36:218)\r\n19:31:29.421  \r\nerror Command failed with exit code 1.\r\n```\r\n"}
{"sentences": "NextJS/Mongoose/Typescript Issue", "description": "Hi,\r\n\r\nI am just starting to incorporate Typescript and I'm getting an issue when using it with NextJS and Mongoose.\r\n\r\nIn NextJS it looks like the recommended way to export my models is like this or I get errors about my schema getting overwritten.\r\n\r\n`const User = models.User || model<IUser, UserModel>('User', userSchema);`\r\n\r\nHowever, my statics function (findByCredentials) is flagging as it doesn't belong on Model<any, {}, {}, {}, any> as a result of models.User.\r\n\r\nHere is my code:\r\n\r\n**IUser.ts_**\r\n```\r\nexport default interface IUser {\r\n\tfirstName: string;\r\n\tlastName: string;\r\n\temail: string;\r\n\tpassword: string;\r\n\trole: 'admin' | 'manager' | 'developer' | 'submitter';\r\n\ttokens: [\r\n\t\t{\r\n\t\t\ttoken: string;\r\n\t\t}\r\n\t];\r\n}\r\n```\r\n\r\n**IUserMethods.ts**\r\n```\r\nexport default interface IUserMethods {\r\n\tgenerateAuthToken(): Promise<string>;\r\n}\r\n\r\n```\r\n\r\n**UserModel.ts**\r\n```\r\nimport { Model, HydratedDocument } from 'mongoose';\r\n\r\nimport IUser from './IUser';\r\nimport IUserMethods from './IUserMethods';\r\n\r\nexport default interface UserModel extends Model<IUser, {}, IUserMethods> {\r\n\tfindByCredentials(\r\n\t\temail: string,\r\n\t\tpassword: string\r\n\t): Promise<HydratedDocument<IUser, IUserMethods>>;\r\n}\r\n```\r\n\r\n**ExtendedNextApiRequest.ts**\r\n```\r\nimport { NextApiRequest } from 'next';\r\n\r\nexport default interface ExtendedNextApiRequest extends NextApiRequest {\r\n\tuser: any;\r\n\ttoken: string;\r\n}\r\n```\r\n\r\n**User.ts**\r\n```\r\nimport { Schema, Model, model, models } from 'mongoose';\r\nimport isEmail from 'validator/lib/isEmail';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nimport IUser from '../interfaces/IUser';\r\nimport IUserMethods from '../interfaces/IUserMethods';\r\nimport UserModel from '../interfaces/UserModel';\r\n\r\n// schema\r\nconst userSchema = new Schema<IUser, UserModel, IUserMethods>({\r\n\tfirstName: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\ttrim: true,\r\n\t},\r\n\tlastName: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\ttrim: true,\r\n\t},\r\n\temail: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\tunique: true,\r\n\t\ttrim: true,\r\n\t\tlowercase: true,\r\n\t\tvalidate(value: string) {\r\n\t\t\tif (!isEmail(value)) {\r\n\t\t\t\tthrow new Error('Email is invalid.');\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tpassword: {\r\n\t\ttype: String,\r\n\t\trequired: true,\r\n\t\ttrim: true,\r\n\t\tminlength: [6, 'Password must be at least 6 characters.'],\r\n\t\tvalidate(value: string) {\r\n\t\t\tif (value.toLowerCase().includes('password')) {\r\n\t\t\t\tthrow new Error('Password cannot contain \"password\".');\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\trole: {\r\n\t\ttype: String,\r\n\t\tenum: {\r\n\t\t\tvalues: ['admin', 'manager', 'developer', 'submitter'],\r\n\t\t\tmessage: '{VALUE} is not supported.',\r\n\t\t},\r\n\t\trequired: true,\r\n\t\ttrim: true,\r\n\t\tlowercase: true,\r\n\t\tdefault: 'submitter',\r\n\t},\r\n\ttokens: [\r\n\t\t{\r\n\t\t\ttoken: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true,\r\n\t\t\t},\r\n\t\t},\r\n\t],\r\n});\r\n\r\n// methods\r\nuserSchema.methods.toJSON = function () {\r\n\tconst user = this;\r\n\tconst userObject = user.toObject();\r\n\r\n\tdelete userObject.password;\r\n\tdelete userObject.tokens;\r\n\r\n\treturn userObject;\r\n};\r\n\r\nuserSchema.methods.generateAuthToken = async function () {\r\n\tconst user = this;\r\n\tconst secret = process.env.JWT_SECRET!;\r\n\tconst token = jwt.sign({ _id: user._id.toString() }, secret);\r\n\r\n\tuser.tokens = user.tokens.concat({ token });\r\n\tawait user.save();\r\n\r\n\treturn token;\r\n};\r\n\r\n// statics\r\nuserSchema.statics.findByCredentials = async (\r\n\temail: string,\r\n\tpassword: string\r\n) => {\r\n\tconst user = await User.findOne({ email });\r\n\r\n\tif (!user) {\r\n\t\tthrow new Error('Failed to login.');\r\n\t}\r\n\r\n\tconst isMatch = await bcrypt.compare(password, user.password);\r\n\r\n\tif (!isMatch) {\r\n\t\tthrow new Error('Failed to login.');\r\n\t}\r\n\r\n\treturn user;\r\n};\r\n\r\n// middleware\r\nuserSchema.pre('save', async function (next) {\r\n\tconst user = this;\r\n\r\n\tif (user.isModified('password')) {\r\n\t\tuser.password = await bcrypt.hash(user.password, 8);\r\n\t}\r\n\tnext();\r\n});\r\n\r\n// model\r\nconst User = models.User || model<IUser, UserModel>('User', userSchema);\r\n\r\nexport default User;\r\n```\r\n\r\n**login.ts**\r\n```\r\nimport { NextApiResponse } from 'next';\r\n\r\nimport ExtendedNextApiRequest from '../interfaces/ExtendedNextApiRequest';\r\nimport User from '../models/User';\r\n\r\nconst login = async (req: ExtendedNextApiRequest, res: NextApiResponse) => {\r\n\tconst { email, password } = req.body;\r\n\r\n\ttry {\r\n\t\tconst user = await User.findByCredentials(email, password);\r\n\t\tconst token = await user.generateAuthToken();\r\n\r\n\t\treturn res.status(200).json({ user, token });\r\n\t} catch (error) {\r\n\t\tconsole.log(error);\r\n\t\treturn res.status(400).json(error);\r\n\t}\r\n};\r\n\r\nexport default login;\r\n```\r\n\r\nThe line that is getting the error is in login.ts:\r\n\r\n`const user = await User.findByCredentials(email, password);`\r\n\r\nThe warning that shows is:\r\n\r\n> Property 'findByCredentials' does not exist on type 'Model<any, {}, {}, {}, any>'.ts(2339)\r\n\r\nReally appreciate any advice on this issue."}
{"sentences": "Middleware is using import field instead of browser if exports is there", "description": "Suppose I have a dummy package like this:\r\n\r\n```json\r\n{\r\n  \"name\": \"foo\",\r\n  \"version\": \"0.1.0\",\r\n  \"type\": \"module\",\r\n  \"main\": \"index.cjs\",\r\n  \"module\": \"index.js\",\r\n  \"browser\": \"browser.js\",\r\n  \"exports\": {\r\n    \".\": {\r\n      \"import\": \"./index.js\",\r\n      \"require\": \"./index.cjs\",\r\n      \"browser\": \"./browser.js\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nNow if I import `foo` in `middleware.ts`, it resolves to `index.js`. But if I remove the `exports` field completely, it resolves to `browser.js`. Is this a bug or am I doing something wrong here?"}
{"sentences": "Hydration error when using <p> inside <div>", "description": "I was trying a simple example and my `index.tsx` looks like this:\r\n```\r\nexport default function Home() {\r\n  return (\r\n    <div>\r\n      <p>\r\n        <h3>This is index</h3>\r\n      </p>\r\n    </div>\r\n  )\r\n}\r\n```\r\n\r\nWhen I run this code, I get an `Unhandled Runtime Error. Error: Hydration failed because the initial UI does not match what was rendered on the server`.\r\n\r\nThe solution which fixes the issue was replace `<p>` with `<div>`. But I would like to know why `<p>` tag does not work and how changing it into `<div>` tag makes it work."}
{"sentences": "unable to use simple routing", "description": "hello ,\r\n these are my first steps with next.js.\r\n\r\nI am unable to follow the documentation at https://nextjs.org/docs/basic-features/pages\r\nthat is, i've added an about.js document , with the following content\r\nexport default function about() {\r\n  return <div>About</div>\r\n}\r\n\r\nbut when I try to retrieve at at 0.0.0.0:3000/about\r\nI receive http 404.\r\n \r\n\r\n Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017\r\n    Binaries:\r\n      Node: 18.12.1\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.1.1\r\n      eslint-config-next: 13.1.1\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\r\n\r\nplease advise\r\nOmer\r\n\r\n\r\n"}
{"sentences": "\"type\": \"module\" does not work and raise \"require() of ES Module\" Error", "description": "I am using Next.js and Visx (a charting lib based). Both are the latest version. However, I got the following error which complains that Visx is using the CommonJS require() for importing its dependencies. I have \"type\": \"module\" to my package.json already and all these packages should support ESM by default i.e. they are not supposed to use require() to begin with. Why am I still getting this error? Thank you!\r\n\r\n```\r\nServer Error\r\nError: require() of ES Module /Users/.../node_modules/@visx/scale/node_modules/d3-scale/src/index.js from /Users/.../node_modules/@visx/scale/lib/scales/band.js not supported.\r\nInstead change the require of index.js in /Users/.../node_modules/@visx/scale/lib/scales/band.js to a dynamic import() which is available in all CommonJS modules.\r\n```\r\n\r\nconfig.json dependencies:\r\n\r\n```\r\n\"next\": \"^13.0.7\",\r\n\"@visx/visx\": \"^2.17.0\",\r\n```\r\n\r\nI tried the common fix which is adding `\"type\": \"module\"` to my package.json. It did not work. Other fixes are for Next.js version before v12, which does not apply in my case.\r\n\r\nThanks for reading this far!"}
{"sentences": "NextJS Docker image is too big", "description": "I used [Dockerfile](https://nextjs.org/docs/deployment#docker-image) from docs to build Docker image. The base Node image is 168 Mb and final build image size is **575Mb**. I believe we are copying `node_modules` to image as well but I am not sure since I am ignoring them explicitly here in .dockerignore\r\n\r\n **.dockerignore**\r\n```\r\nDockerfile\r\n.dockerignore\r\nnode_modules\r\nnpm-debug.log\r\nREADME.md\r\n.next\r\n```\r\n\r\n**Dockerfile**\r\n```\r\n# Install dependencies only when needed\r\nFROM node:alpine AS deps\r\n# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.\r\nRUN apk add --no-cache libc6-compat\r\nWORKDIR /app\r\nCOPY package.json yarn.lock ./\r\nRUN yarn install --frozen-lockfile\r\n\r\n# Rebuild the source code only when needed\r\nFROM node:alpine AS builder\r\nWORKDIR /app\r\nCOPY . .\r\nCOPY --from=deps /app/node_modules ./node_modules\r\nRUN yarn build && yarn install --production --ignore-scripts --prefer-offline\r\n\r\n# Production image, copy all the files and run next\r\nFROM node:alpine AS runner\r\nWORKDIR /app\r\n\r\nENV NODE_ENV production\r\n\r\nRUN addgroup -g 1001 -S nodejs\r\nRUN adduser -S nextjs -u 1001\r\n\r\n# You only need to copy next.config.js if you are NOT using the default configuration\r\n# COPY --from=builder /app/next.config.js ./\r\nCOPY --from=builder /app/public ./public\r\nCOPY --from=builder --chown=nextjs:nodejs /app/.next ./.next\r\nCOPY --from=builder /app/node_modules ./node_modules\r\nCOPY --from=builder /app/package.json ./package.json\r\n\r\nUSER nextjs\r\n\r\nEXPOSE 3000\r\n\r\nENV PORT 3000\r\n\r\n# Next.js collects completely anonymous telemetry data about general usage.\r\n# Learn more here: https://nextjs.org/telemetry\r\n# Uncomment the following line in case you want to disable telemetry.\r\n# ENV NEXT_TELEMETRY_DISABLED 1\r\n\r\nCMD [\"node_modules/.bin/next\", \"start\"]\r\n\r\n```"}
{"sentences": "Service firestore not available", "description": "I am trying to use firestore as my Database with Next.js but whenever I initialize it with `getFirestore()` then it shows me this error:\r\n`Error: Service firestore is not available`\r\n\r\nThis error never happened before in any other framework like React or Svelte. I also tried creating a new firebase project but it didn't work.\r\nAny help will be greatly appreciated."}
{"sentences": "How to use regular regular expressions in middleware", "description": "Hello, I'm using the matcher in middleware, I'm trying to only invoke the middleware when there is a % in the url. Is there any documentation on how to do this? My code:\r\n\r\n```\r\n// middleware.ts\r\nimport { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\n\r\nexport function middleware(request: NextRequest) {\r\n  console.log('invoked middleware', request.nextUrl.pathname)\r\n}\r\n\r\nexport const config = {\r\n  matcher: '/(/%/)*', // this doesn't work\r\n}\r\n```"}
{"sentences": "cannot use css transition inside jsx loop (map)", "description": "[Code Sandbox](https://codesandbox.io/p/sandbox/strange-violet-ow7sxm?file=%2FComponents%2FNotes.jsx&selection=%5B%7B%22endColumn%22%3A37%2C%22endLineNumber%22%3A68%2C%22startColumn%22%3A37%2C%22startLineNumber%22%3A68%7D%5D)\r\n\r\n![Screenshot (131)](https://user-images.githubusercontent.com/71011043/209789786-c3bd72f6-1f6a-4de3-928c-61c034f7d44c.png)\r\n"}
{"sentences": "How to do a dropdown button that expands the screen and push other divs down?", "description": "First of all...  \r\n\r\nHappy holidays!!  ... and thank you very much for all your help this year...\r\n\r\nRegarding this post.... How can I create a dropdown button that pushes other divs below further down?\r\n\r\nThe problem is that I have a regular dropdown which only hides the display of a div, then when the button is clicked, then you have a display of the div, the problem is that this div is being displayed on top of other divs   on the screen...  How can I display the div and push other divs down so it isn't displaying on top of anything?\r\n\r\nIs this an html setup for what I want? \r\n\r\nThe page I am working with it this below..  right now it doesn't look so bad, but the list of the dropdown is getting long and using more of the screen..\r\n\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/products/index.js\r\n\r\n\r\n"}
{"sentences": "Get cookies in getInitialProps in _app.js", "description": "Hello 👋 \r\n\r\nI took the default AB testing example as a basis and modified it a little bit to fit my needs. I'm setting cookies as well but I'm not redirecting based on a path, I'm simply setting a context in my _app.js file which provides the active running AB tests and the bucket via a hook that any component can use.\r\n\r\nI have a middleware file that checks for a AB test cookie and gets the bucket the user falls into. If no such cookie is set I modify the response the middleware creates and set the cookie this way (=handling the first time load of the app).\r\n\r\n```javascript\r\n// this is done for all active AB tests\r\n\r\n let bucket = req.cookies.get(cookieName)?.value;\r\n let hasBucket = !!bucket;\r\n  \r\n if (!bucket || !allowedBuckets.includes(bucket)) {\r\n    // If there's no active bucket in cookies or its value is invalid, get a new one\r\n    bucket = chooseBucket(buckets);\r\n    hasBucket = false;\r\n  }\r\n  \r\n  // Add the bucket to the response cookies if it's not there or if its value was invalid\r\n  if (!hasBucket) {\r\n    response.cookies.set(cookieName, bucket, {\r\n      expires: endDate,\r\n    });\r\n  }\r\n```\r\n\r\nNow the issue is that the cookie is only set once the first request is done, since it's only then the cookie is set. To have the correct state right on the initial render of my app I'm looking at the response the middleware provides inside my _app.js's getInitialProps and parse the `set-cookie` header from `ctx.res?.getHeader('set-cookie')` - AFAIK this is currently the only way to get the cookie value which is set by middleware? When I get the header via this option it returns me this\r\n\r\n```\r\n[\r\n    'custom-ab-test-bucket=c; Path=/; Expires=Wed, 21 Dec 2022 00:00:00 GMT',\r\n    'custom-ab-test-#2-bucket=a; Path=/; Expires=Tue, 27 Dec 2022 00:00:00 GMT'\r\n]\r\n```\r\n\r\nwhich I can parse and use to setup my apps state correctly. If the user has all the cookies set already, this header is empty but then I can simply access the cookies from the request and setup the state.\r\n\r\nThis works well in development and when I build the app locally and run it, but does break in production. The `ctx.res?.getHeader('set-cookie')` value is `undefined`, for some reason. \r\n\r\nI can see in the deployment logs on vercel that the middleware actually sets the header\r\n\r\n```\r\nMIDDLEWARE RESPONSE COOKIES  {\"custom-ab-test-#2-bucket\":{\"name\":\"custom-ab-test-#2-bucket\",\"value\":\"b\",\"expires\":\"2022-12-27T00:00:00.000Z\",\"path\":\"/\"}}\r\n```\r\n\r\nbut they do not appear to be present on the response object in `getInitialProps`.\r\n\r\nDoes anyone have any idea what could be the issue or if there is a simpler approach to what I'm trying to do?\r\n\r\nAn example repo can be found [here](https://github.com/simerlec/next-13-cookie-demo)\r\n\r\ndeployment for it is [here](https://next-13-cookie-demo.vercel.app/) \r\n\r\nPlease let me know if I should make it clearer on what I'm trying to do here 😅 \r\n\r\nthank you and kind regards"}
{"sentences": "Error using dynamic import for SSR False, TypeError: item is not a function", "description": "I am using Next Js v10.0.0, and regraph lastest trial sdk.\r\n\r\nim a trying to import the following\r\n\r\n`const neighbors = dynamic(() => import('regraph/analysis'), { ssr: false })`\r\nsince im having an error `navigator is not defined`\r\n\r\nbut when it using at runtime it says: `TypeError: neighbors is not a function`\r\n\r\nsomeone knows how to use this?\r\n\r\nwould love to know the works around."}
{"sentences": "Event listeners not working on Nextjs 13", "description": "Hi guys,\r\n\r\nHoping to get some help here, excuse me if i'm missing something completely obvious, i'm still learning NextJS.\r\n\r\nI'm working on an app for microservices as part of the freeCodeCamp course, and for some reason my `onClick` , `onSubmit` etc.. listeners don't work. I am using the new experimental version on Next, so i'm wondering if that is the issue or something else. \r\n\r\nYou can find all my files here and test it yourself:\r\n[https://github.com/vkats90/nextjs-13-api.git](url)\r\n\r\nHere is the front page (app/page.jsx) with a simple button with a listener I put there to test if it's listening, and it's not:\r\n\r\n```\r\n'use client'\r\n\r\nimport Image from 'next/image'\r\nimport styles from './page.module.css'\r\n\r\nexport default function Home() {\r\n  function handleClick() {\r\n    console.log('hello');\r\n}\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <main className={styles.main}>\r\n        <h1 className={styles.title}>\r\n          freeCodeCamp API exercise\r\n        </h1>\r\n\r\n        <p className={styles.description}>\r\n          Choose any of the following Microservices:\r\n        </p>\r\n        <button onClick={handleClick}>Click me</button>\r\n        <div className={styles.grid}>\r\n          <a href=\"/timestamp-microservice\" className={styles.card}>\r\n            <h2>Timestamp &rarr;</h2>\r\n            <p>Get the time in UTC and Unix</p>\r\n          </a>\r\n\r\n          <a\r\n            href=\"/header-parser-microservice\"\r\n            className={styles.card}\r\n          >\r\n            <h2>Headparser &rarr;</h2>\r\n            <p>Get you client and IP information</p>\r\n          </a>\r\n\r\n          <a\r\n            href=\"/url-shortener-microservice\"\r\n            rel=\"noopener noreferrer\"\r\n            className={styles.card}\r\n          >\r\n            <h2>Url Shortener &rarr;</h2>\r\n            <p>input your url and get a shorter one</p>\r\n          </a>\r\n          <a\r\n            href=\"/exercise-tracker\"\r\n            rel=\"noopener noreferrer\"\r\n            className={styles.card}\r\n          >\r\n            <h2>Exercise Tracker &rarr;</h2>\r\n            <p>Log in and track your exercises</p>\r\n          </a>\r\n          <a\r\n            href=\"/filemetadata-microservice\"\r\n            rel=\"noopener noreferrer\"\r\n            className={styles.card}\r\n          >\r\n            <h2>File Metadata &rarr;</h2>\r\n            <p>Upload a file and get information about it</p>\r\n          </a>\r\n        </div>\r\n      </main>\r\n\r\n      <footer className={styles.footer}>\r\n        <a\r\n          href=\"https://github.com/vkats90\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          Made by Vlad Kats\r\n        </a>\r\n      </footer>\r\n    </div>\r\n  )\r\n} \r\n```\r\n\r\n\r\nThanks for your help!"}
{"sentences": "Fetching global data from API at build-time?", "description": "Hi!\r\nDoes anyone know of a good way (or any way, really) to fetch data so that it is globally available during static generation, without explicitly adding it to getStaticProps on every single page?\r\n\r\nMy use case involves getting translations and some configuration data from an API, and my attempts didn't work out so far.\r\n\r\nI considered doing 'something with webpack', or having a pre-build step to download the data before next kicks in, but maybe there are other options?\r\n\r\n"}
{"sentences": "req.cookies is not able to parse cookie when multiple cookies are present", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nI tried to access cookie in next.js server side **api** by using **req.cookies** helper but when multiple cookies are present in request header **req.cookies** is giving all the cookies and all cookies are in encrypted form. \r\n\r\nI tried to print the **req.cookies** result in console log and below is the output:\r\n`{\"_gid\":\"GA1.2.595108422.1594311424\",\"gitpod-user\":\"loggedIn\",\"theme\":\"{\\\"id\\\":\\\"dark\\\",\\\"mode\\\":\\\"dark\\\",\\\"colors\\\":{\\\"brand\\\":\\\"\\\",\\\"brand2\\\":\\\"\\\",\\\"background1\\\":\\\"#1e1e1e\\\",\\\"background2\\\":\\\"\\\",\\\"background3\\\":\\\"\\\",\\\"paperShadow\\\":\\\"\\\",\\\"fontColor1\\\":\\\"\\\",\\\"fontColor2\\\":\\\"\\\",\\\"fontColor3\\\":\\\"\\\",\\\"disabled\\\":\\\"\\\"}}\",\"a0:session\":\"Fe26.2**9014ce40bb1bfe378ecc9a239b6423f4673c9cbc2e118daefb296fabd3e5fe9f*UsQNbXQEDoMUpG4VuYNPtg*eZmsbdH2SIfc3_arJYk86fzKICsR0ZO_AwaYT450osQKxEqBfRwYEaSgVy8oFRl2ya3uth-7HuQYfsh-4yPdR3V5qeFvyRoYk3Q70zs6Ot0sz-6YoJWq2dAZtBaCHNDHZnOt4qrBqBI5eV9hjbm-kBBqpcqN7d6r9kd1vXZLbtok71OOtDE1MWWkFr2dWbkQS1Vi2rHR7zTX17sevVwtD7IyrlnsmrZr6wKm5x8D71wdOH5H66nxFjkufUx0VxUTUNu9ouGopB4Li722-6WzRwumNEqBINW7nqr8ubA3KYgGmECBghufcuBXrkNOlv0S8bNqn1cmimxRSGo-f3nyjeVdlsAek1vwUZ0EId97s_mjPz-2ZEsD0V5QyGB1bdUVDFmSugvbxMsBPCuIImv6l7dpeGh5OV_HEfQws3JV-hCTTGUPE9akbXA_akr4yhYiIodIVOQAqFxsJWYjB87pKF3GC6v1be6wtARSsRpUZ92snlfamTv874pi1Bh6iEK72z8o9BC7FDB7EoA3ZNkR9_CSdOMIt-ZgIEoqjXMKWwog2C72Pjmxp_6sFBazebMwVeTpqNIrKnkZusrTryukImP6VgTFEj6o1L9RJZqyLG_cxQ4sYlT6UB6sQe36qI3tWpDEUWQ9XPcxhO9nnjyBDj2lpD2_rFy7cS6F7EvaKPrKCRSYQnv4Av_G9q7NYXH9pAzA_-W8MWkOMLJcinsZ-MkqpIwDvGScHDLhnvbdg4QHJvHpAJ9h2Jl4oDveMjYVqKsCft0zhm5QtoUEb9SPV1w6GaBkuinzkaDoOCBOwYbAcL_Sz4UJbHl8KiqLCp1cuwQ7nsRPgfAuktpI-nChhSkk3U1Cl7ZS-tMPn885kKdedWnXnXaHV-odkRnF1fdt0NObcL8sVXC_LXxsysGDCHsCoo3SKCzKYJODoT8oW10KMSOHOWA9sMv3Nwj9CDX8-qQ1X4tu_0KRFTL33VhbrZMmize3omOoZBD0UeVcdYTvUDKa2gI-POyemw2Ck4btl2LJFqTsIte4lvUbFGP6tN-tXzy1JwQCZKlbMgNqVxcmPDuxtDiVQjklBQ6OkJ-R5ceJK--vpPuQJ1jTdKxU6H-LlQpiYuZTuU9D9lSaq3eb7H-2mWBJ648NneXILlofq8Mty0zS4fdhvVrmwk8C9ZMuu3fqdpZMErZprAEk_rMJkVjBqnYZ3OdWhjXP9ZNajvZDY-XsHNjNTnJx5AwL9p9WObauMS3oWdfKfDcYcPyNbgE_HXLxSBanqusEIXkdV_JyatCIdTLgNvrFdVuda0ol7smNEws7LSM4NrtMWYUZvsy4Hd6jHZk4X4_zw30O1DKaOt2RGsGWz1cVVrkDv6XVCqng7xW7VLL6qlGhDlQirS-f11wmdDCZ2-RKD65yl1_54_IgwxVawdTZaKt_B5r_F-Do-GEHj8Pujl9PZFWOIILyYMwAG6jjil87zlt-HV_d_yHq6DcK0YazahraQ5Ob7KRfV8XSwciB3tan0IJlaMybE68SAUHScN9KsEPCKCcC6XGqSQPCJPTla6ObiAu8yYc0hTXqLjGKXJ_XzVwle3AVsbDOBPUSpTuoCEuSzakdOyPnIdUFuNuaclKvOjT7gVEA9NoZsBJ7MybLrPlhHjENKFM9mWSg2jfUynelDDnoJ7ZTKSmIHZaiCmb4B-iq1RrzpQVh5KgzWya2lVquMGACwVnlRfH2lOxuYSyHrdrtf_oiEpJz-P3WxLrewZGhuom8ojU6xCwKqkJ128MaEz7F420mHdyLn0JIDzs6Fd4xKsMoacYkI6XAZ0arYqtyHn_yu5fiyQWH0lLfKZSoI7RZE0dIpb1YwdussP3kL-oIwFBDIoIt0cwUar_CviCKhnKzTsZcRY3OrpV6d0pDIm_IDUJQMo-WpA_a-Tr_5u4MrjU0aYOB4xNHEY8zsCT1hQibnPICUdmjee-yEDs2lHKhsrx1rNgHnGY0kvVXthRHrMRKaVnT3TP2Yv0vFev0zj_2kqkgwDLLmeZF24Thjo3rTFA4IdztQnb1lB4lCBLt7Mouzkg0u_jhicNFH99AoefCAQiWEfbDEVyM-eaXdR3YPDOj76f2ODsVaKsK4GNPj8KKj2v5o3yfO_bM7LBlvdMuLf_lAQsDa65VHBHVXy3sj31FT4_8v2dSHJKtOic-6fL2qlh_evkcgfCYxiDphxRgOMH2_YzTx92N1B3-6gob3tlej5Wt6Pgi21sYTALfiDHXkJ_Ax2uEQaEkSZODLWSS59TOOssmTidgMgy-X8AMqV3jncAPWPwMtoNJ0BwDUqjJV2AtVB1_zX2TfycBE0y0fiIDzrYMm1PF8eYbz-DLIvacmaaK9l6P-4hT8dzIQ-huZE5ZLcFU99OSG6SpE5b9FYf7zNZoB6AE0pN3WBTo9sFFIfvhYAVgg5Zy4B3IpOtbuq6x9hM4_01tMw**a029ddc2e2468f149929515340fb67e533cf8a4c27574fbb12fa34a7fbacba8e*AGxoiZ_0mO0ghuLI0hcnrDVOz-AMb-QAQ_zB5Pktj_M\",\"_ga\":\"GA1.2.401110148.1591930422\"}`\r\n\r\nI want to access **a0:session** in above cookies in decrypt form. I am not sure if this is a bug or require different way of handling.\r\n\r\nThanks for help!\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. To reproduce this open any next.js project in gitpod.io for development\r\n2. Create api in **pages/api/test** and add below code snippet\r\n`export default async function test(req, res) {\r\n        console.log(JSON.stringify(req.cookies));\r\n}`\r\n3. Above console.log will print multiple cookies one from gitpod and one from application\r\n\r\n## Expected behavior\r\n\r\nIf multiple cookies are present in **req.cookies**, right cookie should be present in decrypt form or selecting right cookie decryt option should be given.  \r\n\r\n## System information\r\n\r\n- OS: Gitpod using Linux\r\n- Browser: Chrome\r\n- Version of Next.js: 9.4.4\r\n- Version of Node.js: 12.16.3\r\n\r\n## Additional context\r\n\r\nThis problem only present when multiple cookies are present in header request.\r\n"}
{"sentences": "Any ideas why the bootstrap carousel doesn't seem to update?", "description": "For some reason I don't get to see any updates on new images I am putting the the bootstrap carousel...  I don't detect any errors either, it just doesn't show up.\r\n\r\nThe carousel component is this one:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/components/carousel-main.js\r\n\r\nAnd I am pulling images from this folder here:\r\nhttps://github.com/Elindo586/nextprojectb/tree/main/public/carousel-main\r\n\r\nThe Terminal is not showing any errors.\r\n\r\nnpm run dev and npm run build doesn't show me any errors.\r\n\r\nI have errors in the console but those seem to be related to Google ads:\r\n\r\nUncaught (in promise) TypeError: Failed to execute 'put' on 'Cache': Request scheme 'chrome-extension' is unsupported\r\n    at sw.js:70:18\r\napp.js:4 service worker installed\r\nadsbygoogle.js?client=ca-pub-8682017023658879:207 AdSense head tag doesn't support data-nscript attribute.\r\n(anonymous) @ adsbygoogle.js?client=ca-pub-8682017023658879:207\r\nads:1          Failed to load resource: the server responded with a status of 403 ()\r\nads:1          Failed to load resource: the server responded with a status of 403 ()"}
{"sentences": "Nextjs 13 (13.0.6) Fetch Other Route at First Time when \"standalone\" mode", "description": "Dear Nextjs team,\nThank you for amazing Nextjs 13\nAnd support \"standalone\" mode as well when build production in version 13.0.6\n\nI have minor issue, when succeeded build and access the production in my self-hosting server (GCP with docker build), I got at first time that the website fetch \"all route\" before the homepage open, like picture below\n\n![image](https://user-images.githubusercontent.com/520463/207055211-a1b4c410-8b11-43f4-b98c-43a1f813600a.jpeg)\n\nIs it expected?"}
{"sentences": "Chunk naming", "description": "I have a question regarding how chunks are named.\r\n\r\nDoes the name of the chunk change for any other reason other than content (code) change?\r\n\r\nI noticed if you build the project for the second time (after deleting the .next folder), the chunk names will remain the same for chunks with no content changes.\r\n\r\n"}
{"sentences": "ISR (revalidate) doesn't work with docker image deployment", "description": "Hello, I used the ISR (revalidate) property in my static pages to get fresh data after I’ve built the site. It worked with the normal deployment 'npm run build/start' but didn't work with docker. Here's what I tried:\r\n- Without docker: \r\nI run `npm run build` then` npm run start`\r\nthen I change the data on the graphql end point and the data is refreshed successfully also on my built site!  ✔️\r\n\r\n- Using Docker:\r\nI used the docker template for deployment mentioned [here](https://github.com/vercel/next.js/tree/canary/examples/with-docker) and I tried to use the **revalidate** property to get fresh data from a grapql endpoint without rebuilding. But it didn't work, I had to re-build the image and re-run the container to see the newly fetched data. ❌\r\n\r\nThe DOCKERFILE it is the same mentioned above, except for the exposed port I changed it to 5000\r\n`EXPOSE 5000`\r\n`ENV PORT 5000`\r\n\r\nI've searched a lot but couldn't find a solution to this.\r\n\r\nThanks."}
{"sentences": "Does on-demand ISR immediately trigger a rebuild or on the next load?", "description": "When manually revalidating a statically rendered route, such as `res.revalidate('/products')`, does Nextjs immediately rebuild that page or simply mark it as stale and build it when a visitor next accesses the page?"}
{"sentences": "Does old getServerSideProps still available in Next 13v ? How to fetch from Firstore in Next 13 SSR ?", "description": "I am new to next 13 and When I use async function component for new ssr and I got error in npm run dev .\r\n\r\n> Error: Objects are not valid as a React child (found: [object Promise]). If you meant to render a collection of children, use an array instead.\r\n\r\n![carbon (5)](https://user-images.githubusercontent.com/71011043/208279699-07cf3847-9e25-4b56-8f42-607cebb25861.png)\r\n\r\n### **folder structure and nextjs v 13.0.6**\r\n![Screenshot (116)](https://user-images.githubusercontent.com/71011043/208286099-a2482198-cf04-4288-8310-24f36a328bd5.png)\r\n\r\n\r\n\r\n"}
{"sentences": "[Examples] Provide auth example for \"AWS Amplify with NextJS\" sample", "description": "# Feature request\r\n\r\n## Is your feature request related to a problem? Please describe.\r\n\r\nThe current sample provided for AWS Amplify doesn't have code to show how to use AWS Amplify auth. Also not clear is how to do auth like shown in the `Auth0` with APIs.\r\n\r\n## Describe the solution you'd like\r\n\r\nA more robust sample with API and auth will give newcomers more confidence in adopting the sample for more complex applications.\r\n\r\n"}
{"sentences": "Error occurred prerendering page /posts/.DS_Store when next build", "description": "Error occurred prerendering page \"/posts/.DS_Store\". Read more: https://err.sh/next.js/prerender-error:\r\nError: ENOENT: no such file or directory, open '~/nextjs-demo/posts/.DS_Store.md\r\n\r\nDoes anyone encounter this building problem?\r\n\r\nI've read the doc on /next.js/prerender-error, but it seems no help.\r\n\r\n\"next\": \"9.3.5\"\r\nMacOS Catalina 10.15.5\r\nnode: 10.17.0"}
{"sentences": "no such file or directory... Error: Command \"npm install\" exited with 1", "description": "```\r\n[21:52:01.672] Warning: You're seeing the last 2,000 lines of logs. Any lines before that were automatically truncated.\r\n// ...Many more similar errors...\r\n[21:52:07.547] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.548] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.550] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.552] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.553] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.554] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.559] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.571] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.581] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.581] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.585] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.587] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.593] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.599] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.600] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.603] npm WARN tar ENOENT: no such file or directory, lstat '/vercel/path0/node_modules/.staging/next-bb840e7e/dist'\r\n[21:52:07.642] \r\n[21:52:07.643] npm ERR! A complete log of this run can be found in:\r\n[21:52:07.643] npm ERR!     /vercel/.npm/_logs/2022-12-16T05_52_02_093Z-debug.log\r\n[21:52:07.671] Error: Command \"npm install\" exited with 1\r\n```\r\n\r\nUsing next.js v12 latest, node v14 rpm v6\r\n\r\nAny suggestions will help 🙏 "}
{"sentences": "Complex routes with multiply variables", "description": "👋 there! Guys, I have a question. I have project Python/SSR and I wanna rebuild it with next.js. So, this project have a realy complex URL's\r\n\r\nlike example: `/season/$var/league/$var/games/` or `/season/$var/league/$var/overall/`. But, how create urls (pages) like this with next.js, this is actually possible? "}
{"sentences": "Deployment Error : No Next.js version could be detected in your project", "description": "I am trying to deploy my project using dev branch but i am getting this error \r\n`No Next.js version could be detected in your project. Make sure `\"next\"` is installed in \"dependencies\" or \"devDependencies\"`\r\n\r\nProject is working fine in local machine\r\nI even changed \"next\" : \"latest\" to \"next\": \"13.0.2\" \r\n\r\nAny solution to this ? "}
{"sentences": "500 | Internal Server Error after successfully build and deploy", "description": "Hello everyone,\r\n\r\nSo after successfully deploying my site, I got 500 Internal Server Errors. I don't know what went wrong. I was thinking maybe because of my environment variables which I have already stored in Vercel. Does anyone have any suggestions on which part I should look into?"}
{"sentences": "Getting/Decoding previewData from the client side?", "description": "The new [preview API](https://nextjs.org/docs/advanced-features/preview-mode) allows you to set some preview cookies.\r\n\r\nCurrently, when I'm calling my enable-preview endpoint, I'm returning the same data as JSON that I set as my previewData. This allows me to store those values inside the local storage for my client.\r\n\r\nNow since the cookies might time out after a while, my client still has the local storage values set.\r\nIs there some way of accessing the cookies directly from the client-side, which would mean I wouldn't have to store anything inside local storage.\r\n\r\nCurrently, the cookies seem to be encrypted and I don't know how to access the data stored inside it."}
{"sentences": "API routes works locally, but not in production", "description": "I have a `posts` collection in my database (I'm using MongoDB) where I update the views of the articles whenever someone visits the unique slug of each article.\r\n\r\nThe issue now here is that, when I hit the endpoint locally, on my PC, everything works fine. But, when I deploy it to netlify or vercel, I keep getting this error \"Bad request, missing form\".\r\n\r\nWhat could be wrong? \r\n\r\nPS: I'm not using next13, yet. Current version is `^12.2.1`"}
{"sentences": "NextJs 13 appDir + Standalone results in 404", "description": "Hi sorry I don't see a template for this discussion, so please bare w/ me with this barebones post.\r\n\r\nI'm using the new `app` directory feature and replaced `pages/index.tsx` with `app/page.tsx`. The app loads fines via `npm run dev` but when I build for standalone and run via `node ./next/standalone/server.js`, I get a 404 when trying to load the home page.\r\n\r\nThis is the generated `server.js` file:\r\n\r\n```\r\nconst NextServer = require(\"next/dist/server/next-server\").default;\r\nconst http = require(\"http\");\r\nconst path = require(\"path\");\r\nprocess.env.NODE_ENV = \"production\";\r\nprocess.chdir(__dirname);\r\n\r\n// Make sure commands gracefully respect termination signals (e.g. from Docker)\r\n// Allow the graceful termination to be manually configurable\r\nif (!process.env.NEXT_MANUAL_SIG_HANDLE) {\r\n  process.on(\"SIGTERM\", () => process.exit(0));\r\n  process.on(\"SIGINT\", () => process.exit(0));\r\n}\r\n\r\nlet handler;\r\n\r\nconst server = http.createServer(async (req, res) => {\r\n  try {\r\n    await handler(req, res);\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.statusCode = 500;\r\n    res.end(\"internal server error\");\r\n  }\r\n});\r\nconst currentPort = parseInt(process.env.PORT, 10) || 3000;\r\n\r\nserver.listen(currentPort, (err) => {\r\n  if (err) {\r\n    console.error(\"Failed to start server\", err);\r\n    process.exit(1);\r\n  }\r\n  const nextServer = new NextServer({\r\n    hostname: \"localhost\",\r\n    port: currentPort,\r\n    dir: path.join(__dirname),\r\n    dev: false,\r\n    customServer: false,\r\n    conf: {\r\n      env: {},\r\n      webpack: null,\r\n      webpackDevMiddleware: null,\r\n      eslint: { ignoreDuringBuilds: false },\r\n      typescript: { ignoreBuildErrors: false, tsconfigPath: \"tsconfig.json\" },\r\n      distDir: \"./.next\",\r\n      cleanDistDir: true,\r\n      assetPrefix: \"\",\r\n      configOrigin: \"next.config.js\",\r\n      useFileSystemPublicRoutes: true,\r\n      generateEtags: true,\r\n      pageExtensions: [\"tsx\", \"ts\", \"jsx\", \"js\"],\r\n      target: \"server\",\r\n      poweredByHeader: true,\r\n      compress: true,\r\n      analyticsId: \"\",\r\n      images: {\r\n        deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],\r\n        imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\r\n        path: \"/_next/image\",\r\n        loader: \"default\",\r\n        loaderFile: \"\",\r\n        domains: [],\r\n        disableStaticImages: false,\r\n        minimumCacheTTL: 60,\r\n        formats: [\"image/webp\"],\r\n        dangerouslyAllowSVG: false,\r\n        contentSecurityPolicy: \"script-src 'none'; frame-src 'none'; sandbox;\",\r\n        remotePatterns: [],\r\n        unoptimized: false,\r\n      },\r\n      devIndicators: {\r\n        buildActivity: true,\r\n        buildActivityPosition: \"bottom-right\",\r\n      },\r\n      onDemandEntries: { maxInactiveAge: 15000, pagesBufferLength: 2 },\r\n      amp: { canonicalBase: \"\" },\r\n      basePath: \"\",\r\n      sassOptions: {},\r\n      trailingSlash: false,\r\n      i18n: null,\r\n      productionBrowserSourceMaps: false,\r\n      optimizeFonts: true,\r\n      excludeDefaultMomentLocales: true,\r\n      serverRuntimeConfig: {},\r\n      publicRuntimeConfig: {},\r\n      reactStrictMode: true,\r\n      httpAgentOptions: { keepAlive: true },\r\n      outputFileTracing: true,\r\n      staticPageGenerationTimeout: 60,\r\n      swcMinify: true,\r\n      output: \"standalone\",\r\n      experimental: {\r\n        optimisticClientCache: true,\r\n        manualClientBasePath: false,\r\n        legacyBrowsers: false,\r\n        newNextLinkBehavior: true,\r\n        cpus: 9,\r\n        sharedPool: true,\r\n        profiling: false,\r\n        isrFlushToDisk: true,\r\n        workerThreads: false,\r\n        pageEnv: false,\r\n        optimizeCss: false,\r\n        nextScriptWorkers: false,\r\n        scrollRestoration: false,\r\n        externalDir: false,\r\n        disableOptimizedLoading: false,\r\n        gzipSize: true,\r\n        swcFileReading: true,\r\n        craCompat: false,\r\n        esmExternals: true,\r\n        appDir: true,\r\n        isrMemoryCacheSize: 52428800,\r\n        fullySpecified: false,\r\n        outputFileTracingRoot: \"\",\r\n        swcTraceProfiling: false,\r\n        forceSwcTransforms: false,\r\n        largePageDataBytes: 128000,\r\n        enableUndici: true,\r\n        adjustFontFallbacks: false,\r\n        adjustFontFallbacksWithSizeAdjust: false,\r\n        trustHostHeader: false,\r\n      },\r\n      configFileName: \"next.config.js\",\r\n    },\r\n  });\r\n  handler = nextServer.getRequestHandler();\r\n\r\n  console.log(\r\n    \"Listening on port\",\r\n    currentPort,\r\n    \"url: http://localhost:\" + currentPort\r\n  );\r\n});\r\n```"}
{"sentences": "Is useRouter from next/navigation not supposed to work in async pages?", "description": "I'm trying to use `useRouter()` in the `app `directory, but it only works if the page isn't `async`.\r\nThis works\r\n```ts\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function Page() {\r\n    const router = useRouter();\r\n    // Etc...\r\n}\r\n```\r\n\r\nBut this\r\n```ts\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default async function Page() {\r\n    const router = useRouter();\r\n    // Etc...\r\n}\r\n```\r\nfails to render with `Error: Cannot read properties of null (reading 'useContext')`\r\n\r\nAm I doing something wrong here?"}
{"sentences": "Image is not loading in certain viewports.", "description": "There is an intermittent problem in which images cannot be loaded from the projects page.\r\nFormat that is loaded when resizing the screen in the state that it cannot be loaded\r\n\r\n![ezgif-1-79a899f0a2](https://user-images.githubusercontent.com/87694150/174436417-c95d479f-9ba6-4e1b-99e5-efc48c0c009d.gif)\r\n\r\n```tsx\r\n// project-item.tsx\r\n...\r\n        <Image\r\n          className='rounded-t-xl'\r\n          src={imgSrc}\r\n          width='100%'\r\n          height='60%'\r\n          layout='responsive'\r\n          objectFit='cover'\r\n          quality={100}\r\n          alt={title}\r\n          priority={true}\r\n        />\r\n      </div>\r\n...\r\n```\r\n\r\nthese images are from aws server (I used notion API)\r\nthrow 502 err\r\n\r\nIt's my first time using nextjs, so I'm embarrassed..."}
{"sentences": "Next.js 13 (app version) background revalidation and caching dynamic segments", "description": "I'm trying out the new `app` version. Are requests made to a dynamic route segment (i.e. `/posts/123`) cached by default?\r\n\r\nFor example:\r\n\r\n1. I navigate to `/posts/123` for the first time. It builds the `/app/posts/[postID]/page.js` page/file and it sends a `fetch` request to the database to retrieve the `123` post.\r\n2. I go to `/posts/123` again.\r\n\r\nWhat's the expected behavior? Should that page be cached or should a new request to the database be made?\r\n\r\nReading the [background revalidation docs](https://beta.nextjs.org/docs/data-fetching/revalidating#background-revalidation), I thought the page would be cached and another `fetch` request wouldn't be made until the `revalidate` period expired:\r\n\r\n```\r\nWhen a request is made to a route segment that hasn’t been generated, Next.js will dynamically render the route on the first request. Future requests will serve the static route segments from the cache.\r\n```\r\n\r\nHowever, when I tried out this feature, it looked like the `fetch` request was being made every time I visited the `/posts/123` page - not only on the first time.\r\n\r\nHere's the code I tried:\r\n\r\n```js\r\n// app/posts/[postID]/page.js\r\nasync function getData(id) {\r\n  const res = await fetch(`http://localhost:3004/posts/${id}`, { next: { revalidate: 3600 } });\r\n  return res.json();\r\n}\r\n\r\nexport default async function Page({ params }) {\r\n  const posts = await getData(params.postID);\r\n\r\n  return <div>{post.id} - {post.title}</div>\r\n}\r\n\r\n// pages/api/posts/[postID].js\r\nexport default function handler(req, res) {\r\n  console.log('>>>> loaded');\r\n  res.status(200).json({ id: 1, title: 'John Doe' });\r\n}\r\n```\r\n\r\nI've tried it by running `next build` and `next start`. Is there something wrong here or `fetch` being called on every request is the expected behavior?"}
{"sentences": "'as' prop in <Link> missing in Next13?", "description": "I combed through the documentation for Next 13 and didn't find an equivalent to the 'as' property. I think this is an important feature, because it allows for [contextual routing](https://dev.to/toomuchdesign/contextual-routing-and-modal-routes-in-next-js-18fn). Does anyone know of equivalent functionality in next13? \r\n\r\n[Next 12 docs](https://nextjs.org/docs/api-reference/next/link)\r\n> as - Optional decorator for the path that will be shown in the browser URL bar. Before Next.js 9.5.3 this was used for dynamic routes, check our [previous docs](https://nextjs.org/docs/tag/v9.5.2/api-reference/next/link#dynamic-routes) to see how it worked. Note: when this path differs from the one provided in href the previous href/as behavior is used as shown in the [previous docs](https://nextjs.org/docs/tag/v9.5.2/api-reference/next/link#dynamic-routes)."}
{"sentences": "How to correctly use a SQL DB with NextJS (without express)", "description": "Hi!\r\n\r\nIm pretty new with Next and im a little bit confused.\r\nIm using the /api folder like in the create-next-app default example and i want to get data from my DB.\r\nNow i used the MariaDB driver and im creating a pool for the connections. i dont think this works correctly so thats why im asking..\r\n\r\nIm getting the data and everything runs fine but! i think everytime someone fetches the API the driver creates a new connection pool. Is this because Next works \"serverless\"? i saw a doc by vercel that used serverless-mysql. so im wondering do i need a serverless driver? or can i just use a \"normal\" connection instead of using a pool? or can i use a connection pool?\r\n\r\nThis is my first project where im making the API in next so any tips or help in that regard is highly appriciated.\r\nSilvan"}
{"sentences": "Environment variables are not loaded on client side when import them via Dotenv with a custom server", "description": "Hello together, I hope someone can help me. Since I upgraded to Next 13.0.6 all the env vars are not loaded. Normally I import them like that in the next.config.js:\r\n\r\n```\r\nconst moduleExports = withBundleAnalyzer({\r\n  trailingSlash: true,\r\n  webpack: (config) => {\r\n    config.plugins =\r\n      [\r\n        ...config.plugins,\r\n\r\n        // Read the .env file\r\n        new Dotenv({\r\n          path: path.join(__dirname, '.env'),\r\n          systemvars: true,\r\n        }),\r\n      ] || []\r\n\r\n    return config\r\n  },\r\n})\r\n```\r\n\r\nOn server side they seems to be there (at least the console make a log with the correct value) but on Client Side they are all undefined. Strangely it worked before without any problems?"}
{"sentences": "@next/font/local dont set weight with tailwind", "description": "I use tailwind like in docs. When i set class `font-normal` or others nothing change in font-weight\r\n\r\n```\r\nconst golosFont = localFont({\r\n  src: [\r\n    { path: \"../assets/GolosText-Regular.woff2\", weight: \"400\" },\r\n    { path: \"../assets/GolosText-Medium.woff2\", weight: \"500\" },\r\n    { path: \"../assets/GolosText-DemiBold.woff2\", weight: \"600\" },\r\n    { path: \"../assets/GolosText-Bold.woff2\", weight: \"700\" },\r\n    { path: \"../assets/GolosText-Black.woff2\", weight: \"900\" },\r\n  ],\r\n  variable: \"--font-golos\",\r\n});\r\n```\r\n\r\ntw config\r\n```\r\ntheme: {\r\n    extend: {\r\n      fontFamily: {\r\n        sans: [\"var(--font-golos)\", ...fontFamily.sans],\r\n      },\r\n    },\r\n  },\r\n  ```\r\n  \r\n  \r\n\r\n"}
{"sentences": "isSerializable does not include Date type", "description": "https://github.com/zeit/next.js/blob/master/packages/next/lib/is-serializable-props.ts#L41\r\n\r\nIs it possible that Date as type is missing from this method? I am getting an error when trying to export my site as a static one and when the object contains date values.\r\n\r\nTemporary workaround is to cast the date type as a string"}
{"sentences": "next/image for dynamically sized images", "description": "Hi,\r\n\r\nfirst thank you for providing the `<Image>` component, this will ease my development especially with lazy loading.\r\n\r\nI want to display images that have varying aspect ratios in a fixed size container. Using \r\n\r\n```\r\n<Image\r\n    src={coverUrl}\r\n    width={500}\r\n    height={500}\r\n/>\r\n```\r\n\r\nthe image get stretched to the 1x1 aspect ratio. This is due to the style that is applied: \r\n\r\n```\r\nwidth: 0px;\r\nheight: 0px;\r\nmin-width: 100%;\r\nmax-width: 100%;\r\nmin-height: 100%;\r\nmax-height: 100%;\r\n```\r\n\r\nFor my purposes I want only the min and max height set. How can I archive this? Thank you!"}
{"sentences": "Need some help with Prisma", "description": "I have a simple project, which fetch data from DB using prisma. on index page I have 3 links which depends from season.number, which comes from DB and is a latest. For example current season is 8 and links lead propperly `/season/1/standings/` and when, new season was created in db, links should be `/season/2/standings/`. And it works with dev. In production doesn't work unless app build and start over again.\r\n\r\nhomepage:\r\n\r\n```\r\nconst getData = async () => {\r\n  const season = await prisma.season.findFirst({\r\n    orderBy: {\r\n      createdAt: 'desc'\r\n    }\r\n  })\r\n\r\n  const conferences = await prisma.conference.findMany({\r\n    select: {\r\n      name: true,\r\n      ticker: true\r\n    }\r\n  })\r\n\r\n  return {\r\n    conferences,\r\n    season\r\n  }\r\n}\r\n\r\n\r\nconst Home = async () => {\r\n  const { conferences, season } = await getData()\r\n  ........\r\n``` \r\n\r\nHow can I escape that situation and build once? Cause site not gonna be changed very often, but data.\r\n\r\nnext 13, appDir enabled next config\r\n\r\n```\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  swcMinify: true,\r\n  trailingSlash: true,\r\n  generateEtags: false,\r\n  experimental: {\r\n    appDir: true\r\n  },\r\n  webpackDevMiddleware: config => {\r\n    config.watchOptions = config.watchOptions || {}\r\n    config.watchOptions.ignored = [\r\n      // Don't watch _any_ files for changes\r\n      /.*/\r\n    ]\r\n    return config\r\n  }\r\n}\r\n\r\nmodule.exports = nextConfig\r\n```\r\n\r\nP.S. also tried this one and no result https://beta.nextjs.org/docs/api-reference/segment-config"}
{"sentences": "Is it possible to disable API routes?", "description": "We currently have a back-end implemented with Java, but we're wanting to host the front-end using Next.js.\r\n\r\nIs it possible to disable API routes so calls to `/api/...` are fallen through rather than caught by the Next.js server? I'm having a hard time finding anything on the docs about such a setting."}
{"sentences": "Nextjs serverside pages path not working on Vercel production, but working fine on localhost", "description": "Hello\r\n\r\nI have some problem when deploy my apps in vercel.\r\nI have 2 endpoint api which :\r\npages\r\n- src\r\n--pages\r\n--- api\r\n---- graphql\r\n---- verification\r\n\r\nmy graphql endpoint workings fine, but verification for send an email didnt working as expected\r\n\r\nmy output when deployed\r\n\r\n![image](https://user-images.githubusercontent.com/77242429/152277840-2b332187-1884-4574-aa2c-6a7d36fdda96.png)\r\n\r\nand this is my code api/verification.ts\r\n\r\n```ts\r\nimport { NextApiRequest, NextApiResponse } from \"next\";\r\nimport nodemailer from \"nodemailer\";\r\nimport getConfig from \"next/config\";\r\nimport handlebars from \"handlebars\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\n\r\nexport default async (req: NextApiRequest, res: NextApiResponse) => {\r\n  const { email, username, generateToken } = req.body;\r\n\r\n  // email options from handlebars\r\n  const filePath = path.join(\r\n    // @reference: https://stackoverflow.com/questions/54436021/nextjs-public-folder\r\n    getConfig().serverRuntimeConfig.PROJECT_ROOT,\r\n    \"/public/views/verification.handlebars\"\r\n  );\r\n  // replace all content from html and convert into string\r\n  const source = fs.readFileSync(filePath, \"utf-8\").toString();\r\n  const template = handlebars.compile(source);\r\n  const replacement = {\r\n    email: username,\r\n    actions: `http://localhost:3000/auth/signup/flow/show?email=${email}&t=${generateToken}`,\r\n  };\r\n  const htmlToSend = template(replacement);\r\n\r\n  // exit email options from handlebars\r\n\r\n  // transporter for api nodemailer with gmail smtp\r\n  const transporter = nodemailer.createTransport({\r\n    host: \"smtp.gmail.com\",\r\n    port: 465,\r\n    secure: true,\r\n    auth: {\r\n      user: process.env.GOOGLE_MAIL,\r\n      pass: process.env.GOOGLE_PASS,\r\n    },\r\n  });\r\n\r\n  try {\r\n    const sendMsg = await transporter.sendMail({\r\n      from: \"noreply@meraki.dev\",\r\n      to: email,\r\n      subject: `Verified your accounts`,\r\n      html: htmlToSend,\r\n    });\r\n\r\n    console.log(\"message sent\", sendMsg.messageId);\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n\r\n  res.status(200).json(req.body);\r\n};\r\n```\r\n\r\nwhen visiting page it give 500 Internal server error.  and when i input my email for receive an email it give error\r\n\r\n```json\r\n       POST https://flawn.vercel.app/api/verification 500\r\nsignup-6929e74fd7fcf5f0.js:1 Error: Request failed with status code 500\r\n    at e.exports (0-86d70c73a7ed4ab1.js:1:6442)\r\n    at e.exports (0-86d70c73a7ed4ab1.js:1:8884)\r\n    at XMLHttpRequest.A (0-86d70c73a7ed4ab1.js:1:899)\r\n```\r\n\r\n\r\nimage\r\n![image](https://user-images.githubusercontent.com/77242429/152278958-e678c71f-3be2-414c-beec-c3bfce87b836.png)\r\n\r\n\r\nand working fine if i try in local development\r\nany help please? :\")\r\n"}
{"sentences": "API route returns favicon.ico", "description": "Hi\r\n\r\nIm trying to to use api routes to return an Image from our own image CDN. and afterwards use it with Next image.\r\nThe response returns the image but also a favicon.ico, which I think automatically comes from Next and this causes errors.\r\n \r\nDoes anybody know how to not make it return the favicon?\r\nHeres my code\r\n\r\n```\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  try {\r\n    res.setHeader(\r\n      'Cache-Control',\r\n      `public, immutable, no-transform, s-maxage=31536000, max-age=31536000`\r\n    );\r\n    res.setHeader('content-type', 'image/jpeg');\r\n\r\n    const image = await fetch('URL to CDN');\r\n\r\n    const contentType = image.headers.get('content-type') || '';\r\n    const body = image.body;\r\n\r\n    res.setHeader('content-type', contentType);\r\n\r\n    return res.status(200).send(body);\r\n  } catch (error) {\r\n    console.error('Error when retrieving image from API');\r\n    return res.status(404).end();\r\n  }\r\n}\r\n```"}
{"sentences": "mime type is never set", "description": "**Goal**\r\nI am trying to dynamically construct a javascript file in this path: `/api/column/script.js` by having a file called `pages/api/column/script.js.tsx` \r\n\r\n**Issue**\r\n I keep getting the following error from the browser:\r\n```\r\nFailed to load module script: Expected a JavaScript module script but the server responded with a MIME type of \"\". Strict MIME type checking is enforced for module scripts per HTML spec\r\n```\r\nChecking the headers, it's true, it does not have the content type\r\n\r\n**Attempts**\r\n1. Sending the javascript code inside the API handler function like so: `res.status(StatusCodes.NOT_FOUND).setHeader('Content-Type', 'text/javascript')` does not work\r\n2. Setting the `headers` in next.config like so:\r\n```\r\nheaders: [\r\n    {\r\n      source: '/api/column/script.js',\r\n      headers: [\r\n        {\r\n          key: 'content-type',\r\n          value: 'text/javascript',\r\n        },\r\n      ],\r\n    },\r\n```\r\nEither way do not set the mime type, nor any header for that matter. For sanity check, I open the URL directly and it loads just fine, I copy pasted the file into `public/script.js` returns the appropriate mime type.\r\n\r\nIs there a way to set the mime type?\r\n"}
{"sentences": "Using the baseUrl feature in 9.4 breaks my jest tests. Is there a way to get Jest to use the same config?", "description": "I just read the announcement for next 9.4 (Congrats! 🎉 ) and decided to give it a shot.\r\n\r\nI converted a bunch of `import '../../../components/Foo'` to `import 'components/Foo'`, and Next is working great. However, now my Jest tests fail because of the new pathing.\r\n\r\nIs there some way to get Jest to use the same config?"}
{"sentences": "Hydration failed because the initial UI does not match nextjs on chrome browser", "description": "When today morning opening my current working project and run on dev server on chrome I got this \"Error: Hydration failed because the initial UI does not match what was rendered on the server\". Then I tried so many solutions mentioned in nextjs documents and stackoverflow. But I coundn't find a working solution. Then I just created new next js project and tried and got the same error. Error was,\r\n>`react-dom.development.js?160d:94 Warning: Expected server HTML to contain a matching <div> in <body>.\r\n    at div\r\n    at InnerLayoutRouter (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:124:11)\r\n    at RedirectErrorBoundary (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:303:9)\r\n    at RedirectBoundary (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:310:11)\r\n    at NotFoundErrorBoundary (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:339:9)\r\n    at NotFoundBoundary (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:346:11)\r\n    at LoadingBoundary (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:258:11)\r\n    at ErrorBoundary (webpack-internal:///./node_modules/next/dist/client/components/error-boundary.js:40:11)\r\n    at RenderFromTemplateContext (webpack-internal:///./node_modules/next/dist/client/components/render-from-template-context.js:12:34)\r\n    at OuterLayoutRouter (webpack-internal:///./node_modules/next/dist/client/components/layout-router.js:18:11)\r\n    at body\r\n    at html\r\n    at ReactDevOverlay (webpack-internal:///./node_modules/next/dist/client/components/react-dev-overlay/internal/ReactDevOverlay.js:53:9)\r\n    at HotReload (webpack-internal:///./node_modules/next/dist/client/components/react-dev-overlay/hot-reloader-client.js:19:11)\r\n    at Router (webpack-internal:///./node_modules/next/dist/client/components/app-router.js:97:11)\r\n    at ErrorBoundaryHandler (webpack-internal:///./node_modules/next/dist/client/components/error-boundary.js:28:9)\r\n    at ErrorBoundary (webpack-internal:///./node_modules/next/dist/client/components/error-boundary.js:40:11)\r\n    at AppRouter\r\n    at ServerRoot (webpack-internal:///./node_modules/next/dist/client/app-index.js:113:11)\r\n    at RSCComponent\r\n    at Root (webpack-internal:///./node_modules/next/dist/client/app-index.js:130:11)\r\nprintWarning @ react-dom.development.js?160d:94\r\nreact-dom.development.js?160d:14706 Uncaught Error: Hydration failed because the initial UI does not match what was rendered on the server.\r\n    at throwOnHydrationMismatch (react-dom.development.js?160d:14706:1)\r\n    at tryToClaimNextHydratableInstance (react-dom.development.js?160d:14756:1)\r\n    at updateHostComponent (react-dom.development.js?160d:22897:1)\r\n    at beginWork (react-dom.development.js?160d:24709:1)\r\n    at HTMLUnknownElement.callCallback (react-dom.development.js?160d:4246:1)\r\n    at Object.invokeGuardedCallbackDev (react-dom.development.js?160d:4295:1)\r\n    at invokeGuardedCallback (react-dom.development.js?160d:4359:1)\r\n    at beginWork$1 (react-dom.development.js?160d:31944:1)\r\n    at performUnitOfWork (react-dom.development.js?160d:30853:1)\r\n    at workLoopConcurrent (react-dom.development.js?160d:30839:1)\r\n    at renderRootConcurrent (react-dom.development.js?160d:30797:1)\r\n    at performConcurrentWorkOnRoot (react-dom.development.js?160d:29844:1)\r\n    at workLoop (index.js?82e4:10:3922)\r\n    at flushWork (index.js?82e4:10:3630)\r\n    at MessagePort.performWorkUntilDeadline (index.js?82e4:10:1812)\r\nreact-dom.development.js?160d:94 Warning: An error occurred during hydration. The server HTML was replaced with client content in <#document>.\r\nprintWarning @ react-dom.development.js?160d:94\r\n3react-dom.development.js?160d:31301 Uncaught Error: Hydration failed because the initial UI does not match what was rendered on the server.\r\n    at throwOnHydrationMismatch (react-dom.development.js?160d:14706:1)\r\n    at tryToClaimNextHydratableInstance (react-dom.development.js?160d:14756:1)\r\n    at updateHostComponent (react-dom.development.js?160d:22897:1)\r\n    at beginWork (react-dom.development.js?160d:24709:1)\r\n    at beginWork$1 (react-dom.development.js?160d:31919:1)\r\n    at performUnitOfWork (react-dom.development.js?160d:30853:1)\r\n    at workLoopConcurrent (react-dom.development.js?160d:30839:1)\r\n    at renderRootConcurrent (react-dom.development.js?160d:30797:1)\r\n    at performConcurrentWorkOnRoot (react-dom.development.js?160d:29844:1)\r\n    at workLoop (index.js?82e4:10:3922)\r\n    at flushWork (index.js?82e4:10:3630)\r\n    at MessagePort.performWorkUntilDeadline (index.js?82e4:10:1812)\r\nreact-dom.development.js?160d:22844 Uncaught Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\r\n    at updateHostRoot (react-dom.development.js?160d:22844:1)\r\n    at beginWork (react-dom.development.js?160d:24692:1)\r\n    at beginWork$1 (react-dom.development.js?160d:31919:1)\r\n    at performUnitOfWork (react-dom.development.js?160d:30853:1)\r\n    at workLoopSync (react-dom.development.js?160d:30689:1)\r\n    at renderRootSync (react-dom.development.js?160d:30654:1)\r\n    at recoverFromConcurrentError (react-dom.development.js?160d:29970:1)\r\n    at performConcurrentWorkOnRoot (react-dom.development.js?160d:29857:1)\r\n    at workLoop (index.js?82e4:10:3922)\r\n    at flushWork (index.js?82e4:10:3630)\r\n    at MessagePort.performWorkUntilDeadline (index.js?82e4:10:1812)`\r\n\r\nMy default browser is chrome and then I tried in edge and brave browser and amazingly they don't give me those errors.\r\n\r\nCode sandbox for testing project: https://codesandbox.io/p/github/dwalker93/next13/draft/condescending-frog\r\n(No issues when running the same project in chrome via codesandbox)\r\n\r\nIn chrome browser\r\n![image](https://user-images.githubusercontent.com/65861708/203402913-95d9a637-80c5-42f3-946c-911dbd42edcf.png)\r\n\r\nIn Edge Browser\r\n![image](https://user-images.githubusercontent.com/65861708/203402975-40c02513-3420-4a76-ab8a-fb2ffe91f89b.png)\r\n\r\nIn Brave browser\r\n![image](https://user-images.githubusercontent.com/65861708/203403198-0712361a-f10f-46cb-b430-f7151818653b.png)\r\n\r\n"}
{"sentences": "Homepage downloads blank “index” file instead of loading site on NextJS 13", "description": "### NextJS 13\r\n\r\nWhenever I open my [website](https://forntoh.dev), it requests to download a file instead of displaying the page.\r\n\r\nOn safari mobile, the message is \"Do you want to download forntoh.dev\".\r\n\r\nHow do I prevent that?\r\n\r\nHosted on Vercel.\r\n\r\n![image](https://user-images.githubusercontent.com/27886627/201482405-5e6c7634-0577-41aa-9f52-3d339dd3621e.png)\r\n"}
{"sentences": "Loading custom Script [Iubenda Example]", "description": "I want to load the cookie banner solution from iubenda to block all unwanted cookie-scripts. Gatsby has done a plugin for that.\r\nhttps://www.gatsbyjs.org/packages/gatsby-plugin-iubenda-cookie-footer/\r\n\r\n```import Document, { DocumentContext, Head, Main, NextScript, Html } from 'next/document';\r\n\r\nconst iubendaImplementation = `\r\n<script type=\"text/javascript\">\r\nvar _iub = _iub || [];\r\n_iub.csConfiguration = {\"countryDetection\":true,\"perPurposeConsent\":true,\"whitelabel\":false,\"lang\":\"de\",\"siteId\":222222,\"consentOnDocument\":true,\"consentOnHorizontalScroll\":true,\"cookiePolicyId\":222222, \"banner\":{ \"acceptButtonDisplay\":true,\"customizeButtonDisplay\":true,\"acceptButtonColor\":\"#65a6a0\",\"acceptButtonCaptionColor\":\"white\",\"customizeButtonColor\":\"#212121\",\"customizeButtonCaptionColor\":\"white\",\"position\":\"float-top-center\",\"textColor\":\"white\",\"backgroundColor\":\"#000001\" }};\r\n</script>\r\n<script type=\"text/javascript\" src=\"//cdn.iubenda.com/cs/iubenda_cs.js\" charset=\"UTF-8\" async></script>`;\r\n\r\nexport default class MyDocument extends Document {\r\n    render() {\r\n        return (\r\n            <Html lang=\"de-at\">\r\n                <Head>\r\n                    <div dangerouslySetInnerHTML={{ __html: iubendaImplementation }}> </div>\r\n                </Head>\r\n                <body>\r\n                    <Main />\r\n                    <NextScript />\r\n                </body>\r\n            </Html>\r\n        );\r\n    }\r\n}\r\n```\r\n\r\n\r\nWith this code I am able to see the cookie banner but I also got an error: \r\n\r\n> index.js:1 Warning: next-head-count is missing. https://err.sh/next.js/next-head-count-missing"}
{"sentences": "No Firebase App '[DEFAULT]' has been created - call Firebase App.initializeApp() (app/no-app)", "description": "I'm getting that error when calling firebase in `getInitialProps` or `getStaticProps`.\r\n\r\n```\r\nPage.getInitialProps = async ({ req }) => {\r\nconst db = await firebase.firestore(); // firebase is not ready yet\r\n...\r\n```\r\n\r\nThe issue seems to be that whatever call is being made is happening before `initializeApp()` is complete. In the [with-firebase](https://github.com/zeit/next.js/blob/canary/examples/with-firebase/firebase/clientApp.js), firebase is just configured and exported. So I guess it needs to loaded async somehow. \r\n\r\nAnyone have a solution for this? "}
{"sentences": "Font loader error", "description": "upgrage @next/font  to 13.0.3/4 getting an error\r\n\r\n```\r\nerror - Font loader error:\r\nCannot read properties of undefined (reading 'fs')\r\nLocation: src\\utils\\hubot-sans.ts\r\n```\r\n\r\n```tsx\r\n\r\n// utils/hubot-sans.ts\r\nconst hubotSans = localFont({\r\n  src: '../assets/Hubot-Sans.woff2',\r\n  weight: '200 900',\r\n  variable: '--font-hubot',\r\n});\r\n\r\n// pages/_app.tsx\r\n\r\nconst MyApp = ({\r\n  Component,\r\n  pageProps: { session, ...pageProps },\r\n}: AppProps) => {\r\n  const getLayout = Component.getLayout || ((page) => page);\r\n\r\n  return (\r\n    <SessionProvider session={session}>\r\n      {getLayout(\r\n        <div id=\"__discola\" className={`${hubotSans.variable} font-sans`}>\r\n          <Component {...pageProps} />\r\n        </div>\r\n      )}\r\n    </SessionProvider>\r\n  );\r\n};\r\n\r\nexport default trpc.withTRPC(MyApp);\r\n\r\n```\r\n\r\nanyone here experience the same issue?"}
{"sentences": "Image artifacts when using sharp optimizer in production", "description": "Hi, I'm having an issue that is getting quite hard to solve, it has to do with the `sharp` image optimization library. Here's what happens when an image gets requested from a cloud storage URL using `next/image` (old `next/image`, I'm using `next 12.3.1`):\r\n\r\n![image](https://user-images.githubusercontent.com/3876046/202251492-d94bafc2-374f-45f5-a256-84a495ccb695.png)\r\n\r\n### The issue\r\nAs you can see, the image comes with some strange white artifacts\r\n\r\n### Where I am currently\r\nSome things that I know are:\r\n- The white artifacts are not really white, they are transparent pixels and you're seeing the background color of the `<body />`.\r\n- Which images get \"sharp-optimized\" with artifacts on them seem to be random, since:\r\n  - Only some images have artifacts\r\n  - Once the 60 seconds default cache TTL for optimized images are over, the images are re-optimized in subsequent requests and then, there's a different set of images that come with artifacts (some images that previously had artifacts are displayed without them and viceversa).\r\n- The issue only happens when optimizing `png` images and keeping them as `png`\r\n  - `jpeg` to `jpeg` works fine\r\n  - `jpeg` to `webp` works fine\r\n  - `png` to `png` **has issues**\r\n  - `png` to `webp` works fine\r\n- The issue does **not** happen when optimizing with the `squoosh` package used in development\r\n- I started a simple node project and installed sharp to optimize some of the problematic images myself following [what next does](https://github.com/vercel/next.js/blob/v12.3.1/packages/next/server/image-optimizer.ts#L509) and wasn't able to reproduce the issue\r\n\r\nRight now I'm using `squoosh` in production to avoid having images with artifacts, but it's quite noticeable that the image optimization service runs quite slower than with `sharp` and wonder if anyone has some insight on the issue"}
{"sentences": "Any limit on ISR revalidate?", "description": "I'm planning on only revalidating certain pages once every 3 days as I will only be updating my data once every 3 days. This would result in the revalidate parameter for ISR static generation being `432000`. Is there any limit for how large ISR revalidating can be?"}
{"sentences": "New example: With Postgres.js", "description": "Hey team.\r\n\r\nCan I have a Code Review for this PR?\r\n\r\nhttps://github.com/vercel/next.js/pull/42962\r\n\r\nTIA"}
{"sentences": "Next.js suddenly does not work in WSL 2 (can't open localhost in browsers) if I turn on VPN", "description": "Hi, guys.\r\n\r\nI have Next.js repo and have been working on it in WSL 2 without problem. Suddenly, today it doesn't work anymore. Next.js successfully compiles and listens to port 3000 as usual but I can't open the localhost in my browsers as if no local server is running. \r\n\r\n![image](https://user-images.githubusercontent.com/17370471/95301508-df5feb80-08aa-11eb-9a94-1745c585da59.png)\r\n"}
{"sentences": "Cannot read properties of undefined (reading 'fs') after use @next/fonts", "description": "I did everything as in the [manual](https://nextjs.org/docs/basic-features/font-optimization), I got such an unexpected error  in pages/_app.js\r\n<img width=\"1440\" alt=\"Снимок экрана 2022-11-11 в 23 40 00\" src=\"https://user-images.githubusercontent.com/41699729/201409187-792dbfbd-c642-4e69-a19b-8cae0d917b65.png\">\r\n"}
{"sentences": "next/link doesn't output className", "description": "Hello,\r\nWe were trying to migrate to Next.js 13. For some reason the new next/link component (whether with legacyBehavior or not) doesn't output the CSS class names.\r\nDid anyone face this issue?"}
{"sentences": "next getServerSideProps Function enhancement help", "description": "First of all, thank you for this great project, and thank you for your dedication to this project!\r\n\r\nThe environment\r\n\"Next\" : \"13.0.2\",\r\n\r\nbackground\r\nI need to check login information at one of getServerSideProps not login Redirection to login page Users log in and go directly to the page instead of the home page\r\n\r\nThe sample\r\n```ts\r\n  - pages\r\n    - index.ts // No login is required\r\n    - a.ts // You need to login to access getServerSideProps -> Not logged in redirection login.com? Cb=xxx.com/a so that users login to x.com/automatically jump back\r\n\r\nI tried ctx.req.headers.referer or ctx.req.url but it didn't meet my requirements in the following scenarios\r\n  1. When using the Link component at xxx.com, switch to xxx.com/a\r\n    ctx.req.headers.referer // xxx.com\r\n    ctx.req.url // /_next/data/development/a.json\r\n  2. Enter xxx.com in the browser\r\n    ctx.req.headers.referer // undefined\r\n    ctx.req.url // /a 👌 This is in line with my appeal\r\n```\r\n\r\nMy question\r\n1. Can other fields be provided to support /a\r\n2. How to get protocol (http/https) I can't find any usable fields (maybe Symbol(NextRequestMeta)._protocol but I don't know how)\r\n3. Can you provide a unified api similar to middleware.request for ctx? For example the req. Cookies. The get request. Cookies. Set"}
{"sentences": "@next/font + Tailwind docs or example", "description": "👋 Hello, I can't figure out how to get @next/font working with Tailwind. Are there any docs or examples anyone could point me towards, please?"}
{"sentences": "Web app working well locally but giving me error when deployed on Vercel", "description": "I just audio player project. It worked completely fine locally but when I deployed it on Vercel, it displayed this error on first render:\n\n\"Application error: a client-side exception has occurred (see the browser console for more information).\"\n\nI followed this [discussion](https://github.com/vercel/next.js/discussions/36121) but it didn't work.\n\nLive url: https://musica-webapp.vercel.app/\nGitHub repo: https://github.com/xOluwaseyi/musica\n\n![musica-productionbug.png](https://user-images.githubusercontent.com/75592533/200032774-09e62b67-95d7-4739-b97f-ec6457178e7b.png)\n\n"}
{"sentences": "Trouble accessing cookies in middleware", "description": "I am following the method shown in the [documentation on middleware](https://nextjs.org/docs/advanced-features/middleware#using-cookies).\r\n\r\nIn my middleware:\r\n\r\n```\r\nexport async function middleware(request: NextRequest) {\r\n\tconsole.log('COOKIES:', request.cookies);\r\n\tconsole.log('HAS XSRF-Token:', request.cookies.has('XSRF-Token'));\r\n\tconst xsrf_cookie = request.cookies.get('XSRF-Token')?.value;\r\n\tconsole.log('XSRF-Token:', xsrf_cookie);\r\n\treturn NextResponse.next();\r\n}\r\n```\r\n\r\n\r\nThe console output:\r\n```\r\nCOOKIES: {\r\n  XSRF-Token: 'XSRF-Token=aaaaaa; Path=/',\r\n  session: 'session=aaaaaa; Path=/'\r\n}\r\nHAS XSRF-Token: true\r\nXSRF-Token: undefined\r\n```\r\n\r\nAs you can see, the cookie is clearly there, yet `get()` results in undefined"}
{"sentences": "Why does my nav bar forwards me to the old address?", "description": "Previously I had the page `/products `  being forward to the page` /products/piston-pumps`\r\n\r\nNow I created the page `/products`  with an `index.js `   so now if I type in the browser /products it stays in /products...\r\n\r\nHowever,  why does the nav bar some times goes to `/products` but then  most of the time goes to `/products/piston-pumps`  ???\r\n\r\nI have updated the code for the nav bar, and on the first load of the browser I click on the `Products `nav bar selection and it works good,  but then I start navigating the site and I do another click on the same link, and it takes me to the old page????      what is going on???\r\n\r\nProject link:\r\nhttps://github.com/Elindo586/nextprojectb\r\n\r\n\r\n```\r\nimport { React, useState, useEffect } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nfunction MainNav() {\r\n  const [isPath, setIsPath] = useState();\r\n  useEffect(() => {\r\n    title();\r\n  }, [isPath]);\r\n\r\n  const show = () => {\r\n    let drop = document.getElementById(\"navbarTogglerDemo02\");\r\n\r\n    if (drop.classList.value === \"navbar-collapse collapse\") {\r\n      drop.classList.value = \"navbar-collapse collapse show\";\r\n    } else {\r\n      drop.classList.value = \"navbar-collapse collapse\";\r\n    }\r\n  };\r\n\r\n  const title = () => {\r\n    let findTitle = window.location.pathname;\r\n    setIsPath(findTitle);\r\n    // document.title = `TU  | ${findTitle}`;\r\n    switch (findTitle) {\r\n      case \"/\":\r\n        document.title = \"TU | Home\";\r\n        break;\r\n      case \"/products\":\r\n        document.title = \"TU | Products\";\r\n        break;\r\n      case \"/services/fluid-analysis\":\r\n        document.title = \"TU | Services\";\r\n        break;\r\n      case \"/inventory\":\r\n        document.title = \"TU | Inventory\";\r\n        break;\r\n      case \"/fluid-power-formulas\":\r\n        document.title = \"TU | Formulas\";\r\n        break;\r\n      case \"/interactive\":\r\n        document.title = \"TU | Interactive\";\r\n        break;\r\n      case \"/contact-us\":\r\n        document.title = \"TU | Contact Us\";\r\n        break;\r\n      default:\r\n        console.log(\"This is not a part of this website.\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <nav\r\n      className=\"navbar navbar-expand-lg bg-dark navbar-dark\"\r\n      onClick={title}\r\n    >\r\n      <Link href=\"/\">\r\n        <a onClick={title} className=\"navbar-brand\">\r\n          &nbsp; <strong>TU</strong>\r\n        </a>\r\n      </Link>\r\n\r\n      <button\r\n        className=\"navbar-toggler\"\r\n        type=\"button\"\r\n        data-bs-toggle=\"collapse\"\r\n        data-bs-target=\"#navbarTogglerDemo02\"\r\n        aria-controls=\"navbarTogglerDemo02\"\r\n        aria-expanded=\"false\"\r\n        aria-label=\"Toggle navigation\"\r\n        onClick={show}\r\n      >\r\n        <span className=\"navbar-toggler-icon\"></span>\r\n      </button>\r\n\r\n      <div className=\"navbar-collapse collapse\" id=\"navbarTogglerDemo02\">\r\n        <ul className=\"navbar-nav\">\r\n          <li className=\"nav-item active\">\r\n            <Link href=\"/\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Home\r\n              </a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            {/* <a className=\"nav-link\" href=\"/Products/products.html\">| Products</a> */}\r\n            <Link href=\"/products\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Products\r\n              </a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            {/* <a className=\"nav-link\" href=\"/Services/Services.html\">| Services</a> */}\r\n            <Link href=\"/services/fluid-analysis\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Services\r\n              </a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            <Link href=\"/inventory\">\r\n              <a className=\"nav-link\">Inventory</a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            {/* <a className=\"nav-link\" href=\"formulas.html\">| Formulas</a> */}\r\n            <Link href=\"/fluid-power-formulas\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Formulas\r\n              </a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            {/* <a className=\"nav-link\" href=\"Interactive.html\">| Interactive</a> */}\r\n            <Link href=\"/interactive\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Interactive\r\n              </a>\r\n            </Link>\r\n          </li>\r\n          <li className=\"nav-item\">\r\n            <Link href=\"/blog/english\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Blogs\r\n              </a>\r\n            </Link>\r\n          </li>\r\n\r\n          <li className=\"nav-item\">\r\n            {/* <a className=\"nav-link\" href=\"contactus.html\">| Contact Us</a> */}\r\n            <Link href=\"/contact-us\">\r\n              <a className=\"nav-link\" onClick={title}>\r\n                Contact Us\r\n              </a>\r\n            </Link>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </nav>\r\n  );\r\n}\r\n\r\nexport default MainNav;\r\n```\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Why does usePathName() in a client component cause a page segment to be fully dynamic (instead of static)?", "description": "I have a \"goofing around\" app I am moving to Next 13's beta `app/` approach as mechanism to learn about the new capabilities.  In the process of working on it, I noticed that some page segments that should have been static were acting as if they were perma-dynamic.  Calls to `fetch()` with `{ next: { revalidate: 60 } }` were being re-rendered every time both with `next build && next start` and with deployments to Vercel.\r\n\r\nI created a simple debugging page which you can see here.  It gets the current time from an API with a fetch call and the page should be cached for 30 seconds:  https://github.com/ervwalter/games.ewal.net/blob/master/frontend/app/debug/page.tsx.  It is not cached and is regenerated every time you refresh the page (see https://ewal-games.vercel.app/debug for the live Vercel-deployed site).\r\n\r\nNote, I can also see in the `next build` output that next has decided that these are \"server-side\" pages (they have the λ icon).\r\n\r\nAfter digging around, I eventually found that it was the use of the `usePathName()` hook in my leaf-node client component for my sidebar (I use it to give the current page link a different background color) was causing this behavior.   Specifically, these 2 lines of code is the cause:  https://github.com/ervwalter/games.ewal.net/blob/master/frontend/app/sidebar.tsx#L157-L158\r\n\r\nIf I remove those lines of code, the debug page immediately starts working as expected.  The page is statically rendered at build time and is updated every 30 seconds with ISR-like behavior.\r\n\r\nMy question is why this happens/matters? If it's a bug, great, I can create an issue.  But I'm wondering if I am just misunderstanding something.  Is there something special about asking the routing engine what page is active which is incompatible with static rendering?"}
{"sentences": "Cannot access database during build time with dynamic pages", "description": "I have an issue where Prisma is unable to connect to the database server during build time. So this doesn't happen in the dev environment, and only appears when I'm using dynamic routes with Next.js.\r\n\r\n\r\n\r\nHere is a screenshot of the error:\r\n\r\n![prisma ssg error](https://i.imgur.com/7s3mdDR.jpeg)\r\n\r\nAnd here is the code for [id].tsx\r\n```\r\nexport async function getStaticProps(\r\n  context: GetStaticPropsContext<{ id: string }>\r\n) {\r\n  const ssg = await createProxySSGHelpers({\r\n    router: appRouter,\r\n    ctx: {},\r\n    transformer: superjson\r\n    // optional - adds superjson serialization\r\n  });\r\n  const id = context.params?.id as string;\r\n  // prefetch `post.byId`\r\n  await ssg.user.getOne.prefetch({ id });\r\n  return {\r\n    props: {\r\n      trpcState: ssg.dehydrate(),\r\n      id\r\n    },\r\n    revalidate: 10\r\n  };\r\n}\r\n\r\nexport const getStaticPaths: GetStaticPaths = async () => {\r\n  const users = await prisma.user.findMany({\r\n    select: {\r\n      id: true\r\n    }\r\n  });\r\n  return {\r\n    paths: users.map((user) => ({\r\n      params: {\r\n        id: user.id\r\n      }\r\n    })),\r\n    // https://nextjs.org/docs/basic-features/data-fetching#fallback-blocking\r\n    fallback: true\r\n  };\r\n};\r\n```\r\n"}
{"sentences": "Common chunks in serverless page bundles", "description": "As I understand it there is quite a bit of overlap / duplicated code between each serverless page bundle, where each base file at least includes react and react-dom. Adding external libraries also leads to an increase in each page bundle size.\r\n\r\nThis does not pose a problem when you deploy one Lambda Fn per serverless page bundle (like Now and [serverless-nextjs-plugin](https://github.com/danielcondemarin/serverless-next.js/tree/master/packages/serverless-nextjs-plugin) do.\r\n\r\nHowever for [this project](https://github.com/danielcondemarin/serverless-next.js) I've been maintaining for a while now is not possible to deploy one Lambda Fn. per page as it uses Lambda@Edge behind the scenes where doing this isn't possible.\r\nAn example of the issue can be found in https://github.com/serverless-nextjs/serverless-next.js/issues/236 where a user hit the limit of how big the Lambda artifact can be.\r\n\r\nIs it possible to output common chunks between sls page bundles? This would considerably reduce duplication. Considering the next framework is pushing so much for serverless this change would give library maintainers like myself the flexibility to take even further what's possible in this area.\r\n\r\nI'm more than happy to look into it myself, all I'd need would be a bit of initial guidance 🙌"}
{"sentences": "Way to get route pathname on layout in next13", "description": "useRouter does not work on server and we have no access to layout on component."}
{"sentences": "Type-only export not supported?", "description": "Hi, I'm moving from babel to swc in my next 12 project, and just got this issue. The error message seems to indicate that swc is not recognizing type-only exports. How could I resolve this?\r\n\r\n```\r\nerror - ../src/index.tsx\r\nModule parse failed: Unexpected token (3:7)\r\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\r\n| // Base\r\n| export { default as Button } from './Button';\r\n> export type { ButtonProps } from './Button';\r\n| \r\n| export { default as IconButton } from './IconButton';\r\n> Ready on http://localhost:3000\r\n```"}
{"sentences": "Use nested SASS classes with css modules", "description": "This is my css/sass module:\r\n```sass\r\n.landingProductSmall, .landingProductLarge\r\n  cursor: pointer\r\n  position: relative\r\n\r\n  .dots\r\n    position: absolute\r\n    background-image: url(/background.svg)\r\n    background-size: 3em\r\n    background-repeat: repeat\r\n    top: 0\r\n    left: 0\r\n    right: 0\r\n    bottom: 0\r\n\r\n  &:hover\r\n    .dots\r\n      background-size: 3.4em\r\n```\r\nThe component:\r\n```tsx\r\n<div className={styles.landingProductSmall}>\r\n  <div className=\"dots\"></div>\r\n</div>\r\n```\r\nIt does not apply the `.dots` style to the children of `.landingProductSmall` / `.landingProductLarge`.\r\nAny suggestions?"}
{"sentences": "Static generation for a subset of pages for a route, and dynamic for the rest", "description": "I have 30,000 products in my database, but only a few hundred of them have actual useful information.\r\n\r\nI want to generate `/product/[productId]` pages statically to make the loading faster.\r\n\r\nStatically generating all 30,000 pages fails on Vercel because it takes too long.\r\n\r\nIs there a way to generate the `/product/[productId]` pages statically for few hundred `productId`s and dynamically for the rest?"}
{"sentences": "Nextjs 13 in app directory, it does not render tailwind css", "description": "I just started using NEXTjs 13 and I have upgraded my tailwind config file to make sure that it reads the css but it is still not reading any tailwind css when the file is inside the app directory. \r\n\r\n``` -tailwind.config.js file\r\n content: [\r\n    \"./app/**/*.{js,ts,jsx,tsx}\",\r\n    \"./pages/**/*.{js,ts,jsx,tsx}\",\r\n    \"./components/**/*.{js,ts,jsx,tsx}\",\r\n  ],\r\n```\r\n\r\nIf I use pages, it will render normally, what am I missing here? \r\n\r\n"}
{"sentences": "Newbie facing hydration issues and trying to fix it", "description": "Hey,\r\n\r\nI'm currently getting into Nextjs 12.2. I've a simple component that fetch data using `useSWR` but for some reasons, I got some hydration issues and can't understand where it is coming from. See bellow two examples, one failing and one working but I'd like to understand why the first one is not working.\r\n\r\n---\r\n\r\nEnd up with hydration issues\r\n```typescript\r\nimport axios from \"axios\";\r\nimport useSWR from \"swr\";\r\nimport styles from \"./styles.module.scss\";\r\n\r\nconst fetcher: any = (url: string) =>\r\n  axios.get(url).then((response) => response.data);\r\n\r\nfunction MyComponent() {\r\n  const { data } = useSWR<[]>(\r\n    \"http://localhost:3000/api/articles\", // Return an array of objects\r\n    fetcher\r\n  );\r\n\r\n  return (\r\n    <div className={styles[\"my-component\"]}>\r\n      <table>\r\n        <tbody>\r\n          <tr>\r\n            <th>Title</th>\r\n            <th>Description</th>\r\n          </tr>\r\n          {data == undefined ? (\r\n            <div>Loading...</div>\r\n          ) : (\r\n            data.map((a: any) => (\r\n              <tr key={a.uid}>\r\n                <td>{a.title}</td>\r\n                <td>{a.description}</td>\r\n              </tr>\r\n            ))\r\n          )}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MyComponent;\r\n```\r\n---\r\nEnd up working\r\n```typescript\r\nimport axios from \"axios\";\r\nimport useSWR from \"swr\";\r\nimport styles from \"./styles.module.scss\";\r\n\r\nconst fetcher: any = (url: string) =>\r\n  axios.get(url).then((response) => response.data);\r\n\r\nfunction MyComponent() {\r\n  const { data } = useSWR<[]>(\r\n    \"http://localhost:3000/api/articles\", // Return an array of objects\r\n    fetcher\r\n  );\r\n\r\n  // Re-rendering a part of the component instead of the whole component seems to be issue, but why?\r\n  if (!data) {\r\n    return \"loading...\";\r\n  }\r\n  return (\r\n    <div className={styles[\"my-component\"]}>\r\n      <table>\r\n        <tbody>\r\n          <tr>\r\n            <th>Title</th>\r\n            <th>Description</th>\r\n          </tr>\r\n          {data == undefined ? (\r\n            <div>Loading...</div>\r\n          ) : (\r\n            data.map((a: any) => (\r\n              <tr key={a.uid}>\r\n                <td>{a.title}</td>\r\n                <td>{a.description}</td>\r\n              </tr>\r\n            ))\r\n          )}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MyComponent;\r\n```\r\n---\r\nFrom what I understand, hydration is caused when the rendering of a component is different between SSR and first client rendering, but in the first example, I don't understand what's going wrong especially because it's a common use case to have only a part of your component to be conditionally rendered based on a fetch logic.\r\n\r\nThanks for your help! "}
{"sentences": "loading.js not rendered on next 13", "description": "Hi, I am trying to enable loading.js functionality and it is not working, my requested page just blocks for specified timeout period. I am doing this all in app folder\r\nI am not using typescript, I believe it shouldn't,  but is there any limitation in using plain javascript?\r\n\r\nThank you for any help here.\r\n\r\nThis is page tree:\r\n![Screenshot 2022-10-28 at 19 30 33](https://user-images.githubusercontent.com/7074260/198697489-8ddd440b-c83d-4d56-8b69-79fd755b2864.png)\r\n\r\nlayout.js\r\n```\r\nexport default async function RootLayout({ children }) {\r\n  return (\r\n    <html lang=\"en\">\r\n      <head>\r\n        <title>Next.js</title>\r\n      </head>\r\n      <body>\r\n        <div style={{ background: \"red\", width: \"100%\" }}>LAYOUT</div>\r\n        <div>{children}</div>\r\n      </body>\r\n    </html>\r\n  );\r\n}`\r\n```\r\n\r\npage.js\r\n```\r\nconst fetchData = async () => {\r\n  // delay\r\n  await new Promise((resolve) => setTimeout(resolve, 5000));\r\n\r\n  return \"Returned data\";\r\n};\r\n\r\n\r\nexport default async function Page() {\r\n  const data = await fetchData();\r\n  if (!data) {\r\n    return null;\r\n  }\r\n  return (\r\n    <div>\r\n      <h1>TITLE</h1>\r\n      <h2>{data}</h2>\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\nloading.js\r\n```\r\nexport default function Loading() {\r\n  return (\r\n    <div>\r\n      <h1>Loading.....</h1>\r\n    </div>\r\n  );\r\n}\r\n\r\n```\r\nnext.config.js\r\n\r\n\r\n```\r\n/** @type {import('next').NextConfig} */\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  swcMinify: true,\r\n  experimental: {\r\n    appDir: true,\r\n  },\r\n};\r\n\r\n\r\nmodule.exports = nextConfig;\r\n```\r\n\r\n\r\npackage.json\r\n```\r\n{\r\n  \"name\": \"play\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\"\r\n  },\r\n  \"dependencies\": {\r\n    \"next\": \"13.0.0\",\r\n    \"react\": \"18.2.0\",\r\n    \"react-dom\": \"18.2.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"eslint\": \"8.26.0\",\r\n    \"eslint-config-next\": \"^13.0.0\"\r\n  }\r\n}\r\n```\r\n\r\n\r\n\r\n"}
{"sentences": "How can I disable inline font optimization (obsoleted)?", "description": "Due to Content-Security-Policy, we are not allowed to use base64 font on our website. Is there any configuration option that we can disable this feature?\r\n\r\nThanks!"}
{"sentences": "Middleware fetch /api ECONNREFUSED", "description": "In development all works fine. But when I try production build Im unable to call fetch from my middleware.\r\n\r\nWhy is this not working ??\r\n\r\n```\r\nexport default async function middleware(req: NextRequest) {\r\n  const url = req.nextUrl.clone();\r\n\r\n  if (publicPaths.some((path) => url.pathname.includes(path)))\r\n    return NextResponse.next();\r\n\r\n  let session;\r\n  try {\r\n    session = await fetch(\r\n      `${url.origin}${env.NEXT_PUBLIC_APP_BASE_PATH}/api/auth/session`,\r\n      {\r\n        headers: req.headers,\r\n      }\r\n    ).then((res) => res.json());\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n\r\n  url.search = new URLSearchParams(`callbackUrl=${url}`).toString();\r\n  url.pathname = `/api/auth/signin`;\r\n\r\n  return session?.user ? NextResponse.next() : NextResponse.redirect(url);\r\n}\r\n```\r\n\r\nI keep getting \r\n> [TypeError: fetch failed] {\r\n  >cause: [Error: Error: connect ECONNREFUSED ::1:3000]\r\n>}\r\n"}
{"sentences": "amp-carousel autoplay and loop aren't working", "description": "Hi ,\r\nI used [amp-carousel](https://playground.amp.dev/?url=https%3A%2F%2Fpreview.amp.dev%2Fdocumentation%2Fcomponents%2Famp-carousel.example.3.html%3Fformat%3Dwebsites&format=websites&_gl=1*vbs84i*_ga*YW1wLUVJbjFZVnVUamsyZl9Wem1kQWJwdEE.) and added attributes `autoplay` `loop` , but it isn't working.\r\n\r\n\r\n```javascript\r\n<amp-carousel\r\n    type=\"slides\"\r\n    width=\"950\"\r\n    height=\"500\"\r\n    controls\r\n    loop\r\n    autoplay\r\n    layout=\"responsive\"\r\n    delay=\"3000\"\r\n    role=\"region\"\r\n    aria-label=\"Looping carousel\">\r\n ...\r\n</amp-carousel>\r\n```\r\n\r\n\r\nThe console print : \r\n\r\n```bash\r\nerror  The attribute 'autoplay' in tag 'amp-carousel' is set to the invalid value 'true'.  \r\nhttps://amp.dev/documentation/components/amp-carousel/\r\nerror  The attribute 'loop' in tag 'amp-carousel' is set to the invalid value 'true'.      \r\nhttps://amp.dev/documentation/components/amp-carousel/\r\n\r\n```\r\n\r\nIs something wrong with my code?  or how can I use correct method `amp-carousel` with loop and autoplay?\r\n"}
{"sentences": "App not building with npm when using jsx prop in style tag", "description": "Hello. I am working to export my app as static files using `next build && next export`. \r\n\r\nI previously used yarn and was successfully able to build and export the app as static files. Then I decided to move the whole app to another repo, so I basically copy pasted the code (excluding `node_modules` and `yarn.lock`) but this time used npm.\r\n\r\nThis was when I encountered that running the same build and export script did not successfully build the app (the error message responsible for this reads `Error: Unknown property 'jsx' found  react/no-unknown-property`) which pointed to something I have in my code for client portal \r\n```js\r\n<style jsx>\r\n  .....\r\n</style>\r\n```\r\nI had to remove the `jsx` from the `<style>` tag to build and export the app but this wasn't necessary when using yarn. Any explanation why this is occurring? Thanks for reading.\r\n\r\nP.S. yarn version `1.22.17`, npm version `8.1.2`, next `12.1.6`, react `18.2.0`"}
{"sentences": "What is the ‘use client’ used for？", "description": "next.js 13 with `turbopack` example project: https://github.com/vercel/next.js/blob/canary/examples/with-turbopack/app/context/CategoryNav.tsx\r\n\r\nWhat is the ‘use client’ in jsx file head used for?\r\n\r\n<img width=\"547\" alt=\"image\" src=\"https://user-images.githubusercontent.com/16160933/197956665-389febb8-86a8-4af5-b884-85f585c59a8d.png\">\r\n"}
{"sentences": "Scripts don't have the right CORS headers when deployed to Vercel", "description": "Hey guys, I have the following headers set in my next config. I'm using a `SharedArrayBuffer` on a few pages, and in order to use `SharedArrayBuffer`, browsers require these cross origin settings to be used.\r\n\r\nThis works correctly in on my local machine (in both dev and prod mode). It works when these headers are set, and throws an error if I remove them from the config.\r\n\r\n~~The problem is that when I deploy my site to Vercel, these headers aren't used on anything, and the site throws an error.~~\r\n\r\n~~Not sure why they aren't being used, would appreciate any input~~\r\n\r\n```js\r\n  async headers() {\r\n    return [\r\n      {\r\n        source: \"/:path*\",\r\n        headers: [\r\n          {\r\n            key: \"Cross-Origin-Opener-Policy\",\r\n            value: \"same-origin\",\r\n          },\r\n          {\r\n            key: \"Cross-Origin-Embedder-Policy\",\r\n            value: \"require-corp\",\r\n          },\r\n        ],\r\n      },\r\n    ];\r\n  },\r\n```\r\n\r\n\r\nUPDATE:\r\n\r\nIt looks like I had a bit of a misunderstanding.\r\n\r\nThe headers ARE being used, just not on the worker scripts, so they throw an `ERR_BLOCKED_BY_RESPONSE` error when I try to import them.\r\n\r\n![image](https://user-images.githubusercontent.com/92771507/194261631-0374e01c-09e9-4a5f-ad3e-fe7a3b26a955.png)\r\n\r\n![image](https://user-images.githubusercontent.com/92771507/194401213-e506ce89-a44b-40cf-8320-e66cd4de3d81.png)\r\n\r\n\r\nThe error says iframe, but im trying to load a worker. I read this as I need to add a `Cross-Origin-Embedder-Policy` header to the scripts im trying to import. On my local machine they have this header and it works, but for some reason it doesn't on the deployed site."}
{"sentences": "useState is keeping original value and not updating", "description": "I am using the Next.js catch all route ('[[...slug]]') to create a page that includes an image based on a parameter in the url. If there are no parameters in the url, the variables are set to a default variables to create the page.\r\nIn the [[...slug]].tsx file, I set the two variables to either the parameters in the url, or the default parameters, with an if statement. \r\n\r\n      const router = useRouter();\r\n      let storyType = \"\";\r\n      let storyBrand = \"\";\r\n    \r\n      const storyData = router.query.slug;\r\n    \r\n      if (!storyData) {\r\n        storyType = \"defaultStoryType\";\r\n        storyBrand = \"defaultStoryBrand\";\r\n      } else {\r\n        storyType = storyData[0];\r\n        storyBrand = storyData[1];\r\n      }\r\n\r\nI then send these variables to a component\r\n\r\n      return (\r\n        <Fragment>\r\n          <DemoHeader storybrand={storyBrand} storytype={storyType} />\r\n          ....\r\n\r\nIn the component, I use useState to make sure the image is able to load. If it can't be found, I want to change the source of the image to a default source. The parameters are passed to the component correctly. \r\n\r\n    function DemoImage(props) {\r\n      const { src, alt, width, height } = props;\r\n      console.log(\"this is the source in demoimage before useState: \" + src);\r\n    \r\n      const [imgSrc, setImgSrc] = useState(src);\r\n      console.log(\"this is imgSrc after useState:     \" + imgSrc);\r\n    \r\n      const [imgSrc2, setImgSrc2] = useState(\"/img/demo/chase/logo.png\");\r\n      console.log(\"this is imgSrc2:    \" + imgSrc2);\r\n    \r\n      const handleOnError = () => {\r\n        console.log(\"could not find imgSrc\");\r\n        setImgSrc(\r\n          \"https://via.placeholder.com/150x150.png?text=This+is+error+image\"\r\n        );\r\n      };\r\n      const handleOnError2 = () => {\r\n        console.log(\"could not find imgSrc2\");\r\n        setImgSrc2(\"https://via.placeholder.com/150x150.png?text=error+Image2\");\r\n      };\r\n    \r\n      return (\r\n        <Fragment>\r\n          <Image\r\n            //{...props}\r\n            width={width}\r\n            height={height}\r\n            src={imgSrc}\r\n            alt={alt}\r\n            onError={handleOnError}\r\n          />\r\n          <Image\r\n            width={width}\r\n            height={height}\r\n            src={imgSrc2}\r\n            alt={alt}\r\n            onError={handleOnError2}\r\n          />\r\n        </Fragment>\r\n      );\r\n    }\r\n\r\nThe problem is that it goes through the component twice. The first time must be something nextjs does, because it does not even test if the image can be loaded, and variables are not updated with the slug. And the second time through the component it does not reset useState, and therefore appears to use the default values as per the console.log output below. If I reset the useState, it goes through an endless loop.\r\n\r\n    FIRST TIME-DOES NOT USE SLUG-IMGSRC SET TO DEFAULT\r\n    This is storyType from slug in slugtsx:  defaultStoryType\r\n    This is the source in demoimage before useState: /img/demo/defaultStoryBrand/logo.png\r\n    This is imgSrc after useState:     /img/demo/defaultStoryBrand/logo.png\r\n    This is imgSrc2:    /img/demo/chase/logo.png\r\n    \r\n    SECOND TIME-HAS SLUG AND CORRECT SRC-DOES NOT SET IMGSRC\r\n    This is storyType from slug in slugtsx:  wsbm\r\n    This is the source in demoimage before useState: /img/demo/chase/logo.png\r\n    This is imgSrc after useState:     /img/demo/defaultStoryBrand/logo.png\r\n    This is imgSrc2:    /img/demo/chase/logo.png\r\n    GET http://localhost:3000/_next/image?url=%2Fimg%2Fdemo%2FdefaultStoryBrand%2Flogo.png&w=640&q=75 400 (Bad Request)\tImage (async)\tsetValueForProperty @ react-dom.development.js?ac89:855\tupdateDOMProperties @ react-dom.development.js?ac89:9738\tupdateProperties @ react-dom.development.js?ac89:10143\tcommitUpdate @ react-dom.development.js?ac89:11047…\r\n    could not find imgSrc \r\n    This is the source in demoimage before useState: /img/demo/chase/logo.png\r\n    This is imgSrc after useState:     https://via.placeholder.com/150x150.png?text=This+is+error+image\r\n\r\nFor debugging purposes, I duplicated some of the code using a set variable (imgSrc2) so you can see that it does work correctly if useState is correct.\r\n\r\nCan I reset useState without causing an endless loop? Or is there a way to set properly set useState so it uses the updated parameter?\r\n\r\nThanks!\r\n"}
{"sentences": "concurrentFeatures CSS Error", "description": "**next version**\r\n12.0.1\r\n\r\n**React version**\r\n18.0.0-alpha-6c3dcc7a4-20211027\r\n\r\nError:\r\n```\r\nUnhandled Runtime Error\r\nTypeError: Cannot read properties of null (reading 'parentNode')\r\n\r\nstyles\\globals.css (16:0) @ Object.options.insert\r\n\r\n  14 | // this code should fail.\r\n  15 | var anchorElement = document.querySelector('#__next_css__DO_NOT_USE__');\r\n> 16 | var parentNode = anchorElement.parentNode// Normally <head>\r\n  17 | ;\r\n  18 | // Each style tag should be placed right before our\r\n  19 | // anchor. By inserting before and not after, we do not\r\n  ```\r\n  pages/app.tsx\r\n  ```\r\nimport '../styles/globals.css'\r\nimport type { AppProps } from 'next/app'\r\n\r\nfunction MyApp({ Component, pageProps }: AppProps) {\r\n    return <Component {...pageProps} />\r\n}\r\n\r\nexport default MyApp\r\n```\r\nnext.config.js\r\n```\r\n/** @type {import('next').NextConfig} */\r\nmodule.exports = {\r\n  reactStrictMode: true,\r\n  experimental: {\r\n    concurrentFeatures: true,\r\n    serverComponents: true,\r\n  },\r\n};\r\n```\r\n\r\nthis error happens when importing any CSS file\r\nam I missing something?\r\n \r\nnote: this error is only in development "}
{"sentences": "A way to rate limit SSR?", "description": "I am wanting to rate limit certain ssr pages that get generated through search.. is there any built in nextjs tools for this?"}
{"sentences": "How to add crossorigin attribute to <link rel=\"preload\" href=\"...\" as=\"image\" />", "description": "Hi, the image on my website need to use cors, but when I set the priority and crossorigin for next/image, there is a problem, I need to add the crossorigin attribute to the preload link tag, I can't find how to add it, I need help, thanks!"}
{"sentences": "Access context values inside of getLayout", "description": "Is there a way to use a hook or access the component's hook values inside of the `getLayout` function?\r\n\r\n![index js — microjournal-Thursday-October-13-2022-12 51 21PM@2x](https://user-images.githubusercontent.com/20052710/195658693-18febcb8-22e0-45c6-830e-8fe09a063d55.png)\r\n\r\nOr, is there a better way I should be approaching this usecase?\r\n\r\nI'm trying to have a dashboard that shows the login component `<Auth />` at the root page when the user isn't logged in, otherwise it shows their `<Profile />`. This currently works with the `<Home />` page shown above, but now I'm trying to add a `<SideNav />` into the authenticated routes.\r\n\r\nI thought I could do this with `getLayout` but I need to do it conditionally for the `<Home` page whether `session` exists or not."}
{"sentences": "Is there a way to combine CSR and SSR/SSG for the same app?", "description": "My Team is looking to build something like a [Medium](https://medium.com/) clone. \r\n\r\nHere, The posts created by users are not expected to change much, so SSG seems like a good option, especially with the new Incremental build feature (#11552) . However, things like 'upvotes' on posts can change very frequently, so we are unsure how to accommodate that with SSG/SSR.\r\n\r\nAlso, a portion of the app will lie beyond a login, like Dashboards, or an editor to create a new post... etc. Since these don't need SEO, so we were thinking if that could be done via CSR, while other parts remained SSG or SSR. \r\n\r\nCan such a combination be done with NextJS ? We have been making CSR apps only till now, so apologies if the questions are a bit dumb :( \r\n\r\nSome advice/ideas would be of great help :)\r\n"}
{"sentences": "npx create-next-app@latest fails with incorrect data check", "description": "\r\n**macOS: 12.6\r\nnode: v14.20.0 (use nvm )\r\nnpm: 6.14.17**\r\n\r\n\r\nlike: https://github.com/vercel/next.js/issues/29669\r\n\r\nWhen execute `npx create-next-app@latest` , the command always failed as below:\r\n\r\n```\r\nMy-MBP:Git user$ npx create-next-app@latest\r\nnpx: installed 1 in 2.241s\r\n✔ What is your project named? … next-20221013\r\nCreating a new Next.js app in /Users/....../Git/next-20221013.\r\n\r\nUsing yarn.\r\n\r\nInstalling dependencies:\r\n- react\r\n- react-dom\r\n- next\r\n\r\nyarn add v1.22.19\r\ninfo No lockfile found.\r\n[1/4] 🔍  Resolving packages...\r\n[2/4] 🚚  Fetching packages...\r\nerror https://registry.npmmirror.com/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-android-arm64/-/swc-android-arm64-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-darwin-arm64/-/swc-darwin-arm64-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-12.3.1.tgz: incorrect data check\r\nerror An unexpected error occurred: \"https://registry.npmmirror.com/next/-/next-12.3.1.tgz: incorrect data check\".\r\ninfo If you think this is a bug, please open a bug report with the information provided in \"/Users/.../Git/next-20221013/yarn-error.log\".\r\ninfo Visit https://yarnpkg.com/en/docs/cli/add for documentation about this command.\r\nerror https://registry.npmmirror.com/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-darwin-x64/-/swc-darwin-x64-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-12.3.1.tgz: incorrect data check\r\nerror https://registry.npmmirror.com/@next/swc-freebsd-x64/-/swc-freebsd-x64-12.3.1.tgz: incorrect data check\r\n\r\nAborting installation.\r\n  yarn add --exact --cwd /Users/.../Git/next-20221013 react react-dom next has failed.\r\n```\r\n\r\nI tried `yarn cache clean`, but no lucky.\r\n\r\nreally appreciate any advice to resolve the matter. \r\n"}
{"sentences": "Website unresponsive after deploying to vercel 🥲", "description": "Website works well in localhost but once I deploy to vercel website becomes unresponsive and images are not loading.\r\n\r\nwebpack\r\nsite.webmanifest\r\nbuildmanifest.js\r\n\r\nall loading 🧐\r\n\r\nhttps://github.com/gunaseelan13/ullur.in-Dev\r\n\r\n![J_TPR0Vw](https://user-images.githubusercontent.com/16633639/194810483-c234c7c7-8c91-4c59-9a7b-2014c9ca761c.jpg)\r\n![toBcqBHo (1)](https://user-images.githubusercontent.com/16633639/194810492-f3506bbf-ac1a-4df0-9587-648a5607e13c.jpg)\r\n\r\n"}
{"sentences": "Vercel Deployment Serverless function error", "description": "After updating to next 12, I'm getting weird errors when deploying to Vercel\r\n\r\n```\r\nERROR\tError: Cannot find module '/var/task/node_modules/next/dist/server/next.js'. Please verify that the package.json has a valid \"main\" entry\r\n    at tryPackage (internal/modules/cjs/loader.js:320:19)\r\n    at Function.Module._findPath (internal/modules/cjs/loader.js:533:18)\r\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:875:27)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:745:27)\r\n    at Module.require (internal/modules/cjs/loader.js:961:19)\r\n    at require (internal/modules/cjs/helpers.js:92:18)\r\n    at Object.<anonymous> (/var/task/node_modules/@sentry/nextjs/dist/utils/instrumentServer.js:7:14)\r\n    at Module._compile (internal/modules/cjs/loader.js:1072:14)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1101:10)\r\n    at Module.load (internal/modules/cjs/loader.js:937:32) {\r\n  code: 'MODULE_NOT_FOUND',\r\n  path: '/var/task/node_modules/next/package.json',\r\n  requestPath: 'next'\r\n}```\r\n\r\nAny ideas?"}
{"sentences": "Service workers", "description": "I'd like to ask what's the recommendation ? \r\nI've been using for my old projects:\r\nhttps://www.npmjs.com/package/next-offline"}
{"sentences": "Negative lookahead for pageExtensions in NextJS Config", "description": "I am unsure how the array of `pageExtensions` is handled, but I assumed paths would be matched against a blob pattern, however it doesn't seem to be the case.\r\n\r\nI have a bunch of pages with `.tsx` extension, however, I would like to exclude some pages which have the extension`.ignore.tsx`, however I cannot seem to get it to work. I have tried:\r\n\r\n```\r\npageExtensions: ['(ignore.){0}tsx']\r\n```\r\n\r\nAny help would be appreciated."}
{"sentences": "NextJS Website Breaks On Production But Works Fine On Development", "description": "I have been developing an application using NextJS with Typescript and has encountering this problem. I am not new, but I have never encountered this problem while I have done many projects like this and hosted them.\r\n\r\nSo, in simple words, I created a horizontal menu (main menu) that has contents inside of it. But when i switch around on the main menu, the app basically breaks (this occurs when it's hosted and works without errors when I run it locally). Although navigating around the side menus works fine.\r\n\r\nHosted Website Link: https://inflow-temp.vercel.app/\r\n\r\nDemo Video Link: https://www.awesomescreenshot.com/video/11478402?key=c4d65a557445434a7823230cb3cbbfb0\r\n\r\nClone to check it locally. Repo Link: https://gitlab.com/ettadevs/inflow-temp\r\n\r\n![image](https://user-images.githubusercontent.com/61845339/193618716-6120ce46-1aec-49a3-90a4-811c28f67805.png)\r\n\r\nI am not fetching data from the internet nor mapping anything. I changed it dynamic routing hoping that would fix it, but still encountering the problem on production(hosted).\r\n\r\nI have also tried hosting it on netlify just in case if it was vercel.com that was causing the problem, and yet I have had no luck in fixing this problem.\r\n\r\nI have scoured the internet looking for answers, but found none.\r\n\r\nI don't understand what is causing the problem or how to fix it. Thanks in advance for all your help."}
{"sentences": "how to integrate 'remark-gfm' and other remark/rehype plugins into 'blog-with-comments' template example...", "description": "Hi, everyone. I'am beginner.. starting Next.js\r\n(First, thanks for reading my quesion 😭)\r\n\r\nI just want to integrate many remark/rehype plugins in my Next.js application.\r\n\r\nFor example, if I want to include `remarkGfm` plugin, when `.mdx` files are in `pages` folder, just adding the plugins in `next.config.mjs` can solve the problem  according to Next.js reference. \r\n\r\nBut if `.mdx` files are NOT in `pages` folder (like blog-with-comments template examples provided by Next.js) how to solve this issue correctly...\r\n\r\nBy guessing, I tried modify some code in `markdownToHtml` function originally at\r\n\r\n```js\r\nexport default async function markdownToHtml(markdown) {\r\n    const result = await remark()\r\n        .use(remarkHtml)\r\n        .process(markdown)\r\n    return result.toString()\r\n```\r\nto\r\n\r\n```js\r\nexport default async function markdownToHtml(markdown) {\r\n\r\n     markdown = await compile(markdown, {\r\n        remarkPlugins: [remarkGfm, remarkMath, remarkFrontmatter, remarkMdxFrontmatter],\r\n        rehypePlugins: [rehypeKatex],\r\n    })\r\n\r\n    const result = await remark()\r\n        .use(remarkHtml)\r\n        .process(markdown)\r\n    return result.toString()\r\n```\r\n\r\nBut It resulted in quite strange texts (sometimes error).\r\n\r\nIs there any reference(docs) to consult to? \r\nAny thoughts or commend is really valulable to me..\r\n\r\nThanks a lot in advance!! 🙏\r\n"}
{"sentences": "How do you test structured data / schema markup from localhost?", "description": "I'm attempting to validate structured data (using Google's Rich Results Test and Schema.org's Schema Markup Validator) from a local development server.\r\n\r\nMy only idea is to use ngrok to create a web-accessible live link for Google to crawl.  However, the page accessed through ngrok is modifying the JSON inside of each `<script type=\"application/ld+json\">` such that double quotes are replaced with html entities.\r\n\r\nThis throws parsing errors inside the validators, so I currently can't text any schema without running a full build. \r\n\r\nHow do you approach this? Cheers!"}
{"sentences": "next/link: How to prefetch page data (.json)?", "description": "I want `<Link>` to prefetch page data (`_next/data/...`) in addition to the page .js itself. I don't mind the increased server load and would happily trade it off for page speed.\r\n\r\nIs there any way to accomplish this?\r\n\r\n(NB: there used to be an issue in Next for this, but then it got implemented as https://github.com/scaleapi/data-prefetch-link and the issue was closed. Now the data-prefetch-link package is outdated and I guess we're back to square 1 unless I missed something.)\r\n\r\n**Update 1:** I tried rewriting my pages to use `getInitialProps` and then going the https://github.com/scaleapi/data-prefetch-link route, but `router.prefetch` no long returns the prefetched page .js in the promise and I can't call its `getInitialProps`.\r\n\r\n**Update 2:** I think I'll just annotate each `<Link>` with the component corresponding to that link so that I can call `getInitialProps` on prefetch. We'll see how it goes. I still need to copy `next/link` into my project but it's not that big."}
{"sentences": "Unable to install next-app", "description": "Running init next-app is throwing error\r\n-------------------------------------------------------------------------------------------------------------------------------------\r\nD:\\React\\NextTut>npm init next-app nextjs-blog\r\nnpm ERR! code ENOLOCAL\r\nnpm ERR! Could not install from \"k\\AppData\\Roaming\\npm-cache\\_npx\\10804\" as it does not contain a package.json file.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     C:\\Users\\Kunal k\\AppData\\Roaming\\npm-cache\\_logs\\2020-06-25T07_46_55_991Z-debug.log\r\nInstall for [ 'create-next-app@latest' ] failed with code 1\r\n---------------------------------------------------------------------------------------------------------------------------------------\r\nOS: Windows\r\nNodeJs version: v12.16.1\r\nNPM Version: 6.13.4\r\n------------------------------------------------------------------------------------------------------------------------------\r\nI tried changing the npm cache path from \"Kunal k\" to  \"Kunal~1\" as depicted by the command \"DIR /x\" but no luck.\r\nTried verifying and force cleaning npm cache no luck.\r\n\r\nIt seems the issue is with the space in my user name but not sure about it.\r\n\r\nPlease Help me solve this I am new to next don't understand much about the error. FYI create-react-app works perfectly  fine without any issue.\r\n"}
{"sentences": "SyntaxError: Failed to construct 'WebSocket': The URL 'undefined/graphql' is invalid.", "description": "Graphql Websocket Error on Nextjs \r\n\r\nHelp.. I got the error when running the app on my new setup mac but previously i'm using windows 10 for running this app and its working fine but when i'm migrate on mac this error was caused\r\n\r\n```bash\r\nSyntaxError: Failed to construct 'WebSocket': The URL 'undefined/graphql' is invalid.\r\n```\r\n\r\nI dont know or am i miss something for configuration?\r\n\r\n<img width=\"1440\" alt=\"Screenshot 2022-03-06 at 00 43 38\" src=\"https://user-images.githubusercontent.com/77242429/156894458-68f86363-bdb3-4678-b3d3-9f8849cb1833.png\">\r\n\r\napollo.ts\r\n```ts\r\nimport { ApolloClient, ApolloLink, HttpLink, split } from \"@apollo/client\";\r\nimport { getMainDefinition } from \"@apollo/client/utilities\";\r\nimport { WebSocketLink } from \"@apollo/client/link/ws\";\r\nimport { SentryLink } from \"apollo-link-sentry\";\r\nimport { cache } from \"@utils/apolloCache\";\r\n\r\nconst httpLink = new HttpLink({\r\n  uri: `${process.env.NEXT_PUBLIC_API_URL}/graphql`,\r\n  credentials: \"include\",\r\n});\r\n\r\nconst wsLink = process.browser\r\n  ? new WebSocketLink({\r\n      // if you instantiate in the server, the error will be thrown\r\n      uri: `${process.env.NEXT_PUBLIC_API_WS_URL}/graphql`,\r\n      options: {\r\n        reconnect: true,\r\n      },\r\n    })\r\n  : null;\r\n\r\nconst splitLink = process.browser\r\n  ? split(\r\n      // only create the split in the browser\r\n      // split based on operation type\r\n      ({ query }) => {\r\n        const definition = getMainDefinition(query);\r\n        return (\r\n          definition.kind === \"OperationDefinition\" &&\r\n          definition.operation === \"subscription\"\r\n        );\r\n      },\r\n      wsLink,\r\n      httpLink\r\n    )\r\n  : httpLink;\r\n\r\nif (!process.browser) {\r\n  global.fetch = fetch;\r\n}\r\n\r\nexport const client = new ApolloClient({\r\n  link: ApolloLink.from([new SentryLink(), splitLink]),\r\n  ssrMode: !process.browser,\r\n  credentials: \"include\",\r\n  cache,\r\n});\r\n\r\n```"}
{"sentences": "Next Middleware doesnt work on local SSL server", "description": "If I run my Nextjs app without ssl with \"next dev\". Middleware works, doesnt produces error at least.\r\n\r\nBut If I try to run the next on SSL, empty middleware function produces error.\r\n\r\nIf I delete the middleware file app works on SSL without issue. So how to make the middleware work on local SSL?\r\n\r\n\r\nmiddleware.js (in the root of project)\r\n```js\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport function middleware(request) {\r\n    let response = NextResponse.next();\r\n\r\n\r\n    return response;\r\n}\r\n```\r\n\r\nLocal https server\r\n```js\r\nconst { createServer: createHttpsServer } = require(\"https\");\r\nconst next = require(\"next\");\r\nconst fs = require(\"fs\");\r\n\r\nconst dev = process.env.NODE_ENV !== \"production\";\r\nconst app = next({ dev });\r\nconst handle = app.getRequestHandler();\r\nconst PORT = process.env.PORT || 3000;\r\n\r\nif (!fs.existsSync(\"./certs/.capath\")) {\r\n    console.error(`To fix this error, run the command below:`);\r\n    process.exit();\r\n}\r\n\r\napp.prepare()\r\n    .then(() => {\r\n        const server = createHttpsServer(\r\n            {\r\n                key: fs.readFileSync(\"./certs/devcert.key\"),\r\n                cert: fs.readFileSync(\"./certs/devcert.cert\"),\r\n            },\r\n            (req, res) => handle(req, res)\r\n        );\r\n\r\n        return server.listen(PORT, (err) => {\r\n            if (err) throw err;\r\n\r\n            console.log(\"> Ready on https://dev2-new.localsslserver.de:3000\");\r\n        });\r\n    })\r\n    .catch((err) => {\r\n        console.error(err);\r\n    });\r\n\r\n```\r\n\r\nError I am getting in the console.\r\n\r\n```js\r\nerror - (middleware)\\node_modules\\next\\dist\\server\\web\\next-url.js (16:0) @ parseURL\r\nerror - Invalid URL: https://undefined:undefined/favicon.ico?__nextDefaultLocale=\r\n```\r\n\r\nError on the index page.\r\n\r\n```js\r\nServer Error\r\nTypeError: Invalid URL: https://undefined:undefined/?__nextDefaultLocale=\r\n\r\nThis error happened while generating the page. Any console logs will be displayed in the terminal window.\r\n\r\n\r\n```\r\n\r\n"}
{"sentences": "subfolder routing", "description": "i want to navigate between subfolder file but routing does not work .\r\npages\r\n    product\r\n         file1\r\n         file2\r\n         file3\r\n\r\n<Link href={\"/product/file1\"}>go to file 1</Link>\r\n<Link href={\"/product/file2\"}>go to file 2</Link>\r\n<Link href={\"/product/file3\"}>go to file 3</Link>\r\n\r\nfirst time when i click on Link its fine but then from inside my file1 when i click on  Link it give\r\n404 error  \"localhost:300/product/product/file2\"   what is the problem?\r\n\r\n\r\n\r\n"}
{"sentences": "I can't access nextjs.org", "description": "Yesterday I sent a lot of requests to nextjs.org in a short amount of time and after that it seems I am not able to access it. Does vercel have any form of IP banning?"}
{"sentences": "Normal scripts \"<script>\" not working after page navigation", "description": "After the page navigation my scripts is not loading anymore. "}
{"sentences": "Weird behaviour with dynamic route - initial state doesn't include query", "description": "I've got a simple page that uses `useRouter` and I'm seeing the router query come in _after_ page render:\r\n\r\n```js\r\nimport { useRouter } from 'next/router';\r\n\r\nexport default function Page() {\r\n  const router = useRouter();\r\n  const { courseId } = router.query;\r\n  console.log(courseId); // once as undefined, then again with actual value\r\n  \r\n  return <h1>{ courseId }</h1>\r\n}\r\n```\r\n\r\nSurely this should have the actual query populate on SSR? \r\n\r\nI've also tried wrapping in `withRouter` - same effect. Also the log on the server side is always undefined.\r\n"}
{"sentences": "Code executed when yarn start is run", "description": "I'm new to Next.js.\r\nI'd like to see the code executed when I run the yarn start script. Can you tell me where the github repository is?"}
{"sentences": "Dynamic Routes with Next Export (and say - Vercel)", "description": "I know some similar things have come up, but I haven't yet been able to solve this, I may just be doing something a bit daft.\r\n\r\n## Setup: Dynamic Routes\r\n\r\nBasically I have dynamic routes, from pages of the following form:\r\n- `/pages/apps/[user]/index.tsx`\r\n- `/pages/apps/[user]/[id].tsx`\r\n\r\nBoth files then take the incoming `user` and `id` query parameters and fetch some data.\r\n\r\nThis works great locally with `next dev`, and I presume would work fine with `next start` on deployment. \r\n\r\n## Issue: Doesn't work on export of static files\r\n\r\nSo I think ideally this could be built with `next build && next export` or similar and work. From discussions and issues raised here, I know it's not really possible for this to work out of the box everywhere without switching to a full SPA model. But I think this should be doable at least in some specific circumstances. I'm very happy to host directly on Vercel too, and it seems that others have had a good experience with exactly this problem. However, even on Vercel, I'm getting 404s for these pages. All non-dynamic pages are working, and the dynamic pages work if linked to from another page.\r\n\r\nI won't know all the routes etc ahead of time, so some solutions available with `getStaticPaths` etc probably won't work.\r\n\r\nTwo notes from @timneutkens:\r\n- [Here, he discusses that `next export` would require proxy-level routing to solve the general dynamic cases](https://github.com/vercel/next.js/discussions/11956#discussioncomment-4965), but that Vercel (previously ZEIT) should have this working out of the box\r\n- I think he [makes the same general point here](https://github.com/vercel/next.js/discussions/12121#discussioncomment-6266), that Vercel should have this working out of the box\r\n\r\n[This previous NextJS](https://github.com/vercel/next.js/discussions/11178#discussioncomment-4802) discussion is someone who has this all working on Vercel, but is trying to get it to work on Netlify - and later [an example solution](https://github.com/jericopulvera/netlify-rewrite-test) is given for Netlify, using wildcard redirects.\r\n\r\nHopefully this is actually possible and I'm not misinterpreting the various discussions - and ideally I'm just doing something dumb and/or my route names are slightly wrong!"}
{"sentences": "Parsing error: Cannot find module 'next/babel'", "description": "I am having this issue after I setup my using `npx create-next-app`. The problem is in the picture as shown below:\r\n\r\n![Untitled](https://user-images.githubusercontent.com/64187129/124082970-eacdf500-da7f-11eb-9797-fad1a468a15d.png)\r\n\r\nMay I know how can I resolve this? This is my first time building a project with Next.js."}
{"sentences": "NextJS environment variables are undefined in the client-side while using `NEXT_PUBLIC_`", "description": "Event with having prefixed all client-side exposed variables with `NEXT_PUBLIC` verifying them results in error. **The server-side does not complain about missing variables.**\r\n\r\nNextJS Version: `12.2.5`\r\n\r\n`.env.development`\r\n```bash\r\nDATABASE_URL=\"postgresql://dbuser:dbpass@localhost:5432/db?schema=public\"\r\nNEXT_PUBLIC_STATIC_MUSTER_URL=\"http://localhost:8080/muster\"\r\nNEXT_PUBLIC_MUSTER_SEARCH_HOST=\"http://localhost:7777\"\r\nNEXT_PUBLIC_MUSTER_SEARCH_API_KEY =\"key\"\r\nNEXT_PUBLIC_NEWS_API_KEY=\"another_key\"\r\nNEXT_PUBLIC_NEWS_API_URL=\"http://localhost:8888\"\r\nNEXT_PUBLIC_BASE_URL=\"http://localhost:3000\"\r\n```\r\n\r\n`utils/env.ts`\r\n```typescript\r\nfunction defaultValidator(key: string) {\r\n    const value = process.env[key];\r\n\r\n    if (value) {\r\n        return value;\r\n    }\r\n\r\n    throw new Error(`Environment variable ${key} was not defined!`);\r\n}\r\n\r\nexport const env = {\r\n    NODE_ENV: process.env.NODE_ENV,\r\n    // DATABASE_URL: defaultValidator(\"DATABASE_URL\"), // results in client error\r\n    NEXT_PUBLIC_STATIC_MUSTER_URL: defaultValidator(\"NEXT_PUBLIC_STATIC_MUSTER_URL\"), // results in client error\r\n    NEXT_PUBLIC_MUSTER_SEARCH_HOST: defaultValidator(\"NEXT_PUBLIC_MUSTER_SEARCH_HOST\"),\r\n    NEXT_PUBLIC_MUSTER_SEARCH_API_KEY: defaultValidator(\"NEXT_PUBLIC_MUSTER_SEARCH_API_KEY\"),\r\n    NEXT_PUBLIC_NEWS_API_KEY: defaultValidator(\"NEXT_PUBLIC_NEWS_API_KEY\"),\r\n    NEXT_PUBLIC_NEWS_API_URL: defaultValidator(\"NEXT_PUBLIC_NEWS_API_URL\"),\r\n    NEXT_PUBLIC_BASE_URL: defaultValidator(\"NEXT_PUBLIC_BASE_URL\"),\r\n}\r\n```\r\n\r\n`pages/test.tsx`\r\n```typescript\r\nimport {env} from 'utils/env'\r\ndefault export function Test() {\r\n   return (<div>{JSON.stringify({url: env.NEXT_PUBLIC_STATIC_MUSTER_URL})}</div>)\r\n}\r\n```\r\n\r\nClient-Side error:\r\n```\r\nUnhandled Runtime Error\r\nError: Environment variable NEXT_PUBLIC_STATIC_MUSTER_URL was not defined!\r\n```\r\n\r\n"}
{"sentences": "How to provide a large ‘sitemap.xml’ in vercel", "description": "We fetch a dynamic generated xml from our CMS API, and we return its content in a Next.js API route (that just works as a proxy).\r\n\r\nIn development this works as expected, but due the 4MB payload size limitation in Vercel functions we get a 500 error (our sitemap is really big ~12MB).\r\n\r\nI have seen [this official guide in Vercel](https://vercel.com/guides/how-do-i-generate-a-sitemap-for-my-nextjs-app-on-vercel), but looks like it's is meant for small/medium sites. And generating the sitemap.xml file after build isn't an option, as the pages and content come from out CDN.\r\n\r\nAny ideas on how to solve this?"}
{"sentences": "Shallow Routing on a dynamic page/route", "description": "From a normal page, I can do `router.push(\"/this-page\", \"/this-page/\" + id, {shallow: true})` without refreshing the page. \r\n\r\nI'd like to be able to do that, from a dynamic route (e.g. [...city].js) as well.\r\n\r\nThis unfortunately creates a full refresh instead: `router.push(\"/this-page/\" + city, \"/this-page/house/\" + id, {shallow: true})`\r\n\r\nDoes anyone know how to fix/avoid this issue?\r\n\r\nI made a demo of my issue on Stackblitz here: https://stackblitz.com/edit/nextjs-ezyusx?file=pages/index.js"}
{"sentences": "How to provide a large ‘sitemap.xml’ with Next on Vercel", "description": "We fetch a dynamic generated xml from our CMS API, and we return its content in a Next.js API route (that just works as a proxy).\r\n\r\nIn development this works as expected, but due the 4MB payload size limitation in Vercel functions we get a 500 error (our sitemap is really big ~12MB).\r\n\r\nI have seen [this official guide in Vercel](https://vercel.com/guides/how-do-i-generate-a-sitemap-for-my-nextjs-app-on-vercel), but looks like it's is meant for small/medium sites. And generating the sitemap.xml file after build isn't an option, as the pages and content come from out CDN.\r\n\r\nAny ideas on how to solve this?"}
{"sentences": "Will v13 drop IE11 support?", "description": "IE adds big drag to final bundles:\r\n- bigger JS because of unsupported syntax transformed by babel\r\n- crazy HTML and JS boilerplate around `<img>` tag because of unsupported width/height aspect ratios and `loading=\"lazy\"`\r\n\r\nMicrosoft stopped IE11 support for [Teams and 365 already](https://techcommunity.microsoft.com/t5/microsoft-365-blog/microsoft-365-apps-say-farewell-to-internet-explorer-11-and/ba-p/1591666) and will event [officially phase out support](https://docs.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge#what-is-the-lifecycle-policy-for-internet-explorer-) for the browser itself June 15th, 2022.\r\n\r\nIs Next.js team planning to stop supporting IE11 in next major release (whenever that be)?"}
{"sentences": "How to use layout rendering menu with data from server side, to help with SEO", "description": "Hi!\r\n\r\nI'm implementing website and I need to render dynamic navbar items that are provided from external API.\r\nThe problem is that nextjs dont allow to use methods to serverside inside components, only in **pages**.\r\n\r\nHow can I implement that? Or its impossible to load a navbar with data from external API, and served by the server to help SEO.\r\n\r\nI'm using layout.tsx like nextjs documentation recomends:\r\n```typescript\r\nexport const Layout: React.FC<Props> = ({ children }) => {\r\n  return (\r\n    <>\r\n      <Navbar />\r\n      {children}\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n```\r\n\r\nAnd on Navbar component I need to load API content, and I would like to server it directly from server like using `GetServerSideProps`"}
{"sentences": "Questions about source maps...", "description": "So I am getting this from lighthouse:\r\n\r\n```\r\nMissing source maps for large first-party JavaScript\r\n\r\nSource maps translate minified code to the original source code. This helps developers debug in production. In addition, Lighthouse is able to provide further insights. Consider deploying source maps to take advantage of these benefits. [Learn more](https://developers.google.com/web/tools/chrome-devtools/javascript/source-maps?utm_source=lighthouse&utm_medium=devtools).\r\n\r\n<html>\r\n<body>\r\n<!--StartFragment-->\r\n\r\nchrome-extension://fmkadmapgofadopljbjfkapdkoienihi/build/react_devtools_backend.js |  \r\n-- | --\r\nLarge JavaScript file is missing a source map\r\n\r\n<!--EndFragment-->\r\n</body>\r\n</html>\r\n```\r\n^^^ \r\nAny ideas of what this all means?  \r\n\r\nIf we are talking about javascript, then I can think I am using Nextjs, and the other library is from GSAP to do some animations...\r\n\r\nDoes Nextjs generates a source map for the code?   What recommendations would be good to take care of this? \r\n\r\n"}
{"sentences": "Can't access Page Component props (e.g. getLayout) when using a HOC", "description": "Hello guys, on my app I have several pages that uses some HOCs to access context as props, like this one:\r\n\r\n**`ComponentPage.jsx:`**\r\n```\r\nimport withSomeContext from 'utils/withSomeContext'\r\n\r\nconst ComponentPage = ({states, actions) => {\r\n  return (...)\r\n}\r\n\r\nComponentPage.getLayout = function getLayout(page) {\r\n  return (\r\n    <div>\r\n      Some Header\r\n      <div>{page}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default withSomeContext(ComponentPage)\r\n```\r\nBut then when I pass some props like `getLayout` I can't really retrieve it on the `_app` because of that withSomeContext HOC:\r\n\r\n**`_app.js:`**\r\n```\r\nfunction MyApp({Component, pageProps}) {\r\n  console.log(Component.getLayout, 'I can't retrieve my getLayout prop') ---> undefined\r\n\r\n  return (\r\n    <...>\r\n    (...)\r\n    <AppContainer>\r\n        <Component {...pageProps} />\r\n    </AppContainer>\r\n    </...>\r\n  )\r\n}\r\n\r\nexport default MyApp\r\n```\r\nThis happens because the `Component` prop on the `_app` sees is my `withSomeContext` HOC function instead of my real Page Component. Do you guys can think on any workaround for being able to actually retrieve these kind of props we set for a Page Component while using a HOC to render it? Am I missing something?\r\n\r\n**`withSomeContext.js:`**\r\n```\r\nimport {SomeContextConsumer} from 'contexts/SomeContextConsumer'\r\n\r\nexport const withProperties = (Component) => (props) => {\r\n  return (\r\n    <SomeContextConsumer>\r\n      <Component {...props} />\r\n    </SomeContextConsumer>\r\n  )\r\n}\r\n```"}
{"sentences": "Getting ERR_CONTENT_DECODING_FAILED for webpack chunk on IG/FB's in-app browser", "description": "### What version of Next.js are you using?\r\n\r\n10.0.9\r\n\r\n### What version of Node.js are you using?\r\n\r\n^12\r\n\r\n### What browser are you using?\r\n\r\nInstagram / Facebook's Webview\r\n\r\n### What operating system are you using?\r\n\r\nAndroid\r\n\r\n### How are you deploying your application?\r\n\r\nVercel\r\n\r\n### Describe the Bug\r\n\r\nMy website is not being able to serve one of the script chunks (the one named `_next/static/webpack.+\\.js/`) in GZIP.\r\n\r\nApparently on FB's Webview, the Request headers are asking for the Gzip version (`accept-encoding: gzip, deflate`) whilst in any other browser it gets the Brotli version (`accept-encoding: gzip, deflate, br` => `content-encoding: br`).\r\n\r\n### Expected Behavior\r\n\r\nExpected to work as in any other browser where the Script chunks are served with Brotli or Gzip with correct content types set\r\n\r\n### To Reproduce\r\n\r\nJust open `https://vidanatural.eco.br` in your Facebook Webview. \r\n\r\nTo inspect it you can open any website in your Facebook Webview, go to: `chrome://inspect/#devices` and inspect that webview. In the inspector you can change the browser's URL (took my a while to found that out 😅)\r\n\r\nIt seems to be a problem with the Gzip version, what do you guys think?\r\n\r\n### Logs from a normal browser:\r\n<img width=\"853\" alt=\"Captura de Tela 2021-04-04 às 12 38 09\" src=\"https://user-images.githubusercontent.com/566971/113514162-71d40580-9543-11eb-9ebc-901dac9403ee.png\">\r\n<img width=\"986\" alt=\"Captura de Tela 2021-04-04 às 12 38 19\" src=\"https://user-images.githubusercontent.com/566971/113514168-74cef600-9543-11eb-8b08-f947ef6b5507.png\">\r\n\r\n### Logs from Facebook's in-App browser:\r\n<img width=\"546\" alt=\"Captura de Tela 2021-04-04 às 12 38 43\" src=\"https://user-images.githubusercontent.com/566971/113514191-97f9a580-9543-11eb-99c2-e41921de8ef8.png\">\r\n<img width=\"832\" alt=\"Captura de Tela 2021-04-04 às 12 45 33\" src=\"https://user-images.githubusercontent.com/566971/113514200-ac3da280-9543-11eb-8752-cf9710950681.png\">\r\n\r\nThis is breaking all the scripts for everyone coming from Instagram / FB  (most of my visitors).\r\n\r\nI tried disabling compression (`compress: false` in `next.config.js`) but it does not seem to help, the content is still served compressed and the issue is still there.\r\n\r\nI know this may not be the best place to ask for help to this problem, I'm not really sure if it is a Next or Vercel issue, but we might find some sort of bug and I hope to people facing this problem can benefit from this thread.\r\n\r\nI appreciate any help!"}
{"sentences": "On-demand ISR with hostname-rewrites not revalidating", "description": "## When trying to revalidate the page on demand by calling revalidate() it always fails\r\n\r\n**Simple repository to reproduce the error**\r\nhttps://github.com/ianmorais25/hostname-rewrites-isr\r\n\r\nhttps://<your-site.com>/api/revalidate?secret=token\r\n-->\r\nInternal Server Error  \r\nError: Failed to revalidate /: Invalid response 404"}
{"sentences": "How to get rid of hydration error on my next js project?", "description": "How to get rid of hydration error on my next js project?"}
{"sentences": "How to change the scr attribute of <Image /> component on useEffect", "description": "I want to change the src attribute of the <Image /> component to change the image displaying the page.\r\n\r\nActually, It's a profile page. I want to change the src of the <Image /> component when a user change the image.  I am trying this using useEffect but image src is not getting updated.   \r\n\r\nIs there a way to change the src without refreshing the page? "}
{"sentences": "middleware can't get client's cookies when access directly?", "description": "I have a middleware which is handling protected routes.\r\nAnd inside middleware I'm using cookies like `request.headers.get('cookie')`\r\n\r\nOn local, when I access page by Link or directly input url on browser, both of them are working well.\r\nBut on production environment `request.headers.get('cookie')` is returning null even though browser has cookies.\r\nWhy on production env, I can't get cookies? \r\nI'd appreciate if anyone give me hints.\r\nThank you.\r\n```ts:middleware.ts\r\nexport async function middleware(request: NextRequest) {\r\n  console.log(request.headers.get('cookie'));\r\n  const response = NextResponse.next();\r\n  // some api calls with await.\r\n  return response;\r\n}\r\n```\r\n\r\nMy environment is here.\r\n```\r\n+-- next@12.2.3\r\n+-- react@18.2.0\r\n+-- typescript@4.7.4\r\n```"}
{"sentences": "Testing links", "description": "When using other frameworks such as CRA, testing links is trivial, but I am struggling to work out how to do it without spinning up a whole browser with next, I assume it's equaly as easy with Next.js and I am just missing something.\r\n\r\nDoes anyone have any links or advice? (I am using Jest)"}
{"sentences": "How to use useIsFocused in Next js or similar way to use it?", "description": "I want to check if I landed in a route. In react navigation there is called `useIsFocused` that you use in `useEffect` arguments to detect if you landed in a route.\r\n\r\n```\r\nconst isFocused = useIsFocused();\r\n\r\nuseEffect(() => {\r\n /// logic\r\n}, [isFocused])\r\n\r\n```"}
{"sentences": "multiple nextjs on same domain", "description": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n    Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #1 SMP PREEMPT Sun Sep 19 21:31:53 UTC 2021\r\n    Binaries:\r\n      Node: 16.12.0\r\n      npm: 8.1.0\r\n      Yarn: 1.22.17\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 12.0.11-canary.15\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n\r\n### What browser are you using? (if relevant)\r\n\r\n_No response_\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\n_No response_\r\n\r\n### Describe the Bug\r\n\r\nWe have two nextjs applications on the same domain. one with mobile env and one with desktop env to save bytes. at the built time the ternary components remove unused code. we are using nginx to separate by user-agent. also the page is using getStaticProps.\r\n```jsx\r\nprocess.env.PLATFORM === 'mobile' ? <MobileCmp /> : <DesktopCmp />\r\n```\r\n![2022-02-20-232057_1920x1080_scrot](https://user-images.githubusercontent.com/58308349/154861481-66d1b105-e45c-469d-ab80-6bd488777c2f.png)\r\n\r\nwe are getting 404 for a couple of pages in desktop but on mobile everything works. or vice versa sometimes.\r\nI found [a blog](https://arihantverma.com/posts/2021/07/18/workaround-nextjs-data-urls-same-domain-multiple-apps/) describing the same issue but after all his solution is a workaround and I wanna make sure there isn't any official way to solve it by the nextjs team\r\n\r\n\r\n### Expected Behavior\r\n\r\nI don't really. maybe it is something expected by nextjs team but for us as users, more clear way to solve it in doc or error message would be great. or maybe expose `data fetch request path URL prefix`.\r\n\r\n### To Reproduce\r\n\r\nNEXT_PUBLIC_PLATFORM=mobile npm run zoomit:serve -- port 4201\r\nNEXT_PUBLIC_PLATFORM=mobile npm run zoomit:serve -- port 4202\r\n\r\nseparate by user agent in nginx\r\n"}
{"sentences": "Enable production logging", "description": "I deployed my app. The index page returns status 200 with \"error\" as its body. I assume this error is on the SSR side.\r\nI checked the log for pointers, but it's empty. How can I debug such issues? I'm on next 12.2.3.\r\n<img width=\"819\" alt=\"image\" src=\"https://user-images.githubusercontent.com/24858082/186133141-4d759f15-9915-4632-86a3-6078274db596.png\">\r\n"}
{"sentences": "[next/image] Support for AVIF image format", "description": "### Describe the feature you'd like to request\r\n\r\nHello. Is that possible to add support for AVIF image format for next/image module at this moment? If you're not familiar with it here's a good topic to learn from [Comparing AVIF vs WebP file sizes at the same DSSIM](https://www.ctrl.blog/entry/webp-avif-comparison.html) (TLDR; AVIF-encoded images are ~20% lighter than WebP in most of the cases) Many Chrome and Opera versions supports it, and also latest Firefox released major version with AVIF support. Safari doesn't support it yet but considering their latest experience with WebP - they will at some point.\r\n\r\n### Describe the solution you'd like\r\n\r\nNextJS should fetch support table from [caniuse.com](https://caniuse.com/?search=avif) and compare it with visitor's User-Agent and see if browser version supports AVIF. This way NextJS should serve AVIFs to only those visotors whose browser does support it and fallback to WebP otherwise.\r\n\r\n### Describe alternatives you've considered\r\n\r\n\\-"}
{"sentences": "How to fix hydration error in next js while everything is right.", "description": "I'm trying to figure It but If you know then, please answer it."}
{"sentences": "After deploying to vercel, Images have been cropped", "description": "Hi Team, \r\n\r\nI have a storefront where all images look fine on the local side of the project and images fit and all that good stuff. However, \r\nonce I take it and deploy it to vercel, for some reason I found the images have been cropped and changed around. The client I am working for needs to have the whole image in the product cards and not cropped. They are a photographer that needs to have images shown to the fullest. I really hope someone knows how to stop the auto-cropping or can show me the light on this issue\r\n\r\n\r\n( DEV Server )\r\n<img width=\"914\" alt=\"Screen Shot 2022-08-19 at 5 06 11 pm\" src=\"https://user-images.githubusercontent.com/17910103/185741870-1e902bd8-6f22-41d0-b440-57e129ec10f5.png\">\r\n\r\n\r\n( Vercel Deploy Server )\r\n<img width=\"874\" alt=\"Screen Shot 2022-08-19 at 2 12 17 am\" src=\"https://user-images.githubusercontent.com/17910103/185741836-99ffad89-6be1-458d-bfb7-d67110a59b98.png\">\r\n\r\nI have done alot of changes in the app and tried to work it ou myself,  but nothing I do help when it comes to images as something built into the deploy change the image scale and crops it\r\n\r\n\r\n"}
{"sentences": "NPM problem installing Next JS App With Termux on Android", "description": "Specifications:\r\n- Node Js LTS v 16.14.0 \r\n- Device Realme C2*\r\n- 10 Android **OS** \r\n- No Root\r\nUsing Termux v 0.117 Latest\r\nCreating a new Next.js app in /data/data/com.termux/files/home/**nextjs-blog**\r\n\r\n/* separator */\r\n**Input dan Output**\r\n\r\n$ npm init next-app nextjs-blog\r\nCreating a new Next.js app in /data/data/com.termux/files/home/nextjs-blog.\r\n\r\nUsing npm.\r\n\r\nInstalling dependencies:\r\n- react\r\n- react-dom\r\n- next\r\n\r\nnpm ERR! code ERR_SOCKET_TIMEOUT\r\nnpm ERR! network Socket timeout\r\nnpm ERR! network This is a problem related to network connectivity.\r\nnpm ERR! network In most cases you are behind a proxy or have bad network settings.\r\nnpm ERR! network\r\nnpm ERR! network If you are behind a proxy, please make sure that the\r\nnpm ERR! network 'proxy' config is set properly.  See: 'npm help config'\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /data/data/com.termux/files/home/.npm/_logs/2022-02-13T03_41_39_592Z-debug-0.log\r\n\r\nAborting installation.\r\n  npm install --save-exact --save react react-dom next has failed.\r\n\r\n$ node -v\r\nv16.14.0\r\n\r\n$"}
{"sentences": "How can I check which version of Next.js I am working with?", "description": "How can I check it?  and how can I update it? \r\n\r\nI was trying to use next-pwa and just didnt work.... one thing in their documents said I needed to work with Next 9 or higher?... \r\n\r\nEither way... I am looking to do a PWA without having to install a plugin for it, but would be nice to keep Next updated...\r\n\r\nI do have a few plugins installed, but I am trying to keep it to a minimum so I don't run into updating problems later with things that are not compatible.\r\n\r\n"}
{"sentences": "Images not loading in NextJS Headless WordPress demo fresh install", "description": "Hi everyone! I'm trying NextJS for the first time. My goal is to use it as front-end for an headless WordPress website.\r\n\r\nI tried to deploy this template: https://vercel.com/templates/next.js/isr-blog-nextjs-wordpress\r\n\r\nI just followed two simple steps: \r\n1. Click on \"Deploy\"\r\n2. Specified my GraphQL url from my WP install. I checked on my WP install and GraphQL seems to work there. URL is https://wordpress-406795-2818064.cloudwaysapps.com/graphql\r\n\r\nIt seems images are not loaded: https://isr-blog-nextjs-wordpress.vercel.app/\r\n\r\nI try to do some searches but it seems I can't find a solution. What did I do wrong? It seems it gets the rest of the content but just skips images.\r\n\r\nEDIT: some images do work, but only inside content, not when they're set as featured image: https://wordpress-advisor.vercel.app/posts/dolorem-blanditiis-adipisci-nihil-ut-in\r\n\r\nEDIT 2: by the way, got the same config locally, with Local by Flywheel and featured images work without issues there."}
{"sentences": "\"x-nextjs-cache\" HTTP Header", "description": "Hi community,\r\n\r\nI'm using Next.js version 12.1.1 on getting in production an HTTP header`x-nextjs-cache`. Where does this come from, what does it mean, and is it possible to disable it?\r\n\r\nThanks for your help!"}
{"sentences": "Trying to find with-jest-react-testing-library example", "description": "Seems like it once existed from a merge:\r\nhttps://github.com/vercel/next.js/commit/e9e06099cd4fc70362d44292f4cf32659d782f9a#diff-0a35e670065de6c119696460a4ad7d38\r\n\r\nbut now I don't see it in the repo anymore.\r\n\r\nI see it in this forked repo: https://github.com/Megoos/next.js/tree/update-with-jest/examples/with-jest-react-testing-library\r\n\r\nIs there a reason it was removed from next.js repo?"}
{"sentences": "Cors Error", "description": "Hi, I wrote this code in next config js file.\r\n```typescript\r\n...\r\nheaders() {\r\n    return [\r\n      {\r\n        source: \"/api/:path*\",\r\n        headers: [\r\n          { key: \"Access-Control-Allow-Credentials\", value: \"true\" },\r\n          { key: \"Access-Control-Allow-Origin\", value: \"*\" },\r\n          {\r\n            key: \"Access-Control-Allow-Methods\",\r\n            value: \"GET,OPTIONS,PATCH,DELETE,POST,PUT\",\r\n          },\r\n          {\r\n            key: \"Access-Control-Allow-Headers\",\r\n            value:\r\n              \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version\",\r\n          },\r\n        ],\r\n      },\r\n    ];\r\n  },\r\n...\r\n```\r\nbut I get cors error.\r\n![image](https://user-images.githubusercontent.com/93312414/184023346-cba812d9-4ae1-42a4-bf5c-deb53d56e9b9.png)\r\n\r\nI am wrong? how can I fix it? Hope your help. Thanks in advance!!"}
{"sentences": "optimize the volume of my Next. Js project", "description": "I want to optimize the volume of my Next. Js project. Now the image is 800m in size, how can I modify the Webpack configuration to optimize it to 500m"}
{"sentences": "How can I scan a folder to get the number of files in that folder?", "description": "I am working on a blog and I want to add automatic pagination to the blog to go from one page to the next one...\r\n\r\nI already have a pagination system in place, but I just need to replace the data I need to put it on the page......   (I think it is that simple?)\r\n\r\nWould something like this work? \r\n\r\n```\r\n\r\nexport async function getStaticProps() {\r\n  // get files from blog/castellano\r\n  const files = fs.readdirSync(path.join(\"./castellano\"));\r\n\r\n  // get info from files\r\n  const posts = files.map();\r\n\r\n  return {\r\n    props: { post },\r\n  };\r\n}\r\n\r\n\r\n```\r\nI am getting an error because apparently I don't know how to write the path to the folder I want to scan.........     would this be the proper way?\r\n![Capture22](https://user-images.githubusercontent.com/93617433/183711286-e2ca7e33-ac56-4a89-b34d-07ab43ba7602.PNG)\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Using text files as database", "description": "Is there a way for NextJS to read a markdown textfile from a a folder called, say for example, **/md-data/about.md** and include it into a pages file, say **pages/about.tsx**. (Client Side only)\r\n\r\nI want to do this so that a non-developer can edit the about.md file with the content he has in mind.\r\n\r\nI intend to `next export` and not run Next on the server side via nodeJS. I am going to deploy this as a pure client side static site."}
{"sentences": "Property 'getInitialProps' does not exist on type 'FC<ItemProps>'.ts(2339)", "description": "react: \"^16.12.0\",   \r\nreact-dom: \"^16.12.0\",   \r\n@types/react: \"^16.9.49\",   \r\ntypescript: \"^4.0.3\",\r\n\"next\": \"^9.4.4\",\r\n\r\nHow doI resolve the above mentioned issue? My code is as follows:\r\n\r\n```\r\nimport React, {FC} from \"react\";\r\nimport SingleItem from '../components/SingleItem';\r\nimport { useRouter } from 'next/router';\r\n\r\ninterface ItemProps{\r\n  query:{\r\n      id:string;\r\n  };\r\n  userIP:string;\r\n  userAgent:string;\r\n  urlReferer:string;\r\n}\r\n\r\nconst Item:FC<ItemProps> = (props) => {\r\n  const router = useRouter();\r\n  return(\r\n    <div>\r\n      <style dangerouslySetInnerHTML={{ __html: SingleItemStyles }} />\r\n      <SingleItem id={props.query.id} user_ip={props.userIP} user_Agent={props.userAgent} url={router.asPath} urlReferer={props.urlReferer} />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Obtain User IP on initial site load\r\nItem.getInitialProps = async ({ req }) => {\r\n  const userIP = req ? (req.headers['x-real-ip'] || req.connection.remoteAddress) : false;\r\n  const userAgent = req ? req.headers['user-agent'] : navigator.userAgent;\r\n  const urlReferer = req ? req.headers['referer'] : document.referrer;\r\n  \r\n  return { userIP, userAgent, urlReferer }\r\n}\r\n\r\nexport default Item;\r\n```"}
{"sentences": "How to build a knowledge base webapp similar to https://nextjs.org/docs", "description": "I searched for templates/examples, and see mostly blog, not knowledge base (specifically, I like the search bar with real time fuzzy search result). I clone the whole https://github.com/vercel/next.js and know that docs are generated from MDX file in `docs` and `packages/next/pages/_document.tsx`. I did try `pnpm run build --filter next`, but it runs the build, not the dev (with fast refresh) of the docs, while `pnpm run dev --filter next` is not a valid command.\r\n\r\nAny guidance how to achieve a knowledge base similar  to https://nextjs.org/docs with that search bar is highly appriciated."}
{"sentences": "Updating static page with redux state from localStorage (getStaticProps / getStaticPaths)", "description": "I am trying to build a fully static site with pages build using getStaticProps / getStaticPaths with content from a CMS.\r\n\r\nI am using redux and saving its state in localStorage but I am running into an issue where pages with dynamic routes are not displaying the right UI, specifically while using styled-components. \r\n\r\n[This code sandbox demonstrates the problem I am running into.](https://codesandbox.io/s/funny-shannon-39j2m?file=/redux.js)\r\n\r\nFollow these steps: \r\n\r\n1. Click a \"product\" and you will be directed to its page (products/[id]) made with getStaticProps / getStaticPaths.\r\n2. Click the heart icon and the item will be added to the redux store and local storage.\r\n3. Click \"Go Back Home\". You will see that the heart for the \"product\" is correctly filled in on the home page. \r\n4. Click the \"product\" again to go back to its page, the console will display an error \"props don't match server\" and the heart will not be filled in as it should. BUT the state will be correct.  When you click the heart it will remove the item.\r\n\r\nThis may be a problem with styled-components, but I am wondering if any of you have created a static site with redux and how you achieved it. "}
{"sentences": "Accessing publicRuntimeConfig in a custom Next.js server?", "description": "Is this even possible? \r\n\r\nCurrently trying to reference the `domain` environmental variable on the client, but it is undefined. I've read the documentation [here](https://nextjs.org/docs/api-reference/next.config.js/runtime-configuration) and it doesn't mention anything that would prevent it from working, but I'm stumped. \r\n\r\n[With this issue](https://github.com/vercel/next.js/issues/12269), it is noted the `.env` doesn't work on custom Next.js servers without some extra code, so I wondered if this issue was similar.\r\n\r\n```tsx\r\n  publicRuntimeConfig: {\r\n    domain: process.env.DOMAIN\r\n  }\r\n```"}
{"sentences": "My Cookie doesn't set when deployed on heroku with Apollo GraphQL and NextJS", "description": "Hello Everyone,\r\n\r\nHello, everyone I have some problem that cookies that i send in token handler is not set when deployed in heroku but it works fine when development which in localhost, I was read many documentation and can't get it.\r\nI'am struggling now or am i miss something in configuration? \r\nFor domain host i have frontend that host in vercel and backend in heroku\r\n\r\nMy apollo client with Websocket\r\n```ts\r\nimport { ApolloClient, ApolloLink, HttpLink, split } from \"@apollo/client\";\r\nimport { getMainDefinition } from \"@apollo/client/utilities\";\r\nimport { WebSocketLink } from \"@apollo/client/link/ws\";\r\nimport { SentryLink } from \"apollo-link-sentry\";\r\nimport { cache } from \"@utils/apolloCache\";\r\n\r\nconst httpLink = new HttpLink({\r\n  uri: `${process.env.NEXT_PUBLIC_API_URL}/graphql`,\r\n  credentials: \"include\",\r\n  fetchOptions: {\r\n    credentials: \"include\",\r\n  },\r\n});\r\n\r\nconst wsLink = process.browser\r\n  ? new WebSocketLink({\r\n      // if you instantiate in the server, the error will be thrown\r\n      uri: `${process.env.NEXT_PUBLIC_API_WS_URL}/graphql`,\r\n      options: {\r\n        reconnect: true,\r\n      },\r\n    })\r\n  : null;\r\n\r\nconst splitLink = process.browser\r\n  ? split(\r\n      // only create the split in the browser\r\n      // split based on operation type\r\n      ({ query }) => {\r\n        const definition = getMainDefinition(query);\r\n        return (\r\n          definition.kind === \"OperationDefinition\" &&\r\n          definition.operation === \"subscription\"\r\n        );\r\n      },\r\n      wsLink,\r\n      httpLink\r\n    )\r\n  : httpLink;\r\n\r\nif (!process.browser) {\r\n  global.fetch = fetch;\r\n}\r\n\r\nexport const client = new ApolloClient({\r\n  link: ApolloLink.from([new SentryLink(), splitLink]),\r\n  ssrMode: !process.browser,\r\n  credentials: \"include\",\r\n  cache,\r\n});\r\n```\r\nFor example mutation signin :\r\n```ts\r\nsignin: async (\r\n    _: any,\r\n    { credentials }: SignInArgs,\r\n    { db, res }: Context\r\n  ): Promise<UserPayloadType> => {\r\n    const { email, password } = credentials;\r\n\r\n    // compare input form email with data in database avaliable or not\r\n    const user = await db.user.findUnique({\r\n      where: {\r\n        email,\r\n      },\r\n    });\r\n\r\n    if (!user) {\r\n      return {\r\n        userErrors: [\r\n          {\r\n            message: \"Can't find user with this email\",\r\n          },\r\n        ],\r\n      };\r\n    }\r\n\r\n    if (user.isVerified === false) {\r\n      return {\r\n        userErrors: [\r\n          {\r\n            message: \"Please verified your account first\",\r\n          },\r\n        ],\r\n      };\r\n    }\r\n\r\n    // compare and force override user.password as string\r\n    const isMatch = await bcrypt.compare(password, user.password as string);\r\n\r\n    if (!isMatch) {\r\n      return {\r\n        userErrors: [\r\n          {\r\n            message: \"Your password does not match\",\r\n          },\r\n        ],\r\n      };\r\n    }\r\n\r\n    // create token to cookie\r\n    const authToken = createToken(user.id, user.username);\r\n\r\n    // and send it\r\n    sendToken(res, authToken);\r\n\r\n    return {\r\n      userErrors: [],\r\n      user: user,\r\n    };\r\n  },\r\n```\r\n\r\nThis is my backend server\r\n\r\n```ts\r\nimport { typeDefs } from \"./graphql/schema\";\r\nimport { AllResolvers } from \"./services/resolvers/resolvers\";\r\nimport { createServer } from \"http\";\r\nimport { execute, subscribe } from \"graphql\";\r\nimport { SubscriptionServer } from \"subscriptions-transport-ws\";\r\nimport { makeExecutableSchema } from \"@graphql-tools/schema\";\r\nimport { ApolloServerPluginLandingPageGraphQLPlayground } from \"apollo-server-core\";\r\nimport { ApolloServer } from \"apollo-server-express\";\r\nimport { context } from \"./lib/context\";\r\nimport { pubsub } from \"./lib/context\";\r\nimport { PassportGoogle } from \"./lib/passport/config\";\r\nimport { GoogleAuthenticate } from \"./lib/passport/socialMediaAuth\";\r\nimport express from \"express\";\r\nimport passport from \"passport\";\r\nimport cookieParser from \"cookie-parser\";\r\nimport cors from \"cors\";\r\nimport * as AllTypes from \"./services/index\";\r\n\r\nPassportGoogle();\r\n\r\n(async function () {\r\n  const app = express();\r\n  const httpServer = createServer(app);\r\n\r\n  const schema = makeExecutableSchema({\r\n    typeDefs,\r\n    resolvers: {\r\n      ...AllResolvers,\r\n      ...AllTypes,\r\n    },\r\n  });\r\n\r\n  const corsOptions = {\r\n    origin: true,\r\n    credentials: true,\r\n  };\r\n\r\n  app.use(function (req, res, next) {\r\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\r\n    res.header(\"Access-Control-Allow-Methods\", \"GET, PUT, POST\");\r\n    res.header(\r\n      \"Access-Control-Allow-Headers\",\r\n      \"Origin, X-Requested-With, Content-Type, Accept\"\r\n    );\r\n    next();\r\n  });\r\n\r\n  app.set(\"trust proxy\", 1);\r\n  app.use(cors(corsOptions));\r\n  app.use(cookieParser());\r\n\r\n  // Google login auth\r\n  app.get(\r\n    \"/auth/google\",\r\n    passport.authenticate(\"google\", { scope: [\"profile\", \"email\"] })\r\n  );\r\n\r\n  // Google callback\r\n  app.get(\r\n    process.env.GOOGLE_CALLBACK_ROUTE!,\r\n    passport.authenticate(\"google\", {\r\n      session: false,\r\n      failureRedirect: `${process.env.FRONTEND_URI}/auth/signin`,\r\n    }),\r\n    GoogleAuthenticate\r\n  );\r\n\r\n  const subscriptionServer = SubscriptionServer.create(\r\n    {\r\n      schema,\r\n      execute,\r\n      subscribe,\r\n      async onConnect() {\r\n        return { pubsub };\r\n      },\r\n    },\r\n    { server: httpServer, path: \"/graphql\" }\r\n  );\r\n\r\n  const server = new ApolloServer({\r\n    schema,\r\n    plugins: [\r\n      {\r\n        async serverWillStart() {\r\n          return {\r\n            async drainServer() {\r\n              subscriptionServer.close();\r\n            },\r\n          };\r\n        },\r\n      },\r\n      ApolloServerPluginLandingPageGraphQLPlayground(),\r\n    ],\r\n    context,\r\n    introspection: true,\r\n  });\r\n  await server.start();\r\n  server.applyMiddleware({ app, cors: corsOptions });\r\n\r\n  const PORT = process.env.PORT || 4000;\r\n  httpServer.listen(PORT, () =>\r\n    console.log(\r\n      `🚀 Server and WS is now running on http://localhost:${PORT}/graphql or ws://localhost:${PORT}/graphql ${process.env.FRONTEND_URI}`\r\n    )\r\n  );\r\n})();\r\n```\r\nMy token handler\r\n```ts\r\n// Token Handler \r\nimport JWT from \"jsonwebtoken\";\r\nimport { Response } from \"express\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"secret\";\r\n\r\nexport const createToken = (userId: string, username: string) =>\r\n  JWT.sign({ userId, username }, JWT_SECRET, { expiresIn: \"1d\" });\r\n\r\nexport const sendToken = (res: Response, token: string) =>\r\n  res.cookie(process.env.COOKIE_NAME!, token, {\r\n    secure: process.env.NODE_ENV === \"development\" ? false : true,\r\n    httpOnly: true,\r\n  });\r\n\r\nexport const verifyToken = (token: string) => {\r\n  try {\r\n    return JWT.verify(token, JWT_SECRET) as {\r\n      userId: string;\r\n      username: string;\r\n      iat: number;\r\n      exp: number;\r\n    } | null;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n};\r\n\r\n```\r\n\r\nmy context\r\n```ts\r\nimport { AppContext, Context } from \"@interface/context\";\r\nimport { prisma } from \"../lib/prisma\";\r\nimport { PubSub } from \"graphql-subscriptions\";\r\nimport { verifyToken, createToken, sendToken } from \"../utility/tokenHandlers\";\r\n\r\nexport const db = prisma;\r\nexport const pubsub = new PubSub();\r\n\r\nexport const context = async ({ res, req }: AppContext): Promise<Context> => {\r\n  // get token from cookie\r\n  const token = req.cookies[`${process.env.COOKIE_NAME!}`];\r\n\r\n  if (token) {\r\n    // Verify token\r\n    const decoded = verifyToken(token);\r\n\r\n    // if was decoded\r\n    if (decoded) {\r\n      req.userId = decoded.userId;\r\n      req.username = decoded.username;\r\n\r\n      // Re generate token if below conditions are met\r\n      if (Date.now() / 1000 - decoded.iat > 6 * 60 * 60) {\r\n        // find it in prisma db\r\n        const findUser = await db.user.findUnique({\r\n          where: {\r\n            id: req.userId,\r\n          },\r\n        });\r\n\r\n        if (findUser) {\r\n          const newToken = createToken(findUser.id, findUser.username);\r\n\r\n          // send it\r\n          sendToken(res, newToken);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    db,\r\n    res,\r\n    req,\r\n    pubsub,\r\n  };\r\n};\r\n```\r\n\r\nI'm sorry if code example is long, because i want to explain in more detail and clearly \r\nPlease help me... Any suggestion and answer i will appreciate <3\r\n\r\nThanks before."}
{"sentences": "Production - Cache instruction not applied", "description": "**What version of Next.js are you using?**\r\n\r\n12.2.2\r\n\r\n**What version of Node.js are you using?**\r\n\r\nv16.15.0 (local) v16.16.0 (on prod)\r\n\r\n**What browser are you using ?**\r\n\r\nGoogle Chrome\r\n\r\n**What operating system are you using?**\r\n\r\nWindows\r\n\r\n**How are you deploying your application**\r\n\r\nnext build\r\npm2 start npm\r\n\r\n**Server Configuration**\r\n\r\nMy server is a VPS on Debian16 and running with Apache2\r\n\r\n**Describe the Bug**\r\n\r\nBuilding an e-commerce website. \r\nOn production, when I go to the cart page, I always have the same cart, even after adding / removing products.\r\nThis is because I have the default Cache-Control for the _next/data/development/cart.json file. This is the file which return my getServerSideProps results.\r\nIf I press CTRL + R, the cart page is now at correct state. But if I leave the page and come back, I always have the first version stored in cache.\r\n\r\nHere is my getServerSideProps function for the cart page :\r\n\r\n```\r\nexport const getServerSideProps = withIronSessionSsr(async (context) => {\r\n  // Get the cart\r\n  let cart: CartInterfaceForCartPage | null = null;\r\n  if (context.req.session.user) {\r\n    cart = await getCartFromDatabaseForCartPage(context.req.session.user.id);\r\n  }\r\n\r\n  context.res.setHeader(\r\n    'Cache-Control',\r\n    'no-cache, no-store, max-age=0, must-revalidate'\r\n  );\r\n\r\n  return {\r\n    props: {\r\n      cart,\r\n    },\r\n  };\r\n}, ironOptions);\r\n```\r\n\r\nwithIronSessionSsr is a module to have session on the server side.\r\n\r\n**On Local**\r\nWith npm run dev or build & start, the cart page is working nicely and I have for the cart.json file :\r\nStatus Code: 200 OK\r\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\r\nlike I asked in my getServerSideProps function.\r\n\r\n**On Production**\r\n\r\nWith npm run dev or build & start the cart.json ressource have these headers  :\r\nStatus Code: 200 OK (from disk cache)\r\nCache-Control: max-age=31536000, public\r\nwhich is the default Next cache control (I think).\r\n\r\n"}
{"sentences": "Sentry v7 breaking entire js system in Next.js", "description": "Is it possible to make Next.js bundler transpile Sentry package into ES5? \r\n\r\nI upgraded my Sentry to v7 but they say they default `bundle.min.js` to ES6 instead of ES5. I think this is the root cause of breaking my entire JS on older browsers. Others have the same issue here but no solution - https://github.com/getsentry/sentry-javascript/issues/5452 \r\n\r\nSentry in the release notes here say this:\r\n\r\n> Default bundle.min.js to ES6 instead of ES5. [ES5 bundles are still available at bundle.es5.min.js](https://github.com/getsentry/sentry-javascript/blob/7.0.0/MIGRATION.md#renaming-of-cdn-bundles). (https://github.com/getsentry/sentry-javascript/pull/4958)\r\n\r\n<img width=\"997\" alt=\"image\" src=\"https://user-images.githubusercontent.com/6372489/180502654-9c982ae5-7efc-4fff-9ae7-d2dbf8414926.png\">\r\n\r\n\r\n I am using Typescript next template.\r\n\r\n"}
{"sentences": "Contradictory warnings: @next/next/no-before-interactive-script-outside-document and @next/next/no-script-in-document", "description": "Vercel complains about `<Script src=\"/script/my-script.js\" strategy=\"beforeInteractive\" />` being present in _app.js with the warning:\r\n\r\n```\r\nWarning: `next/script`'s `beforeInteractive` strategy should not be used outside of `pages/_document.js`. See: https://nextjs.org/docs/messages/no-before-interactive-script-outside-document  @next/next/no-before-interactive-script-outside-document\r\n```\r\n\r\nBut when I move the script tags to _document.js, eslint complains:\r\n\r\n```\r\nnext/script should not be used in pages/_document.js. See: https://nextjs.org/docs/messages/no-script-in-document-pageeslint[@next/next/no-script-in-document](https://nextjs.org/docs/messages/no-script-in-document-page)\r\n```\r\n\r\nThese warnings appear to be irreconcilable. Any advice?"}
{"sentences": "Remove .html on next config redirects", "description": "Hii all, for my project I have to put some redirects in place. The old site used .html in the paths, but for the new one we don't. I can't really figure out how to remove the .html coming in from source in the destination. \r\n\r\nIt works by removing it with a piece of middleware, but this forces 2 redirects whilst I only want one. \r\n\r\nHoping anybody here can help out 🙏 "}
{"sentences": "ENV Variables not working", "description": "Hello!, I'm asking for help since I've trying for a long time and I cant make it work, I've downloaded this example -> [mongodb + mongoose](https://github.com/vercel/next.js/tree/canary/examples/with-mongodb-mongoose)\r\n\r\nright now I have the problem that .env.local is not being counted? this line of code only works if I literally delete the .env.local and hardcode the uri\r\n\r\n```const MONGODB_URI = process.env.MONGODB_URI```\r\n\r\nin case is not clear I'm completely new to next I'm trying to get to work that example since it got my interest but Idk if docs are outdated or i'm missing something\r\n\r\nalso just in case I'dont want to use NEXT_PUBLIC since I want to keep secret the mongodb_uri since is my actual db which I use for some projects\r\n\r\nedit: I made a friend tried the same example and it worked for him, what is messed up with me idk"}
{"sentences": "Should I use getInitialProps or getServerSideProps", "description": "Hello there,\r\nI'm making a Next.js (frontend) and Node.js (backend API) Project in which I have to fetch blog data. I'm trying to implement pagination with pages and filters with URL query parameters (?page=1&sort=likes) but I can't decide wether to use getInitialProps or getServerSideProps.\r\n\r\n- If I would use getInitialProps I would save the request to Next.js server at continous requests for example to filter but also it makes the bundle size bigger. Also Better UX with a Loading Animation\r\n- If I would use getServerSideProps it would make the bundle size smaller but introduces that extra request at every  page request.\r\n\r\nWhat would you choose?"}
{"sentences": "Add env variable to make next/image unoptimised", "description": "### Describe the feature you'd like to request\n\nSometimes developer might want to make all next/image components `unoptimized`, e.g. when running next.js code outside of the next.js server (storybook, ladle, etc). \n\n### Describe the solution you'd like\n\nIt would be really convinient if nextjs would expose an environment variable, which would make all images unoptimized\n\n### Describe alternatives you've considered\n\nFor storybook there is [this solution](https://github.com/vercel/next.js/issues/18393#issuecomment-909636489), which is basically monkey-pathing all next/image components"}
{"sentences": "On-demand revalidate with middleware rewriting", "description": "Hi dears,\r\nI can't figure out what I'm supposed to call inside res.unstable_revalidate() when I use in _middleware subdomain rewrite something like:\r\n\r\nurl.pathname = `/_pages/${currentHost}${pathname}`;\r\nreturn NextResponse.rewrite(url);\r\n\r\nThis page renders by calling sub.domain.com\r\n"}
{"sentences": "Is a leaderboard a good usecase for Incremental Static Regeneration?", "description": "I want to display a leaderboard on my website but it would be wasteful to make a new database request whenever a user opens that page.\r\nI was planning to use ISR here and refresh the leaderboard only every 30-60 seconds.\r\n\r\nDo you think that's a good alternative to caching the data server-side? Or are there any problems with this approach?"}
{"sentences": "Runtime basepath", "description": "I would like to deploy my next.js app onto an Openshift environment, with an nginx reverse proxy infront of it.\r\n\r\nThe problem is that I have a hard requirement that the nginx proxy is on a subdomain that depends on the Openshift namespace.\r\n\r\nE.g - `my.openshift.app/<NAMESPACE>/nginx/my-next-app`\r\n\r\nBecause the namespace is dynamic, I cannot use `basepath` at build time. Is there any way to make this dynamic, or is it simply against the purpose of next.js static and server side rendering?"}
{"sentences": "Next Learn Create Nextjs Blog App", "description": "I am following the learn course to create a nextjs blog app. \r\n\r\nThis is the index page of the sample app.\r\n<img width=\"688\" alt=\"Screenshot 2022-07-18 at 1 44 01 PM\" src=\"https://user-images.githubusercontent.com/59417546/179470550-fbabdc42-4d49-4427-9359-4f5f3d239f94.png\">\r\n\r\nThis the blog page\r\n<img width=\"979\" alt=\"Screenshot 2022-07-18 at 1 44 26 PM\" src=\"https://user-images.githubusercontent.com/59417546/179470627-1fb58f2a-e95a-4fb2-9cb3-f6293e156586.png\">\r\n\r\nIt's code can be found here : https://github.com/vercel/next-learn/tree/master/basics/demo\r\n\r\nIn the blog page, I want to display images related to the blog at the top instead of name and profile image. I have created a layout for that but am having a problem on how i can set the src in Image (next/image) in the layout to use images particularly for that blog.\r\n "}
{"sentences": "_document 'link' element doesn't work in production.", "description": "I'm trying to get a font from [google fonts](https://fonts.googleapis.com), so I used `link` element in _document file.\r\n\r\n\r\n`\r\n    <Html>\r\n      <Head>\r\n        <link\r\n          href='https://fonts.googleapis.com/css?family=Poppins:400,400i,700,700i|Rock+Salt:400,400i,700&subset=devanagari,latin_ext,latin&display=swap'\r\n          rel=\"stylesheet\"\r\n        />\r\n      </Head>\r\n      <body>\r\n        <Main />\r\n        <NextScript />\r\n      </body>\r\n    </Html>\r\n `\r\n\r\nThe font works fine on development, and I can see in the `head` tag, the `link` element like that.\r\n\r\n`<link href=\"https://fonts.googleapis.com/css?family=Poppins:400,400i,700,700i|Rock+Salt:400,400i,700&amp;subset=devanagari,latin_ext,latin&amp;display=swap\" rel=\"stylesheet\">`\r\n\r\nBut in production, it doesn't bind the `url` to `href` attribute, but it binds it with `data-href`, So it doesn't work, and it looks like that.\r\n\r\n`<link data-href=\"https://fonts.googleapis.com/css?family=Poppins:400,400i,700,700i|Rock+Salt:400,400i,700&amp;subset=devanagari,latin_ext,latin&amp;display=swap\" rel=\"stylesheet\">`\r\n\r\nAny idea what can be causing this issue.\r\n\r\nThanks a lot.\r\n"}
{"sentences": "Got Unexpected token '.' on Cpanel hosting", "description": "After build my application i have start the application locally by npm run start and its was ok but when I host it on cpanel I get a error  on stderr.log which is \" \r\n  children: data?.map((single)=>/*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_SingleCollection__WEBPACK_IMPORTED_MODULE_4__/* [\"default\"] */ .Z, {\r\n                           ^\r\n\r\nSyntaxError: Unexpected token '.'\r\n\"\r\nI have used ssr also SWR for internal fatch. I have tried to host an empty project that was ok on Cpanel. it working on vercel hosting but not in Cpanel\r\n"}
{"sentences": "Meta tags not in _document.js not working", "description": "Hello guys, I have been having issues with meta tags in my app. only the head tag in _document that's picked up. If i inspect the page I see the meta tags, but the meta tags doesn't show up when I use a meta preview (opengraph.xyz) or twitter card validator. \r\n\r\nI also noticed other head tags in doesn't appear in the source code but is present when I inspect the page. I've tried several solutions but none seem to work. Snippets of my code is present below: \r\n\r\nThe first image is the _app.js\r\n\r\n<img width=\"1440\" alt=\"Screenshot 2022-03-24 at 12 18 31\" src=\"https://user-images.githubusercontent.com/33222698/159906142-592c769a-a2bc-473a-907b-0b362deec866.png\">\r\n\r\nThis is for SSR(Dynamic meta tag)\r\n\r\n<img width=\"1310\" alt=\"Screenshot 2022-03-24 at 12 20 08\" src=\"https://user-images.githubusercontent.com/33222698/159906024-e7a807bb-0525-4c40-aec8-613dae2de91f.png\">\r\n"}
{"sentences": "GET /_next/image randomly start returning HTTP 500  on Azure App Service static website", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\nNextJS 12.0.7\r\nNodeJS Node 14 LTS \r\nStatic Website \r\nAzure App Service\r\n\n\n### What browser are you using? (if relevant)\n\nAny browser \n\n### How are you deploying your application? (if relevant)\n\nNextJS 12.0.7 SSG and Azure App services  \n\n### Describe the Bug\n\nWe have a static website generated using NextJS and for the images we use NextJS Image component. What happens is that images on the website  randomly starts returning HTTP 500 after a while.  The HTTP 500 returns for random images in the website and at random points in time. Some time's it takes days and some just minutes after we deploy the website. When it happens we have to restart the App Service so the error disappears and it starts working again. Only to come back again. \r\n\r\nGET /_next/image returns HTTP 500\n\n### Expected Behavior\n\nExpect the images to continue loading without any errors.\n\n### Link to reproduction\n\nwe don't have it.\n\n### To Reproduce\n\nSince this is a random issue... There is no way to reproduce it."}
{"sentences": "How can I reach a component to import to a page?", "description": "So I have page of blog1-page like under pages like this\r\n\r\n```\r\nRoot\r\nPage/blog/blog1/Page\r\n```\r\n\r\nand I need to import a component from here:\r\n\r\n```\r\nRoot\r\nComponents/blog1component \r\n```\r\n\r\nWhat would be the proper way to reach the folder for the import?\r\n\r\n`import blog1componet from \".../.../ ??? \"`\r\n\r\nI can't seem to find a way to reach the component folder all the way the /blog1/Page location.....    \r\n\r\n"}
{"sentences": "Next Js direct loading causes 403 forbidden", "description": "Hi, Next Js static site generation website routing with <Link> works well.\r\nBut direct loading causes error. There is not problem local dev and build mode, only server is problem. What do you think about this bug?\r\nThank you."}
{"sentences": "NextJS converts / to %2F during build", "description": "I have been trying to convert my wordpress site to NextJS using graphql. The url of my wordpress site is in this format: mysite.com/2022/12/01/slug. Since I need the site to be exactly like my wordpress site, I need the url to be in the same format. So instead of slug I used the uri of the page to dynamically generate pages in nextJs. The code is :\r\n\r\n```\r\nimport Image from \"next/image\";\r\n\r\nexport default function Post(data) {\r\n\tconst post = data.post;\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<h1>{post.title}</h1>\r\n\t\t\t<Image width=\"640\" height=\"426\" src={post.featuredImage.node.sourceUrl} />\r\n\t\t\t<article dangerouslySetInnerHTML={{ __html: post.content }}></article>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nexport async function getStaticProps(context) {\r\n\tconsole.log(context);\r\n\tconst res = await fetch(\"http://edailybuzz.local/graphql\", {\r\n\t\tmethod: \"POST\",\r\n\t\theaders: { \"Content-Type\": \"application/json\" },\r\n\t\tbody: JSON.stringify({\r\n\t\t\tquery: `\r\n                query GetPostByURI($id: ID!) {\r\n                    post(id: $id, idType: URI) {\r\n                        title\r\n                        slug\r\n\t\t\t\t\t\turi\r\n                        content\r\n                        featuredImage {\r\n                            node {\r\n                                sourceUrl\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            `,\r\n\t\t\tvariables: {\r\n\t\t\t\tid: context.params.uri,\r\n\t\t\t},\r\n\t\t}),\r\n\t});\r\n\r\n\tconst json = await res.json();\r\n\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tpost: json.data.post,\r\n\t\t},\r\n\t};\r\n}\r\n\r\nexport async function getStaticPaths() {\r\n\tconst res = await fetch(\"http://edailybuzz.local/graphql\", {\r\n\t\tmethod: \"POST\",\r\n\t\theaders: { \"Content-Type\": \"application/json\" },\r\n\t\tbody: JSON.stringify({\r\n\t\t\tquery: `\r\n            query AllPostsQuery {\r\n                posts {\r\n                    nodes {\r\n\t\t\t\t\t\turi\r\n                        \r\n                    }\r\n                }\r\n            }\r\n        `,\r\n\t\t}),\r\n\t});\r\n\r\n\tconst json = await res.json();\r\n\tconst posts = json.data.posts.nodes;\r\n\r\n\tlet paths = posts.map((post) => ({\r\n\t\tparams: { uri: decodeURIComponent(post.uri) },\r\n\t}));\r\n\tconsole.log(paths);\r\n\r\n\treturn { paths, fallback: false };\r\n}\r\n```\r\n\r\n\r\nDuring build, the uri converts to /posts/@2F2022@2F07@2F12%@Fblog-12%2F instead of /posts/2022/07/12/blog-12/. I have tried everything and searched everywhere but couldn't find the solution. I have created a file [uri].js in the posts folder under Pages. In need of help big time.\r\n"}
{"sentences": "SWC config in Next.js 12", "description": "I am having some troubles getting our Next.js App to compile so that it only contains es5 syntax to cause no syntax errors in ie11. (As of now after switching to SWC, arrow functions are still present in the static JS-files for the website and thus ie11 crashes)\r\n\r\nWe used to have the following config inside our .babelrc file that helped in this case\r\n```json\r\n{\r\n  …\r\n  \"env\": {\r\n    \"production\": {\r\n      \"presets\": [\r\n        [\r\n          \"next/babel\",\r\n          {\r\n            \"preset-env\": {\r\n              \"targets\": \"defaults, IE 11, iOS 9\"\r\n            }\r\n          }\r\n        ]\r\n      ]\r\n    },\r\n    …\r\n}\r\n```\r\n  \r\nNow with SWC from what I read in the [SWC docs](https://swc.rs/docs/configuration/supported-browsers#targets), it should work fairly similar using the env targets property in the .swcrc config-file. So I setup my config as follows:\r\n```json\r\n{\r\n  \"env\": {\r\n    \"targets\": \"defaults, IE 11, iOS 9\"\r\n  }\r\n}\r\n```\r\nNow the problem I am having the Next.js output doesn't change at all based on this config. I additionally tried setting the compile target to es5, but that didn't work neither.\r\n\r\nThe Next.js doc still is very lacking on how one can configure SWC inside a next.js project. Since the equivalent is still present for babel however, I think this should really be added. ~@kdy1 In case you could point me in the right direction, I would be glad to contribute into extending the docs on this.~"}
{"sentences": "[TypeError]: The NextURL configuration includes no locale", "description": "Hello all! So I wanna ask you guys about my Nextjs website's error which currently occurs on my production server. \r\n\r\nSo in the website I make, I implement Internationalized Routing on my website [Middleware](https://nextjs.org/docs/advanced-features/middleware). It runs well on local, no error occurs during the development stage. \r\n\r\nThus I pushed the website to my server. It also runs well on my server (without a domain address), but when I point a domain ([gabutnetwork.net](gabutnetwork.net)) to my server address, however when I visited the website using that domain, out of nowhere an `500: Internal Server Error` occured, and then I went check the website with my server address, and it ran pretty well, without error occurred.\r\n\r\nThen I tried to debug my Nextjs log, and it turns out that;\r\nthe reason why `500 Internal Server Error` occured is because of an error at `Error [TypeError]: The NextURL configuration includes no locale \"en;q=0.6\"` . But it's really weird, an error could be occured on the website which has domain while the same website doesn't have any error when visiting it through the server address. \r\n\r\nAnd also, while the console says `Error [TypeError]: The NextURL configuration includes no locale \"en;q=0.6\"`  , however the web console says `\"A client-side exception has occurred\"`\r\n\r\nMay I know the explanation of experience I'm facing right now? Thanks.\r\n\r\n---\r\n\r\nscreen shots \r\n<img width=\"1438\" alt=\"Screenshot 2022-07-13 at 20 01 32\" src=\"https://user-images.githubusercontent.com/67791514/178740368-786c5b05-3133-45f5-b087-07c4173c1ad4.png\">\r\n<img width=\"1438\" alt=\"Screenshot 2022-07-13 at 20 02 40\" src=\"https://user-images.githubusercontent.com/67791514/178740426-b8595d4a-62a0-4ba2-8c2f-276077e45018.png\">\r\n\r\n---\r\n\r\ninfo\r\n```\r\n\"next\": \"^12.2.2\",\r\n\"react\": \"18.1.0\",\r\n\"next-i18next\": \"^11.0.0\",\r\n```"}
{"sentences": "Deprecated `request.page` in middleware", "description": "I've been using `request.page` in the middleware to get the page url with slug, but after deprecating it in `12.2.0` it's not possible anymore to know the page url with slug. (https://github.com/vercel/next.js/pull/37349)\r\n\r\nFor example, I have pages like:\r\n- /page/[id]\r\n- /page/[...slug]\r\n\r\nBut not I can only get\r\n- /page/1234\r\n- /page/some/thing\r\n- /page/some/url\r\n\r\nIt's an issue for me since I have a list of all the urls I want to handle with `slug`, but in case of absolute urls with id, it makes it hard to extract and match urls.\r\n\r\nAny idea how I can solve it? as the suggestion to use `URLPattern` is not working well for my use case."}
{"sentences": "experimental.appDir purpose?", "description": "I was looking around for some way to have custom functions built and exported as part of the next.js build pipeline, for the purposes of making a CLI to run random database queries and etc.\r\n\r\nIt looks like this use case has specifically been avoided (happy to be corrected?), but I did find an undocumented config flag `experimental.appDir`.\r\n\r\nFrom what I can see, if enabled this flag will scan for additional files to compile matching `app/*.page.(ts|js|etc)`, and it will compile them into `.next/server/app/`. The original code will be included, along with other exports (listed below).\r\n\r\nCan someone hint what this feature is for? Thanks.\r\n\r\n```js\r\nexports.id = 154;\r\nexports.ids = [154];\r\nexports.modules = {\r\nexports[\"default\"] = AppRouter;\r\nexports.fetchServerResponse = fetchServerResponse;\r\nexports.LayoutSegmentsContext = exports.ParamsContext = exports.PathnameContext = exports.QueryContext = void 0;\r\nexports.QueryContext = QueryContext;\r\nexports.PathnameContext = PathnameContext;\r\nexports.ParamsContext = ParamsContext;\r\nexports.LayoutSegmentsContext = LayoutSegmentsContext;\r\nexports[\"default\"] = OuterLayoutRouter;\r\nexports.InnerLayoutRouter = InnerLayoutRouter;\r\nexports.matchSegment = void 0;\r\nexports.matchSegment = matchSegment;\r\nexports.reducer = reducer;\r\n```"}
{"sentences": "Middleware", "description": "\r\n![dashboard-–-Deployment-Overview](https://user-images.githubusercontent.com/42802922/177841173-0191ec06-950a-4dba-9cfc-cc8951751732.png)\r\nmiddleware.ts\r\n```ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport const middleware = (req: NextRequest) => {\r\n  const { cookies, geo, nextUrl } = req;\r\n  console.info(`Country: ${geo?.country}`);\r\n\r\n  const isAuthenticated = cookies.get('isLoggedIn');\r\n  if (!isAuthenticated) {\r\n    const logingUrl = new URL('/auth', req.url);\r\n    return NextResponse.redirect(logingUrl);\r\n  }\r\n\r\n  const clientId = cookies.get('clientId');\r\n  const origin = nextUrl.origin;\r\n  const relative = `/clients/owner/${clientId}/restaurants-list`;\r\n  const absolute = new URL(relative, origin);\r\n  const pathname = nextUrl.pathname;\r\n  if (isAuthenticated && pathname === '/auth') {\r\n    return NextResponse.redirect(absolute);\r\n  }\r\n  if (pathname === '/') {\r\n    return NextResponse.redirect(absolute);\r\n  }\r\n};\r\n```\r\nWhat am I doing wrong?\r\n\r\nNextjs version `12.2.0`\r\n"}
{"sentences": "All next/image components fail to load the src due to a 404", "description": "Hi! \r\n\r\nToday I've updated my nextjs from `12.1.0` to `12.2.0`. Ever since I've been getting errors on my next/image components with a `404 Not Found`. Not using any experimental features like the `next/future/image` but using a CDN (cloudinary). Has there been a breaking change to the next/image component that went over my head? Or does someone know the solution to this problem, or can guide me towards one?\r\n\r\nThanks!\r\n\r\n_extra info: still using react 17.0.2, but don't think that should be a problem._"}
{"sentences": "Would anybody be so awesome to tell me how to target this file?", "description": "I need to target the parts-parker.json  from the  parker.js file \r\n\r\nCan I do something like?\r\n\r\n`import db from \".../utils/parts-parker\" `      <-  this is getting me an error \r\n\r\nor\r\n\r\n` import db from \"/utils/parts-parker\"`  <- this doesn't get errors, but the data is just blanked, nothing, nada.. \r\n\r\n\r\n![202020](https://user-images.githubusercontent.com/93617433/177601648-f33738f0-232c-4305-b4e4-ac54d75b4d92.PNG)\r\n\r\n"}
{"sentences": "On-demand ISR revalidate not work with hostname-rewrite", "description": "## Everything works correctly except the revalidate function which always returns 'Error revalidating'\r\n\r\nhostname-rewrite: [https://github.com/vercel/examples/tree/main/edge-functions/hostname-rewrites](url) \r\n```\r\n// pages/api/revalidate.js\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.query.secret !== process.env.MY_SECRET_TOKEN) {\r\n    return res.status(401).json({ message: 'Invalid token' })\r\n  }\r\n  try {\r\n    await res.revalidate('/')\r\n    return res.json({ revalidated: true })\r\n  } catch (err) {\r\n    return res.status(500).send('Error revalidating')\r\n  }\r\n}\r\n```"}
{"sentences": "Can't access ENV vars defined in .env.test", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nI have added an .env.test file to an app based on the environment variable starter, containing one variable TEST_ENV_VARIABLE.\r\n\r\nWhen I run the tests, ENV_VARIABLE defined in .env is appearing in process.env, but not TEST_ENV_VARIABLE defined in .env.test\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behaviour, please provide code snippets or a repository:\r\n\r\n1. git clone https://github.com/erkde/environment-variables-app\r\n2. yarn install\r\n3. yarn test\r\n\r\n## Expected behaviour\r\n\r\nTo be able to add/override env variables using an .env.test file within tests.\r\n\r\n## Screenshots\r\n\r\nN/A\r\n\r\n## System information\r\n\r\n- OS: [e.g. macOS]\r\n- Browser (if applies) [e.g. chrome, safari]\r\n- Version of Next.js: [e.g. 9.5.2]\r\n- Version of Node.js: [e.g. 12.18.2]\r\n\r\n## Additional context\r\n\r\nAdd any other context about the problem here.\r\n"}
{"sentences": "Issue with next/jest", "description": "For some reason, my environment variables aren't being \"loaded\" into process.env by `next/jest`.\r\nHere's my configuration and an example test.\r\n\r\nConfiguration:\r\n```ts\r\nimport NextJest from 'next/jest';\r\n\r\nconst createJestConfig = NextJest({\r\n  dir: './',\r\n});\r\n\r\nconst customJestConfig = {\r\n  moduleDirectories: ['node_modules', '<rootDir>/'],\r\n  testEnvironment: 'jest-environment-jsdom',\r\n};\r\n\r\nmodule.exports = createJestConfig(customJestConfig);\r\n```\r\n\r\nTest:\r\n```ts\r\ndescribe('HTML document root', () => {\r\n  it('Should have a language environment variable available', () => {\r\n    expect(process.env.NEXT_PUBLIC_DOCUMENT_LANG).toBeDefined();\r\n  });\r\n});\r\n\r\nexport {};\r\n```\r\n\r\nI have a TypeScript basePath of `.` (root)."}
{"sentences": "What is the folder `.swc` generated in Next.js 12.2", "description": "Hi,\r\n\r\nI just updated my project to Next.js 12.2 and I notice Next.js automatically create a folder named `.swc`.\r\nThis folder contains another named `plugins`and `plugins` contains `v2`.\r\nSo here is the structure: `.swc` > `plugins` > `v2` but `v2` folder is empty.\r\n\r\nIs it normal? Why is it empty?\r\n\r\nShould I .swc as an ignored files in git? Should I track on Git?"}
{"sentences": "next/image is not honoring the `maxAge` set by upstream images", "description": "Hey team,\r\nI see that documentation of next/image about the [caching behaviour](https://nextjs.org/docs/api-reference/next/image#caching-behavior) states that\r\n\r\n> The expiration (or rather Max Age) of the optimized image is defined by either the minimumCacheTTL or the upstream image Cache-Control header, whichever is larger.\r\n\r\nMy upstream image has a header `cache-control: max-age=31536000`. When I use this image with next/image component, this `maxAge` value is not honoured at all and header is added like `Cache-Control: public, max-age=0, must-revalidate`.\r\n\r\nWhen I looked at the [code](https://github.com/vercel/next.js/blob/12.1.7-canary.8/packages/next/server/image-optimizer.ts#L577), it correctly states that it will be always `Cache-Control: public, max-age=0, must-revalidate`.\r\n\r\nThis was got changed under [commit](https://github.com/vercel/next.js/commit/130f8645a2db18527142a7764eaa5e649183cc74), but the commit message does not talk more about why this was done.\r\n\r\nCan you please help me understand is this a bug introduced in next/image?\r\n\r\n//cc @styfle "}
{"sentences": "how i can convert this code to  `export default function`", "description": "```\r\nimport Link from 'next/link';\r\nimport { useState } from 'react';\r\nimport Logo from '../constants/svg/logo.svg';\r\n\r\nexport const Navbar = () => {\r\n  const [active, setActive] = useState(false);\r\n\r\n  const handleClick = () => {\r\n    setActive(!active);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <nav className='sticky top-0 z-40 flex flex-wrap items-center p-3 bg-white drop-shadow-md '>\r\n        <Link href='https://app.xpeace.cloud/login'>\r\n          <button className=\"hidden ml-[35px]   bg-[#E9E9E9] hover:bg-sky-700 items-center justify-center w-full px-3 py-2 font-bold text-black rounded lg:inline-flex w-24 hover:bg-[#b4b4b4] hover:text-black \">\r\n            ورود\r\n          </button>\r\n        </Link>\r\n        <Link href='https://app.xpeace.cloud/register'>\r\n          <button className=\"hidden  ml-[20px] bg-[#1361FF] hover:bg-sky-700 items-center justify-center w-full px-3 py-2 font-bold text-white rounded lg:inline-flex w-32 hover:bg-[#0f4fce] hover:text-black\">\r\n            ثبت نام\r\n          </button>\r\n        </Link>\r\n        <button\r\n          className='inline-flex p-3 mr-auto  text-black rounded outline-none hover:bg-[#1361FF] lg:hidden hover:text-white'\r\n          onClick={handleClick}\r\n        >\r\n          <svg className='w-6 h-6' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path strokeLinecap='round' strokeLinejoin='round' strokeWidth={2} d='M4 6h16M4 12h16M4 18h16' /></svg>\r\n        </button>\r\n        {/*Note that in this div we will use a ternary operator to decide whether or not to display the content of the div  */}\r\n        <div\r\n          className={`${active ? '' : 'hidden'\r\n            }   w-full lg:inline-flex lg:flex-grow lg:w-auto`}\r\n        >\r\n          <div className='flex flex-col items-start w-full lg:inline-flex lg:flex-row lg:ml-auto lg:w-auto lg:items-center lg:h-auto'>\r\n            <Link href='/about'>\r\n              <a className='items-center justify-center w-full px-3 py-2 font-bold text-center text-black rounded lg:inline-flex lg:w-auto hover:text-bluext '>\r\n                درباره ما\r\n              </a>\r\n            </Link>\r\n            <Link href='/'>\r\n              <a className='items-center justify-center w-full px-3 py-2 font-bold text-center text-black rounded lg:inline-flex lg:w-auto hover:text-bluext '>\r\n                پشتیبانی\r\n              </a>\r\n            </Link>\r\n            <Link href='/about'>\r\n              <a className='items-center justify-center w-full px-3 py-2 font-bold text-center text-black rounded lg:inline-flex lg:w-auto hover:text-bluext '>\r\n                تعرفه ها\r\n              </a>\r\n            </Link>\r\n            <Link href='/'>\r\n              <a className='items-center justify-center w-full px-3 py-2 font-bold text-center text-black rounded lg:inline-flex lg:w-auto hover:text-bluext '>\r\n                خانه\r\n              </a>\r\n            </Link>\r\n          </div>\r\n        </div>\r\n        <Link href='/'>\r\n          <a className='inline-flex items-center p-2 mr-4 '>\r\n            <Logo className='text center cinema' />\r\n          </a>\r\n        </Link>\r\n      </nav>\r\n    </>\r\n  );\r\n};\r\n```\r\nhow i can convert this code to  `export default function`\r\n"}
{"sentences": "How to redirect to an external domain through `res.redirect()` from an API route", "description": "Hi 👋🏻 ,\r\n\r\nI am building an ecommerce and I use my API routes to generate a checkout URL (hosted on Mollie.com) and I am trying to directly redirect the user to the page through `res.redirect()` instead of returning said URL to my `fetch()` function and then redirect on the client-side.\r\n\r\nBecause it's on an external domain name, I get the classic CORS error message: \r\n`Blocking of a Cross-Origin Request: the “Same Origin” policy does not allow viewing of the remote resource located at https://www.mollie.com/paymentscreen/testmode/?method=creditcard&token=3.quxy0f. Reason: CORS request failed.`\r\n\r\n`/pages/index.js`:\r\n```\r\n[...]\r\nawait fetch('/api/checkout', {\r\n\theaders: { Accept: 'application/json', 'Content-Type': 'application/json' },\r\n\tcredentials: 'include',\r\n\tmethod: 'POST',\r\n\tmode: 'cors',\r\n\tbody: JSON.stringify(data),\r\n}).then((response) => response.json())\r\n[...]\r\n```\r\n\r\n`/pages/api/checkout`:\r\n```\r\n[...]\r\nawait mollieClient.payments.create({ ... }).then(async (payment) => {\r\n\tres.setHeader('Access-Control-Allow-Origin', 'https://www.mollie.com');\r\n\tres.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\r\n\tres.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\r\n\tres.redirect(payment.getCheckoutUrl()); // ? returns a string such as https://www.mollie.com/paymentscreen/testmode/?method=creditcard&token=3.quxy0f\r\n});\r\n[...]\r\n```\r\n\r\nI have also tested through `next.config.js` headers directive but none seem to solve my issue – I think it’s probably due to my lack of knowledge in the matter but I'm out of ideas (and would really love to make this work this way).\r\n\r\nIs it even possible?\r\n\r\nAny ideas?\r\nThanks!"}
{"sentences": "next/image serves image with low resolution per Lighthouse-Best Practices", "description": "With the new `Image` component, Lighthouse is not happy with the image sizes provided as you can see below:\r\n\r\n![Screenshot 2020-11-05 at 14 58 18](https://user-images.githubusercontent.com/9449665/98250154-6621ea00-1f77-11eb-8c55-5d6e76da8ff6.png)\r\n\r\nAfter reading quite a lot about it I am still unable to satisfy Lighthouse. Take a look at [this issue](https://github.com/GoogleChrome/lighthouse/issues/10802), for instance. \r\n\r\nI thought that that could be addressed by the `sizes` property of the `Image` component, but that did not work.\r\n\r\n\r\n\r\n        <Image\r\n                            src=\"/images/main-logo.png\"\r\n                            alt=\"quiamo logo\"\r\n                            className={classes.branding}\r\n                            width=\"180\"\r\n                            height=\"60\"\r\n                            loading=\"eager\"\r\n                            priority\r\n                            sizes=\"only screen and (min-resolution: 3dppx) 473px\"\r\n            />\r\n\r\nThis would output like below, ie, adding a `sizes` property with a media-query, but no effect on Lighthouse.\r\nI was expecting it to add a `srcset` with the informed size.\r\n\r\nActually I was expecting that `next/image` would handle that automatically by providing different sizes/resolution for the most common devices. \r\n\r\n    `<img alt=\"quiamo logo\" src=\"/_next/image?url=%2Fimages%2Fmain-logo.png&amp;w=320&amp;q=75\" srcset=\"/_next/image?url=%2Fimages%2Fmain-logo.png&amp;w=320&amp;q=75 320w\" class=\"makeStyles-branding-7\" sizes=\"only screen and (min-resolution: 3dppx) 473px\" style=\"visibility:visible;height:100%;left:0;position:absolute;top:0;width:100%\">`"}
{"sentences": "Any ideas of why the radio buttons don't set the initial value when sending a form?", "description": "At first when you see the form in the browser, it seems like it is setting up the initial value to check the proper radio button...  sure enough there is a the proper radio button marked correctly... \r\n\r\nThe problem is that when the form is sent.. if I haven't done any clicks, then the form comes in the email as missing the initial setting of the radio button... it comes without any marks, as if there was no initial settings for the radio buttons at all..\r\n\r\nNow... if I start clicking on the radio buttons... then the form comes correctly marked properly...\r\n\r\nIs it that I need to use some useEffect maybe?????\r\n\r\n\r\nThe code goes some like this:\r\n\r\n\r\n```\r\nconst FlowmeterForm = () => {\r\n  \r\n  const [flowDirection, setFlowDirection] = useState(\"uni-directional-flow\");\r\n  const [readingDirection, setReadingDirection] = useState(\r\n    \"uni-directional-reading\"\r\n  );\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n\r\n    console.log(\"Sending\");\r\n\r\nand it keeps going.... \r\n```\r\n\r\nthen returns a set of radio buttons:\r\n\r\n```\r\n<h6>* Flow Direction Options</h6>\r\n          <input\r\n            type=\"radio\"\r\n            name=\"flowDirection\"\r\n            value=\"uni-directional-flow\"\r\n            id=\"flowUnidirectional\"\r\n            checked={flowDirection === \"uni-directional-flow\"}\r\n            onChange={(e) => {\r\n              setFlowDirection(e.target.value);\r\n            }}\r\n          />\r\n          <label htmlFor=\"flowUniDirectional\"> Uni-directional </label> &nbsp;\r\n          <input\r\n            type=\"radio\"\r\n            name=\"flowDirection\"\r\n            value=\"bi-directional-flow\"\r\n            id=\"flowBiDirectional\"\r\n            checked={flowDirection === \"bi-directional-flow\"}\r\n            onChange={(e) => {\r\n              setFlowDirection(e.target.value);\r\n            }}\r\n          />\r\n          <label htmlFor=\"flowBiDirectional\"> Bi-directional </label>\r\n          <br /> <br />\r\n          <h6>* Flow Reading Options</h6>\r\n          <input\r\n            type=\"radio\"\r\n            name=\"readingDirection\"\r\n            id=\"readingUniDirectional\"\r\n            value=\"uni-directional-reading\"\r\n            checked={readingDirection === \"uni-directional-reading\"}\r\n            onChange={(e) => {\r\n              setReadingDirection(e.target.value);\r\n            }}\r\n          />\r\n          <label htmlFor=\"readingUniDirectional\"> Uni-directional</label> &nbsp;\r\n          <input\r\n            type=\"radio\"\r\n            name=\"readingDirection\"\r\n            id=\"readingBiDirectional\"\r\n            value=\"bi-directional-reading\"\r\n            checked={readingDirection === \"bi-directional-reading\"}\r\n            onChange={(e) => {\r\n              setReadingDirection(e.target.value);\r\n            }}\r\n          />\r\n          <label htmlFor=\"readingBiDirectional\"> Bi-directional </label>\r\n          <br />\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Failed to load resource: the server responded with a status of 500 (Internal Server Error)", "description": "From this code below there are 2 problems...\r\n\r\n1.  apparently is not responding back to the form page and I am getting an error 500 as shown on the title of this discussion..\r\n\r\n2. and most important... it isn't re-directing me to the thankyou page...\r\n\r\n\r\n3.. on the half good news is that it is sending the emails after all..\r\n\r\nWould any body know how to fix this? \r\n\r\n```\r\nexport default async function stuff(req, res) {\r\n  let nodemailer = require(\"nodemailer\");\r\n  const transporter = nodemailer.createTransport({\r\n    service: \"Outlook365\",\r\n    auth: {\r\n      user: process.env.EMAIL,\r\n      pass: process.env.EPASSWORD,\r\n    },\r\n  });\r\n\r\n  await new Promise((resolve, reject) => {\r\n    // verify connection configuration\r\n    transporter.verify(function (error, success) {\r\n      if (error) {\r\n        console.log(error);\r\n        reject(error);\r\n      } else {\r\n        console.log(\"Server is ready to take our messages\");\r\n        resolve(success);\r\n      }\r\n    });\r\n  });\r\n\r\n  const mailData = {\r\n    from: \"info@tu.biz\",\r\n    to: \"info@tu.biz\",\r\n    subject: \"contact form\",\r\n    text:\r\n      req.body.company +\r\n      \" | Sent from: \" +\r\n      req.body.email +\r\n      req.body.country +\r\n      req.body.notes,\r\n    html: `<div>${req.body.company}</div><div>Sent from: ${req.body.email}</div><div> ${req.body.country}</div> <div> ${req.body.notes}`,\r\n  };\r\n\r\n  try {\r\n    await new Promise((req, res) => {\r\n      transporter.sendMail(mailData, function (err, info) {\r\n        // if (err) console.log(err);\r\n        // // else console.log(info);\r\n      });\r\n      res.redirect(307, \"/thankyou\");\r\n    });\r\n  } catch (err) {\r\n    res.status(500).send({ error: \"failed to fetch data\" });\r\n  }\r\n}\r\n```\r\n Below is the code for the contact form..... I am getting the error right on the fetch line..\r\n\r\n\r\n```\r\nconst handleSubmit = (e) => {\r\n    e.preventDefault();\r\n\r\n    console.log(\"Sending\");\r\n\r\n    let data = {\r\n      firstName,\r\n      company,\r\n      email,\r\n      country,\r\n      notes,\r\n    };\r\n\r\n    fetch(\"/api/contact\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json, text/plain, */*\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(data),\r\n    }).then((res) => {\r\n      console.log(\"Response received\");\r\n      if (res.status === 200) {\r\n        console.log(\"Response succeeded!\");\r\n        setSubmitted(true);\r\n        setFirstName(\"\");\r\n        setCompany(\"\");\r\n        setEmail(\"\");\r\n        setCountry(\"\");\r\n        setNotes(\"\");\r\n        // router.replace(\"/thankyou\");\r\n        // res.redirect(307, \"/thankyou\");\r\n      }\r\n    });\r\n  };\r\n\r\n```\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Would anybody have any experience sending a contact form to smtp office 365?", "description": "So, I got this contact form here:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/components/contact-form.js\r\n\r\nAnd this api code here:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/api/contact.js\r\n\r\nAnd I am getting this error here:\r\n```\r\nevent - compiled client and server successfully in 122 ms (177 modules)\r\n{ firstName: '', company: '', email: '', country: '', notes: '' }\r\n[Error: 34032:error:1408F10B:SSL routines:ssl3_get_record:wrong version number:c:\\ws\\deps\\openssl\\openssl\\ssl\\record\\ssl3_record.c:332:\r\n] {\r\n  library: 'SSL routines',\r\n  function: 'ssl3_get_record',\r\n  reason: 'wrong version number',\r\n  code: 'ESOCKET',\r\n  command: 'CONN'\r\n\r\n```\r\nI think part of the problem is the beginning of this code here:\r\n\r\n```\r\nexport default function handler(req, res) {\r\n  let nodemailer = require(\"nodemailer\");\r\n  const transporter = nodemailer.createTransport({\r\n    port: 587,\r\n    host: \"smtp.office365.com\",\r\n    auth: {\r\n      user: process.env.EMAIL,\r\n      pass: process.env.EPASSWORD,\r\n    },\r\n    secure: true,\r\n  });\r\n\r\n```\r\nSo I am using a smtp protocol from Office365 because that was the only email account that I have with smtp....  unless I can get one free from Gmail?  Do they have one? Or maybe I need to pay for one ....\r\n\r\nAnyway...  the Office documents don't say anything about SSL...\r\nhttps://docs.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-up-a-multifunction-device-or-application-to-send-email-using-microsoft-365-or-office-365\r\n\r\n\r\nIs this error above related to my website being an https://www.mysite.com ?   If so, is there a way to fix it?  \r\n\r\n\r\n\r\n"}
{"sentences": "Infinite loop inside middleware", "description": "```\r\nimport { NextResponse } from 'next/server'\r\n\r\nexport function middleware(req) {\r\n    if (req.page.name === '/profile') {\r\n        console.log(req.page.name);\r\n        return NextResponse.redirect(new URL('/profile?test=a', req.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n}\r\n```\r\n\r\nThe terminal will print '/profile/' infinitely and Chrome returns ERR_TOO_MANY_REDIRECTS, is this expected behavior when adding search params inside middleware? I couldn't find anything regarding dynamic routes/search params for middleware inside docs, thanks\r\n"}
{"sentences": "Redirecting with Middleware, removing query params", "description": "# The problem\r\nRedirecting from a url with query params to a route without. Next merges the query params from the incoming request and appends them to the redirect url, even if you do not want them to. This was only an issue for us because our client was redirecting old wordpress pages to their new wordpress website and wordpress uses specific query params to query pages, so in order for the redirect to work the query params needed to be gone/blank.\r\n\r\n# The Solution\r\nRe-add the query params yourself and set their values to be nothing i.e. `?post_type=&p=`\r\n\r\n\r\nWe were using a redirect file that had entries in the shape of:\r\n```javascript\r\n// redirects.js\r\nconst redirects = [\r\n  {\r\n    source: '/au/?post_type=pages&p=123456',\r\n    destination: 'https://destination.au.com/new-page-with-slug-only/',\r\n    permanent: true\r\n  },\r\n]\r\n```\r\n\r\nAnd then we were clearing the params with the following\r\n\r\n```javascript\r\n// pages/_middleware.js\r\nimport { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport redirects from '../redirects';\r\n\r\nconst redirectMap = redirects.reduce((map, redirect) => ({\r\n  ...map,\r\n  [redirect.source]: redirect.destination,\r\n}), {});\r\n\r\nexport function middleware(req: NextRequest) {\r\n  const { href, origin, searchParams } = req.nextUrl;\r\n  const redirectKey = href.replace(origin, '');\r\n  const redirect = redirectMap[redirectKey];\r\n\r\n  if (redirect) {\r\n    let params = '';\r\n    searchParams.forEach((_, key) => {\r\n      params = `${params ? `${params}&` : '?'}${key}=`;\r\n    });\r\n    return NextResponse.redirect(`${redirect}${params}`);\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n```"}
{"sentences": "Apply some settings in next.config.js to production build only", "description": "The [Remove Console](https://nextjs.org/docs/advanced-features/compiler#remove-console) transform removes `console.*` from dev browser console, not just in production build.\r\n\r\nIs there any way to apply this transform to production only?\r\n```\r\n// next.config.js\r\nmodule.exports = {\r\n  compiler: {\r\n    removeConsole: true,\r\n  },\r\n}\r\n```\r\n\r\nI used to use `babel-plugin-transform-remove-console` to do this like so...\r\n\r\n`.babelrc`\r\n```\r\n{\r\n  \"presets\": [\"next/babel\"],\r\n  \"env\": {\r\n    \"production\": {\r\n      \"plugins\": [[\"transform-remove-console\", { \"exclude\": [\"error\", \"warn\"] }]] // removes consoles.log from app for production builds\r\n    }\r\n  }\r\n}\r\n```\r\n"}
{"sentences": "Is there a Vercel discussion section elsewhere? .. I got a hosting question...", "description": "So...  I just uploaded new pages to github, which is connected to Vercel....\r\n\r\nHow long does it take to view a change live on the browser?\r\n\r\nI am refreshing my page, clearing cookies, browsing history and stuff... and I can't see the changes...\r\n\r\nI went to Vercel to check the project... seems like it was doing another build just a few seconds ago...\r\n\r\nI see the changes in the localhost3000  but not on the live browser...   and I don't see any build errors. "}
{"sentences": "Shamelessly asking for syntax advice... for href Link using props..", "description": "I want to create a set of button components that would take props and add the href links elsewhere as props...\r\n\r\nWhat would be the correct syntax for it? \r\n\r\nThe component looks like this:\r\n\r\n```\r\nfunction Buttons(props) {\r\n  return (\r\n    <div>\r\n      <div className=\"row\">\r\n        <div className=\"col-md-9\">\r\n          \r\n          <div className=\"col-md-12 centering-btn\">\r\n            <Link href={props.previous}>\r\n              <a\r\n                className=\"btn btn-info d-flex justify-content-center\"\r\n                target=\"blank\"\r\n              >\r\n                Previous\r\n              </a>\r\n            </Link>\r\n            <Link href={props.next}>\r\n              <a\r\n                className=\"btn btn-info d-flex justify-content-center\"\r\n                target=\"blank\"\r\n              >\r\n                Next\r\n              </a>\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Buttons;\r\n```\r\nNotice the props   `<Link href={props.previous}>`\r\n\r\nThen.... to add the props this doesnt seem to work....\r\n```\r\n<Buttons\r\nprevious = \"./blog/previous-post\"\r\nnext =  \"./blog/next-post\"\r\n />\r\n```\r\n\r\nThis doesn't work either...\r\n```\r\n`${./blog/previous-post}`\r\n```\r\n"}
{"sentences": "Script Components insert multiple script tags.", "description": "Hi, I'm using Next.js well, but I've encountered some problems.\r\n\r\nWhen you add a script tag using next/script, multiple identical scripts are inserted.\r\n\r\nAre Script tags affected by rendering?\r\n\r\ne.g\r\n\r\n<img width=\"554\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52775389/173812022-db3217f5-27ef-4697-b4ca-2b42e504448a.png\">\r\n\r\n \r\n```\r\nconst HeadElement: React.FC = () => {\r\n  return (\r\n    <>\r\n      <Head>\r\n          <title>blahblah</title>\r\n      </Head>\r\n      <Script strategy=\"lazyOnload\" {...restProps}>\r\n           {`console.log('hello, world')`}\r\n       </Script>\r\n  );\r\n};\r\n```\r\n\r\nhelp me."}
{"sentences": "How can I create a meta tag template component?", "description": "So I want to create a component for meta tags, that way I don't have to copy, and paste, and delete sections of meta tags for a new page.\r\n\r\nI have some rough ideas doing it using props... but it isnt working fully...\r\n\r\nHere is my sample:\r\nfrom meta-data.js\r\n\r\n```\r\nimport React from \"react\";\r\n\r\nfunction Meta(props) {\r\n  return (\r\n    <div>\r\n      <meta name=\"twitter:description\" content=\"hello test\" />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Meta;\r\n```\r\n^^  this is just a sample of one meta tag without including props in the tag.\r\n\r\nthen go to page:\r\n\r\n```\r\nimport React from \"react\";\r\nimport Image from \"next/image\";\r\nimport Head from \"next/head\";\r\nimport Link from \"next/link\";\r\nimport Meta from \"../../components/meta-data\";\r\nimport Blogger from \"../../components/blog-post\";\r\n\r\nconst TestPost = () => {\r\n  return (\r\n    <div>\r\n      <div>\r\n        <Head>\r\n          <Meta />\r\n        </Head>\r\n      </div>\r\n      <Blogger\r\n        title=\"Hello\"\r\n        body=\"this is the body\"\r\n        description=\"this is description\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TestPost;\r\n```\r\n\r\n^^^  this is a page of a blog test trying to pull the meta tag and put it in the head of the page.....   when I go to the console in local host 3000  I can't see the meta tag.\r\n\r\ngrrr.. why wouldn't I be able to see the tag?....  actually, even the pages that have tags and I see them in the browser I can't find them in the localhost3000..\r\n\r\n....  then the real deal ....  from here `content=\"hello test\" `   I need to implement the props...\r\n\r\nWhat could be a good way to write the props on this?  \r\n\r\n\r\nCould be like this?\r\n\r\n```\r\nfunction Meta(props) {\r\n  return (\r\n    <div>\r\n      <meta name=\"twitter:description\" content={props.twitterdescription} />\r\n    </div>\r\n  );\r\n}\r\n```\r\nAnd then at the page go like this? \r\n\r\n```\r\n<div>\r\n        <Head>\r\n          <Meta twitterdescription=\" This is a description\"/>\r\n        </Head>\r\n      </div>\r\n```\r\n\r\nI can do a try and error and test it, but I can't see the tags on the localhost3000\r\n\r\n\r\n"}
{"sentences": "AssetPrefix is ignored when page having getServersideProps is loaded", "description": "I used asseetPrefix in next.config.js and it works as expected when loading page which is prerendered (no getServersideProps). However, when loading page which is rendered on the server (having  getServersideProps), the page ignores assetPrefix and it loads static files from just **/_next/static/***.\n\nI am figuring out why it happens. Is there anyone who had same experience with me?"}
{"sentences": "Rewrites/Redirects not working after deploying using gh-pages", "description": "Hi All,\r\n\r\nAfter deploying my site using github pages, I noticed that the rewrites/redirects are not working. Everything else is working as expected. I have added the `basePath: process.env.NEXT_PUBLIC_BASE_PATH || '',\r\n  assetPrefix: process.env.NEXT_PUBLIC_BASE_PATH || '',` as well. All the direct links & images are working except for rewrites & redirects. I know that there use to be a limitation where rewrites/redirects only worked in the a Node environment. Is that limitation still there? If anyone can let me know a workaround/solution for this that will be great.\r\n\r\nThanks in advance."}
{"sentences": "Reduce the impact of third-party code - Next js", "description": "How can we handle these script I am already using defer but not seems working\r\n<img width=\"603\" alt=\"Screen Shot 2020-11-01 at 23 21 43\" src=\"https://user-images.githubusercontent.com/4488516/97816923-60878400-1c99-11eb-82c8-a29224988adf.png\">\r\n"}
{"sentences": "Faunadb example update", "description": "I decided to use faunadb for my new project and I had to update + rewrite swr part slightly to use the current versions of technologies. How do I patch the example code on vercel? Should I submit a new example as described in the contributing doc?\r\n\r\n[Code is here](https://github.com/vorcigernix/zitrone/tree/with-faunadb)."}
{"sentences": "is it intentionally NextResponse.rewrite  of middleware not invoke the other nested middlewares?", "description": "Is it intentionally a Next.Js Application that has an middleware a upper level of other when use NextResponse.rewrite not invoke other internally (children folder ) of this previous one called.\r\n\r\nFor ex.\r\n\r\nIf you have an project with the following structure:\r\n\r\npages/_middleware.js -> this return NextResponse.rewrite\r\n\r\nand you are acessing the following route\r\nblog/12/my-awesome-post that will access the following directory:\r\n\r\n```\r\n* pages/\r\n     _middleware.tsx -> inside this middleware has NextResponse.rewrite that will interrupt the invoke of any nested middleware\r\n        index.tsx\r\n        blog/\r\n            index.tsx\r\n            _middleware.ts -> won't be executed\r\n            [id]/\r\n                [slug].tsx\r\n```\r\n\r\n\r\nI'm wondering if is this a correct behavior or is a bug?\r\nThank you in advanced.\r\n\r\n\r\n\r\n"}
{"sentences": "How to do an action on a post request for a form... ?", "description": "This code here:\r\n\r\n```\r\n<form\r\n          action=\"https://formsubmit.co/myemail@myemail.com\"\r\n          method=\"POST\"\r\n          encType=\"multipart/form-data\"\r\n>\r\n```\r\n\r\nIs this the proper way to include this in Next? \r\n\r\nI get the feeling the form isn't sending anything to the website to get the POST... \r\n\r\nGranted I haven't tested the form recently, but I think they still work Ok.... I am just testing it again now in Next\r\n\r\n\r\nFull code here:\r\nhttps://github.com/Elindo586/nextprojectb/blob/main/pages/components/pump-form.js\r\n\r\n"}
{"sentences": "Server Error ReferenceError: window is not defined", "description": "Hi, I'm developing an application in next.js (typescript) that uses powerbi-client-react to render powerbi dashboards in the application.\r\n\r\nIn a simple react application I can do what I want but would like to do it in next.js.\r\n\r\nHere's the error and code:\r\n\r\n```\r\nServer Error\r\nReferenceError: window is not defined\r\n\r\nThis error happened while generating the page. Any console logs will be displayed in the terminal window.\r\nCall Stack\r\nnew WindowPostMessageProxy\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (5959:56)\r\nwpmpFactory\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (8252:12)\r\nnew Service\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (10554:21)\r\nObject../src/powerbi-client.ts\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (8858:15)\r\n__webpack_require__\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (33:30)\r\n<unknown>\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (97:18)\r\n<unknown>\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (100:10)\r\nwebpackUniversalModuleDefinition\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (6:20)\r\nObject.<anonymous>\r\nfile:///C:/Users/user/coding/project/node_modules/powerbi-client/dist/powerbi.js (13:3)\r\nModule._compile\r\nnode:internal/modules/cjs/loader (1101:14)\r\n```\r\n```\r\nimport type { NextPage } from 'next'\r\nimport React, { useState} from 'react'\r\nimport Head from '../components/head'\r\n\r\n\r\nimport dynamic from 'next/dynamic'\r\nimport { EmbedProps } from 'powerbi-client-react';\r\nimport { models } from \"powerbi-client\";\r\n\r\nconst PowerBIEmbed = dynamic<EmbedProps>(() => import('powerbi-client-react').then(m => m.PowerBIEmbed), { ssr: false });\r\n\r\nconst Home: NextPage = () => {\r\n  const reportId = process.env.REACT_APP_REPORT_ID;\r\n\tconst accessToken = process.env.REACT_APP_ACCESS_TOKEN;\r\n\tconst embedUrl = `https://app.powerbi.com/reportEmbed?reportId=${reportId}&groupId=${groupId]`\r\n\tconst [config] = useState<models.IReportEmbedConfiguration>({\r\n\t\ttype: 'report',\r\n\t\tembedUrl: embedUrl,\r\n\t\ttokenType: models.TokenType.Aad,\r\n\t\taccessToken: accessToken,\r\n    \tsettings: {\r\n      \t\tpanes: {\r\n          \t\tfilters: {\r\n              \t\texpanded: false,\r\n              \t\tvisible: false\r\n          \t\t}\r\n      \t\t},\r\n\t\tfilterPaneEnabled: false,\r\n\t\tnavContentPaneEnabled: false,\r\n      \tzoomLevel: 1,\r\n\t\tbackground: 1,\r\n\t\tcustomLayout: {\r\n\t\t\tdisplayOption: models.DisplayOption.FitToWidth\r\n\t\t }\r\n    \t}\r\n\t});\r\n  return (\r\n    <div>\r\n      <Head/>\r\n      <main>\r\n        <div>\r\n        <PowerBIEmbed\r\n\t\t\t\tembedConfig = { config }\r\n\t\t\t\tcssClassName = { \"report-style-class vh-100\"}\r\n\t\t\t/>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Home\r\n\r\n```\r\n"}
{"sentences": "On-Demand Revalidation for new content", "description": "I have a blog and use on-demand revalidation. It works like a charm when modifying an article.\r\nHowever I can't get it to work when I post a new article. The index page show the new article, but the link to the article dosen't work (404) and I always get a 500 error. Does anyone have any hints how to get it to work?\r\n\r\nHere is my code snippet, where Path refers to the edited blog post or the path of the new blog post.\r\n\r\nWhen I post a new article I run validate for index ('/') and once more for the new post slug ('/post/19' for example)\r\n\r\n```ts\r\nimport type { NextApiRequest, NextApiResponse } from \"next\";\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n) {\r\n  const path = req.body.pathToRevalidate\r\n  \r\n  // Check for secret to confirm this is a valid request\r\n  if (req.query.secret !== process.env.REVALIDATE_SECRET) {\r\n    console.log({ message: \"Invalid token\" })\r\n    return res.status(401).json({ message: \"Invalid token\" });\r\n  }\r\n\r\n  try {\r\n    await res.unstable_revalidate(path);\r\n    return res.json({ revalidated: true });\r\n  } catch (err) {\r\n    // If there was an error, Next.js will continue\r\n    // to show the last successfully generated page\r\n    return res.status(500).send(err);\r\n  }\r\n}\r\n\r\n\r\n```"}
{"sentences": "erros during npm run start..", "description": "why would I be getting errors from npm run start? \r\n\r\nI want to check getstaticprops, but i get this error on npm run start \r\n\r\n```\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\nError: Could not find a production build in the 'C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\.next' directory. Try building your app with 'next build' before starting the production server. https://nextjs.org/docs/messages/production-start-no-build-id\r\n    at NextNodeServer.getBuildId (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\server\\next-server.js:137:23)\r\n    at new Server (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\server\\base-server.js:93:29)\r\n    at new NextNodeServer (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\server\\next-server.js:86:9)\r\n    at NextServer.createServer (C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\server\\next.js:109:16)\r\n    at async C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb\\node_modules\\next\\dist\\server\\next.js:121:31\r\nPS C:\\Users\\Edgar\\Desktop\\Stuff\\Acode\\nextprojectb> \r\n```\r\n"}
{"sentences": "Unable to convert example of `useSwr` hook to use `react-query`'s `useMutation` hook?", "description": "I tried changing the `useSwr` hook to use:\r\n\r\n```ts\r\nimport { useMutation } from 'react-query';\r\n\r\nconst { data: user, mutate: mutateUser } = useMutation<User>('/api/user');\r\n```\r\n\r\nBut I get an error stating:\r\n\r\n> No `mutationFn` found\r\n\r\nUnable to solve this. I tried adding `mutationFn` inside `useMutation` like the following & it works but it is static redundant code:\r\n\r\n```ts\r\nconst { data: user, mutate: mutateUser } = useMutation<User>('/api/user', {\r\n    mutationFn: () => {\r\n      const u: User = {\r\n        isLoggedIn: false,\r\n        avatarUrl: '',\r\n        login: '',\r\n      }\r\n      return Promise.resolve(u)\r\n    },\r\n  })\r\n```\r\n\r\nIf I use a dynamic request using something like `axios` then do I need to put the `fetchJson` from `login.tsx` to `mutationFn` hook?\r\n\r\nBasically, I want to use `react-query` instead of `swr` & unable to find a solution?\r\n\r\nMy question is what should i put in `mutationFn` because there is no equivalent of it in `swr` so i'm confused what to actually put in there? Empty function doesn't work.\r\n\r\nI'm pretty sure it's really simple but haven't been able to make it work.\r\n\r\nStackblitz Demo → https://stackblitz.com/edit/next-iron-session-with-react-query?file=lib%2FuseUser.ts (go to `/login` route, enter a github username like `vvo` & click `Login` to see the error in console)\r\n\r\nRepo → https://github.com/deadcoder0904/next-iron-session-with-react-query"}
{"sentences": "running tests: yarn not installed causes test error", "description": "in `.github / actions / next-stats-action/src/prepare/repo-setup.js` : 130 a string likely eval-ed includes a yarn invocation but installing yarn wasn't mentioned in contributing guide explicitly when using pnpm. globally installing yarn fixed the issue.\r\n\r\n<img width=\"1276\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1675992/171707445-a7874d52-aa09-4077-a718-6bcf19abbc8f.png\">\r\n\r\n<img width=\"855\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1675992/171707651-d82884a1-36eb-49e3-8264-c3089c27aa7e.png\">\r\n\r\nThis section could include a call to install yarn globally, or the issue could be remedied by using pnpm or whatever *pm du jour in the eval code above 👆\r\n\r\n![image](https://user-images.githubusercontent.com/1675992/171729420-27e91c58-119b-48d1-a58a-24779ac6a561.png)\r\n\r\n\r\n\r\n"}
{"sentences": "Page data not updating when using router.push(\"/route\")", "description": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in Next.js canary release\r\n\r\n### Provide environment information\r\n\r\nLinux/Ubuntu 20.04\r\n\r\n### What browser are you using? (if relevant)\r\n\r\n_No response_\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\n_No response_\r\n\r\n### Describe the Bug\r\n\r\nAs stated in the doc the getServerSideProps method gets called in these cases\r\n\r\n- When you request this page directly, getServerSideProps runs at request time, and this page will be pre-rendered with the returned props\r\n- When you request this page on client-side page transitions through [next/link](https://nextjs.org/docs/api-reference/next/link) or [next/router](https://nextjs.org/docs/api-reference/next/router), Next.js sends an API request to the server, which runs getServerSideProps.\r\n\r\nBut in my nextjs app it's not working that way. I have a form page to create new data after what I router.push to the data list page. The actual issue is that the data list is not showing the new entry. Why is that ? I even tried using router.replace(router.asPath) in the component I'm routing to but same thing. I'm wondering if the fact that I'm using next-pwa is the reason to this. Maybe the last request is cached or some stuff like that. Just wanna understand \r\n\r\n### Expected Behavior\r\n\r\nGetServerSideProps should be called when I'm on the data list page and new added entry should show up automatically\r\n\r\n### To Reproduce\r\n\r\nI will soon provide a way to reproduce this issue. "}
{"sentences": "Difference between yarn and pnpm for developing with local version of Next.js", "description": "In the instruction for [developing with local version of Next.js](https://github.com/vercel/next.js/blob/canary/contributing.md#developing-with-your-local-version-of-nextjs), both `yarn` and `pnpm` are used. The former is for installing dependencies, and the latter is for updating dependencies after one makes changes to local Next.js.\r\n\r\n Why are there two package managers in this case and what are the differences between then?"}
{"sentences": "error - ./node_modules/next/dist/build/webpack/loaders/css-loader/src/index.js??ruleSet[1].rules[2].oneOf[8].use[1]!./node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js??ruleSet[1].rules[2].oneOf[8].use[2]!./src/styles/index.css Error: Unexpected '/'. Escaping special characters with \\ may help.", "description": "i was using tailwind v2 on an old project & now i switched to using tailwind v3 & it's throwing errors. it was working fine before i updated my deps.\r\n\r\nthe error is:\r\n\r\n> error - ./node_modules/next/dist/build/webpack/loaders/css-loader/src/index.js??ruleSet[1].rules[2].oneOf[8].use[1]!./node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js??ruleSet[1].rules[2].oneOf[8].use[2]!./src/styles/index.css\r\nError: Unexpected '/'. Escaping special characters with \\ may help.\r\n\r\nit looks like the error is pointing out to comments in my css files.\r\n\r\n### styles/index.css\r\n\r\n```css\r\n@import 'tailwindcss/base';\r\n\r\n@import './nprogress.css';\r\n@import './base.css';\r\n@import './scrollbar.css';\r\n@import './fast-image-zoom.css';\r\n@import './grid.css';\r\n@import './anchor.css';\r\n@import './prism.css';\r\n@import './gif.css';\r\n@import './giscus.css';\r\n\r\n@import 'tailwindcss/components';\r\n@import 'tailwindcss/utilities';\r\n```\r\n\r\n the root file has no comments but i have comments in other files.\r\n\r\n### styles/giscus.css\r\n\r\n```css\r\n// style loading comments indicator in giscus\r\n.gsc-comments-count {\r\n\t@apply text-gray-900 dark:text-white mt-10;\r\n}\r\n```\r\n\r\n### styles/nprogress.css\r\n\r\n```css\r\n#nprogress {\r\n\t@apply pointer-events-none;\r\n\r\n\t& .bar {\r\n\t\t@apply bg-white h-[2px];\r\n\r\n\t\t/* Fancy blur effect */\r\n\t\t& > .peg {\r\n\t\t\tbox-shadow: 0 0 20px rebeccapurple, 0 0 15px rebeccapurple;\r\n\t\t\t@apply block absolute right-0 w-[140px] h-full opacity-100 rotate-3 translate-x-0 -translate-y-1;\r\n\t\t}\r\n\t}\r\n\r\n\t& > .spinner > .spinner-icon {\r\n\t\t@apply border-l-gray-300 border-t-gray-800;\r\n\t}\r\n}\r\n```\r\n\r\nit also looks like `postcss-loader` & `css-loader` issue & i'm not sure how to solve it?\r\n\r\nhere are some additional files:\r\n\r\n### postcss.config.js\r\n\r\n```js\r\nmodule.exports = {\r\n\tplugins: [\r\n\t\t'postcss-import',\r\n\t\t'postcss-flexbugs-fixes',\r\n\t\t'postcss-nested',\r\n\t\t'postcss-custom-properties',\r\n\t\t'tailwindcss',\r\n\t\t'autoprefixer',\r\n\t],\r\n}\r\n```\r\n\r\n### next.config.js\r\n\r\n```js\r\nconst bundleAnalyzer = require('@next/bundle-analyzer')\r\n\r\nconst withBundleAnalyzer = bundleAnalyzer({\r\n\tenabled: process.env.ANALYZE === 'true',\r\n})\r\n\r\nconst nextConfig = {\r\n\texperimental: {\r\n\t\tesmExternals: true,\r\n\t},\r\n\twebpack: (config, options) => {\r\n\t\tconfig.module.rules.push({\r\n\t\t\ttest: /\\.svg$/,\r\n\t\t\tuse: ['@svgr/webpack', 'url-loader'],\r\n\t\t})\r\n\t\t\r\n\t\tif (!options.isServer) {\r\n\t\t\tconfig.resolve.fallback.fs = false\r\n\t\t}\r\n\r\n\t\treturn config\r\n\t},\r\n}\r\n\r\nmodule.exports = withBundleAnalyzer(nextConfig)\r\n```\r\n\r\nhow do i solve it? i just can't get it to run :("}
{"sentences": "Rewrite to external URL with subdomain redirects url", "description": "Hi all,\r\n\r\nI'm trying to add rewrite rules to my application to support incremental adoption of nextjs.\r\n\r\nWith my nextjs application hosted at `localhost:3000`, I would like /about-us to route to `BLOG_URL/about-us`, but have the url remain at `localhost:3000/about-us`. Based on the documentation I would expect that is what would happen, but the url changes to `BLOG_URL/about-us`. The expected behavior (re-writing url rather than redirect) works for my first rule where `localhost:3000/` shows the content of `BLOG_URL` but the url remains `localhost:3000/`.\r\n\r\nIs this expected behavior? Thank you!\r\n\r\n```\r\nconst nextConfig = {\r\n  reactStrictMode: true,\r\n  experimental: {\r\n    outputStandalone: true,\r\n  },\r\n  distDir: \"build\",\r\n  async rewrites() {\r\n    return {\r\n      beforeFiles: [\r\n        {\r\n          source: \"/\",\r\n          destination:`${BLOG_URL}`,\r\n        },\r\n        {\r\n          source: \"/about-us\",\r\n          destination:`${BLOG_URL}/about-us`,\r\n        },\r\n        {\r\n          source: \"/search\",\r\n          destination: \"/\",\r\n        },\r\n      ],\r\n      afterFiles: [\r\n        {\r\n          source: \"/sitemap/:path*\",\r\n          destination: \"/sitemap.xml\",\r\n        },\r\n      ],\r\n    };\r\n  },\r\n};\r\n```\r\n"}
{"sentences": "getServersideProps first page load only", "description": "Is there a getServersideProps for SSRing the first page load only (not client transitions)?\r\n\r\nI want to load some basic data for my webpage on the first request, but after that treat it as a SPA which does not need to hit the server for routing. The issue is having getServersideProps on every route (to SSR the first page load, and avoid an extra round trip for some basic initial required data) causes a full server round trip on every navigation.\r\n\r\nI've seen that a custom Document's getInitialProps may behave like this, but that seems hacky (plus the docs say to avoid using it to prepare for React 18)."}
{"sentences": "I cannot access response data if i send any statusCode other than 200", "description": "### Verify canary release\n\n- [X] I verified that the issue exists in Next.js canary release\n\n### Provide environment information\n\n\r\n    Operating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 21.3.0: Wed Jan  5 21:37:58 PST 2022; root:xnu-8019.80.24~20/RELEASE_ARM64_T8101\r\n    Binaries:\r\n      Node: 16.15.0\r\n      npm: 8.8.0\r\n      Yarn: 1.22.10\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 12.1.6\r\n      react: 18.1.0\r\n      react-dom: 17.0.2\n\n### What browser are you using? (if relevant)\n\nChrome\n\n### How are you deploying your application? (if relevant)\n\nVercel\n\n### Describe the Bug\n\nI try to send the appropriate response status code when sending response data from the api routes  but it fails to display response data unless its a 200 status code\r\n\r\n\n\n### Expected Behavior\n\ni expect i do not have to send a 200 status code for every response\n\n### To Reproduce\n\nWhenever i send a response like below i cant seem to access the response data to display the custom error message i specified, i hope i am not doing something wrong \r\n\r\n```js\r\n return res.status(400).json({\r\n    status: \"success\",\r\n    msg: \"error\",\r\n  });\r\n};\r\n````\r\ni only get a request failed log in the console\r\n\r\nbut with \r\n```js\r\nreturn res.status(200).json({\r\n    status: \"success\",\r\n    msg: \"error\",\r\n  });\r\n};\r\n```\r\n\r\ni can easily access the response data and access the custom error message \r\ni need guidance \r\nthanks"}
{"sentences": "ISR on demand how to avoid multiple calls to API in getStaticPaths during revalidation", "description": "Hello everyone,\r\n\r\nI would like to create endpoint to revalidate pages in bulk, something like:\r\n![Screenshot 2022-05-18 at 15 15 38](https://user-images.githubusercontent.com/5172081/169047666-3ab0bb02-148b-4e54-ae59-ff0df4a7e698.png)\r\n\r\nMy problem is that in getStaticPaths I need to do API call to generate unique paths URLs that contains ID:\r\n![Screenshot 2022-05-18 at 15 16 10](https://user-images.githubusercontent.com/5172081/169047697-e565498e-bb62-455c-bf66-f7dfbaf645fe.png)\r\n\r\nAnd now when I fire \"unstable_revalidate\" it triggers \"getStaticPaths\" that is doing API call. When I will revalidate 10k elements it will perform 10k unwanted API calls. Do you maybe have any idea how to overcome this scenario?"}
{"sentences": "How to fetch more than 20 posts? I'm using Prismic GraphQL API", "description": "Hi, I've been searching all the forums, answers and tried almost everything. I'm a newbie coder. I linked my NextJS site with Prismic CMS, however I could only fetch a maximum of 20 posts from Prismic.\r\n\r\nHere's the official guide but don't know how to apply to my code:\r\nhttps://prismic.io/docs/graphql/query-the-api/query-the-graphql-api\r\n\r\nHere's my code in `api.js`:\r\n```\r\nimport Prismic from 'prismic-javascript';\r\n\r\nconst REPOSITORY = process.env.PRISMIC_REPOSITORY_NAME\r\nconst REF_API_URL = `https://${REPOSITORY}.prismic.io/api/v2`\r\nconst GRAPHQL_API_URL = `https://${REPOSITORY}.prismic.io/graphql`\r\nexport const API_TOKEN = process.env.PRISMIC_API_TOKEN\r\nexport const API_LOCALE = process.env.PRISMIC_REPOSITORY_LOCALE\r\nexport const PrismicClient = Prismic.client(REF_API_URL, { accessToken: API_TOKEN });\r\n\r\nasync function fetchAPI(query, { previewData, variables} = {}) {\r\n  \r\n  const prismicAPI = await PrismicClient.getApi()\r\n\r\n  const res = await fetch(\r\n    `${GRAPHQL_API_URL}?query=${query}&variables=${JSON.stringify(variables)}`,\r\n    {\r\n      headers: {\r\n        'Prismic-Ref': previewData?.ref || prismicAPI.masterRef.ref,\r\n        'Content-Type': 'application/json',\r\n        'Accept-Language': API_LOCALE,\r\n        Authorization: `Token ${API_TOKEN}`,\r\n      }\r\n    }\r\n  )\r\n\r\n  if (res.status !== 200) {\r\n    console.log(await res.text())\r\n    throw new Error('Failed to fetch API')\r\n  }\r\n\r\n  const json = await res.json()\r\n  if (json.errors) {\r\n    console.error(json.errors)\r\n    throw new Error('Failed to fetch API')\r\n  }\r\n  return json.data\r\n}\r\n\r\nexport async function getAllProfilesWithSlug() {\r\n  const data = await fetchAPI(`\r\n    {\r\n      allMaker_profiles(first:24 sortBy:meta_firstPublicationDate_ASC) {\r\n        pageInfo{\r\n          hasPreviousPage\r\n          hasNextPage\r\n          startCursor\r\n          endCursor\r\n        }    \r\n        edges {\r\n          node {\r\n            _meta {\r\n              uid\r\n            }\r\n          }\r\n          cursor\r\n        }\r\n      }\r\n    }\r\n  `)\r\n  return data?.allMakerProfiles?.edges\r\n}\r\n\r\nexport async function getAllProfilesForHome(previewData) {\r\n  const data = await fetchAPI(\r\n    `\r\n    query {\r\n      allMaker_profiles(first:24 sortBy:meta_firstPublicationDate_ASC) {\r\n        pageInfo{\r\n          hasPreviousPage\r\n          hasNextPage\r\n          startCursor\r\n          endCursor\r\n        }    \r\n        edges {\r\n          node {\r\n            image\r\n            name\r\n            location\r\n            biography\r\n            tag\r\n            expertise1\r\n            expertise2\r\n            expertise3\r\n            expertise4\r\n            expertise5\r\n            website\r\n            instagram\r\n            twitter\r\n            linkedin\r\n            website2\r\n            _meta {\r\n              uid\r\n            }\r\n          }\r\n          cursor\r\n        }\r\n      }\r\n    }\r\n  `,\r\n    { previewData }\r\n  )\r\n\r\n  return data.allMaker_profiles.edges\r\n}\r\n```\r\n\r\nAppreciate any help or pointers on this! Sorry it's my first time posting a question here! Hope I provided the necessary info here."}
{"sentences": "__dirname pointing to `/` (during dev)", "description": "I'm trying to port some code to Next, and I'd say I was pretty familiar with how everything works, but this has stumped me (and there doesn't seem to be a mention in these discussions) - so:\r\n\r\nDuring dev, `__dirname` is pointing to `/` - when my project, let alone the actual directory, is much deeper than that (more like `/Users/remy/dev/myapp/lib/emails/`).\r\n\r\nI'm trying to send emails from an API route, and I load the HTML templates from files in the `__dirname` directory (which worked when I was running this under Express). But running from an `/api/get-token` route (which sends an email), the directory name isn't right so I can't load up the static files to send the emails.\r\n\r\nAny ideas - or alternative suggestions?"}
{"sentences": "Runtime configs in nextjs", "description": "Hi, I'm trying to setup my nextjs app to use runtime configurations. Basically, I have an endpoint url that needs to be available trough docker env vars.\r\nI configured following these docs  but it isn't working. My app still using default values from .env file. Could anyone help to understand what I missed or did wrong? \r\nThanks!\r\n\r\ndocs:\r\nhttps://nextjs.org/docs/api-reference/next.config.js/runtime-configuration\r\nhttps://nextjs.org/docs/advanced-features/custom-app\r\n\r\nsteps:\r\n1- added to my next.config.js\r\n```js\r\npublicRuntimeConfig: {\r\n  NEXT_PUBLIC_BACKEND_HOST: process.env.NEXT_PUBLIC_BACKEND_HOST,\r\n},\r\n```\r\n2- retrieved config in my pages\r\n```js\r\nconst { publicRuntimeConfig } = getConfig()\r\nconst baseURL = publicRuntimeConfig.NEXT_PUBLIC_BACKEND_HOST\r\n```\r\n3- created a custom app to setup getInitialProps\r\n> Runtime configuration won't be available to any page (or component in a page) without getInitialProps.\r\n```js\r\nimport App from 'next/app'\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  return <Component {...pageProps} />\r\n}\r\nMyApp.getInitialProps = async (appContext) => {\r\n  const appProps = await App.getInitialProps(appContext);\r\n  return { ...appProps }\r\n}\r\nexport default MyApp\r\n```"}
{"sentences": "Build fails, can't resolve 'fs', and then property of 'then' of undefined", "description": "I started getting this error message\r\n```\r\n\r\n19:16:43.922 | $ next build\r\n-- | --\r\n19:16:44.611 | info  - Creating an optimized production build...\r\n19:16:44.623 | Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n19:16:44.623 | This information is used to shape Next.js' roadmap and prioritize features.\r\n19:16:44.623 | You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n19:16:44.624 | https://nextjs.org/telemetry\r\n19:16:48.559 | Failed to compile.\r\n19:16:48.560 | ModuleNotFoundError: Module not found: Error: Can't resolve 'fs' in '/vercel/workpath0/node_modules/dotenv/lib'\r\n19:16:48.560 | > Build error occurred\r\n19:16:48.561 | Error: > Build failed because of webpack errors\r\n19:16:48.561 | at build (/vercel/workpath0/node_modules/next/dist/build/index.js:15:918)\r\n19:16:48.561 | at runMicrotasks (<anonymous>)\r\n19:16:48.561 | at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n19:16:48.580 | error Command failed with exit code 1.\r\n19:16:48.580 | info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n19:16:48.594 | Error: Command \"yarn run build\" exited with 1\r\n19:16:50.699 | Done with \"package.json\"\r\n\r\n```\r\n\r\nAfter looking online, I added `next.config.js` file with fs: 'empty':\r\n```\r\nmodule.exports = {\r\n  webpack: (config, options) => {\r\n    config.node = {\r\n      fs: 'empty',\r\n    };\r\n  },\r\n};\r\n\r\n```\r\n\r\nThis didn't solve the problem for me, I received this error message:\r\n```\r\n\r\n19:20:12.509 | $ next build\r\n-- | --\r\n19:20:13.197 | info  - Creating an optimized production build...\r\n19:20:13.221 | Attention: Next.js now collects completely anonymous telemetry regarding usage.\r\n19:20:13.221 | This information is used to shape Next.js' roadmap and prioritize features.\r\n19:20:13.221 | You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\n19:20:13.221 | https://nextjs.org/telemetry\r\n19:20:13.422 | > Build error occurred\r\n19:20:13.423 | TypeError: Cannot read property 'then' of undefined\r\n19:20:13.423 | at getBaseWebpackConfig (/vercel/workpath0/node_modules/next/dist/build/webpack-config.js:134:618)\r\n19:20:13.423 | at async Promise.all (index 0)\r\n19:20:13.423 | at async build (/vercel/workpath0/node_modules/next/dist/build/index.js:11:102)\r\n19:20:13.440 | error Command failed with exit code 1.\r\n19:20:13.440 | info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n19:20:13.452 | Error: Command \"yarn run build\" exited with 1\r\n19:20:15.464 | Done with \"package.json\"\r\n\r\n```\r\n\r\nI'm not sure how to fix this."}
{"sentences": "Couldn't load texture with Three.js", "description": "### What example does this report relate to?\n\nwith-three-js\n\n### What version of Next.js are you using?\n\n12.0.9\n\n### What version of Node.js are you using?\n\n16.13.2\n\n### What browser are you using?\n\nFirefox\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\nnext start\n\n### Describe the Bug\n\nWhen trying to load a GLB model, containing a jpg image, the image is not showing\r\n\r\nError on the console:\r\nTHREE.GLTFLoader: Couldn't load texture blob:http://localhost:3000/b13bda71-c4d2-4b80-ae74-ff05408a400b\n\n### Expected Behavior\n\nThe image to appear\n\n### To Reproduce\n\nusing https://github.com/vercel/next.js/tree/canary/examples/with-three-js as codebase load a model with a jpg image inside"}
{"sentences": "Passing props to Layout", "description": "I was playing around and making a Dashboard and so I decided to share layout between the multiple pages my dashboard has. I need to pass some props to my layout, but I can't get my way to passing any prop from the page to the getLayout function. \r\n\r\nGoal is to pass to DashboardLayout several props whose's state and data come from the page itself: `loading` - which is provided to the page by an auth middleware; `session` - an object with the session data; `store` - the returning value from swr.\r\n\r\n```js\r\n\r\nconst Dashboard = ({loading}) => {\r\n\tconst { data: session } = useSession();\r\n\r\n\tconst { data, error, mutate } = useSWR(\r\n\t\tloading ? null : `/api/stores/${session.user.store}?type=id`,\r\n\t\tget\r\n\t);\r\n\r\n\treturn <>a</>;\r\n};\r\n\r\nDashboard.auth = {\r\n\tloading: <Dashboard loading={true} />,\r\n};\r\n\r\nDashboard.getLayout = function getLayout(page: any) {\r\n\r\n\treturn <DashboardLayout theme={theme}>{page}</DashboardLayout>;\r\n};\r\n```\r\n"}
{"sentences": "Jquery with next js", "description": "I try to use jquery it is my assets javascript file (It only works when I edit the script at that moment and as if it wasn't being read the other times)\r\nCode:\r\n```js\r\n$('.sidebarCollapse').on('click', function () {\r\n\t//my code\r\n});"}
{"sentences": "create-next-app --example on GitHub Enterprise", "description": "My company is pivoting from create-react-app to Next.\r\n\r\nI want to craft and distribute examples/templates for my users (some 1000 apps+ historically), and am looking into [generation via example](https://nextjs.org/docs/api-reference/create-next-app#options) or having to implement some sort of repo/artifact clone system.\r\n\r\nI'd love to use `create-next-app --example https://git.onpremise.company.com/standards/next-app` but it seems like public github retrieval is hard-coded ([here, and elsewhere in the file](https://github.com/vercel/next.js/blob/812860e2db4be2b8d3313963de17b3a2904a81a9/packages/create-next-app/helpers/examples.ts#L77)).\r\n\r\nIs there some way to support generation time templating, or do most folks make boilerplate we are expecting users to clone and replace values within? (SWC lockfile woes start to worry me)."}
{"sentences": "TypeScript: Cannot find module '@graphql-types@' in 'with-typescript-graphql'-example", "description": "I just cloned the example `with-typescript-graphql` ([examples/with-typescript-graphql/](https://github.com/vercel/next.js/tree/canary/examples/with-typescript-graphql)) to experiment with it and found out that in the file [lib/resolvers.ts](https://github.com/vercel/next.js/blob/9e53af8e30f200902f675415e19d0a6a588e301e/examples/with-typescript-graphql/lib/resolvers.ts) in the first line a module `@graphql-types@` is being imported. \r\n\r\n```\r\nimport { QueryResolvers, MutationResolvers } from '@graphql-types@'\r\n```\r\n\r\nI - and TypeScript also - cannot find the module in node-modules and also not on npm or somewhere else. It's not even added as a dependency in package.json. Typescript says\r\n\r\n```\r\nCannot find module '@graphql-types@' or its corresponding type declarations.ts(2307)\r\n```\r\n\r\nWhat's up with that module? What is it? Where is it from?"}
{"sentences": "Source code for next.js/commerce", "description": "Does anyone have the source code for the aesthetically pleasing [commerce landing page](https://nextjs.org/commerce)? Loving the scroll animation!"}
{"sentences": "zsh: killed     npx next dev", "description": "![image](https://user-images.githubusercontent.com/83243777/166134469-4fefecfa-a6cb-49e7-bc71-0cf591280808.png)\r\n\r\n\r\nDoes anyone have any idea for why I am getting this error? This did not seem to be a case yesterday, and I haven't touched my code since. This error is also isolated to this project only, as it does not happen with other projects.\r\n\r\nI'm quite confused because I couldn't find anything on Stack Overflow that could help..."}
{"sentences": "node:events:368 - unhandled error - M1 Max MacBook", "description": "Hi,\r\n\r\nFor a little while now I have been having this issue when running `yarn dev` on an existing nextJS project.\r\n\r\n```\r\ninfo  - Using external babel configuration from /Users/chris/workspace/XXX/XXX/babel.config.js\r\nnode:events:368\r\n      throw er; // Unhandled 'error' event\r\n      ^\r\n\r\nError: read ECONNRESET\r\n    at TLSWrap.onStreamRead (node:internal/stream_base_commons:211:20)\r\nEmitted 'error' event on ClientRequest instance at:\r\n    at TLSSocket.socketErrorListener (node:_http_client:447:9)\r\n    at TLSSocket.emit (node:events:390:28)\r\n    at TLSSocket.emit (node:domain:475:12)\r\n    at emitErrorNT (node:internal/streams/destroy:164:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:129:3)\r\n    at processTicksAndRejections (node:internal/process/task_queues:83:21) {\r\n  errno: -54,\r\n  code: 'ECONNRESET',\r\n  syscall: 'read'\r\n}\r\n\r\nNode.js v17.2.0\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n```\r\n\r\nI have tried running this project across multiple versions of node. And nearly always face the same issue.\r\n\r\nI cannot share the project as it is private. However other colleges not running on Apple Silicon are not having this issue."}
{"sentences": "Inline script to inject in head tag but built with webpack", "description": "Hey there 👋🏼 \r\n\r\nI'd like to inject a handmade script in the head tag. So far so good. However, I'd like to write that script in a file using imports and other JS features. So that would require the file to be processed by Webpack.\r\nAlso, I would like to inline the script into the head tag, and not link it with the `src` attribute, for performance purposes.\r\nI'm not too sure how to achieve this, and possibly have it integrated as straightforward as possible \r\nWorking on a relatively high traffic app, I would consider this to be a common procedure, so I am hopeful about the feasibility using NextJS. \r\n\r\nAny ideas I could be suggested to achieve this?\r\nAll help is welcome"}
{"sentences": "Run next js Laning page and view its source code", "description": "Hello,\r\nI have cloned the [next js repo](https://github.com/vercel/next.js)\r\nI have gone through the code base and I can not seem to find the source code for the [Next js landing page](https://nextjs.org)\r\nDoes this repo contain the landing page? \r\nIf yes? How can I access it on localhost after installing dependencies and running the project?"}
{"sentences": "Can I use a custom --example application?", "description": "Hi,\r\n\r\nCan I use a custom nextjs application as a template when calling `npx create-next-app --example` ?\r\n\r\nI would like create my own create-react-app, host it on GitHub, then do something like \r\n\r\nnpx create-next-app --example[my-url]\r\n\r\nI tried and doesn't work/. I get no-match found.\r\n\r\nI both tried..\r\n- npx create-next-app --example[nextjs-template-playground][https://github.com/Vanals/nextjs-template-playground]\r\n- npx create-next-app --example[https://github.com/Vanals/nextjs-template-playground]\r\n\r\nthank you!\r\n\r\n"}
{"sentences": "Module not found: Can't resolve 'fs'  even using in getStaticPaths and getStaticProps", "description": "```\r\nimport {\r\n  getAllMoviesTitles,\r\n  getMovieData,\r\n getVideoDownloadLink\r\n} from \"../../lib/movies\";\r\nimport Head from \"next/head\";\r\nimport Player from \"../../components/Player\";\r\nimport Navbar from \"../../components/Navbar\";\r\nimport cn from \"classnames\";\r\nimport Link from \"next/link\";\r\n\r\nexport async function getStaticPaths() {\r\n  const paths = getAllMoviesTitles();\r\n  return {\r\n    paths,\r\n    fallback: false,\r\n  };\r\n}\r\n\r\nexport async function getStaticProps({ params }) {\r\n  const movieData = await getMovieData(params.title);\r\n  return {\r\n    props: {\r\n      movieData,\r\n    },\r\n  };\r\n}\r\nconst Theater = ({ movieData }) => {\r\n  return (\r\n    <>\r\n      ...\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Theater;\r\n\r\n```\r\n\r\n../lib/movies.js has fs imported at the top of the file but as I understand if it's in getStaticProps, this should work just fine. Any idea what did I do wrong?"}
{"sentences": "Huge file size differences between production server and static html export", "description": "I'm currently trying to create a static html export by running `next build && next export` to move all files to AWS S3 and serve via CloudFront. It works fine, but somehow the exported file sizes are huge compared to those served by the production server (`next start`). \r\n\r\nFor example `/_next/static/chunks/pages/_app-85ca738d5bdbca13.js` size on the production server is about 170kb, but 720kb after `next export`. How so? I don't get where the difference is coming from, since both files are pretty much identical. "}
{"sentences": "Can Nextjs on-demand revalidation work with aws or any other provider instead of vercel?", "description": "I was watching [this](https://www.youtube.com/watch?v=mMHssutD9mU&ab_channel=codedamn ) video by codedamn. There he said this feature is only for project deployed in vercel. It does not provide netlify, aws, etc.\r\n\r\nIs this true?"}
{"sentences": "Why does on demand ISR only works when passing a specific route to res.unstable_revalidate?", "description": "I've seen the documentations, the oficial videos from Vercel and sometimes, on the revalidate API they call `res.unstable_revalidate('/')` with just a slah (presumably to revalidate the whole application) and sometimes they call with it passing a specific page (to revalidate only that page).\r\n\r\nIn my tests passing just slash is not working and I have no idea why. How could I debug this?\r\n\r\nBelow I have a page which prints a new Date() and only gets updated when I call one of two buttons 'revalidate' or 'revalidate specific'. Only 'revalidate specific works'\r\n\r\napi/revalidate.ts\r\n\r\n    export default async function handler(req: any, res: any): Promise<any> {\r\n      // Check for secret to confirm this is a valid request\r\n      //   if (req.query.secret !== process.env.MY_SECRET_TOKEN) {\r\n      //     return res.status(401).json({ message: 'Invalid token' });\r\n      //   }\r\n    \r\n      const { page } = req.body;\r\n    \r\n      if (page && !page.match(/^\\/.*$/)) {\r\n        return res.status(400).json({ message: 'Invalid URL' });\r\n      }\r\n    \r\n      try {\r\n        if (page) {\r\n          console.info(`[Next.js] Revalidating ${page}`);\r\n          await res.unstable_revalidate(page);\r\n        } else {\r\n          console.info('[Next.js] Revalidating /');\r\n          await res.unstable_revalidate('/');\r\n        }\r\n        return res.json({ revalidated: true });\r\n      } catch (err) {\r\n        // If there was an error, Next.js will continue\r\n        // to show the last successfully generated page\r\n        return res.status(500).send('Error revalidating');\r\n      }\r\n    }\r\n\r\nsrc/pages/myPage.tsx\r\n\r\n    /* eslint-disable react/button-has-type */\r\n    /* eslint-disable @typescript-eslint/explicit-module-boundary-types */\r\n    export function getStaticProps() {\r\n      return {\r\n        props: {\r\n          time: new Date().toISOString(),\r\n        },\r\n        revalidate: 60,\r\n      };\r\n    }\r\n    \r\n    export default function Home({ time }: { time: any }) {\r\n      function revalidate() {\r\n        fetch('api/revalidate');\r\n      }\r\n    \r\n      function revalidateSpecific() {\r\n        fetch('api/revalidate', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify({ page: '/myPage' }),\r\n        });\r\n      }\r\n    \r\n      return (\r\n        <h1>\r\n          <div>{time}</div>\r\n          <div>\r\n            <button\r\n              style={{ border: '1px solid black', backgroundColor: 'transparent' }}\r\n              onClick={() => revalidate()}\r\n            >\r\n              Revalidate\r\n            </button>\r\n          </div>\r\n          <div>\r\n            <button\r\n              style={{ border: '1px solid black', backgroundColor: 'transparent' }}\r\n              onClick={() => revalidateSpecific()}\r\n            >\r\n              Revalidate specific page\r\n            </button>\r\n          </div>\r\n        </h1>\r\n      );\r\n    }\r\n\r\n"}
{"sentences": "How can i load sass variable from JSON ?", "description": "There are few packages out there who claim to compile **JSON** into sass variable , but everyone depends on node-sass. That's not good i don't wanna use previous node sass and next-sass . I wanna use the new built in sass module using dart-sass. Please help me out here, is there any package or next config can we do to make this possible ?"}
{"sentences": "Next Build giving error", "description": "**I am just working on a simple note app in nextjs so I built a simple dashboard**\r\n\r\nThe dashboard.js:\r\n```js\r\nimport React, {useState, useEffect} from \"react\";\r\nimport {useRouter} from \"next/router\";\r\nimport Head from \"next/head\";\r\nimport {TextInput , Label} from \"flowbite-react\";\r\n\r\nexport default function Dashboard({ user, showAlert }) {\r\n\r\n  useEffect(()=>{\r\n   if(!localStorage.getItem(\"token\")){\r\n    router.push(\"/login\")\r\n    showAlert(\"You are not authenticated\", \"error\")\r\n     }\r\n   \r\n  })\r\n\r\n  return (\r\n  <div className=\"bg-white dark:bg-slate-800\">\r\n    <Head> \r\n       <title>{user.name}'s Dashboard - ONoteBook</title>\r\n \r\n       <meta name=\"description\" content=\"A dashboard to control your account.\" />\r\n\r\n       <link rel=\"icon\" href=\"/favicon.png\" />\r\n      \r\n   </Head>\r\n \r\n    <form className=\"flex flex-col gap-4 px-3 justify-center align-center py-8\">\r\n       <h2 className=\"text-black text-center dark:text-white font-bold text-2xl underline\">Your Account Details</h2>\r\n  <div>\r\n    <Label\r\n      className=\"mb-2 block\"\r\n    >\r\n      Your User Id\r\n    </Label>\r\n    <TextInput\r\n      value={user._id}\r\n      disabled={true}\r\n    />\r\n  </div>\r\n  <div>\r\n    <Label\r\n      className=\"mb-2 block\"\r\n    >\r\n      Your Name\r\n    </Label>\r\n    <TextInput\r\n      value={user.name}\r\n      disabled={true}\r\n    />\r\n  </div>\r\n  <div>\r\n    <Label\r\n      className=\"mb-2 block\"\r\n    >\r\n      Your Email\r\n    </Label>\r\n    <TextInput\r\n      value={user.email}\r\n      disabled={true}\r\n    />\r\n  </div>\r\n   <div>\r\n    <Label\r\n      className=\"mb-2 block\"\r\n    >\r\n      Account Created at\r\n    </Label>\r\n    <TextInput\r\n      value={user.date}\r\n      disabled={true}\r\n    />\r\n  </div>   \r\n</form>\r\n   </div>\r\n  \r\n)\r\n}\r\n```\r\n\r\nBut `next build` giving me an error `cannot reading properties of null reading name`"}
{"sentences": "`ReferenceError: performance is not defined` when deploying to Vercel", "description": "Hey Vercel team,\r\n\r\nSorry to bother you but I'm stuck on a really strange issue. In my Next.js app I'm using `@tanstack/react-table` version `8.0.0-alpha.26`. It works fine in local dev mode (`yarn dev`) and builds work fine when I generate them via `yarn build`, but when deploying to Vercel the builds on Vercel fail with:\r\n\r\n```\r\nReferenceError: performance is not defined\r\n--\r\n23:27:09.806 | at Object.getHeaderGroups (/vercel/path0/node_modules/@tanstack/table-core/build/cjs/utils.js:64:33)\r\n23:27:09.807 | at DataTable (/vercel/path0/.next/server/pages/reports.js:749:37)\r\n23:27:09.807 | at Hc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:64:191)\r\n23:27:09.807 | at Kc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:66:253)\r\n23:27:09.807 | at Z (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:71:89)\r\n23:27:09.808 | at Lc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:73:98)\r\n23:27:09.808 | at Nc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:72:306)\r\n23:27:09.808 | at Z (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:71:217)\r\n23:27:09.811 | at Lc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:73:98)\r\n23:27:09.811 | at Kc (/vercel/path0/node_modules/react-dom/cjs/react-dom-server.browser.production.min.js:67:131)\r\n```\r\n\r\nI can't figure out why this would be the case. The code on that line should not be getting executed at all. And I don't get why `yarn build` works on my machine but not on Vercel.\r\n\r\nI tracked it down to the fact that my local environment is using a different version of Node. Node 16+ supports the `performance` API but Node 14 doesn't. This is probably what causes things to break in Vercel. Is there any way to get around this? Can I force Vercel to use Node 16?\r\n\r\nI also logged this issue with `react-table` [here](https://github.com/TanStack/react-table/issues/3830#issuecomment-1101012448)."}
{"sentences": "Unable to deploy next.js site with absolute imports using jsconfig.json", "description": "I'm not able to deploy after I converted all the relative imports to absolute imports using a jsconfig.json file in the root. The same project is building successfully on localhost but on deploying it to vercel (via github) it throws `module not found` error.\r\n\r\nEarlier the deployments were successful using relative imports. And this weird problem is with this given project only. I've two other next.js websites where I am using absolute imports with same configuration and project structure and they are working fine.\r\n\r\nI've tried deleting my GitHub repo and recreating it and resetting the project on vercel.com but nothing works! :(\r\n\r\n![image](https://user-images.githubusercontent.com/12250556/163444232-18084bf5-3e83-4698-99e6-09b00f8ed281.png)\r\n\r\n\r\nMy project folder structure -- \r\n![image](https://user-images.githubusercontent.com/12250556/163444600-4d447285-26a6-4a15-a33b-85b2b8917da5.png)\r\n\r\n\r\njsConfig.json file in the root -- \r\n![image](https://user-images.githubusercontent.com/12250556/163444897-a7b36c29-59ce-4057-b89c-4546f0bfb41e.png)\r\n"}
{"sentences": "Not able to change request URL", "description": "Hi,\r\n\r\nI'm evaluating using Next.js for a work project. I'm having trouble calling an API running locally from a component. \r\n\r\nI'm trying to set a base URL but it doesn't override Next's default. \r\nSo I get: `http://localhost:3000/localhost:12000/api/auth/token`\r\nInstead of: `http://localhost:12000/api/auth/token`\r\n\r\nIf I use https it works like I'd expect. Our local development environment for this API doesn't use https though.\r\n\r\nI've tried setting `localhost:12000/` as a:\r\n- local variable\r\n- .env.local variable\r\n- property in .next.config.js\r\n\r\nI've tried making the call with:\r\n- JavaScript's fetch API\r\n- Axios\r\n- An SDK we have of helper methods that make REST requests\r\n\r\nI've tried doing the calls from:\r\n- the \"Home\" component\r\n- a non page component\r\n\r\nNone of this worked though. I still get the mangled URL. \r\n\r\nI could get it to work doing a call in `getServerSideProps`. So it looks like it's an issue on the client.\r\n\r\nAnyone else come across this? Any ideas?"}
{"sentences": "To use middleware you must provide a hostname and port to the Next.js Server", "description": "I get this error whenever I run my app: `To use middleware you must provide a hostname and port to the Next.js Server`. How can I fix this? Where should I provide `hostname` and `port`?\r\n\r\nFor context, Next is on `v12.0.8`."}
{"sentences": "How to setup React Testing library with NextJS project that uses ContextProvider?", "description": "I am  [setting up test using Jest and React Testing Library](https://nextjs.org/docs/testing) in a nextjs app that uses absolute imports.\r\nI want wrap all tests with provider.\r\neg.\r\n\r\n```JS\r\nimport { Sidebar } from '@/components/Sidebar/Sidebar';\r\nimport { render } from 'test-util';\r\n\r\ndescribe('Should render sidebar when user is logged in', () => {\r\n  test('should render a menubar', () => {\r\n    render(<Sidebar />);\r\n  });\r\n});\r\n```\r\n\r\nProvider [setup](https://testing-library.com/docs/react-testing-library/setup/) from react testing library.\r\n\r\n`test-util.tsx`\r\n```JS\r\nimport React, { FC, ReactElement, ReactNode } from 'react';\r\nimport { render, RenderOptions } from '@testing-library/react';\r\nimport { AuthProvider } from 'store/auth';\r\n\r\nconst AllTheProviders: FC = ({ children }) => {\r\n  return <AuthProvider>{children}</AuthProvider>;\r\n};\r\n\r\nconst customRender = (ui: ReactElement, options?: Omit<RenderOptions, 'wrapper'>) =>\r\n  render(ui, { wrapper: AllTheProviders, ...options });\r\n\r\nexport * from '@testing-library/react';\r\nexport { customRender as render };\r\n```\r\n\r\nHere is my `jest.config.js` in `root` folder.\r\n```JS\r\n\r\n\r\n// @ts-nocheck\r\nconst nextJest = require('next/jest');\r\n\r\nconst createJestConfig = nextJest({\r\n  // Provide the path to your Next.js app to load next.config.js and .env files in your test environment\r\n  dir: './',\r\n});\r\n\r\n// Add any custom config to be passed to Jest\r\nconst customJestConfig = {\r\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\r\n  moduleNameMapper: {\r\n    // Handle module aliases (this will be automatically configured for you soon)\r\n    '^@/components/(.*)$': '<rootDir>/components/$1',\r\n    '^@/pages/(.*)$': '<rootDir>/pages/$1',\r\n    '^@/firebase/(.*)$': '<rootDir>/firebase/$1',\r\n    '^@/store/(.*)$': '<rootDir>/store/$1',\r\n  },\r\n  testEnvironment: 'jest-environment-jsdom',\r\n};\r\n\r\n// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async\r\nmodule.exports = createJestConfig(customJestConfig);\r\n```\r\nHere is `jest.setup.js` in `root` folder.\r\n```JS\r\nimport '@testing-library/jest-dom/extend-expect';\r\n```\r\n\r\nI am getting this error:\r\n```JS\r\n FAIL  components/Sidebar/__test__/Sidebar.test.tsx\r\n  ● Test suite failed to run\r\n\r\n    Cannot find module 'test-util' from 'components/Sidebar/__test__/Sidebar.test.tsx'\r\n\r\n      1 | import { Sidebar } from '@/components/Sidebar/Sidebar';\r\n    > 2 | import { render } from 'test-util';\r\n        |                                   ^\r\n      3 |\r\n      \r\n```\r\n\r\nHere is tsconfig.paths.json in `root` folder.\r\n      \r\n```JS\r\n{\r\n  \"compilerOptions\": {\r\n    \"baseUrl\": \".\",\r\n    \"paths\": {\r\n      \"@/pages/*\": [\"./pages/*\"],\r\n      \"@/components/*\": [\"./components/*\"],\r\n      \"@/features/*\": [\"./features/*\"],\r\n      \"@/firebase/*\": [\"./firebase/*\"],\r\n      \"@/store/*\": [\"./store/*\"]\r\n    }\r\n  }\r\n}\r\n\r\n```\r\nBut if I \r\n```JS\r\nimport { render } from '../../../test-util';\r\n```\r\nIt works."}
{"sentences": "@types/react cannot be installed or recognized with installing command.", "description": "I am getting the following error multiple times ever I try today.\r\n\r\n------------------------------------------\r\n```\r\nMacBook-Pro ~/W/P/nextjs-blog (main) [127]> npm run dev\r\n\r\n> dev\r\n> next dev\r\n\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\nIt looks like you're trying to use TypeScript but do not have the required package(s) installed.\r\n\r\nPlease install @types/react by running:\r\n\r\n        npm install --save-dev @types/react\r\n\r\nIf you are not trying to use TypeScript, please remove the tsconfig.json file from your package root (and any TypeScript files in your pages directory).\r\n```\r\n---------------------------------------------------\r\n\r\nWhat I ran before that is like this;\r\n\r\n```\r\nnpx create-next-app nextjs-blog --use-npm --example \"https://github.com/vercel/next-learn/tree/master/basics/basics-final\"\r\ncd nextjs-blog\r\nnpm run dev\r\n```\r\n\r\nOf course I have run `npm install --save-dev @types/react` as the image I attached below. \r\n\r\nAnd package.json has these lines as the image too.\r\n\r\n\"devDependencies\": {\r\n    \"@types/node\": \"^17.0.23\",\r\n    \"@types/react\": \"^18.0.2\",\r\n    \"typescript\": \"^4.6.3\"\r\n  }\r\n\r\nI also have tried restarting my Mac.\r\nThank you.\r\n\r\n<img width=\"1097\" alt=\"Screen Shot 2022-04-12 at 23 50 04\" src=\"https://user-images.githubusercontent.com/13659751/162991663-361594d6-b2b8-475c-bb8d-4315f8f75b1f.png\">\r\n<img width=\"636\" alt=\"Screen Shot 2022-04-12 at 23 50 13\" src=\"https://user-images.githubusercontent.com/13659751/162991673-e8f604a8-e122-4766-a271-6f43b3e73c7f.png\">\r\n<img width=\"674\" alt=\"Screen Shot 2022-04-12 at 23 52 43\" src=\"https://user-images.githubusercontent.com/13659751/162991678-dba4e1e8-6c4f-4716-aeeb-2c7cb5499148.png\">\r\n"}
{"sentences": "No posts show after following the Vercel Contentful example guide", "description": "Hello, I've followed this guide exactly: https://github.com/vercel/next.js/tree/canary/examples/cms-contentful\r\n\r\nAnd no posts show, either on localhost or after deploying to Vercel.\r\n\r\nI've double-checked environment variables are set just as the guide specifies.\r\n\r\nAny ideas what I can check?\r\n\r\nAny help would be much appreciated! Thank you!"}
{"sentences": "When a 404 is returned during data fetching, Next.js renders a 404 page", "description": "![image](https://user-images.githubusercontent.com/12368101/161576195-6db0729d-d2dd-4863-8a2f-52ef69d9535f.png)\r\n![image](https://user-images.githubusercontent.com/12368101/161576207-41e86d33-8e85-417c-a538-dd20c4f03bc7.png)\r\nIn the case of 404, \"No data\" is output, but the default 404 page of Next.js is rendered."}
{"sentences": "Think there's a typo in a tutorial question.", "description": "Ran into this question in the [Building UI with Components](https://nextjs.org/learn/foundations/from-javascript-to-react/building-ui-with-components) section.\r\n\r\n![shows question on page; question is repeated below in text](https://user-images.githubusercontent.com/5659878/161778840-e1615773-8d5b-40e4-b9e8-062b6d7556e0.png)\r\n\r\n> Quick Review: How would you nest a Header component inside a Layout component in React?\r\n> \r\n> A. `<Layout /><Header />`\r\n> \r\n> B. `<Layout><Header /><Layout/>` \r\n> \r\n> C. `<layout><header><header/><layout/>`\r\n\r\nI guessed B. since it's the one you could make right with the fewest edits, and, sure enough, B. was marked correct after I guessed...\r\n\r\n![B. marked correct on tutorial page](https://user-images.githubusercontent.com/5659878/161779658-11a4939c-40d4-4690-a257-3f36ff5e9ed5.png)\r\n\r\n... but unless I'm having a morning, it should read like this:\r\n\r\n> B. `<Layout><Header /></Layout>` \r\n\r\nShould I just PR jive like this? (And, if so, where is the tutorial? I did [a quick search](https://github.com/search?q=org%3Avercel+Building+UI+with+Components&type=code) but didn't turn up something obvious.)\r\n"}
{"sentences": "React 18", "description": "Which version of NextJS will include React 18 ?"}
{"sentences": "ReferenceError: Response is not defined (trying to upgrade from NextJS 11 to 12)", "description": "Hi all,\r\n\r\nI'm trying to upgrade our project from Next 11 to 12.  However, i'm unable to get our custom server to start in either dev mode or prod mode.  NextJS fails to start up with the following error:\r\n\r\n```javascript\r\nReferenceError: Response is not defined\r\n    at Object.<anonymous> (/<project>/node_modules/next/server/web/spec-extension/response.ts:10:35)\r\n    at Module._compile (node:internal/modules/cjs/loader:1101:14)\r\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1153:10)\r\n    at Module.load (node:internal/modules/cjs/loader:981:32)\r\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\r\n    at Module.require (node:internal/modules/cjs/loader:1005:19)\r\n    at require (node:internal/modules/cjs/helpers:102:18)\r\n    at Object.<anonymous> (/<project>/node_modules/next/server/next-server.ts:98:61)\r\n    at Module._compile (node:internal/modules/cjs/loader:1101:14)\r\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1153:10)\r\n```\r\n\r\nThe source file it's referring to has this:\r\n\r\n```javascript\r\nexport class NextResponse extends Response { ...\r\n```\r\n\r\nhowever Response is never imported.  That said, I'm not sure where the type is defined, since NodeJS has no native DOM.\r\n\r\nSo, I'm really confused.  Any suggestions on debugging this would be most appreciated."}
{"sentences": "next@18 and hot reload not work", "description": "I create new project with next@18 and react@18 and hot not reloading page. So I reinstall next and react (with react-dom) to old versions. \r\n\r\n```\r\n    \"next\": \"12.0.4\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n```"}
{"sentences": "I am trying to use Bot-Aware ISR Fallback, but it seems not to work", "description": "Hello,\r\n\r\nSo to keep it short, I am trying to use the [Bot-Aware ISR Fallback feature](https://nextjs.org/blog/next-12#bot-aware-isr-fallback) introduced in NextJS 12.0, but it does not seem to work.\r\n\r\nAs far as I understood, I should use `fallback: true`, and then Next.JS will automatically use `fallback: \"blocking\"` whenever it detects a bot, right?\r\n\r\nI tried to implement it into my application and deployed it to both Vercel and AWS Amplify. But when I tried using the official Google Search Console and Bing's \"URL Inspection\", https://pagespeed.web.dev and a few other tools the application still returned the fallback/loading version.\r\n\r\nI tried all different NextJS versions, 12.0.0, 12.1.4, canary, but none of them seem to work.\r\nEven the ISR demo from NextJS - https://static-tweet.vercel.app/, doesn't seem to work and still returns a skeleton when a crawler makes a request. I checked the https://static-tweet.vercel.app/ and it uses next@12.0.10 with `fallback: true`\r\n\r\nMaybe I am using the feature the wrong way or misunderstood its functionality. Can you please help with this, as it is very important for me and my project.\r\n\r\nThanks in advance!\r\n\r\nP.S. just in case you need it, here is a link to the Static Twitter source code - https://github.com/lfades/static-tweet"}
{"sentences": "How to import 3rd party css dynamically", "description": "What is the best way to load 3rd party CSS dynamically? This is a follow-up on next@^9.5.4-canary.10\r\nIf I do something like below then I get this error\r\n\r\n```\r\nimport dynamic from 'next/dynamic'\r\nimport { Slider } from \"@reach/slider\";\r\n\r\nconst DynamicComponent = dynamic(() => import('@reach/slider/styles.css'))\r\n\r\nfunction Home() {\r\n  return (\r\n    <div>\r\n      <Header />\r\n      <DynamicComponent />\r\n      <p>HOME PAGE is here!</p>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n\r\n\r\n`Error: Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: object. You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.`\r\n\r\nAny help/suggestions on webpack with css-loader would be great. "}
{"sentences": "How can I make global logging in to a user for the whole app, the problem is discussed below in detail", "description": "https://stackoverflow.com/questions/71718085/how-can-i-specify-authentication-globally-instead-of-defining-on-every-page-in-n"}
{"sentences": "Invalid time value", "description": "![next-error](https://user-images.githubusercontent.com/56534538/94677836-3e12eb80-0326-11eb-986d-0152e7ecee4a.png)\r\nI'm getting this error. How can I fix this?"}
{"sentences": "getServerSideProps ECONNREFUSED when in docker", "description": "Hi the community,\r\n\r\nI have a getServerSideProps function which calls my graphql backend. It works fine locally (although I had some mysterious issues at the beginning #17437), but when I deploy my app into docker, the call fails with ECONNREFUSED. It never reaches my backend. Full error: `request to http://localhost:3415/graphql/ failed, reason: connect ECONNREFUSED 127.0.0.1:3415`. Appreciate your help. Thank you."}
{"sentences": "How to pass params to remark(or rehype) plugins?", "description": "Here is my `nextjs.config.mjs`:\r\n\r\n```js\r\nconst composedConfig = composePlugins([\r\n  mdx({\r\n    extension: /\\.mdx?$/,\r\n    options: {\r\n      remarkPlugins: [remarkFrontmatter, remarkToc, remarkGfm],\r\n      rehypePlugins: [rehypePrism, rehypeSlug],\r\n      providerImportSource: '@mdx-js/react',\r\n    },\r\n  }),\r\n  /** @type {import('next').NextConfig} */\r\n  {\r\n    reactStrictMode: true,\r\n    // experimental: {\r\n    //    reactMode: 'concurrent',\r\n    // },\r\n    pageExtensions: ['ts', 'tsx', 'js', 'jsx', 'md', 'mdx'],\r\n  },\r\n]);\r\n```\r\n\r\nI used some plugins like: remark-toc. The remark-toc support some params:\r\n\r\n```js\r\n.use(remarkToc, {heading: 'contents'})\r\n```\r\n\r\nHow do i passing it to my mdx? i tried: \r\n\r\n```js\r\nremarkPlugins: [remarkFrontmatter, remarkToc({heading: 'contents'}), remarkGfm]\r\n```\r\n\r\nor\r\n\r\n```\r\nremarkPlugins: [remarkFrontmatter, () => remarkToc({heading: 'contents'}), remarkGfm]\r\n```\r\n\r\nIt's not works. will got `error - unhandledRejection: TypeError: Cannot read properties of undefined (reading 'children')`"}
{"sentences": "Self hosted font flashes", "description": "I don't know how else to describe it. \r\n\r\nWhen hovering a link or opening a popup, basically anything where state changes on something, it appears that my font gets loaded each time so there is a flash of a system font before my font shows. This causes the page to shift and I'm not sure how to fix this.\r\n\r\n**EDIT**\r\nOn further investigation it seems like the fonts are not being cached. With every action that causes a rerender, the fonts are fetched again and again.\r\n\r\n**This is in my global styles**\r\n```\r\n@font-face {\r\n  font-family: \"PlusJakartaSans\";\r\n  src: url(\"/fonts/PlusJakartaSans/PlusJakartaSans-Regular.woff2\");\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  font-display: swap;\r\n}\r\n@font-face {\r\n  font-family: \"PlusJakartaSans\";\r\n  src: url(\"/fonts/PlusJakartaSans/PlusJakartaSans-Medium.woff2\");\r\n  font-style: medium;\r\n  font-weight: 500;\r\n  font-display: swap;\r\n}\r\n\r\n@font-face {\r\n  font-family: \"PlusJakartaSans\";\r\n  src: url(\"/fonts/PlusJakartaSans/PlusJakartaSans-Bold.woff2\");\r\n  font-style: bold;\r\n  font-weight: 700;\r\n  font-display: swap;\r\n}\r\n@font-face {\r\n  font-family: \"PlusJakartaSans\";\r\n  src: url(\"/fonts/PlusJakartaSans/PlusJakartaSans-Light.woff2\");\r\n  font-style: light;\r\n  font-weight: 300;\r\n  font-display: swap;\r\n}\r\n```\r\n\r\n**This is in my _document in the head** \r\n```\r\n       <link\r\n            rel=\"preload\"\r\n            href=\"/fonts/PlusJakartaSans/PlusJakartaSans-Regular.woff2\"\r\n            as=\"font\"\r\n            type=\"font/woff2\"\r\n            crossOrigin=\"anonymous\"\r\n          />\r\n          <link\r\n            rel=\"preload\"\r\n            href=\"/fonts/PlusJakartaSans/PlusJakartaSans-Medium.woff2\"\r\n            as=\"font\"\r\n            type=\"font/woff2\"\r\n            crossOrigin=\"anonymous\"\r\n          />\r\n          <link\r\n            rel=\"preload\"\r\n            href=\"/fonts/PlusJakartaSans/PlusJakartaSans-Bold.woff2\"\r\n            as=\"font\"\r\n            type=\"font/woff2\"\r\n            crossOrigin=\"anonymous\"\r\n          />\r\n          <link\r\n            rel=\"preload\"\r\n            href=\"/fonts/PlusJakartaSans/PlusJakartaSans-Light.woff2\"\r\n            as=\"font\"\r\n            type=\"font/woff2\"\r\n            crossOrigin=\"anonymous\"\r\n          />\r\n```\r\n\r\n\r\nHere is an example of what I'm seeing. This is happening on my local and Vercel. What am I missing?\r\n\r\nhttps://user-images.githubusercontent.com/74065047/159327519-5a65343c-2511-4f68-9c49-017c617ec67c.mov\r\n\r\n![Screenshot 2022-03-31 at 19 01 47](https://user-images.githubusercontent.com/74065047/161120518-d4d60356-ca46-4ea3-aa00-f55869f6f698.png)\r\n\r\n"}
{"sentences": "Can i make dynamic page with prefix?", "description": "I want to have dynamic pages /projectname and /@username\r\nIf i create files [projectAlias].tsx and @[username].tsx it doesnt' work?\r\n\r\nWhat about availability of such an approach?"}
{"sentences": ".next build folder exceeds 100MB with 0 assets", "description": "Hi there,\r\n\r\nI'm trying to deploy my next.js project with firebase functions.\r\nBuild works and everythings is fine working locally.\r\n\r\nWhen I tried to deploy it, I had an error from firebase: \r\n`Your proposed upload is larger than the maximum object size specified in your Policy Document`\r\n \r\nThe bundle itself seems fine at first \r\n```\r\nPage                                                 Size     First Load JS\r\n┌ ○ /                                                2.55 kB         181 kB\r\n├   /_app                                            0 B             174 kB\r\n├ ○ /404                                             196 B           174 kB\r\n├ λ /api/graphql                                     0 B             174 kB\r\n├ λ /api/login                                       0 B             174 kB\r\n├ λ /api/logout                                      0 B             174 kB\r\n├ λ /c/[id]                                          2.51 kB         194 kB\r\n├ λ /d/[id]                                          3.98 kB         495 kB\r\n├ λ /data/action/[id]                                2.05 kB         187 kB\r\n├ λ /data/actions                                    2.33 kB         309 kB\r\n├ λ /data/goal/[id]                                  1.3 kB          186 kB\r\n├ λ /data/goals                                      2.59 kB         310 kB\r\n├ λ /data/indicator/[id]                             5.36 kB         367 kB\r\n├ ○ /data/indicator/IndicatorContributions (415 ms)  5.26 kB         198 kB\r\n├ λ /data/indicators                                 3.69 kB         311 kB\r\n├ λ /db                                              1.3 kB          295 kB\r\n├ λ /login                                           2.29 kB         188 kB\r\n├ λ /new-doc                                         2.17 kB         435 kB\r\n└ λ /pdf/[id]                                        383 B           175 kB\r\n+ First Load JS shared by all                        174 kB\r\n  ├ chunks/framework-c26c818a02956540.js             42.1 kB\r\n  ├ chunks/main-c4f520d698d32637.js                  28.3 kB\r\n  ├ chunks/pages/_app-af33ca79759686be.js            103 kB\r\n  ├ chunks/webpack-c66a1cc0a3689c22.js               892 B\r\n  └ css/f179b81aca589996.css                         12.2 kB\r\n```\r\n\r\nChecking my .next folder, **it's over 100MB**. Firebase is trying to upload **143.95 MB**. I have 0 assets. \r\n\r\n90% of the size is the cache folder. 90MB for only 1 file: `.next/cache/webpack/client-production/0.pack`\r\n\r\nI found [this discussion](https://github.com/vercel/next.js/discussions/23314) but deleting .next folder doesn't work.\r\n\r\nIs it because I use extensively `getServerSideProps` ?\r\n\r\nBuild trace can be found [here](https://gist.github.com/Felixaverlant/bbfa7ac2d5afa379622a0e95efb4c4ac).\r\n\r\nThanks for all the help you could provide.\r\nBest."}
{"sentences": "Pull request best practices regarding canary branch rebasing", "description": "First time contributor here. Just wondering, when contributing to next.js is it best practice for the author of the PR to keep it up-to-date with canary, or is that something best left to the core team?\r\n\r\nI don't want to keep force pushing just to stay up-to-date if it isn't necessary."}
{"sentences": "Getting a lot of Timeout Errors on Vercel", "description": "Random URLs are timing out with this error: `Runtime exited with error: signal: killed Runtime.ExitError`.\r\nThis only started to happen after upgrading to Next12.1 – is anyone else running into this issue?\r\n\r\nexample paths throwing errors:\r\n`/_next/data/xTDapJt2MW055u5n8nln9/en-us.json`\r\n` /es-es/`"}
{"sentences": "Updated eslint-config-next 12.1.1 breaks eslint config (import)", "description": "Content was moved to issue https://github.com/vercel/next.js/issues/35606#issuecomment-1079775627"}
{"sentences": "npm export not generating html files", "description": "Hi\r\nFirst of all, I'm very new to programming. This is my first real frontend project, first React, and first Next JS site. I made it with Next JS since I got it recommended, but now I'm totally lost.\r\nI need to export my code as a static website to run on a simple server. I have no idea what kind of server it is, but  I've uploaded different projects before with html, css and js files.\r\nNow I'm at the point where I need to export my Next project with all the states, effects, images, videos and js-logics and what-not I've made. \"npm export\" doesn't give me any html files, so I'm really lost. The getStaticProps and Paths is a total mystery to me, and to me the documentation doesn't explain at all what to do. It's simply nonsense to me...\r\nI only have a single index.js file which has a bunch of states and components to navigate through a multi step form.\r\nSo, if I have something like this:\r\n```\r\nexport default function Home({}) {\r\n  const [color, setColor] = useState('yellow');\r\n  const [step, setStep] = useState(0);\r\n\r\n  return (\r\n    <Layout home color={color} step={step} setStep={setStep}>\r\n      <Head>\r\n        <title>{siteTitle}</title>\r\n      </Head>\r\n        <UserForm color={color} setColor={setColor} step={step} setStep={setStep}/>\r\n    </Layout>\r\n  )\r\n}\r\n```\r\nHow would I make that into a static site? And what about all the things in the public folder?\r\nI'm sorry if this is not how NextJS is supposed to be used, but it's too late for me to go back now... \r\nAny help is greatly appreciated! Thanks!"}
{"sentences": "Cacheing common packages", "description": "In my Next.js application I am observing that all the common js bundles, such as `main`, `_app`, etc. have some id attached to it - e.g. `_app.js?ts=1648142778564`. If I refresh the page, the id changes. I assume this is why these bundles are never cached as opposed to other bundles - for instance, I use `rollbar`, and `rollbar.min.js` shows as cached.\r\n\r\nIs there a way to manage this cacheing behaviour in Next.js? I know there are cache controls [for individual routes](https://nextjs.org/docs/going-to-production#caching), but can I do it for the shared bundles?"}
{"sentences": "getInitialProps works in _app.tsx but getServerSideProps doesn't", "description": "I'm building a ssr app using nextjs and using next-redux-wrapper for state management. My purpose is to detect authentication state of user from server side and depending on this, redirect to login or dashboard.\r\n\r\nWhen I use getInitialProps inside a class component in _app.tsx file, I am able to call it and pass the authenticated state as props to my application pages but when I use a functional component and use getServerSideProps, perhaps getServerSideProps is not being called and so no props are being passed.\r\n\r\n````import React, { useState, useEffect } from 'react'\r\nimport App from 'next/app'\r\nimport Head from 'next/head'\r\nimport { StylesProvider } from '@material-ui/core/styles'\r\nimport { AppProps, AppContext } from 'next/app'\r\nimport { GetStaticProps, NextPage, NextPageContext } from 'next'\r\n\r\nimport { wrapper } from '../store'\r\nimport initialize from '../utils/init'\r\nimport DetectInternet from '../components/detectInternet'\r\n\r\nimport '../styles/index.scss'\r\n\r\ninterface IProps {\r\n  Component: NextPage;\r\n  ctx: NextPageContext\r\n}\r\n\r\nclass WrappedApp extends App {\r\n\r\n  static async getInitialProps({ Component, ctx }: IProps ) {\r\n    initialize(ctx)\r\n    const store = ctx.store.getState()\r\n    const pageProps = Component.getInitialProps ? await Component.getInitialProps(ctx) : {}\r\n    return { pageProps, userData: store.authentication.userData };\r\n  }\r\n\r\n  componentDidMount(){    \r\n    const jssStyles: any = document.querySelector('#jss-server-side'); // Remove the server-side injected CSS from material-ui.\r\n    if (jssStyles) {\r\n      jssStyles.parentElement.removeChild(jssStyles);\r\n    }\r\n  }\r\n\r\n  render () {\r\n    const { Component, pageProps, router, userData } = this.props as any\r\n    return(\r\n      <>\r\n        <Head>\r\n          <meta\r\n            name=\"viewport\"\r\n            content=\"initial-scale=1.0, width=device-width\"\r\n            key=\"viewport\"\r\n          />\r\n        </Head>\r\n        <StylesProvider injectFirst>\r\n          <DetectInternet />\r\n          <Component {...pageProps} {...router} userData={userData} />\r\n        </StylesProvider>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\n//the following code doesn't work\r\n/* const WrappedApp = ({ Component, pageProps, router, }: AppProps) => {\r\n  useEffect(() => {\r\n    const jssStyles:any = document.querySelector('#jss-server-side');\r\n    if (jssStyles) {\r\n      jssStyles.parentElement.removeChild(jssStyles);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n    <Head>\r\n      <meta\r\n        name=\"viewport\"\r\n        content=\"initial-scale=1.0, width=device-width\" \r\n        key=\"viewport\"\r\n      />\r\n    </Head>\r\n    <StylesProvider injectFirst>\r\n      <DetectInternet />\r\n      <Component {...pageProps} {...router} />\r\n    </StylesProvider>\r\n    </>\r\n  )\r\n} */\r\n\r\nexport default wrapper.withRedux(WrappedApp)\r\n\r\n/* export async function getServerSideProps(ctx:any) {\r\n  console.log('dododo') //not being called\r\n  await initialize(ctx)\r\n  const store = ctx.store.getState()\r\n  return {\r\n    pageProps: store,\r\n  };\r\n} */\r\n"}
{"sentences": "Proxy api requests w/o a custom server", "description": "[Official code example](https://github.com/vercel/next.js/blob/master/examples/with-custom-reverse-proxy) uses a [custom server](https://nextjs.org/docs/advanced-features/custom-server), however by using a custom server, we will lose important performance optimizations, like **serverless functions** and [**Automatic Static Optimization**](https://nextjs.org/docs/advanced-features/automatic-static-optimization). This is NOT acceptable to me."}
{"sentences": "Jest Tests fails after upgrading to 9.3, cannot find interopRequireDefault", "description": "I have a inherited next.js project. I've tried to upgrade to 9.3.1 yesterday but when i tried to run my tests it just fails straightway with this error message.\r\n\r\nCannot find module '@babel/runtime-corejs2/helpers/interopRequireDefault' from 'jest.setup.ts'\r\n\r\nI guess it has something todo with that performance optimizing thing that has been done? But i can't figure out what to do.\r\n\r\nAs i said the project is not mine from the beginning so I'm not 100% sure exactly how everything is setup but we are using Jest, Enzyme and React Test Render. \r\n\r\nThe full message is:\r\n\r\n`    Cannot find module '@babel/runtime-corejs2/helpers/interopRequireDefault' from 'jest.setup.ts'\r\n\r\n      1 | import { configure } from \"enzyme\";\r\n      2 | import Adapter from \"enzyme-adapter-react-16\";\r\n    > 3 | \r\n        | ^\r\n      4 | import {GlobalWithFetchMock} from \"jest-fetch-mock\";\r\n      5 | \r\n      6 | const customGlobal: GlobalWithFetchMock = global as GlobalWithFetchMock;\r\n\r\n      at Resolver.resolveModule (node_modules/jest-resolve/build/index.js:276:11)\r\n      at Object.<anonymous> (jest.setup.ts:3:30)`"}
{"sentences": "next-swc's mysterious shakeExports option", "description": "I wonder if anyone on NextJS team can give any background on the undocumented `shakeExports` option to `next-swc` which was [added in 12.0.8](https://github.com/vercel/next.js/pull/32253)?\r\n\r\nI understand from #34010 that it's not intended to be exposed at present, and I'm not asking for it to be. I'm just wondering what the purpose of it is intended to be in the future? It appears to do much the same as the [`disableNextSsg` option](https://github.com/vercel/next.js/blob/da3760bbf5544077a6ffa513c84030d0c0672a69/packages/next/build/swc/options.js#L243) but with the list of exports to shake out configurable.\r\n\r\nReason I ask is that I've been playing with this option (via monkey-patching `next-swc-loader`) and it'd be very useful for something I'm working on. However, obviously it'd be unwise for me to rely on it if it may disappear at any minute.\r\n\r\nI assume it's not been publicly exposed for a reason, and Next doesn't want to commit to maintaining the API at this point. But any background you could give for it's intended purpose would be really helpful in weighing up the risk of utilising it.\r\n\r\n@padmaia you [requested](https://github.com/vercel/next.js/issues/31742) this option be added. Sorry to ping you out of the blue, but would you be able to shed any light?"}
{"sentences": "Need help with deploying nextjs on firebase cloud functions", "description": "It's working fine on the firebase emulator but when deployed it's crashing with no additional logging.\r\n\r\nHere's the repo -- https://github.com/akashrajum7/next-firebase-function\r\nHere's the deployed URL -- https://next-firebase-function.web.app/"}
{"sentences": "on demand ISR does not support custom server with https", "description": "Hi, next.js team\r\nThanks for on-demand (manually) revalidation feature, it is amazing!\r\n\r\nI tried it immediately with res.unstable_revalidate api. It works in smooth way. But I found that it not works for custom server with https\r\nyou can check this [repo](https://github.com/aNyMoRe0505/on-demand-isr-with-custom-server), before you start the server, you need to use `mkcert` to generate credential files, then execute `npm run dev`\r\nthen you can call revalidate api (https://localhost:3000/api/revalidate), you will get the error message in terminal `Error: Failed to revalidate /`\r\n\r\nOnce you replace `https` with `http` (you can check `server.js`), everything work fine including revalidate page manually\r\n\r\nIs it intentional or I just miss something ? Thanks!\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "yarn create next-app returns error, but create react-app works just fine", "description": "![YYfFY](https://user-images.githubusercontent.com/43725762/151035885-9731c9fc-3e8c-4a4a-a74b-e32049ba167f.png)\r\n\r\nCan someone help me fix this? And please, explain why this error occurs so in the future I'll know how to deal with it.\r\nMany thanks!\r\n\r\nStackOverFlow => https://stackoverflow.com/questions/67692005/yarn-create-next-app-returns-error-but-create-react-app-works-just-fine\r\n\r\nSame problem happening to me !! , Please Help"}
{"sentences": "Place third-party scripts inside a <div>", "description": "I'm implementing a 3rd party script where they insert some content on the parent div where the script is placed. \r\n\r\nHowever, using Next.js, all scripts added via `<Script>` was moved to `head` or `body` which causes the content to be run in the wrong place. I cannot use a normal `script` because of [this error](https://nextjs.org/docs/messages/no-sync-scripts)\r\n\r\nI wanted to run a script in an exact place inside a component. eg: `<div> script here </div>`\r\n\r\nHere's the [code / live preview\r\n](https://stackblitz.com/edit/nextjs-baga1f?file=pages/index.js)\r\nAny help?\r\n"}
{"sentences": "Error using type module in package.json", "description": "Hi,\r\nI try in my package.json add \"type\" : \"module\"  is I get an error from the next js config.\r\nHow to fix it"}
{"sentences": "where is v12.1.1-canary.11", "description": "it's [listed as a release tag](https://github.com/vercel/next.js/releases/tag/v12.1.1-canary.11) but i don't see it on npm:\r\n\r\n```bash\r\nnpm info next\r\n\r\ndist-tags:\r\ncanary: 12.1.1-canary.10  latest: 12.1.0            next-11: 11.1.4\r\n```\r\n"}
{"sentences": "next/image unoptimized auto fallback to jpg", "description": "Hey 👋 \r\n\r\nWe get an optimized image back from our API and want to use next/image to display it. We would like to show Webp and the allow it to fallback to jpg in unsupported browsers. From what I can see this is not currently possible.\r\n\r\nExample\r\n\r\n```\r\n<Image \r\n  src={webpUrl} \r\n  alt=\"Nice Alt\"\r\n  unoptimized={true} \r\n/>\r\n```\r\n\r\nIdeally we could do something like:\r\n\r\n```\r\n<Image \r\n  src={webpUrl} \r\n  alt=\"Nice Alt\"\r\n  unoptimized={true} \r\n  jpgFallback={jpgUrl}\r\n/>\r\n```\r\n\r\nIs it currently possible to do anything like this?\r\n"}
{"sentences": "does `url` in `NextRequest` always return a fully qualified URL in Middleware?", "description": "When using Next.js middleware, either on Vercel, custom server, or another hosting provider, will the `req.url` always be a full URL, with protocol and host? For example, in Middleware:\r\n\r\n```tsx\r\nexport default async function middleware(req: NextRequest) {\r\n  console.log('url', req.url); // -> http://localhost:3000/about?\r\n\r\n  return NextResponse.next();\r\n}\r\n```\r\n\r\nThe reason I ask is because I have seen some instances when only the pathname is returned. For example, when using `getServerSideProps`:\r\n\r\n```tsx\r\nexport async function getServerSideProps(context: GetServerSidePropsContext) {\r\n  console.log(context?.req?.url); // -> /about\r\n\r\n  return {\r\n    props: {},\r\n  };\r\n}\r\n```\r\n\r\nEDIT:\r\n\r\nIn reference to https://github.com/vercel/next.js/pull/33410, it looks like middleware will always have an absolute URL in the Edge Functions runtime. In this case, is the Edge Functions runtime only applicable to Vercel, or does this runtime also operate when using a different provider or custom server? \r\n\r\nCC @javivelasco \r\n\r\nThanks!"}
{"sentences": "Scheduled regeneration of static pages", "description": "Hi,\r\n\r\nI'm building an e-commerce website and am wondering what would be the best way to regenerate our static pages every night.\r\n\r\nI know the `unstable_revalidate` function just came out and it would be perfect to invalidate pages in realtime but this would mean we have to intercept and process a lot of different save events from Magento 2. I'm afraid this would be to much work to develop and maintain for our relatively small dev-team. \r\n\r\n**Some context:** We currently have a Magento website with a varnish cache that gets cleared every night. After that a process starts that requests all pages in our sitemap to rebuild the varnish cache.\r\n\r\nWe would like to create a similar proces with next but i'm not sure what would be the most efficient method. The solution i currently have in mind is running a nightly process that executes the `unstable_revalidate` function for all pages in the sitemap. What do you guys think of this solution? Does anybody have a better one? 😄 "}
{"sentences": "Why my remotes images sometime is JPG? I configured AVIF or WEBP", "description": "![image](https://user-images.githubusercontent.com/81380764/139122531-9eaffb3d-9072-4f5d-baf8-7481099c2baa.png)\r\n\r\nMy next.config.js\r\n```\r\n/** @type {import('next').NextConfig} */\r\nmodule.exports = {\r\n  reactStrictMode: true,\r\n  images: {\r\n    domains: ['...'], // I hid the URL here in GitHub  for privacy reasons\r\n    formats: ['image/avif', 'image/webp'],\r\n    minimumCacheTTL: 60\r\n  }\r\n}\r\n```\r\n\r\nMy component Image:\r\n```\r\n<Image\r\n  width={projeto.image_width}\r\n  height={projeto.image_height}\r\n  alt={projeto.title}\r\n  placeholder=\"blur\"\r\n  blurDataURL={projeto.image_blured}\r\n  src={projeto.image_url}\r\n></Image>\r\n```\r\nThank you!"}
{"sentences": "Issue with data from getinitialprops in _app.js 'TypeError: cannot read properties of undefined'", "description": "I'm having an issue displaying data pulled in (from Prismic) with getInitialProps in the _app.js file. I have followed the [Prismic slice machine tutorial](https://prismic.io/docs/technologies/add-navigation-nextjs), which includes defining a header and navigation in Prismic and displaying that data on the frontend - that all works fine.\r\n\r\nI've defined a footer now, have included the call for the footer data in the same place and way I have for the header data in the _app.js file, but that data does not display on the frontend. The error message I am seeing is:\r\n\r\n```\r\nTypeError: Cannot read properties of undefined (reading 'data')\r\n```\r\n\r\nand references the call stack to my _document.js file, but I cannot understand where the issue is in that file.\r\n\r\n**_document.js**\r\n\r\n```\r\nimport Document, { Html, Head, Main, NextScript } from 'next/document'\r\nimport { repoName } from '../prismicConfiguration'\r\nimport Link from 'next/link'\r\n\r\nexport default class extends Document {\r\n\r\n  static async getInitialProps(ctx) {\r\n    const initialProps = await Document.getInitialProps(ctx)\r\n    return { ...initialProps }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Html lang=\"en\">\r\n                <Head>\r\n                    <script async defer src={`//static.cdn.prismic.io/prismic.js?repo=${repoName}&new=true`} />\r\n                </Head>\r\n        <body className=\"\">\r\n          <Main />\r\n          <NextScript />\r\n        </body>\r\n      </Html>\r\n    )\r\n  }\r\n}\r\n```\r\n\r\n**_app.js**\r\n```\r\nimport React from 'react'\r\nimport NextApp from 'next/app'\r\nimport { Client } from '../utils/prismicHelpers'\r\nimport '../styles/style.scss'\r\n\r\nexport default class MyApp extends NextApp {\r\n\r\n  static async getInitialProps(appCtx) {\r\n        const menu = await Client().getSingle('menu') || null\r\n        const footer = await Client().getSingle('footer') || null\r\n\r\n        console.log(\"FOOTER\", footer)\r\n        console.log(\"MENU\",menu)\r\n\r\n    return {\r\n      props: {\r\n        menu: menu,\r\n                footer: footer\r\n      },\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { Component, pageProps, props } = this.props\r\n    return (\r\n      <Component {...pageProps} menu={props.menu} footer={props.footer} />\r\n    )\r\n  }\r\n}\r\n```\r\n\r\n**Footer.js** (where the data should be getting displayed)\r\n```\r\nimport React from 'react'\r\nimport Link from 'next/link'\r\n\r\n// Project functions\r\nimport { linkResolver } from '../prismicConfiguration'\r\nimport { RichText } from 'prismic-reactjs'\r\n\r\n// Footer component\r\nexport default function Footer({ footer }) {\r\n\r\n    return (\r\n\r\n        <footer className=\"footer\">\r\n            <div className=\"container max-width-lg\">\r\n                {footer.data.eyebrow}\r\n                <RichText render={footer.data.headline} />\r\n                <RichText render={footer.data.description} />\r\n                <Link href={linkResolver(footer.data.link)}>\r\n                    <a>\r\n                        {footer.data.linkLabel}\r\n                    </a>\r\n                </Link>\r\n\r\n                { footer.data.copyrightText }\r\n                { footer.data.signoffText }\r\n            </div>\r\n        </footer>\r\n\r\n    )\r\n}\r\n```\r\n\r\nI'm so confused as to why this footer data cannot be displayed or read when it has been defined and called in the same way as the header, which works completely fine. I am console logging both sets of data in the _app.js file and both are returning fine in the terminal, so I am confident what I am adding to the footer component file is correct. For some context, the reason I am pulling this data in the _app.js file is that its data that needs to be across all pages rather than calling it on every single page.\r\n\r\nWhere am I going wrong here?\r\n\r\nThanks\r\n"}
{"sentences": "Problem with redirect code", "description": "Hello,\r\n\r\nI am doing the security part on a site in NextJS and I would like to redirect the user if the page does not exist or he does not have access\r\n\r\nto doing this I try this code in first page : \r\n```Js\r\nif (notexist) {\r\n  res.redirect(404, `/error`);\r\n}\r\nelse if (notacces) {\r\n  res.redirect(404, `/error`);\r\n}\r\n```\r\nbut I got this error : `TypeError: Cannot read properties of undefined (reading 'redirect')`\r\n\r\nAnd in the second page I would like to get the error Code to adapt my message on the page\r\nSo, I try this but it does't work\r\n```Js\r\nexport async function getServerSideProps(ctx) {\r\n  const statusCode = ctx.res ? ctx.res.statusCode : null;\r\n  console.log(statusCode);\r\n  return {\r\n    props: {}\r\n  };\r\n}\r\n```\r\n\r\nDo you have some ideas?"}
{"sentences": "Switch from npm to yarn", "description": "What is needed to switch from `npm` to `yarn`?\r\n\r\nI tried replacing commands with `yarn` instead of `npm run`, deleting `node_modules` and `package-lock.json`, and running `yarn install`, but now `next build` (via `yarn build`) is failing because `eslint` can't seem to resolve any paths (with a combination of \"missing file extension\" and \"Resolve error: typescript with invalid interface loaded as resolver\" for literally every import)."}
{"sentences": "Google Analytics and Web Vitals", "description": "When adding performance monitoring to Next JS, I keep coming upon the error\r\n\r\n```\r\nga is not defined\r\n```\r\n\r\nIt stems from adding this code from the [Next JS documentation](https://nextjs.org/docs/advanced-features/measuring-performance).\r\n\r\n```tsx\r\nexport function reportWebVitals({ id, name, label, value }) {\r\n  ga('send', 'event', {\r\n    eventCategory:\r\n      label === 'web-vital' ? 'Web Vitals' : 'Next.js custom metric',\r\n    eventAction: name,\r\n    eventValue: Math.round(name === 'CLS' ? value * 1000 : value), // values must be integers\r\n    eventLabel: id, // id unique to current page load\r\n    nonInteraction: true, // avoids affecting bounce rate.\r\n  })\r\n}\r\n```\r\n\r\nI'm getting this error both at build time and at run time. I am using TypeScript in strict mode.\r\n\r\nI can confirm that the tag is set up correctly, and I followed the Google Analytics setup from the [demo repo](https://github.com/vercel/next.js/tree/canary/examples/with-google-analytics).\r\n\r\nAny ideas how to solve this error?"}
{"sentences": "Safe to host multiple next.js handlers in custom server?", "description": "# Problem\r\n\r\nI have N applications that I wish to host on the same node.js custom server.\r\n\r\n```js\r\nconst app1 = next({ dev, dir: '/apps/1' })\r\nconst handle1 = app.getRequestHandler()\r\nconst app2 = next({ dev, dir: '/apps/2' })\r\nconst handle2 = app.getRequestHandler()\r\ncreateServer(/* swap handler based on request datas */)(...)\r\n```\r\n\r\nInitial experiments seem to work just fine! However, that could be a dangerous assumption. I am hoping that next can confirm that the handlers are safely isolated from one another, and that running N handlers will not have adverse side effects from next itself."}
{"sentences": "How to use build profiling", "description": "Greetings!\r\n\r\nI've scoured the next.js documentation and searched disucssions/issues, but do not see a clear answer.\r\n\r\nNext.js internally uses a tracing facility. I'd like to study the output of my build spans, but don't see how to specify a reporter.\r\n\r\nIs this a public or private feature? If public, any coaching on how to use the performance tracing would be awesome!"}
{"sentences": "Dont commit public folder bcz it gets regenerated so causes big diff in git but specify favicon.ico in Next.js?", "description": "I am making a blog that regenerates the images with different names like `image-random-string-like-312asdaczx` so causes a big diff in my commit.\r\n\r\nI had already put `public/` folder in my `.gitignore` but I want to use `favicon.ico` so I had to remove it.\r\n\r\nIs there a way to use `favicon.ico` without having to commit `public/` folder?"}
{"sentences": "NextJS webpack config - Exclude files from being compiled", "description": "Hi all, I need some help with **NextJS webpack config**?\r\n\r\nI have a mono-repo and share code between **React-Native** and **NextJS**. To split OS-specific code I separated the native and the web code like that:  (`Login.web.tsx` & `Login.native.tsx`)\r\n\r\nExample: `/Login/index.tsx`\r\n\r\n```js\r\nimport React, { lazy, ReactElement, Suspense } from 'react'\r\nimport { Platform, View } from 'react-native'\r\n\r\nconst LoginComponent = lazy(() => (Platform.OS === 'web' ? import('./Login.web') : import('./Login.native')))\r\n\r\nconst Login = (props: NavigationProp): ReactElement => {\r\n  return (\r\n    <Suspense fallback={<View />}>\r\n      <LoginComponent {...props} />\r\n    </Suspense>\r\n  )\r\n}\r\n\r\nexport default Login\r\n```\r\n\r\nThis example code is located in the `ui-screen` project and will be imported into the one and only NextJS page like that\r\n\r\n```js\r\nimport { Login } from '@monorepo/ui-screen'\r\n\r\nexport default function App() {\r\n  return (\r\n    <Login />\r\n  )\r\n}\r\n```\r\n\r\nReact-Native deals perfectly with that and loads the correct `Login.native.tsx` page. But the **NextJS webpack compiler** still sees this file `Login.native.tsx` and tries to compile it, which obviously causes errors.\r\n\r\nWhen I change the code of `/Login/index.tsx` like that, for test purposes, my web app runs fine\r\n\r\n\r\n```js\r\nconst LoginComponent = lazy(() => (Platform.OS === 'web' ? import('./Login.web') : import('./Login.web')))\r\n```\r\n\r\nHow can I make webpack to exclude files that have the `*.native.*` extensions?\r\n\r\nNote: I tried that\r\n\r\n```js\r\nconst RemovePlugin = require('remove-files-webpack-plugin')\r\n\r\nmodule.exports = withPlugins([withTM()], {\r\n  ...\r\n  plugins: [\r\n    new RemovePlugin({\r\n      before: {\r\n        include: ['Login.native.js']\r\n      }\r\n    })\r\n  ],\r\n  ...\r\n}\r\n```\r\n\r\nBut it has no effect.\r\n"}
{"sentences": "TypeError: Cannot read property 'map' of undefined", "description": "Hello, I'm getting the following error\r\n\r\n### `TypeError: Cannot read property 'map' of undefined`\r\n\r\nthe api comes from a graphql response\r\n\r\nand here my code:\r\n\r\n/pages/index.tsx\r\n```\r\nconst Index = ({ header, services }: LandingPageProps) => (\r\n  <>\r\n    <SectionHero header={header} />\r\n    <SectionServices {...services} />\r\n  </>\r\n)\r\n\r\nexport const getServerSideProps: GetServerSideProps = async () => {\r\n  const { landingPage } = await client.request(GET_LANDING_PAGE)\r\n\r\n  return {\r\n    props: {\r\n      ...landingPage\r\n    }\r\n  }\r\n}\r\n```\r\n/components/SectionService/index.tsx\r\n```\r\nconst SectionServices = ({ services }: ServicesProps) => {\r\n  console.log('services', services) // undefined\r\n\r\n  return (\r\n    <S.Container>\r\n      <Heading>Meus Serviços</Heading>\r\n     // The error happens on the next line\r\n      {services.map(({ title }) => (\r\n        <S.Service key={title}>\r\n          <S.ServiceTitle>{title}</S.ServiceTitle>\r\n        </S.Service>\r\n      ))}\r\n    </S.Container>\r\n  )\r\n}\r\n```\r\n/api.ts\r\n```\r\nexport type ServicesProps = {\r\n  services: Array<{\r\n    title: string\r\n    description: string\r\n  }>\r\n}\r\n\r\nexport type LandingPageProps = {\r\n  ...\r\n  services: ServicesProps\r\n}\r\n```\r\n\r\n"}
{"sentences": "Invalid hook call without hooks", "description": "So, I have had problems with for a few days trying to figure it out myself and it's the only thing stopping me right now from transferring to next from react, but I can't figure it out at all. Whenever I try to test the website in dev enviroment it always gives out the same error for every page, but it works fine on deployment in vercel:\r\n\r\n```\r\nServer Error\r\nError: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\r\n1. You might have mismatching versions of React and the renderer (such as React DOM)\r\n2. You might be breaking the Rules of Hooks\r\n3. You might have more than one copy of React in the same app\r\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.\r\n\r\n```\r\nThe problem is... that page literally doesn't have any hooks at all. I literally couldn't make it any easier and the problem would still persist. \r\nHere is the code of this page (it shows on every, but here's one of them that doesn't have any hooks):\r\n\r\n```\r\nconst Mapa = () => {\r\n    return(\r\n        <div>\r\n\r\n            <iframe src=\"https://mapa.fabrykacraft.pl/\" className=\"mapa\" title=\"mapa\" scrolling=\"no\" />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Mapa;\r\n```\r\n\r\n\r\nI have tried different version of node from LTS to the newest through the ones used on deployment, removed both .next and node_modules, ran npm install even cloned repo on completely different machine, but I still can't figure out what is wrong here. \r\nI have also asked on stack overflow, but there was no answer there. I know it works, but I don't wanna pay for deployment on vercel if I can't at all debug/build or do anything with it locally.\r\n\r\nAny help with that would be greatly appreciated!"}
{"sentences": "How to get ?xx= URL parameters in getServerSideProps", "description": "Hi, \r\n\r\nI have this URL at http://localhost:3000/e/women/dresses?color=black,blue\r\n\r\n\"dresses\" is a dynamic [category]/js file. I am using getServerSideProps(), may I know how can get get the color GET parameter into getServerSideProps function?\r\n\r\nI can get \"dresses\" with no problem using the below params, but I can't get color param.\r\n\r\n```\r\nexport async function getServerSideProps({ params }) {\r\nconst category = params.category\r\n...\r\n}\r\n```\r\nAny guidance appreciated!\r\n"}
{"sentences": "Phase detection for Playwright tests", "description": "Playwright can spin up an instance of next dev server automatically before running tests by passing the `webServer` config object. Additionally, Playwright allows to capture full screen screenshots for visual diffing. I noticed such screenshots to be a bit flaky, because at times Next's dev indicator gets in the way, dirtying up the final screenshot.\r\n\r\nI know I can disable the indicator by passing a `devIndicators` object to next.config.js and I know I can selectively pass different configuration objects based on phases. What I couldn't figure out is a way to keep devIndicators during development and disabling it when next is run by Playwrights. Any hints?"}
{"sentences": "images are blurred in dev env", "description": "**problem:** after  running `yarn dev` I get this in chrome console:\r\n```diff\r\n- GET http://localhost:3000/f_auto,c_limit,w_256,q_auto/_next/static/media/logo.b4d51105.png 404 (Not Found)\r\n```\r\n\r\n**code:**\r\n\r\n```tsx\r\nimport logo from \"../public/static/pics/logo.png\";\r\n\r\n<Image\r\n  alt=\"logo\"\r\n  src={logo}\r\n  priority\r\n  width={80}\r\n  height={26}\r\n/>\r\n```"}
{"sentences": "ESLint error: Missing key prop for element in array", "description": "Hello guys. Can some one please help me out here, I'm really stuck.\r\n\r\nI have a freshly installed NextJs project with **Tailwind CSS** and I'm getting a weird error about ESLint, which is failing my production builds.\r\n\r\nSee the image below for the error (it seems very unnatural to have the error here):\r\n\r\n![ESLint error](https://i.postimg.cc/pXRFbbfc/nextjs-index-error.png)\r\n\r\nDisabling the lint rule as suggested [here](https://nextjs.org/docs/basic-features/eslint#disabling-rules) is not an option for me\r\nsince there are times I will need the rule (e.g when mapping over an array)\r\n\r\n[Here](https://github.com/briantuju/topviewcreators) is the repository if it might help."}
{"sentences": "Placeholder generator doesn't take transparent image into account", "description": "I'm using the lib `plaiceholder` to create the small placeholder for the image. However, my image has a transparent background and the generated base64 doesn't seem to take that into account. The placeholder shows as a square rather than the real image. **Is there any way to overcome it?**\r\n\r\n**See gif:**\r\n![New-video](https://user-images.githubusercontent.com/17390090/141644573-bcc5f3c3-3280-468a-9f7b-d06dcc2178b3.gif)\r\n\r\n**Implementation:**\r\n```\r\nimport { getPlaiceholder } from 'plaiceholder'\r\n\r\nexport default function Scene({ scene, creature }) {\r\n  return (\r\n    <Container>\r\n      <Image\r\n        src={scene.img}\r\n        layout='fill'\r\n        objectFit='cover'\r\n        placeholder='blur'\r\n        blurDataURL={scene.base64}\r\n        alt='bg'\r\n      />\r\n      <ImageWrapper>\r\n        <Image\r\n          src={creature.img}\r\n          width={500}\r\n          height={500}\r\n          objectFit='cover'\r\n          placeholder='blur'\r\n          blurDataURL={creature.base64}\r\n          alt='character'\r\n        />\r\n      </ImageWrapper>\r\n    <Container/>\r\n}\r\n\r\nexport async function getStaticProps() {\r\n  const assets = ['/assets/scene-01.jpg', '/assets/creature-1.png']\r\n\r\n  const promises = assets.map((asset) => getPlaiceholder(asset))\r\n  const response = await Promise.all(promises)\r\n\r\n  const scene = response[0]\r\n  const creature = response[1]\r\n\r\n  return {\r\n    props: {\r\n      scene: {\r\n        img: scene.img,\r\n        base64: scene.base64,\r\n      },\r\n      creature: {\r\n        img: creature.img,\r\n        base64: creature.base64,\r\n      },\r\n    },\r\n  }\r\n}\r\n```\r\n\r\n**Image:**\r\n![Screenshot_15](https://user-images.githubusercontent.com/17390090/141644614-a5524c12-897c-473f-9db1-82adda08c162.png)"}
{"sentences": "When would SWC be updated?", "description": "I have an [issue](https://github.com/typestack/class-transformer/issues/1087) with transforming data with `class-transformer` and seems like swc-project/swc#3459 fixes it. When could we expect this fix to land in Next.js?"}
{"sentences": "How to build a site just like nextjs.org/learn with Next.js", "description": "I'm sorry if this has been asked because I'm looking for something just like \"nextjs.org/learn\", two columns documentation page with points tracking functions building with Next.js. \r\nIs there a source code for the site(https://nextjs.org/learn/basics/create-nextjs-app) or a similar template? I can only find the code for the tutorial.\r\n\r\nAny feedback would be greatly appreciated. :)"}
{"sentences": "i18n - per locale browser chunks, common server chunks", "description": "Hi all,\r\n\r\nCurious if anyone has a nice strategy where locale text is **all** compiled into components, such that there is no runtime overhead for 1) downloading locale text and 2) processing text chunks for a locale. \r\n\r\nIn other words, `f(component, ...locales) => component-locale-1, ..., component-locale-n`"}
{"sentences": "NextJS api rewrite on Vercel and usage", "description": "I have a question about using a rewrite rule in your `next.config.js` file to a graphql endpoint on a different server. For example `some-project.vercel.app/graphql` will be rewritten to `some-backend.otherdomain.com/path/or/whaterver`:\r\n\r\n```js\r\n// next.config.js\r\nmodule.exports = {\r\n  // ...\r\n  async rewrites() {\r\n    return [\r\n      {\r\n        source: '/graphql/:pathname*',\r\n        destination: 'https://some-backend.otherdomain.com/path/or/whaterver'\r\n      }\r\n    ]\r\n  }\r\n};\r\n```\r\n\r\nWhen hosting this on Vercel and letting your application using this endpoint to get data, does this increase the bandwidth usage of the project? I think so because the data is essentially flowing through Vercel but I am not 100% sure and can't seem to find a good answer (or just plain looking wrong 😅 )\r\n\r\nHoping someone knows more on this!"}
{"sentences": "Is it possible to use less in next.js?", "description": "I want to use the less file for styling in my nextjs project. But I tried a lot of methods, such as introducing next-antd-aza-less, or `yarn add @zeit/next-css babel-plugin-import`, and then configuring .babelrc and next.config.js files, but the results all failed . So wanted to ask if using less is supported. If it is supported, please tell me the correct usage and steps, thank you."}
{"sentences": "help me, sass variable does not compile", "description": "**I have the following scss file on my page**\r\n\r\n```scss\r\n// theme.scss\r\n@use './variable' as *;\r\n:root {\r\n  --color-background: #f7f7f7;\r\n  --color-card-background: #fff;\r\n  --color-border: #e0e0e0;\r\n  --color-theme: $color-theme;\r\n  --color-theme-1: $color-theme-1;\r\n  --color-rise: $color-rise;\r\n  --color-rise-1: $color-rise-1;\r\n  --color-fall: $color-fall;\r\n  --color-fall-1: $color-fall-1;\r\n}\r\n```\r\n\r\n```scss\r\n// variable.scss\r\n$color-theme: #df2d45;\r\n$color-theme-1: fade($color-theme, 10%);\r\n$color-rise: #df2d45;\r\n$color-rise-1: fade($color-rise, 8%);\r\n$color-fall: #0cab38; \r\n$color-fall-1: fade($color-fall, 8%);\r\n```\r\n\r\n**I introduced in the _page.tsx file**\r\n\r\n```tsx\r\nimport '../styles/globals.css'\r\nimport './theme.scss'\r\n\r\nfunction MyApp({ Component, pageProps }) {\r\n  return <Component {...pageProps} />\r\n}\r\n\r\nexport default MyApp\r\n```\r\n\r\n**The scss variable is expected to compile successfully, but the result is**\r\n\r\n![9C503A3D-8E8B-42B8-B278-7198E3607795](https://user-images.githubusercontent.com/33046279/122362905-184c7600-cf8b-11eb-940b-2311fdc1e902.png)\r\n\r\n😅   Thanks, does anyone know what's going on？\r\n\r\n\r\n"}
{"sentences": "Importing 3rd party packages via npm", "description": "I'm trying to use a npm package [Markdown to html](https://www.npmjs.com/package/markdown-to-html-converter) in my Next js project but whenever i run the code i'm rendering with this error consistently\r\n`error - SyntaxError: Cannot use import statement outside a module`\r\ncould anyone please help me out or atleast give me a insight of the concepts which i want to look for.\r\n\r\nThank you"}
{"sentences": "React state not reflected in html file generated with next export", "description": "I am working on a next js (version 12) app that has a state (using `useState`) that tracks whether the mobile navbar is toggled or not. The app works fine in development and production server. I then generate the static html files after running `next build && next export`. But, when opening the generated html files in the browser, the toggle button doesn't seem to work . I am assuming that this might not be css related as it works fine in both dev and prod servers. But that the js bundle responsible for handling the working of this state might not be included in the browser or something.\r\n\r\nI have written my code like this:\r\n```js\r\nconst MainLayout = ({ children }: { children: React.ReactNode }) => {\r\n  const [open, setOpen] = useState<boolean>(false)\r\n  const router = useRouter()\r\n\r\n  return (\r\n    <Fragment>\r\n      <div className={`z-30 block fixed inset-0 transform transition-transform ${open ? 'translate-x-0' : '-translate-x-full'} md:hidden`}>\r\n        <MobileMenu router={router} setOpen={setOpen} />\r\n        <div className='fixed inset-0' onClick={() => setOpen(false)} />\r\n      </div>  \r\n\r\n      <header>\r\n        .....\r\n        <button \r\n          type='button' \r\n          title='Menu button'  \r\n          aria-label='Menu button'  \r\n          className='menu-btn md:hidden' \r\n          onClick={() => setOpen(!open)}\r\n        >\r\n          { open ? <CloseIcon /> : <MenuIcon /> }\r\n        </button>\r\n        .....\r\n      </header>\r\n      <main>{ children }</main>\r\n      <footer>.....</footer>\r\n\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nexport default MainLayout\r\n```\r\n\r\nWhy might I be doing wrong? Do I need to include additionally js src files in my `_document.tsx` file that takes care of state variables?\r\n\r\nAny help is much appreciated. thank you for your time.\r\n\r\nEDIT: Updated code"}
{"sentences": "Bug with on-demand revalidation? Both the old and new versions of the page are showing", "description": "I just enabled the new on-demand revalidation feature in NextJS 12.1.0 yesterday.\r\n\r\nIt looks like calling the API to revalidate pages is working, but sometimes I still see the old version when visiting a page.\r\n\r\nAs in, I revalidate the page and I navigate to it -- I see the old page. Refreshing the page brings the new version, buf if I navigate away and then back then I get the old one again.\r\n\r\nSo the only way to produce the new page is to navigate to it and click the refresh button. But navigating to it normally shows the old page.\r\n\r\nThis also happened when testing in a new incognito window, I believe that rules out any browser caching.\r\n\r\nIt's as if the edge cache is not being cleared properly after revalidation or something.\r\n\r\nIs anyone else seeing this?"}
{"sentences": "Stalled NextJS build on Creating an optimized production build", "description": "### What example does this report relate to?\r\n\r\nwebpack\r\n\r\n### What version of Next.js are you using?\r\n\r\n11.3.1\r\n\r\n### What version of Node.js are you using?\r\n\r\n12.20\r\n\r\n### What browser are you using?\r\n\r\nN/A\r\n\r\n### What operating system are you using?\r\n\r\nOSX, Docker alpine\r\n\r\n### How are you deploying your application?\r\n\r\nN/a\r\n\r\n### Describe the Bug\r\n\r\nI recently upgraded a component library that is shared across multiple different modules that are installed. But they are using version 1.x.x and are installed as dependencies in those packages. In the root package I upgrade to 2.x.x \r\n\r\nMy Project\r\nnode_modules\r\n----ui-library@2.0\r\n----moduleA\r\n--------ui-library@1.x\r\n----moduleB\r\n--------ui-library@1.x\r\n\r\nThe pages load when running `next dev`, but when running `next build` it gets stuck at `info  - Creating an optimized production build`. I have only updated the ui library. I let this run on Jenkins for 8 hours just wondering if anything would change, but it did not. When testing locally I was able to get the build to pass if I change the webpack config in my next.config.js file to `config.mode = 'development'`. \r\n\r\nLooking at the resource monitor the cpu sits at 100% usage and the memory used is around 700mb. I have tried adding more memory using `NODE_OPTIONS=--max_old_space_size=4096`\r\n\r\nIf I change the library to publish as 1.999.0 the build passes\r\n\r\n### Expected Behavior\r\n\r\nbuild to work\r\n\r\n### To Reproduce\r\n\r\nUnfortunately I can not share the code as it involves multiple private repositories. I was hoping that someone could point me into ideas of how to debug. "}
{"sentences": "Handle external URL's with query params", "description": "I have a link emailed to a user from an app that looks like this\r\n\r\n`https://www.mywebsite.com/redirect?redirectUrl=exp%3A%2F%2F192.168.1.103%3A19000&mode=signIn&lang=en&apiKey=xxxx&oobCode=xxxx`\r\n\r\nI expected the URL to go to my redirect screen at https://www.mywebsite.com/redirect but I get a 404. How can I handle this in next and then possible parse the URL to grab the redirect params to redirect the user?\r\n\r\n"}
{"sentences": "Not able to set multiple cookies with middleware function", "description": "Hi all,\r\n\r\nI'm having issues trying to set multiple cookies in the _middleware function. It works perfect on localhost, but when deployed on vercel it only sets one cookie. It could be due the fact that Vercel combines everything into one single set-cookie header.\r\n\r\nCode that sets the cookies:\r\n```\r\n   res.cookie(CookieNames.VendorCode, vendorCode, {\r\n      maxAge: 365 * 24 * 60 * 60,\r\n      secure: process.env.NEXT_PUBLIC_VERCEL_ENV !== 'development',\r\n      sameSite: 'none',\r\n    });\r\n\r\n    res.cookie(CookieNames.CountryCode, countryCode, {\r\n      maxAge: 365 * 24 * 60 * 60,\r\n      secure: process.env.NEXT_PUBLIC_VERCEL_ENV !== 'development',\r\n      sameSite: 'none',\r\n    });\r\n\r\n```\r\n\r\nI tried changing this behaviour by changing the `res.cookie()` statements to serializing the cookies first, and then appending them all to the headers like this:\r\n\r\n```\r\n   const cookies: string[] = [];\r\n\r\n    cookies.push(\r\n      serialize(CookieNames.VendorCode, vendorCode, {\r\n        maxAge: 365 * 24 * 60 * 60,\r\n        secure: process.env.NEXT_PUBLIC_VERCEL_ENV !== 'development',\r\n        sameSite: 'none',\r\n      }),\r\n    );\r\n\r\n    cookies.push(\r\n      serialize(CookieNames.CountryCode, countryCode, {\r\n        maxAge: 365 * 24 * 60 * 60,\r\n        secure: process.env.NEXT_PUBLIC_VERCEL_ENV !== 'development',\r\n        sameSite: 'none',\r\n      }),\r\n    );\r\n\r\n    cookies.forEach((cookie) => {\r\n      res.headers.append('Set-Cookie', cookie);\r\n    });\r\n```\r\n\r\nThis sets multiple set-cookie headers on localhost, but when deployed to Vercel it gets reduced to a single set-cookie header again with all cookies in it. However it only sets one cookie, so the problem persists.\r\n\r\nExample set-cookie header on Vercel:\r\n\r\n```\r\nset-cookie: ec-vc=ec; Max-Age=31536000; Secure; SameSite=None, ec-cc=be; Max-Age=31536000; Secure; SameSite=None\r\n```\r\n\r\nI also already tried to add domain & path to the cookies. But no difference there.\r\n\r\nAny help on this would be really appreciated.\r\n\r\nKind regards,\r\nThomas\r\n"}
{"sentences": "Error after migrating from Gatsby", "description": "I followed the migration docs and changed some code appropriately to start using Nextjs instead of Gatsby. However, after fixing all the bugs from errors I was getting, I now get this error:\r\n\r\nI am using typescript so I have some good confidence that I am importing my components properly and using them properly. It's also confusing to me since the app was working just fine when it was running Gatsby. Is there any good way to go about debugging this issue? (Also I have a lot of \"Body\" components haha)\r\n\r\n![image](https://user-images.githubusercontent.com/70706530/154096418-df97e4ee-7e56-4f68-8eb6-56206befe6e5.png)"}
{"sentences": "Long TTFB in localhost", "description": "### What example does this report relate to?\r\n\r\nFetch\r\n\r\n### What version of Next.js are you using?\r\n\r\n12.0.10\r\n\r\n### What version of Node.js are you using?\r\n\r\n14.15.1\r\n\r\n\r\n### What browser are you using?\r\n\r\nChrome\r\n\r\n### What operating system are you using?\r\n\r\nmacOS\r\n\r\n### How are you deploying your application?\r\n\r\nnpm run dev\r\n\r\n### Describe the Bug\r\n\r\nLong TTFB for unknown reasons. I have the app on both Vercel and local. The local has suddenly started having long TTFB loading time.. It will eventually fetch data and loads fine but I have to wait 3 mins for this.\r\n<img width=\"823\" alt=\"Screenshot 2022-02-13 at 4 57 05 PM\" src=\"https://user-images.githubusercontent.com/25930732/153757156-915f417d-e93c-4a1f-a980-6c3b117c4d53.png\">\r\n\r\nNotice the first entry having a loading time of 28880ms. I have pushed the codes onto github and deployed on Vercel and it was working GET request is only 361ms on Vercel.\r\n\r\nThe screenshot above is from Firefox. I've tried Chrome but the same issue persists.\r\n\r\n![Screenshot 2022-02-12 at 4 36 03 PM](https://user-images.githubusercontent.com/25930732/153757616-bfc69b37-2775-4bc6-a0ec-2583d2324fb5.png)\r\n\r\nI'm not sure what happened.. This seems to occur all of a sudden because the codes were working fine just a few days ago. Tried restarting computer, deleting node_modules, npm install, reverting back to the old git version. Nothing works. I'm also using getStaticPaths and getStaticProps. And the database is Mongo Atlas.\r\n\r\n\r\n### Expected Behavior\r\n\r\n-\r\n\r\n### To Reproduce\r\n\r\nimport { MongoClient } from 'mongodb';\r\nimport { Fragment } from 'react';\r\nimport Head from 'next/head';\r\nimport NumberFormat from 'react-number-format';\r\nimport { useRouter } from 'next/router'\r\n\r\nimport { format } from \"date-fns\";\r\n\r\nimport TableContainer from '@mui/material/TableContainer';\r\nimport Table from '@mui/material/Table';\r\nimport TableBody from '@mui/material/TableBody';\r\nimport TableCell from '@mui/material/TableCell';\r\n// import TableHead from '@mui/material/TableHead';\r\nimport TableRow from '@mui/material/TableRow';\r\nimport Paper from '@mui/material/Paper';\r\nimport ReactCountryFlag from \"react-country-flag\"\r\n\r\n\r\n\r\nconst CompanyDetails = props => {\r\n  const router = useRouter()\r\n  if (router.isFallback) {\r\n    return <div>Loading...</div>\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <Head>\r\n        <title>{props.companyData.name}</title>\r\n        <meta name='Company description' content={props.companyData.description} />\r\n      </Head>\r\n      <TableContainer component={Paper}>\r\n                <Table aria-label=\"simple table\">\r\n                  <TableBody>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Company Name\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.name}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Description\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.description}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    \r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Country\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <ReactCountryFlag \r\n                          countryCode={props.companyData.companyId.substr(0, 2)}\r\n                          svg\r\n                          style={{\r\n                              width: '2.5em',\r\n                              height: '2.5em',\r\n                          }}\r\n                        >\r\n                        </ReactCountryFlag>\r\n                        {props.companyData.country}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Registration No.\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.regno}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Website\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <a href={props.companyData.url}>http:{props.companyData.url}</a>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Founded\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.foundationDate}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Status\r\n                      </TableCell>\r\n                      <TableCell>\r\n                      {props.companyData.status}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Stock Exchange (Ticker)\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.mainStockEx} ({props.companyData.ticker})\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Latest FY\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.fy1period}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    <TableRow>\r\n                      <TableCell>\r\n                        Annual revenue\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {props.companyData.currency}\r\n                        <NumberFormat value={props.companyData.fy1revenue} \r\n                        displayType=\"text\" thousandSeparator={true}/>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                    \r\n                  </TableBody>\r\n                </Table>\r\n              </TableContainer>\r\n\r\n\r\n\r\n\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nexport async function getStaticPaths() {\r\n  const client = await MongoClient.connect(\r\n    process.env.MONGODB_URI\r\n  );\r\n  const db = client.db();\r\n\r\n  const companiesCollection = db.collection('companies');\r\n\r\n  const companies = await companiesCollection.find({}, { slug: 1 }).toArray(); // 2nd bracket says return only the slug field\r\n\r\n  client.close();\r\n\r\n  // return {\r\n  //   fallback: true,\r\n  //   paths: companies.map((company) => ({\r\n  //     params: { companyURL: company.slug },\r\n  //   }\r\n  //   )),\r\n  // };\r\n\r\n  return {\r\n    fallback: 'blocking',\r\n    paths: [],\r\n  };\r\n}\r\n\r\nexport async function getStaticProps(context) {\r\n  // fetch data for a single company\r\n\r\n  const companyURL = context.params.companyURL;\r\n\r\n  // const { companyData: company, isLoading } = useCompanies(page, perPage, searchCompanyCountry);\r\n\r\n  const client = await MongoClient.connect(\r\n    process.env.MONGODB_URI\r\n  );\r\n  const db = client.db();\r\n\r\n  const companiesCollection = db.collection('companies');\r\n\r\n  const selectedCompany = await companiesCollection.findOne({\r\n    slug: companyURL,\r\n  });\r\n\r\n  \r\n\r\n  client.close();\r\n\r\n  function formatFoundationDate(value) {\r\n    if (typeof value === \"undefined\") {\r\n      return '';\r\n    } return format(new Date(value), 'yyyy');\r\n  }\r\n\r\n  function checkUndefined(value) {\r\n    if (typeof value === \"undefined\") {\r\n      return '';\r\n    } return value;\r\n  }\r\n  \r\n  function formatDate(value) {\r\n    if (typeof value === \"undefined\" || typeof value.totalRevenue === 'undefined' ) {\r\n      return '';\r\n    } return format(new Date(value.period), 'yyyy/MM');\r\n  }\r\n\r\n  function checkTotalRevenue(value) {\r\n    if ( typeof value === \"undefined\" || typeof value.totalRevenue === 'undefined')  {\r\n      return '';\r\n    } return value.totalRevenue;\r\n  }\r\n  // if (isLoading) return (\r\n  //   <Box sx={{ display: 'flex' }}>\r\n  //     <CircularProgress />\r\n  //   </Box>);\r\n\r\n  return {\r\n\r\n    props: {\r\n      companyData: {\r\n        id: selectedCompany._id.toString(),\r\n        name: selectedCompany.companyName,\r\n        companyId: selectedCompany.companyId,\r\n        description: checkUndefined(selectedCompany.companyBusinessDescription),\r\n        regno: checkUndefined(selectedCompany.companyRegistrationNo),\r\n        country: checkUndefined(selectedCompany.companyCountry),\r\n        foundationDate: formatFoundationDate(selectedCompany.companyFoundationDate),\r\n        status: checkUndefined(selectedCompany.companyStatus),\r\n        mainStockEx: checkUndefined(selectedCompany.companyMainStockEx),\r\n        ticker: checkUndefined(selectedCompany.companyTicker),\r\n        url: checkUndefined(selectedCompany.companyURL),\r\n        fy1revenue: checkTotalRevenue(selectedCompany.companyFy1),\r\n        fy1period: formatDate(selectedCompany.companyFy1),\r\n        currency: checkUndefined(selectedCompany.companyCurrency),\r\n        slug: checkUndefined(selectedCompany.slug)\r\n      }, revalidate: 60*60*24*90,\r\n    },\r\n  };\r\n}\r\n\r\nexport default CompanyDetails;\r\n"}
{"sentences": "How do you use decorated functional components with `next/link`?", "description": "I have 3 parts:\r\n- [the decorator for functional components](https://github.com/GabenGar/next-js-site/blob/master/src/components/meta/block-component.ts)\r\n- [base component for links which is a decorated wrapper for `<a>` element](https://github.com/GabenGar/next-js-site/blob/master/src/components/html/a/base.tsx)\r\n- [the decorated internal link component which is a wrapper for `next/link`](https://github.com/GabenGar/next-js-site/blob/master/src/components/links/internal.tsx)\r\n\r\nAs per docs, [functional components have to be wrapped in `React.forwardRef()`](https://nextjs.org/docs/api-reference/next/link#if-the-child-is-a-functional-component) for `next/link` to work. However I am not sure in what order I have to pass in my setup without typescript screaming everywhere. Do I have to write special logic in my decorator to handle the return type of `forwardRef()` (because it doesn't return a function)? Definitely not going to look clean both for the decorator signature nor its implementation."}
{"sentences": "How to fetch data from server once then make it global for every page", "description": "I have global data that I need to get from server once, then make it global for every page, As simple as this.\r\n\r\n```\r\nconst MyApp = ({ Component, pageProps, globalLayout }) => {\r\n  return <Component {...pageProps} globalLayout={globalLayout} />;\r\n};\r\n\r\nMyApp.getInitialProps = async ({ req }) => {\r\n  if (typeof window === \"undefined\") {\r\n    const subdomain = req.headers.host.split(\".\")[0];\r\n    const res = await fetch(\r\n      `https://myapi.com/api/v1/layout?sub_domain=${subdomain}`\r\n    );\r\n    const data = await res.json();\r\n\r\n    return {\r\n      globalLayout: data.results ? data.results.portal : null,\r\n    };\r\n  }\r\n};\r\n\r\nexport default MyApp;\r\n```\r\n\r\nData depends on the subdomain, however I am getting `TypeError: Cannot read property 'headers' of undefined`\r\n\r\nI was thinking about using `getServerSideProps` in `_app.js` and pass it to every component, but It's not supported yet. Any ideas? \r\n\r\n "}
{"sentences": "Potential Issue with Release v11.1.3", "description": "Is it possible that the v11.1.3 release was improperly cut? \r\n\r\nLooking at the latest canary tag for the release, there are a lot more commits on canary than actually made it to the patch.  I[ commented on a PR that I expected/wanted to see in the release](https://github.com/vercel/next.js/pull/28710#issuecomment-1021665525), but wasn't sure if it was going to get any eyes over there."}
{"sentences": "next/image lazy loading with lazyBoundary x-axis?", "description": "Next/images lazy load off-screen images quickly along the y-axis while scrolling down but on a carousel component that side scrolls with `overflow-x: scroll` they are not lazy loaded despite only being a few pixels off screen on the x-axis. \r\n\r\nIncreasing the `lazyBoundary` prop on next/image didn't seem to help.\r\n\r\nIs there a way to include the x-axis in the `lazyBoundary ` or any other ideas that could help?\r\n\r\nMuch appreciated!"}
{"sentences": "Using ssr with express session", "description": "Hi, I have an external express server using `express-session`. \r\n\r\nIn my next.js app, I call a login route and the server returns a cookie in the response header. Then I do a `router.push(/to-protected-route)`. And in my `protected-route` page, I do the following but I see that the request fires twice and on the server it sees 2 cookies with 2 different `sid`s. I was wondering what I should do? Thanks!: \r\n\r\n`export const getServerSideProps: GetServerSideProps = async (context) => {\r\n  const cookies = context.req.cookies;\r\n  if (cookies[\"connect.sid\"]) {\r\n    console.log(\"calling getUser\");\r\n    const data = await graphqlRequestClient.request(GET_ME, undefined, {\r\n      cookies: context.req.cookies.toString(),\r\n    });\r\n    console.log(\"data\", data);\r\n  } else {\r\n    return {\r\n      redirect: {\r\n        destination: \"/login\",\r\n        permanent: false,\r\n      },\r\n    };\r\n  }\r\n  return {\r\n    props: {}, // will be passed to the page component as props\r\n  };\r\n};`"}
{"sentences": "Deploying nextjs onto AWS EC2 with PM2", "description": "hi all,\r\n\r\nI have set up a nextjs project using `npx create-next-app` and I wish to test out the deployment process with the basic skeleton codes from `npx create-next-app`. I have created an EC2 instance running on Ubuntu v18\r\n\r\nI tried running the nextjs using pm2 with the following command:\r\n`npm run build\r\npm2 start npm --name \"next\" -- prod`\r\n\r\nHowever, I'm getting `App [nextjs:0] exited with code [1] via signal [SIGINT]` upon execution of the command and nothing is appearing on my EC2 public IP address.\r\n\r\nBelow is the snippet from the `package.json` of the nextjs project:\r\n`\"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"prod\": \"next start -p 80\",\r\n    \"export\": \"next export\"\r\n  },`\r\n\r\nDoes anyone have any suggestions on how I can deploy in the correct manner?"}
{"sentences": "How to customize site based on build-time env variables?", "description": "I have some env variables that customize our Next site – for example I don’t want to insert the Google Analytics tracking code into development / preview builds. Something like:\r\n\r\n```typescript\r\n{env.allowAnalytics && (\r\n  <script /* load analytics tracking code */>\r\n)}\r\n```\r\n\r\nThis works fine during the first server render, but obviously fails on the client where there is no env to speak of. Is there a way to set up some “build-time flags” during build time and have them available on the client, too?\n\n(Like what if I want my development version to have red background and production version to have green background based on build-time `process.env`?)\r\n\r\nI know I could set up these flags in `getStaticProps` for each page and then store them in props (making them available on the client) – but that means doing it for each and every page, doesn’t it?"}
{"sentences": "eslint-config-next not working with eslint v8", "description": "When I try upgrading ESLint to v8.8.0, I'm not able to run `eslint .` because of this error coming from `eslint-config-next`:\r\n\r\n```\r\nOops! Something went wrong! :(\r\n\r\nESLint: 8.8.0\r\n\r\nError: Cannot read config file: /[REDACTED]/node_modules/eslint-config-next/index.js\r\nError: Failed to patch ESLint because the calling module was not recognized.\r\nIf you are using a newer ESLint version that may be unsupported, please create a GitHub issue:\r\nhttps://github.com/microsoft/rushstack/issues\r\nReferenced from: /[REDACTED]/.eslintrc.js\r\n```\r\n\r\nWe're on Next v11, so we're on `eslint-config-next@11.1.3`. Upgrading to 11.1.4 did not fix the issue.\r\n\r\nWhat's the latest ESLint version that the config supports?"}
{"sentences": "Next.js with MongoDB and Mongoose throws 500 Internal Server Error when deploy it on Vercel", "description": "My application is working on **localhost** without problem. When I deploy it tho vercel through github it throws error. My building logs are like that\r\n\r\n``` js\r\n\r\nCloning github.com/sayinmehmet47/electronic-products47 (Branch: main, Commit: 2ae970b)\r\nCloning completed: 738.588ms\r\nAnalyzing source code...\r\nInstalling build runtime...\r\nBuild runtime installed: 2.071s\r\nLooking up build cache...\r\nBuild Cache not found\r\nInstalling dependencies...\r\nyarn install v1.22.17\r\n[1/4] Resolving packages...\r\n[2/4] Fetching packages...\r\n[3/4] Linking dependencies...\r\nwarning \"next > styled-jsx > @babel/plugin-syntax-jsx@7.14.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".\r\nwarning \"react-chrono > @emotion/styled > @emotion/babel-plugin@11.7.2\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\nwarning \"react-scripts > @typescript-eslint/eslint-plugin > tsutils@3.21.0\" has unmet peer dependency \"typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta\".\r\nwarning \" > slick-carousel@1.8.1\" has unmet peer dependency \"jquery@>=1.8.0\".\r\n[4/4] Building fresh packages...\r\nDone in 44.34s.\r\nDetected Next.js version: 12.0.7\r\nRunning \"yarn run build\"\r\nyarn run v1.22.17\r\n$ next build\r\ninfo  - Loaded env from /vercel/path0/.env.production\r\nAttention: Next.js now collects completely anonymous telemetry regarding usage.\r\nThis information is used to shape Next.js' roadmap and prioritize features.\r\nYou can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:\r\nhttps://nextjs.org/telemetry\r\ninfo  - Checking validity of types...\r\nwarn  - No ESLint configuration detected. Run next lint to begin setup\r\ninfo  - Creating an optimized production build...\r\ninfo  - Compiled successfully\r\ninfo  - Collecting page data...\r\ninfo  - Generating static pages (0/4)\r\ninfo  - Generating static pages (1/4)\r\ninfo  - Generating static pages (2/4)\r\ninfo  - Generating static pages (3/4)\r\ninfo  - Generating static pages (4/4)\r\ninfo  - Finalizing page optimization...\r\nPage                                       Size     First Load JS\r\n┌ λ /                                      17.4 kB         116 kB\r\n├   └ css/5674832e1468d24d.css             1.14 kB\r\n├   /_app                                  0 B            85.6 kB\r\n├ ○ /404                                   194 B          85.8 kB\r\n├ λ /api/orders                            0 B            85.6 kB\r\n├ λ /api/orders/[id]                       0 B            85.6 kB\r\n├ λ /api/products                          0 B            85.6 kB\r\n├ λ /api/products/[id]                     0 B            85.6 kB\r\n├ ○ /card                                  2.48 kB         104 kB\r\n├ λ /orders/[id]                           26.3 kB         119 kB\r\n├ ○ /payment/Paypal                        1.05 kB        96.4 kB\r\n└ λ /product/[id]                          3.31 kB        94.8 kB\r\n+ First Load JS shared by all              85.6 kB\r\n  ├ chunks/framework-91d7f78b5b4003c8.js   42 kB\r\n  ├ chunks/main-d98b4a7f39fdfc80.js        28.2 kB\r\n  ├ chunks/pages/_app-9a201061d3b88321.js  14.6 kB\r\n  ├ chunks/webpack-49b6f2937c9ce9f4.js     838 B\r\n  └ css/736f475f789b4b00.css               6.93 kB\r\nλ  (Server)  server-side renders at runtime (uses getInitialProps or getServerSideProps)\r\n○  (Static)  automatically rendered as static HTML (uses no initial props)\r\nDone in 21.93s.\r\nTraced Next.js server files in: 309.973ms\r\nCreated all serverless functions in: 1.013s\r\nUploading build outputs...\r\nDeploying build outputs...\r\nBuild completed. Populating build cache...\r\nUploading build cache [76.45 MB]...\r\nBuild cache uploaded: 1.436s\r\nDone with \"package.json\"\r\n\r\n\r\n```\r\nWhen I check my functions logs I have this error.\r\n\r\n``` js\r\n[GET] /\r\n13:39:09:78\r\n,\r\n      [Symbol(kCapture)]: false,\r\n      [Symbol(RequestTimeout)]: undefined\r\n    },\r\n    aborted: false,\r\n    timeoutCb: null,\r\n    upgradeOrConnect: false,\r\n    parser: null,\r\n    maxHeadersCount: null,\r\n    reusedSocket: false,\r\n    host: 'electronic-products47.vercel.app',\r\n    protocol: 'https:',\r\n    _redirectable: Writable {\r\n      _writableState: [WritableState],\r\n      _events: [Object: null prototype],\r\n      _eventsCount: 3,\r\n      _maxListeners: undefined,\r\n      _options: [Object],\r\n      _ended: true,\r\n      _ending: true,\r\n      _redirectCount: 0,\r\n      _redirects: [],\r\n      _requestBodyLength: 0,\r\n      _requestBodyBuffers: [],\r\n      _onNativeResponse: [Function (anonymous)],\r\n      _currentRequest: [Circular *1],\r\n      _currentUrl: 'https://electronic-products47.vercel.app/api/products',\r\n      [Symbol(kCapture)]: false\r\n    },\r\n    [Symbol(kCapture)]: false,\r\n    [Symbol(kNeedDrain)]: false,\r\n    [Symbol(corked)]: 0,\r\n    [Symbol(kOutHeaders)]: [Object: null prototype] {\r\n      accept: [Array],\r\n      'user-agent': [Array],\r\n      host: [Array]\r\n    }\r\n  },\r\n  response: {\r\n    status: 404,\r\n    statusText: 'Not Found',\r\n    headers: {\r\n      date: 'Sun, 06 Feb 2022 11:39:10 GMT',\r\n      'content-type': 'application/json',\r\n      connection: 'close',\r\n      'x-vercel-error': 'DEPLOYMENT_NOT_FOUND',\r\n      'content-length': '85',\r\n      server: 'Vercel',\r\n      'x-vercel-id': 'iad1::gxt5k-1644147550847-622d8eef832b',\r\n      'strict-transport-security': 'max-age=63072000; includeSubDomains; preload',\r\n      'cache-control': 'public, max-age=0, must-revalidate',\r\n      'x-vercel-cache': 'MISS'\r\n    },\r\n    config: {\r\n      transitional: [Object],\r\n      adapter: [Function: httpAdapter],\r\n      transformRequest: [Array],\r\n      transformResponse: [Array],\r\n      timeout: 0,\r\n      xsrfCookieName: 'XSRF-TOKEN',\r\n      xsrfHeaderName: 'X-XSRF-TOKEN',\r\n      maxContentLength: -1,\r\n      maxBodyLength: -1,\r\n      validateStatus: [Function: validateStatus],\r\n      headers: [Object],\r\n      method: 'get',\r\n      url: 'https://electronic-products47.vercel.app/api/products',\r\n      data: undefined\r\n    },\r\n    request: <ref *1> ClientRequest {\r\n      _events: [Object: null prototype],\r\n      _eventsCount: 7,\r\n      _maxListeners: undefined,\r\n      outputData: [],\r\n      outputSize: 0,\r\n      writable: true,\r\n      destroyed: false,\r\n      _last: true,\r\n      chunkedEncoding: false,\r\n      shouldKeepAlive: false,\r\n      _defaultKeepAlive: true,\r\n      useChunkedEncodingByDefault: false,\r\n      sendDate: false,\r\n      _removedConnection: false,\r\n      _removedContLen: false,\r\n      _removedTE: false,\r\n      _contentLength: 0,\r\n      _hasBody: true,\r\n      _trailer: '',\r\n      finished: true,\r\n      _headerSent: true,\r\n      socket: [TLSSocket],\r\n      _header: 'GET /api/products HTTP/1.1\\r\\n' +\r\n        'Accept: application/json, text/plain, */*\\r\\n' +\r\n        'User-Agent: axios/0.25.0\\r\\n' +\r\n        'Host: electronic-products47.vercel.app\\r\\n' +\r\n        'Connection: close\\r\\n' +\r\n        '\\r\\n',\r\n      _keepAliveTimeout: 0,\r\n      _onPendingData: [Function: noopPendingOutput],\r\n      agent: [Agent],\r\n      socketPath: undefined,\r\n      method: 'GET',\r\n      maxHeaderSize: undefined,\r\n      insecureHTTPParser: undefined,\r\n      path: '/api/products',\r\n      _ended: true,\r\n      res: [IncomingMessage],\r\n      aborted: false,\r\n      timeoutCb: null,\r\n      upgradeOrConnect: false,\r\n      parser: null,\r\n      maxHeadersCount: null,\r\n      reusedSocket: false,\r\n      host: 'electronic-products47.vercel.app',\r\n      protocol: 'https:',\r\n      _redirectable: [Writable],\r\n      [Symbol(kCapture)]: false,\r\n      [Symbol(kNeedDrain)]: false,\r\n      [Symbol(corked)]: 0,\r\n      [Symbol(kOutHeaders)]: [Object: null prototype]\r\n    },\r\n    data: { error: [Object] }\r\n  },\r\n  isAxiosError: true,\r\n  toJSON: [Function: toJSON],\r\n  page: '/'\r\n}\r\nRequestId: 0353ce42-21d7-4ba1-80df-1a9f40898eef Error: Runtime exited with error: exit status 1\r\nRuntime.ExitError\r\n```\r\nI have environment variables that I also added them to vercel. \r\n\r\n``` js\r\nMONGODB_URI= mongodb+srv://***@cluster0.ywv3z.mongodb.net/electronicProducts?retryWrites=true&w=majority\r\nMONGODB_DB= \"electronic-products47\"\r\nPROD_URL = \"https://electronic-products47.vercel.app\"\r\nDEV_URL = \"http://localhost:3000\"\r\n```\r\nWhen I fetch some API by getServerSideProps I use this snippet\r\n\r\n``` js\r\nexport async function getServerSideProps({ params }) {\r\n  let dev = process.env.NODE_ENV !== \"production\";\r\n  let { DEV_URL, PROD_URL } = process.env;\r\n  await dbConnect();\r\n  const res = await fetch(\r\n    `${dev ? DEV_URL : PROD_URL}/api/products/${params.id}`\r\n  );\r\n  const data = await res.json();\r\n  return { props: { product: data } };\r\n}\r\n\r\n```\r\nI also followed this essay to host my app [essay][1]\r\nthis is also my repo that I am working on it https://github.com/sayinmehmet47/electronic-products47\r\n\r\n\r\n  [1]: https://www.section.io/engineering-education/build-nextjs-with-mongodb-and-deploy-on-vercel/"}
{"sentences": "What is the best way to use global variable?", "description": "I want to use global variable for showing title, setting link for back button, and some.\r\nWhat is the best way?\r\n```jsx\r\n// _app.jsx\r\n    <div className=\"border-2 border-slate-400 w-screen h-screen rounded bg-white\">\r\n      <TitleBar />\r\n      <div className=\"p-2\">\r\n        <Component {...pageProps} />\r\n      </div>\r\n    </div>\r\n// ---\r\nfunction TitleContent() {\r\n  return (\r\n    <div className=\"text-center text-white\">My Application - {someGlobalVarable}</div>\r\n  );\r\n}\r\n```\r\n```jsx\r\n// index.jsx\r\nexport default function Home({ items }) {\r\n  someGlobalVariable = \"Home\";\r\n  return (\r\n    <>\r\n      // ...\r\n    </>\r\n  );\r\n}\r\n```\r\n"}
{"sentences": "Is it possible to pass data from _middleware.ts to pages components?", "description": "Looks like it's not possible to pass data from _middleware.ts to pages components? Will it keep as is? or is there any possibility?"}
{"sentences": "@sentry/nextjs withSentryConfig enables productionBrowserSourceMaps, in the end, assets sourcemap is open to the public.", "description": "### Descriptions\r\n- I am using `@sentry/nextjs` withSentryConfig to track errors in my production nextjs app.\r\n- Recently, I found out that sentryConfig enables `productionBrowserSourceMaps` even if I did not set it to true in my next.config.js\r\n- I understood that sentry needs assets' sourcemaps. However, I thought I need a way to distinguish build dir to upload to sentry release and build dir being served on my nextjs server.\r\n- I don't think there is a way to do this right now in my knowledge. Anyone to have idea to handle this kind of problems? Please share with me."}
{"sentences": "Trigger one page rebuild from custom express server", "description": "Hi. \r\n\r\nI've read the documentation about getStaticProps and getStaticPaths for statically pre-rendering pages that use dynamic routes. I'd like to know if there is a way to rebuild only one page when it's updated. For example let's say I'm rendering product pages, and a product can be updated via a call to my custom express api. Could I trigger a rebuild of the updated product page from my api (something like app.buildOne('/products/my-product-id'))?\r\n\r\nThanks."}
{"sentences": "NextJS 12: Webpack alias does not work when alias is outside of next root", "description": "The issue https://github.com/vercel/next.js/issues/7234 (Webpack alias does not work when alias is outside of next root) has as the solution the use of the plugin `next-babel-loader`. I assume that this plugin came out-of-the-box with NextJS before, because we had not installed it explicitly.\r\n\r\nUnfortunately, after upgrading to NextJS 12, we can't use this plugin (there's the error `Module not found: Can't resolve 'next-babel-loader'`), and this happens even **Opting Out of SWC**, so there's no way for us to compile the project (we don't see reference to npm install  `next-babel-loader` or anything of the sort). The only way to work is to include the folder inside the project.\r\n\r\nCurrently, we use 3 folders, `common`, `web` and `native`, with `web` being the react web project with NextJS, that uses `common/lib` with code shared between the `web` and `native` projects. This means that for NextJS 12 to work, we would need to include `common/lib` inside `web`, which would be bad, because we don't wan't to make `react native` \"see\" the web project.\r\n\r\nWe tried to use a symlink `web/lib` pointing to `common/lib`, and in the NextJS webpack configuration `config.resolve.alias['@/lib'] = path.resolve(__dirname, 'lib');`, but to no avail (it doesn't see the external folder, giving the error Syntax error: Unexpected token as it is what happens when use `../common/lib`). The only way we make it work was to move the directory `common/lib` to `web/lib`, which is what we **don't** want.\r\n\r\nIs there a way to import from an alias path outside the root (from a parent folder) in NextJS 12?\r\n"}
{"sentences": "Configure api route path", "description": "Hello team,\r\n\r\nWe are starting to look at api routes in Next. This part from the documentation is relevant to the question:\r\n\r\n> Any file inside the folder pages/api is mapped to /api/* and will be treated as an API endpoint instead of a page.\r\n\r\nUnfortunately we have a conflict with other infrastructure at the `/api` path, so I'm wondering if it's possible to configure the pathway of api routes? Basically instead of `pages/api` -> `api/*` I'd like to have `page/api` -> `something/*`"}
{"sentences": "How does Next.js compute the built-in geo localization data", "description": "hello,\r\n\r\nI'm trying to figure out how nextjs computes the geo info from `NextRequest.geo`, but had no success so far by just inspecting the source code.\r\n\r\nis it based on data bundled with nextjs? is it calling an external geo IP service? does it have a quota?\r\n\r\ntrying to determine how reliable it is to use the provided geo data in a production environment\r\n\r\nthank you"}
{"sentences": "Middleware: How to rewrite api with authorization header to another api end point?", "description": "We are using Nextjs 12. Able to rewrite API endpoint another endpoint but need to add authorization header from middleware for security purpose.\r\n\r\nIs it possible to add req header before rewrite?"}
{"sentences": "Error occurred prerendering page on CI/CD, works locally?", "description": "Why would building succeed locally but fail in CI/CD?\r\n```\r\nError occurred prerendering page /en/example/category1/1\r\nTypeError: Only absolute URLs are supported\r\n```\r\n\r\nI get this error in CI/CD for every dynamic route that I have in my paths array in getStaticPaths.\r\n\r\nAnd then finally\r\n```\r\n> Build error occurred\r\nError: Export encountered errors on following paths:\r\n\t/en/example/category1/1\r\n\t/en/example/category1/2\r\n       ...rest of the pages\r\n```\r\n\r\nI have my directory structured as example/[category]/[page].tsx\r\n\r\nAnd then have this as my paths\r\n\r\n```js\r\npaths: [\r\n      { params: { category: 'category1', page: '1' } },\r\n      { params: { category: 'category1', page: '2' } },\r\n      { params: { category: 'category1', page: '3' } },\r\n      { params: { category: 'category1', page: '4' } },\r\n      { params: { category: 'category2', page: '1' } },\r\n      { params: { category: 'category2', page: '2' } },\r\n      { params: { category: 'category3', page: '1' } },\r\n      { params: { category: 'category4', page: '1' } },\r\n      { params: { category: 'category5', page: '1' } },\r\n      { params: { category: 'category6', page: '1' } },\r\n    ],\r\nfallback: 'blocking',\r\n```\r\n\r\nI am running node 17 locally and was running node 12 as an alpine image in CI/CD but changed it to 16 and then 17 with no success.\r\n\r\nI think it's also important to note that I have my i18n object set to this\r\n\r\n```\r\ni18n: {\r\n    defaultLocale: 'en',\r\n    locales: ['en', 'nl'],\r\n}\r\n```\r\n\r\nAnd the URLs that fail to prerender only seem to start with /en which is my default locale."}
{"sentences": "What is the suggested way of static data fetching for persistent components?", "description": "Hi there,\r\n\r\nI have a basic question regarding data fetching with getStaticProps etc. Given that it's page based (can't use on components), what is the suggested way to fetch data for components which persist as part of the layout across all pages?\r\n\r\nFor example, my nav bar. My navbar component is populated with data from my CMS. The `navbar` is loaded within my `layout` HOC, which in turn is loaded in my custom `_app`. I can't fetch the data from the custom app as per [this post](https://github.com/vercel/next.js/discussions/10949), so I'm not sure how else it should be done elegantly?"}
{"sentences": "The meaning of <> </>", "description": "I find this syntax at https://nextjs.org/learn/basics/navigate-between-pages/link-component#:~:text=function%20FirstPost()%20%7B%0A%20%20return%20(-,%3C%3E,-%3Ch1%3EFirst%20Post Anyone knows what the meaning of it?"}
{"sentences": "How to serve NextJS static files through custom Express server?", "description": "My use case is that I need to run a somewhat expensive middleware for the routes that are served through `pages`. \r\n\r\nI have a custom server whose code kinda looks like this (unnecessary items omitted for brevity):\r\n\r\n```typescript\r\nconst handle = app.getRequestHandler()\r\n\r\nconst bootstrap = async () => {\r\n    await app.prepare()\r\n\r\n    const server = express()\r\n\r\n    server.use(somewhatExpensiveMiddleware)\r\n\r\n    server.use(customRouter) // has logic for calling `app.render(req, res, pathname)` accordingly\r\n\r\n    server.all('*', (req, res, next) => {\r\n         return handle(req, res)\r\n    })\r\n}\r\n```\r\n\r\nThat middleware needs to run on which request which is for whatever is in the `pages` directory. However with this setup, the `handle` method provided by Next.js is the one that serves that static asset. Is there a way through which I can place the handling of that static asset earlier in my middleware chain - for both dev and production environments, without breaking any functionality?\r\n\r\n**Note:** the static asset could be both: either placed in `public` directory or the compiled `css`, `js` by Next.js which is served through `.next`.\r\n\r\nThanks in advance! 🙏 "}
{"sentences": "What is @next/react-dev-overlay exactly?", "description": "No usage docs or screenshots. Google just shows npmjs.com clones. Kinda curious what it is and how to use it."}
{"sentences": "Next JS Standalone build queries", "description": "Hello Team,\r\n\r\nI am using the next js standalone experimental feature, which reduces the docker image size. I have a query: How do I add a few extra deps during prod build without declaring it in project `imports?`\r\n\r\n**For Example:**\r\n\r\nI have a `sharp` npm package in my package.json dependencies; since I am using the standalone build, how do I enforce the next js to include the sharp package `.next/standalone/node_modules` during build time?\r\n\r\nAny help here would be highly appreciated.\r\n"}
{"sentences": "Block Bad Bots", "description": "I'm trying to block some bots, but by robots.txt it's not blocking. Another simple method would be using .htaccess but Vercel doesn't have it.\r\n\r\nAny simple way to block?\r\n\r\nSo it doesn't work.\r\nUser-agent: BLEXBot \r\nDisallow: / \r\nUser-agent: BLEXBot Crawler \r\nDisallow: / \r\nUser-agent: BLEXBot/1.0 \r\nDisallow: / "}
{"sentences": "Dynamic Import returns LoadableComponent instead of Module", "description": "# Bug report\r\n\r\n## Describe the bug\r\n\r\nWhen I try to load Phaser using `dynamic imports` in a JSX component, it fails to load the `Phaser` object.\r\nInstead, the loaded object is a `LoadableComponent`, and when I try to create the Phaser object, I receive this error:\r\n\r\n`TypeError: Phaser.Game is not a Constructor` (see screenshot below)\r\n\r\n## To Reproduce\r\n\r\n\r\nI've created a sample repository to make it easy for anyone to reproduce the error:\r\nhttps://github.com/renatodex/react-phaser-issue\r\n\r\nThe repo has 2 a `components` folder with 2 files using different techniques to import `Phaser`.\r\n\r\n### 1. components/this_module_works.js\r\n\r\nThis file is a simple JS module, and I've used an `await` import on the `phaser` module to retrieve it only in client side (i check for `typeof window !== 'undefined'`)\r\nIt's imported on the `index.js` page and it works normally.\r\n\r\n### 2. components/this_component_is_broken.js\r\n\r\nHere, the idea is to make it a Component to be used on the main page.\r\nI tried to use the `dynamic import` to retrieve the `phaser` module, but it always returns a `LoadableComponent` instance, instead of returning the `Phaser` object.\r\n\r\nAs a result, the page throws an error when you try to import it.\r\n\r\n## Expected behavior\r\n\r\nThe error happens because the Dynamic Import returns a `LoadableComponent`, and I was expecting it to return the `Phaser` object as a result.\r\n\r\nThe TypeError is basically thrown because `LoadableComponent` is not the `Phaser` object.\r\n\r\n## Screenshots\r\n\r\n![image](https://user-images.githubusercontent.com/68507/82956291-e08d1d80-9f86-11ea-8fbf-ca04254f81d0.png)\r\n\r\n## System information\r\n\r\n- macOS\r\n- chrome\r\n- Version of Next.js: 9.4.2\r\n- Version of Node.js: v12.14.1\r\n- Version of Phaser: 3.23\r\n\r\n## Additional context\r\n\r\nThe repository is a simple Next app. You can run the server using `yarn run dev` or something.\r\n"}
{"sentences": "Ignore typescript typing error when building from `Next.js` v12.0.7", "description": "How to ignore the error below? The error originates from `node_modules`. Apparently, the directory exclusion of `node_modules/**/*` in `tsconfig.json` is not working. \r\n\r\nI have checked #16385 but it's not helpful because I meant to ignore those errors coming from `node_modules`, but not the type checking of my code. (Build should fail if my code have any typescript build error)\r\n\r\n### Error message\r\n\r\n```\r\n> next build\r\n\r\ninfo  - Loaded env from E:\\Personal@SSD\\Game\\DL\\dragalia-site-front\\.env\r\nFailed to compile.\r\n\r\n./node_modules/recharts/src/component/DefaultTooltipContent.tsx:4:15\r\nType error: Could not find a declaration file for module 'lodash'. 'E:/Personal@SSD/Game/DL/dragalia-site-front/node_modules/lodash/lodash.js' implicitly has an 'any' type.\r\n  Try `npm i --save-dev @types/lodash` if it exists or add a new declaration (.d.ts) file containing `declare module 'lodash';`\r\n\r\n  2 |  * @fileOverview Default Tooltip Content\r\n  3 |  */\r\n> 4 | import _ from 'lodash';\r\n    |               ^\r\n  5 | import React, { PureComponent, CSSProperties, ReactNode } from 'react';\r\n  6 | import classNames from 'classnames';\r\n  7 | import { isNumOrStr } from '../util/DataUtils';\r\ninfo  - Checking validity of types .ERROR: \"build:next\" exited with 1.\r\n```\r\n\r\n### `tsconfig.json`\r\n\r\n```\r\n{\r\n  \"compilerOptions\": {\r\n    /* Visit https://aka.ms/tsconfig.json to read more about this file */\r\n    /* Basic Options */\r\n    \"target\": \"es2020\",\r\n    \"module\": \"commonjs\",\r\n    \"esModuleInterop\": true,\r\n    \"jsx\": \"preserve\",\r\n    \"lib\": [\r\n      \"dom\",\r\n      \"dom.iterable\",\r\n      \"esnext\"\r\n    ],\r\n    \"plugins\": [\r\n      {\"name\": \"typescript-plugin-css-modules\"}\r\n    ],\r\n    /* Compiling Options */\r\n    \"allowJs\": false,\r\n    \"removeComments\": true,\r\n    \"resolveJsonModule\": true,\r\n    \"isolatedModules\": true,\r\n    \"noFallthroughCasesInSwitch\": true,\r\n    \"typeRoots\": [\r\n      \"node_modules/@types\",\r\n      \"types\"\r\n    ],\r\n    /* Strict Type-Checking Options */\r\n    \"strict\": true,\r\n    /* Module Resolution Options */\r\n    \"moduleResolution\": \"node\",\r\n    \"allowSyntheticDefaultImports\": true,\r\n    /* Advanced Options */\r\n    \"skipLibCheck\": true,\r\n    \"forceConsistentCasingInFileNames\": true,\r\n    \"noEmit\": true,\r\n    \"incremental\": true\r\n  },\r\n  \"include\": [\r\n    \"pages/**/*\",\r\n    \"server/**/*\",\r\n    \"src/**/*\",\r\n    \"types/**/*\"\r\n  ],\r\n  \"exclude\": [\r\n    \"node_modules\",\r\n  ]\r\n}\r\n```"}
{"sentences": "Using the 'fs' module in pages/_middleware.js", "description": "Hey guys!\r\n\r\nI'm trying to organize my middlewares in a separate directory and dynamically importing them from 'fs', but I got `Module not found: Can't resolve 'fs'`.\r\n\r\nShouldn't it work since the middleware runs on the server side?"}
{"sentences": "Incompatible href and as values when using Catch All Route", "description": "I'm using contextual routing with next-use-contextual-routing on a page that is a catch all route ([...slug]) and am getting the error:\r\n> The provided `as` value (/post/1/Work) is incompatible with the `href` value (/company/[...slug]). \r\n\r\nReact dev tools also gave the following warning:\r\n> Mismatching `as` and `href` failed to manually provide the params: slug in the `href`'s `query`\r\n\r\nIt seems the query params are being passed to the href value incorrectly for a catch all route. \r\n\r\nThe path of the main page is:\r\n\r\n`/company/1/Company`\r\n\r\n And the Contextual href that is generated for it is: \r\n\r\n`/company/[...slug]?slug[0]=1&slug[1]=Company `\r\n\r\nWhat is the correct way of passing query params to a catch all slug route?"}
{"sentences": "Nextjs MongoDB template: clientPromise is not a function", "description": "I am using Next.js's MongoDB example template and it comes with a MongoDB util function:\r\n\r\n```js\r\nimport { MongoClient } from 'mongodb';\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client;\r\nlet clientPromise;\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Please add your Mongo URI to .env.local');\r\n}\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n  if (!global._mongoClientPromise) {\r\n    client = new MongoClient(uri, options);\r\n    global._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = global._mongoClientPromise;\r\n} else {\r\n  client = new MongoClient(uri, options);\r\n  clientPromise = client.connect();\r\n}\r\nexport default clientPromise;\r\n```\r\n\r\n\r\nHere is how I am using it and I am certain that I am using this incorrectly.\r\n\r\n\r\n```js\r\nimport { clientPromise } from '../../lib/mongodb';\r\n\r\nexport default async (req, res) => {\r\n  try {\r\n    const db = await clientPromise();\r\n    const users = await db.collection('users').find({}).limit(20).toArray();\r\n    res.json(users);\r\n  } catch (e) {\r\n    console.error(e);\r\n    res.json({ error: 'Not connected!' });\r\n  }\r\n};\r\n```\r\n\r\nThe error is \"TypeError: (0 , lib_mongodb__WEBPACK_IMPORTED_MODULE_0_.clientPromise) is not a function\"\r\n\r\nCan someone give me a snippet of how to correctly use \"clientPromise\" object returned by the util script?\r\n\r\n"}
{"sentences": "HMR doesn't work when external react and react-dom.", "description": "### What version of Next.js are you using?\n\n11.1.2\n\n### What version of Node.js are you using?\n\n16.11.1\n\n### What browser are you using?\n\nChrome\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\nNo. But you can check reproduce link below.\n\n### Describe the Bug\n\nI have an application which required `window.React` and `window.ReactDOM`, so i modify the webpack externals field in *next.config.js* like this:\r\n```js\r\n// next.config.js\r\n/** @type {import('next').NextConfig} */\r\nmodule.exports = {\r\n  reactStrictMode: true,\r\n  webpack(config, { isServer }) {\r\n    if (!isServer) {\r\n      config.externals = {\r\n        next: 'next',\r\n        react: 'React',\r\n        'react-dom': 'ReactDOM'\r\n      }\r\n    }\r\n    return config;\r\n  }\r\n}\r\n```\r\nBut when i do this, the page can't hot reload when editing code. And there is no warning or error in the Chrome console panel. Only when i manually refresh the page, the latest code can work as well.\n\n### Expected Behavior\n\nHMR works as usual.\n\n### To Reproduce\n\nhttps://github.com/MrKou47/nextjs-hmr-notwork-demo"}
{"sentences": "Splash Screen while server is generating?", "description": "How do I show a Splash Screen (any component actually) while server is generating the HTML to pages/Index (getStaticProps)?\r\n\r\nI know that can be done with Router when navigate to another page, but It doesn't work on the home page (I want to show it on site loading). Any help it's appreciated. Thanks."}
{"sentences": "Deployment error with next-learn - Module not found: Can't resolve 'date-fns' in '/vercel/path0/components'", "description": "Beginner doing the basics. I compared basics-final to my repo and it's identical apart from:\r\n\r\n- Added .babelrc file as a workaround for the SWC ERR_DLOPEN_FAILED error\r\n- Removed vercel.svg\r\n\r\nI got these lines in the deployment status:\r\n\r\n```\r\nFailed to compile.\r\n./components/date.js\r\nModule not found: Can't resolve 'date-fns' in '/vercel/path0/components'\r\n```\r\n\r\npackage.json looks ok to me:\r\n\r\n```\r\n{\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\"\r\n  },\r\n  \"dependencies\": {\r\n    \"date-fns\": \"^2.11.1\",\r\n    \"gray-matter\": \"^4.0.2\",\r\n    \"next\": \"latest\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n    \"remark\": \"^14.0.1\",\r\n    \"remark-html\": \"^15.0.0\"\r\n  }\r\n}\r\n```\r\n"}
{"sentences": "Facebook comment moderator system don't work", "description": "I try to add `<meta property=\"fb:app_id\" content=\"{YOUR_APP_ID}\" />` a lot of time in `<Head></Head>` section but it's don't show that I'm a mod in facebook comment plugin. How can I fix that?"}
{"sentences": "【beginner】I found a place to fix it in the doc, but I don't know where the file is in the folder.", "description": "I'm a newbie trying to send a pull request to OSS for the first time.\r\n\r\nI want to send a pull request for the ↓ page.\r\nhttps://nextjs.org/learn/basics/dynamic-routes/render-markdown\r\n\r\nWhere can I find the page to modify this page in next.js?\r\n\r\nI fixed it with git and finished until clone, but then I can't find the file to fix.\r\n\r\nI would appreciate it if you could answer."}
{"sentences": "Unminified code in \"webpack\" folder in production", "description": "Hi,\r\n\r\nIn the production version of our website - I'm able to see our unminified code through the browser's devtools, and I'm trying to disable this. \r\n\r\nIt looks to me like the sourceMaps for the files are being included inline in the generated javascript files in base64 encoded format. Can someone help me work out how to disable this for production?\r\n\r\nThanks"}
{"sentences": "ReferenceError: AbortController is not defined", "description": "### What version of Next.js are you using?\n\n^12.0.7\n\n### What version of Node.js are you using?\n\n14.17.3\n\n### What browser are you using?\n\nChrome\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\ndevelopment\n\n### Describe the Bug\n\nI have `Navbar` with search bar which shows suggestions on input change.\r\n`Navbar` is added in `_app.js` so it remains on every page on website.\r\nWhen we type something into input, I use code below to load suggestions.\r\n```\r\nuseEffect(() => {\r\n    const loadData = async () => {\r\n        const res = await fetch('/api/autocomplete?q=' + input)\r\n        const json = await res.json()\r\n        setSuggestions(json.results)\r\n    }\r\n    loadData()\r\n}, [input])\r\n```\r\nAPI takes few seconds to return data.\r\nWhen we type something and press enter, it goes to search results page.\r\nBut fetch keeps loading even when route is changed.\r\nAfter few seconds when API returns a response, suggestions list pops up.\r\n\r\nIs there any way to cancel all fetch requests when route changes?\r\n\r\nI found that `AbortController` might work in this case.\r\n```\r\nconst controller = new AbortController()\r\nconst signal = controller.signal\r\n\r\nuseEffect(() => {\r\n    const handleRouteChange = (url, { shallow }) => {\r\n        controller.abort()\r\n    }\r\n    router.events.on('routeChangeStart', handleRouteChange)\r\n}, [])\r\n\r\nuseEffect(() => {\r\n    const loadData = async () => {\r\n        const res = await fetch('/api/autocomplete?q=' + input, { signal })\r\n        const json = await res.json()\r\n        setSuggestions(json.results)\r\n    }\r\n    loadData()\r\n}, [input])\r\n```\r\nIt throws this error:\r\n```\r\nServer Error\r\nReferenceError: AbortController is not defined\r\n```\n\n### Expected Behavior\n\nI think `AbortController` is only available on client side, but how can I handle this error?\n\n### To Reproduce\n\nNothing"}
{"sentences": "Add more i18n configuration options", "description": "### Describe the feature you'd like to request\r\n\r\nI would like to request for three features in the new feature of i18n setup available since NextJS 10 (awesome start btw!).\r\n\r\n## 1. have localeDetection available per domain\r\n\r\nThe current implementation sees translations not more then a simple transformation of the website. So if i turn it on it is nice that when having english as default in my browser it goes to domain.com instead of domain.nl\r\n\r\nBut for larger companies domains are more like a Point Of Sale with own rules and an own market. Now the feature request is to have `localeDetection` as option per domain. That will fix the fact for belgium/chinese etc we can just order the languages available on that domain, so not outside. And prevent them to go to a total other domain.\r\n\r\nSo:\r\n```\r\n      {\r\n        domain: 'mpth.fr',\r\n        locales: ['fr-FR', 'en-FR'],\r\n        defaultLocale: 'fr-FR',\r\n        localeDetection: true,\r\n      },\r\n ```\r\n\r\n## 2. have defaultLocale as optional\r\n\r\nFor some domains defaults are perfect. So for french website, french makes more sence when also giving english as option. French people like it, certainly when using localeDetection for that domain. But their neighbours will not like that so much. So on Belgium if i make Dutch or French as default, half of the nation will not like that its the default, also SEO etc. When we make it optional, root will simply go to one of the two. Certainly with feature request 1 that will fit perfectly.\r\n\r\n```\r\n      {\r\n        domain: 'mpth.be',\r\n        locales: ['nl-BE', 'fr-BE'],\r\n        localeDetection: true,\r\n      },\r\n ```\r\n \r\n ## 3. have locale rewrites as option\r\n \r\nTo have more flexibilty and not having rewrite schema's all over the place maybe its nice to offer locale rewrites. So  allthough using 'nl-BE', there is an option to have it in url like 'nl' by making it transformable. Or even 'nl/be' like Nike/etc. It will give us so much flexibilty.\r\n \r\n ```\r\n      {\r\n        domain: 'mpth.be',\r\n        locales: ['nl-BE', 'fr-BE'],\r\n        localeDetection: true,\r\n        rewrites: {\r\n          'nl-BE': 'nl',\r\n          'fr-BE': 'fr'\r\n        }\r\n      },\r\n ```\r\n \r\n or\r\n \r\n  ```\r\n      {\r\n        domain: 'mpth.com',\r\n        locales: ['nl-BE', 'fr-BE', 'en', etc...],\r\n        localeDetection: true,\r\n        rewrites: {\r\n          'nl-BE': 'nl/be',\r\n          'fr-BE': 'fr/be',\r\n          etc...\r\n        }\r\n      },\r\n ```\r\n\r\n__I know with 3 feature requests in 1 my chances are not so high. But i just want to have mentioned them so i do get a chance to use NextJS in some really bigger domains. Thanks for reading!__\r\n\r\n### Describe the solution you'd like\r\n\r\nI gave clear examples in my Request. If not clear i would be happy to discuss.\r\n\r\n### Describe alternatives you've considered\r\n\r\nWriting my own Middleware which hooks up on the internals of NextJS. Which is a path I can't take because it feels dirty and it is.\r\n\r\nDeploying application per POS. So each having a different routing setup, label sheet generation (so will be able to use 'nl' etc), and configurable 'locale' stuff on multiple places to make most code re-usable. Now containers cant be re-used when traffic on other domains need more containers, so have to spin them up instead of using the quiet ones (cheaper). But it also doesn't solve issue 2.\r\n\r\nTrying to explain clients there is a trade-off in using the most versatile/flexible framework. But these discussions don't go well since in the end we have to deliver what they want."}
{"sentences": "How to run \"next dev\" general app on HTTPS instead of HTTP on localhost", "description": "I want to run my Next App on let say `https://localhost:3000` just **the general application**, \r\n\r\nAs we have options to run REACT apps on `https`  but i can't find the same for Next apps,"}
{"sentences": "How to fetch Serverside data on NextJS 12 from an external API?", "description": "I want to be able to make an API call on my serverside to be able to fetch all the data required to build the page before sending it back to the client.\r\n\r\nI used to do this using getServerSideProps inside of my page but now that getServerSideProps is not available anymore im confused on how to do this.\r\n\r\nI have some async functions that return the fetched data from the api:\r\n\r\n```\r\nexport async function getPrimaryData() {\r\n    const response = await axios.get('https://example.com/primary-data/')\r\n    return response.data\r\n}\r\n\r\nexport async function getSecondaryData() {\r\n    const response = await axios.get('https://example.com/secondary-data/')\r\n    return response.data\r\n}\r\n```\r\nAnd this is how I used to call it inside my page, for example \"index.js\":\r\n\r\n```\r\nexport async function getServerSideProps(context) {\r\n    const [primaryData, secondaryData] = await Promise.all([\r\n        getPrimaryData(),\r\n        getSecondaryData()\r\n    ])\r\n\r\n    return {props: {primaryData, secondaryData}}\r\n}\r\n```\r\n\r\nThen I would simply get the data from the props of the page:\r\n\r\n`props.primaryData`\r\n\r\n\r\n**How can I do the same type of fetching using NextJS 12?**\r\n\r\nI was looking through the new NextJS documentation and couldn't find anything on how to do it."}
{"sentences": "Blank page, white page on mobile. Is there a software to see error on mobile?", "description": "Hi my app run ok on desktop but on mobile it is blank, page loaded done but its just white page. Is there a software to run mobile browser to see what error like F12 on desktop?  Thank you. "}
{"sentences": "I am getting an error in `Implemeting getStaticProps` guide page", "description": "```jsx\r\n <ul className={utilStyles.list}>\r\n   {console.log(allPostsData)}\r\n   {allPostsData.map(({ id, date, title }) => (\r\n                        ^\r\n     <li className={utilStyles.listItem} key={id}>\r\n       {title}\r\n       <br />\r\n```\r\nHere I have the exact same code as given in the documentation according to [this page](https://nextjs.org/learn/basics/data-fetching/implement-getstaticprops). when I try to log `allPostsData` it logs `undefined` in console."}
{"sentences": "Cannot set property 'styles' of undefined", "description": "### What version of Next.js are you using?\n\n11.0.1\n\n### What version of Node.js are you using?\n\n16.4.1\n\n### What browser are you using?\n\nchrome\n\n### What operating system are you using?\n\nwindows\n\n### How are you deploying your application?\n\nvercel\n\n### Describe the Bug\n\nI'm trying to use antd on nextjs project but with less options its really getting crazy.\r\n\r\n\r\nmy next.config.js\r\n\r\n`const withSass = require('@zeit/next-sass');\r\nconst withLess = require('@zeit/next-less');\r\nconst withCSS = require('@zeit/next-css');\r\n\r\nif (typeof require !== 'undefined') {\r\n  require.extensions['.less'] = (file) => { };\r\n}\r\n\r\nmodule.exports = withCSS({\r\n  cssModules: true,\r\n  cssLoaderOptions: {\r\n    importLoaders: 1,\r\n    localIdentName: '[local]___[hash:base64:5]',\r\n  },\r\n  ...withLess(\r\n    withSass({\r\n      lessLoaderOptions: {\r\n        javascriptEnabled: true,\r\n      },\r\n    })\r\n  ),\r\n});\r\n`\r\n\r\n\r\n```\r\nThen I run next dev\r\n\r\n$ next dev\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\ninfo  - Loaded env from D:\\Projects\\powerdev-frontend\\.env.local      \r\ninfo  - Loaded env from D:\\Projects\\powerdev-frontend\\.env.development\r\ninfo  - Using webpack 5. Reason: Enabled by default https://nextjs.org/docs/messages/webpack5\r\nWarning: Built-in CSS support is being disabled due to custom CSS configuration being detected.\r\nSee here for more info: https://nextjs.org/docs/messages/built-in-css-disabled\r\n\r\nTypeError: Cannot set property 'styles' of undefined\r\n    at module.exports (D:\\Projects\\powerdev-frontend\\node_modules\\@zeit\\next-css\\css-loader-config.js:25:56)\r\n    at Object.webpack (D:\\Projects\\powerdev-frontend\\node_modules\\@zeit\\next-css\\index.js:15:36)\r\n    at getBaseWebpackConfig (D:\\Projects\\powerdev-frontend\\node_modules\\next\\dist\\build\\webpack-config.js:162:454)    \r\n    at async Promise.all (index 0)\r\n    at async HotReloader.start (D:\\Projects\\powerdev-frontend\\node_modules\\next\\dist\\server\\hot-reloader.js:16:133)   \r\n    at async DevServer.prepare (D:\\Projects\\powerdev-frontend\\node_modules\\next\\dist\\server\\next-dev-server.js:16:453)\r\n    at async D:\\Projects\\powerdev-frontend\\node_modules\\next\\dist\\cli\\next-dev.js:22:1\r\nerror Command failed with exit code 1.\r\n```\n\n### Expected Behavior\n\nİt must be de easy to use any css type what with nextjs its really going bad.\n\n### To Reproduce\n\nTry to use antd with next lates and see what happen"}
{"sentences": "Cant change locale on 404 page on Vercel", "description": "I created a project with NextJs and made a custom translation hook which works perfectly fine. I dont know since when but after deploying to Vercel I cant change my locale. Locally it still works and I know it used to work on Vercel too.\r\n\r\nYou can find my Repo [here](https://github.com/Alex289/Portfolio)"}
{"sentences": "When are redirects processed? Build-time only? How can we fetch them from a CMS?", "description": "During development, Next.js works great at fetching redirects using the `redirects` async function in `next.config.js`.\r\n\r\nHaving built and deployed to production, none of the changes in the CMS are appearing, so I'm trying to confirm if redirects are only processed _once,_ at build-time, or if there's an option I need to turn on to enable a more ISR-like approach with the defaults from the build, but also occasional updates from the CMS?"}
{"sentences": "Is using next/head to set canonical urls good enough for SEO purposes?", "description": "We have an e-commerce application that is using next/head to set the page-specific canonical urls.  In the page source, the canonical url has not been set, because next/head operates client-side after the page loads.  A consultant has warned us that not having the canonical url in the page source might negatively impact SEO because of the way bots behave.\r\n\r\nTwo questions:\r\n(a) Is next/head a sufficient solution for bot traffic for SEO purposes, and if not\r\n(b) is there a way to statically set the head in a page-specific way?\r\n\r\nI looked into writing a custom document, but the custom document appears to be common to all pages and not possible to set a head value that's specific to a particular page.  Thanks in advance for your thoughts."}
{"sentences": "Is it possible to create page for locale manually? (asking because of MDX)", "description": "Hi everyone! \r\n\r\nIs it possible to create locale version of a page manually? \r\n\r\nSay I have a page `/info` with two language versions (en and cs). I need my links (https://example.com/en/info and https://example.com/cs/info) resolve to two different documents in my `/pages` folder. \r\n\r\n## Why am I asking\r\n\r\nI've started with MDX today by [this guide](https://nextjs.org/docs/advanced-features/using-mdx) and it is **very cool**. As I understand the guide though, it is meant to be used only at the page level. This is edited example from the guide that sits on `pages/info.mdx`:\r\n\r\n```\r\nimport { MyLayoutComponent } from 'my-components'\r\n\r\n# English version of INFO page\r\n\r\nThis is a list in markdown:\r\n\r\n- One\r\n- Two\r\n- Three\r\n\r\nexport default = ({ children }) => <MyLayoutComponent>{children}</MyLayoutComponent>\r\n```\r\n\r\nHow should I proceed when I need the czech version of this page as well? Is creating manual locale versions of the pages the way or would you suggest another approach altogether?\r\n\r\nLet me know if the question makes sense. Thanks in advance, P!"}
{"sentences": "CSS is broken after upgrading to v11", "description": "Hi, I have been unable to upgrade to `next@11` since upgrading breaks the CSS layout, as you can see here in the deployment under this PR: https://github.com/carbon-app/carbon/pull/1249\r\n\r\n![image](https://user-images.githubusercontent.com/8397708/139374664-65d35a13-04c4-4d65-a9ee-3986ee03daef.png)\r\n\r\nAfter any re-render (try typing in the main editor), the layout is fixed. \r\n\r\nCc @samsisle would love your help on this—this issue is preventing us from upgrading, and I would love to try out v12! 🙂 "}
{"sentences": "Does NextJs have an official chat on Gitter or Discord", "description": "Was looking to see if nextjs had an official chat on Discord. I have often found communities and chats in Discord to be quite helpful and welcoming to new members and it also serves as a great place to ask questions. \r\n\r\nI looked around on both gitter and discord and didn't find anything so was wondering if that could be something worth considering\r\n\r\n\r\nThanks for the awesome work that is being done here."}
{"sentences": "how can i redirect to another port (ps:host) in middleware file", "description": "`lmiddleware` file in pages directory:\r\n![image](https://user-images.githubusercontent.com/57590348/145143446-c162bf8c-fa82-4f12-b038-5dc6ddcfc12e.png)\r\n\r\n***WANT HELP*** :  i want to redirect to another port in `middleware` file, i want to change port only. \r\n\r\n*For example*: current location is `http://192.168.1.8:3000/about`,i want to redirect to `http://192.168.1.8:3001/about` in `middleware` file, how can i do it? `NextResponse.redirect()` does't work here.\r\n![image](https://user-images.githubusercontent.com/57590348/145143818-9d3c6cfd-a7e7-4dd2-bcdb-40ca274b493e.png)\r\n\r\nCan someone help me, thanks"}
{"sentences": "Conflicting public files and dynamic routes", "description": "Hi everyone 👋🏻 \r\n\r\nI'm currently working on a project where I have a dynamic route and I need to serve old HTML files (because they are using some old Flash content and I don't have the time to update it all).\r\n\r\nHere's my current folder structure:\r\n```\r\n|── public/\r\n    |── floorplans/\r\n        |── [... some HTML files here using dirty Flash stuff]\r\n|── pages/\r\n    |── [location]/\r\n        |── index.js\r\n\r\n```\r\n\r\nI can correctly access the ressources during development (http://localhost:3000/floorplans/etc.html) but as soon as I go in production, Next.js seems to want to ping my dynamic route instead of my `public` folder ressource as it does during development.\r\n\r\nAny ideas why or how to handle that? I've tried to use rewrites (either through `next.config.js` or `_middleware.js`) but I don't think it's possible to target `/public` explicitly…?\r\n\r\nThanks in advance!"}
{"sentences": "next 12, openapi-generator (without babel with swc)", "description": "I want to enable SWC support on my project, but `.babelrc` file won't let me do that. If I delete it, I get a error.\r\n<img src=\"https://user-images.githubusercontent.com/23018061/141802018-0269651f-6a0b-48fa-8168-f8a37a19651e.png\" width=\"500\">\r\n[codesandbox with error](https://codesandbox.io/s/next-with-openapi-without-babelrc-dcsvu)\r\nbut with the .babelrc file it works \r\n[working codesandbox ](https://codesandbox.io/s/next-with-openapi-yf7c3)\r\nHow can I get swc in my project and with openapi support without babel ?\r\nMaybe I should create an issue?\r\n\r\n\r\n"}
{"sentences": "Can a Next.js component call an async function?", "description": "I have the following code that prints `Silly test{\"message\":\"response from fetch is complete\"}`...\r\n```\r\n// contents of pages/index.js file -----\r\nlet ar = { message: \"waiting for a response from our fetch...\" };\r\n\r\n// does not return while message response using async\r\nfunction archiveRes() {\r\n  // want to perform a POST fetch here and return response of fetch\r\n  return { message: \"response from fetch is complete\" };\r\n}\r\n\r\n// component used to archive the asset record locally in our database\r\nconst ArchiveResponseLocally = () => {\r\n  ar = archiveRes();\r\n  return <>{JSON.stringify(ar)}</>;\r\n};\r\n\r\nexport default function IndexPage() {\r\n  return (\r\n    <div>\r\n      Silly test\r\n      <ArchiveResponseLocally />\r\n    </div>\r\n  );\r\n}\r\n```\r\nHowever if I change the archiveRes function to `async function archiveRes() {...}` all that is printed is `Silly test{}`. Why is `{ message: \"response from fetch is complete\" }` not returned if archiveRes is changed to an async function?\r\n"}
{"sentences": "query params are automatically dropped", "description": "When visiting `localhost:3000?foo=bar`, the website will automatically drop `foo=bar` and redirect to `localhost:300`\r\nI am using `getStaticProps`\r\n\r\nI am wondering why is this behavior happening? it doesn't seem to be documented very well.\r\n\r\nI understand params can't be accessed in `getStaticProps`, I just want to them to be available on client side, so some of my UI (tab) can be rendered correctly"}
{"sentences": "Next.js 10.0.3 gives Javascript heap out of memory error in dev environment with Tailwind CSS (PostCSS Plugin)", "description": "Describe the problem:\r\nI am using TailwindCSS 2.0.2 with Next.js 10.0.3.\r\nTailwindCSS plugin is causing very high memory requirement for Next.js (Node.js process eats all memory), sometimes it also throws Javascript heap out of memory error.\r\n\r\nHot reloading is slow (even if I manage it in some way) but the real pain is Next.js+tailwinds setup takes 3-4x memory compared to others (like I was using Bulma)\r\nWith Next.js+Bulma/Bootstrap setup = ~250mb\r\nWith Next.js+TailwindCSS as PostCSS plugin = ~800mb-1.5gb memory\r\n\r\nLink to a minimal reproduction:\r\nClone this repo.\r\nhttps://github.com/vercel/next.js/tree/canary/examples/with-tailwindcss\r\n\r\nand run it in next.js dev environment and watch out your memory usage (generally it remains around 200-300MB but with Tailwinds 1.2GB).\r\n\r\nI tried to debug it and as soon as I disable tailwinds plugin in PostCSS everything again goes normal.\r\n\r\nThe real problem seems to be in tailwinds PostCSS Plugin, is there any way to reduce memory usage or fix this issue?\r\n\r\nPS: The real problem is I don't want to trigger Out of memory error on the server during the build time.\r\nI am using UBUNTU 20.04 on the local system (just to know this is not a problem related to OS)."}
{"sentences": "My website deployed on Vercel keeps giving me the \"429: TOO_MANY_REQUESTS\" errors. It hasn't been launched yet, so it can't be having too much traffic. What could be going wrong, how can I debug this?", "description": "Occassionally (maybe about half the time) when I load a page on the [website](https://nexy.io/) I'm working on, I'm getting an error that looks like [this](https://i.imgur.com/KEqtSQq.png).\r\n\r\n> 429: TOO_MANY_REQUESTS  \r\n> Code: INTERNAL_FUNCTION_RATE_LIMIT  \r\n> ID: lhr1::258d8-1638206479250-0a01c8648601\r\n\r\nMy website hasn't been launched yet, almost nobody visits it but me, so it can't be having too much traffic yet.\r\n\r\nThe page I'm loading has a `getServerSideProps()` function that does only one thing - uses prisma to fetch posts from my database, which are sent to my component to be rendered.\r\n\r\nI can't imagine what could be causing too many requests.\r\n\r\nMy vercel usage stats look like [this](https://i.imgur.com/pmWaMfR.png).\r\n\r\nWhat am I doing wrong? What could be causing this? How can I debug this?\r\n\r\n[Here's a gist](https://gist.github.com/lumenwrites/83d8fcac2623de6901bc6e730db36b09) where I have included all the relevant code. Any chance you could take a look at it and let me know if you have any ideas on what could be happening?"}
{"sentences": "Create app via `yarn create next-app` but fail", "description": "I try to create a next-app via `yarn create next-app --typescript` command which was written in [documentation](https://nextjs.org/docs/getting-started). It works well, with no errors or warnings. But I got an error in vs code, it seems like this:\r\n![image](https://user-images.githubusercontent.com/39087996/144104007-df74940c-443d-4753-926f-1f7eeca18aee.png)\r\nAnd the IDE hints to me that I have some problems in `/next.config.js`:\r\n![image](https://user-images.githubusercontent.com/39087996/144104175-d99e8858-8f31-467f-a703-4e9ce3a797f4.png)\r\nAnd I try to ensure every package were installed:\r\n![image](https://user-images.githubusercontent.com/39087996/144104521-4b169ac6-c793-48eb-8fef-a76df4f1c5f0.png)\r\nBut I still got the problem :(\r\nAnd if I try to run `yarn dev` or `next`, I got this:\r\n![image](https://user-images.githubusercontent.com/39087996/144104734-a9f89f88-add1-4743-ad34-49cc4b4c1dda.png)\r\n\r\nSo I try to figure out it's my fault？I miss any important part in documentation？I remember that's how I created the project before, but there was no problem.\r\n\r\nThat's my env:\r\n![image](https://user-images.githubusercontent.com/39087996/144105839-9a605fc2-f6b9-47f7-928a-d34b19ffab7d.png)\r\n"}
{"sentences": "How to use the Edge Runtime for getStaticProps ISR?", "description": "Is there a way to run getStaticProps revalidation in the Edge Runtime?"}
{"sentences": "Building on Netlify fails", "description": "Hey everyone, I'm trying to build my NextJS project, which was working well, until I seemed to have added some packages.\r\n\r\nI added `mongodb`, `ioredis`, `password-validator`, `email-validator`, and `token-generator`.\r\n\r\nI have only used these to build a register API endpoint so far, yet I got the error: \r\n\r\n````\r\nModuleNotFoundError: Module not found: Error: Can't resolve 'mock-aws-s3' in '/opt/build/repo/node_modules/@mapbox/node-pre-gyp/lib/util'\r\n````\r\nIt's interesting to me as I'm not using s3 buckets, but after I required it, I then got an error for not having `aws-sdk`. I then installed it, and finally got this final error:\r\n\r\n````\r\n ./node_modules/@mapbox/node-pre-gyp/lib/util/nw-pre-gyp/index.html\r\n Module parse failed: Unexpected token (1:0)\r\n You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\r\n > <!doctype html>\r\n | <html>\r\n | <head>\r\n > Build error occurred\r\n Error: > Build failed because of webpack errors\r\n     at /opt/build/repo/node_modules/next/dist/build/index.js:397:19\r\n     at async Span.traceAsyncFn (/opt/build/repo/node_modules/next/dist/telemetry/trace/trace.js:60:20)\r\n    at async Object.build [as default] (/opt/build/repo/node_modules/next/dist/build/index.js:77:25)\r\n\r\n\r\nI'm fairly new to NextJS (And even React, for that matter), so these kinds of things are strange to me coming from a PHP/Laravel/Composer Background.\r\n\r\nAny help with this would be greatly appreciated. Thanks!"}
{"sentences": "Splash Screen while server is generating", "description": "How do I show a Splash Screen (any component actually) while server is generating the HTML to pages/Index (getStaticProps)?\r\n\r\nI know that can be done with Router when navigate to another page, but It doesn't work on the home page (I want to show it on site loading). Any help it's appreciated. Thanks."}
{"sentences": "Unable to run example", "description": "I am able to replicate this when starting new workspaces from scratch on my Windows 10 Pro PC.\r\n(Version: 10.0.19043 Build 19043)\r\n\r\nI run the command\r\n`npx create-next-app nextjs-blog --use-npm --example \"https://github.com/vercel/next-learn/tree/master/basics/learn-starter\"`\r\n(from https://nextjs.org/learn/basics/create-nextjs-app/setup)\r\n\r\nthen I `cd .\\nextjs-blog\\` and `npm run dev` to get the following:\r\n```\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\n(node:10648) UnhandledPromiseRejectionWarning: ReferenceError: TextEncoder is not defined\r\n    at C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:67:19\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:900:5)\r\n    at Module._compile (internal/modules/cjs/loader.js:776:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:787:10)\r\n    at Module.load (internal/modules/cjs/loader.js:653:32)\r\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\r\n    at Module.require (internal/modules/cjs/loader.js:690:17)\r\n    at require (internal/modules/cjs/helpers.js:25:18)\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\writer.browser.server.js:6:20)\r\n(node:10648) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)\r\n(node:10648) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\r\n(node:10648) ExperimentalWarning: The fs.promises API is experimental\r\nReferenceError: TextEncoder is not defined\r\n    at C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:67:19\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:900:5)\r\n    at Module._compile (internal/modules/cjs/loader.js:776:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:787:10)\r\n    at Module.load (internal/modules/cjs/loader.js:653:32)\r\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\r\n    at Module.require (internal/modules/cjs/loader.js:690:17)\r\n    at require (internal/modules/cjs/helpers.js:25:18)\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\writer.browser.server.js:6:20)\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! @ dev: `next dev`\r\nnpm ERR! Exit status 1\r\nnpm ERR!\r\nnpm ERR! Failed at the @ dev script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     C:\\Users\\[NAME]\\AppData\\Roaming\\npm-cache\\_logs\\2021-11-28T21_51_12_073Z-debug.log\r\n```\r\n\r\nI confirmed that I am on an appropriate version of node by running `node -v` and getting `v10.16.0`.\r\n\r\nIf I use `npm init next-app nextjs-blog` I get the same error with a slightly different output when running:\r\n```\r\nready - started server on 0.0.0.0:3000, url: http://localhost:3000\r\n(node:7716) UnhandledPromiseRejectionWarning: ReferenceError: TextEncoder is not defined\r\n    at C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:67:19\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\cjs\\react-server-dom-webpack-writer.browser.development.server.js:900:5)\r\n    at Module._compile (internal/modules/cjs/loader.js:776:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:787:10)\r\n    at Module.load (internal/modules/cjs/loader.js:653:32)\r\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\r\n    at Module.require (internal/modules/cjs/loader.js:690:17)\r\n    at require (internal/modules/cjs/helpers.js:25:18)\r\n    at Object.<anonymous> (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\compiled\\react-server-dom-webpack\\writer.browser.server.js:6:20)\r\n(node:7716) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)\r\n(node:7716) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\r\nerror - Failed to load next.config.js, see more info here https://nextjs.org/docs/messages/next-config-error\r\nError: Not supported\r\n    at Object.loadConfig [as default] (C:\\Users\\[NAME]\\Work\\Personal\\nextjs-blog\\node_modules\\next\\dist\\server\\config.js:399:74)\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! nextjs-blog@ dev: `next dev`\r\nnpm ERR! Exit status 1\r\nnpm ERR!\r\nnpm ERR! Failed at the nextjs-blog@ dev script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     C:\\Users\\[NAME]\\AppData\\Roaming\\npm-cache\\_logs\\2021-11-28T21_56_48_134Z-debug.log\r\n```"}
{"sentences": "Change the element of the root __next div", "description": "Anyone knows how to change the element of the root __next div? I don’t want it to be a div"}
{"sentences": "Builds failing on Vercel (ERR_INVALID_URL)", "description": "Hi there, I am getting a peculiar build error exclusively on Vercel and was wondering what the issue could be:\r\n\r\n| Time | Log |\r\n| --- | --- |\r\n|14:54:22.261|Cloning github.com/arlyon/web-platform-react (Branch: master, Commit: 9cec193)|\r\n|14:54:23.096|Cloning completed: 835.048ms|\r\n|14:54:23.142|Analyzing source code...|\r\n|14:54:24.235|Installing build runtime...|\r\n|14:54:27.383|Build runtime installed: 3.147s|\r\n|14:54:29.822|Looking up build cache...|\r\n|14:54:30.077|Build Cache not found|\r\n|14:54:30.989|Installing dependencies...|\r\n|14:54:31.232|yarn install v1.22.17|\r\n|14:54:31.308|[1/4] Resolving packages...|\r\n|14:54:31.760|[2/4] Fetching packages...|\r\n|14:54:59.223|[3/4] Linking dependencies...|\r\n|14:54:59.224|warning \"@emotion/css > @emotion/babel-plugin@11.3.0\" has unmet peer dependency \"@babel/core@^7.0.0\".|\r\n|14:54:59.225|warning \"@emotion/css > @emotion/babel-plugin > @babel/plugin-syntax-jsx@7.14.5\" has unmet peer dependency \"@babel/core@^7.0.0-0\".|\r\n|14:54:59.226|warning \" > @tiptap/react@2.0.0-beta.95\" has unmet peer dependency \"@tiptap/core@^2.0.0-beta.1\".|\r\n|14:54:59.226|warning \"@tiptap/react > @tiptap/extension-bubble-menu@2.0.0-beta.50\" has unmet peer dependency \"@tiptap/core@^2.0.0-beta.1\".|\r\n|14:54:59.226|warning \"@tiptap/react > @tiptap/extension-floating-menu@2.0.0-beta.45\" has unmet peer dependency \"@tiptap/core@^2.0.0-beta.1\".|\r\n|14:54:59.232|warning \"react-hot-toast > goober@2.0.41\" has unmet peer dependency \"csstype@^2.6.2\".|\r\n|14:54:59.232|warning \" > @openapi-integration/swr-request-generator@0.7.3\" has unmet peer dependency \"tslib@>=2.1.0\".|\r\n|14:54:59.234|warning \" > eslint-plugin-prettier@4.0.0\" has unmet peer dependency \"prettier@>=2.0.0\".|\r\n|14:54:59.234|warning \"orval > @apidevtools/swagger-parser@10.0.3\" has unmet peer dependency \"openapi-types@>=7\".|\r\n|14:54:59.235|warning \" > tailwindcss@2.2.19\" has unmet peer dependency \"autoprefixer@^10.0.2\".|\r\n|14:54:59.235|warning \" > tailwindcss@2.2.19\" has unmet peer dependency \"postcss@^8.0.9\".|\r\n|14:54:59.236|warning \"tailwindcss > postcss-nested@5.0.6\" has unmet peer dependency \"postcss@^8.2.14\".|\r\n|14:55:24.613|[4/4] Building fresh packages...|\r\n|14:55:26.993|Done in 55.77s.|\r\n|14:55:27.021|Detected Next.js version: 12.0.4|\r\n|14:55:27.023|Running \"yarn run build\"|\r\n|14:55:27.301|yarn run v1.22.17|\r\n|14:55:27.331|$ next build|\r\n|14:55:28.118|Attention: Next.js now collects completely anonymous telemetry regarding usage.|\r\n|14:55:28.119|This information is used to shape Next.js' roadmap and prioritize features.|\r\n|14:55:28.119|You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:|\r\n|14:55:28.119|https://nextjs.org/telemetry|\r\n|14:55:28.119||\r\n|14:55:28.673|info  - Checking validity of types...|\r\n|14:55:46.069||\r\n|14:55:46.070|./src/pages/_document.tsx|\r\n|14:55:46.070|15:50  Warning: Unexpected any. Specify a different type.  @typescript-eslint/no-explicit-any|\r\n|14:55:46.070|16:37  Warning: Unexpected any. Specify a different type.  @typescript-eslint/no-explicit-any|\r\n|14:55:46.070||\r\n|14:55:46.070|./src/pages/clients/[clientId]/index.tsx|\r\n|14:55:46.070|82:15  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion|\r\n|14:55:46.071|83:18  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion|\r\n|14:55:46.072||\r\n|14:55:46.072|./src/pages/clients/[clientId]/principals/[principalId].tsx|\r\n|14:55:46.072|98:15  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion|\r\n|14:55:46.072|99:18  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion|\r\n|14:55:46.073||\r\n|14:55:46.073|./src/pages/clients/index.tsx|\r\n|14:55:46.073|31:11  Warning: 'principalData' is assigned a value but never used.  @typescript-eslint/no-unused-vars|\r\n|14:55:46.073||\r\n|14:55:46.073|./src/pages/clients/new.tsx|\r\n|14:55:46.074|35:10  Warning: 'loading' is assigned a value but never used.  @typescript-eslint/no-unused-vars|\r\n|14:55:46.074|36:9  Warning: 'session' is assigned a value but never used.  @typescript-eslint/no-unused-vars|\r\n|14:55:46.074|44:9  Warning: 'x' is assigned a value but never used.  @typescript-eslint/no-unused-vars|\r\n|14:55:46.074|46:27  Warning: 'value' is defined but never used.  @typescript-eslint/no-unused-vars|\r\n|14:55:46.074||\r\n|14:55:46.075|./src/pages/experts/index.tsx|\r\n|14:55:46.075|83:38  Warning: Unexpected any. Specify a different type.  @typescript-eslint/no-explicit-any|\r\n|14:55:46.075|165:35  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion|\r\n|14:55:46.075||\r\n|14:55:46.075|./src/pages/updates/[slug].tsx|\r\n|14:55:46.076|19:20  Warning: Unexpected any. Specify a different type.  @typescript-eslint/no-explicit-any|\r\n|14:55:46.076||\r\n|14:55:46.076|info  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules|\r\n|14:55:46.077|info  - Creating an optimized production build...|\r\n|14:55:46.078|warn  - using beta Middleware (not covered by semver) - https://nextjs.org/docs/messages/beta-middleware|\r\n|14:55:46.113|info  - Disabled SWC as replacement for Babel because of custom Babel configuration \".babelrc.js\" https://nextjs.org/docs/messages/swc-disabled|\r\n|14:55:46.805|info  - Using external babel configuration from /vercel/path0/.babelrc.js|\r\n|14:55:47.150|warn - As of Tailwind CSS v2.2, `lightBlue` has been renamed to `sky`.|\r\n|14:55:47.150|warn - Please update your color palette to eliminate this warning.|\r\n|14:59:33.658|info  - Compiled successfully|\r\n|14:59:33.658|info  - Collecting page data...|\r\n|14:59:34.009|(node:794) UnhandledPromiseRejectionWarning: TypeError [ERR_INVALID_URL]: Invalid URL: web-platform-react-3ga20uy39-arlyon.vercel.app|\r\n|14:59:34.009|at new NodeError (internal/errors.js:322:7)|\r\n|14:59:34.009|at onParseError (internal/url.js:270:9)|\r\n|14:59:34.009|at new URL (internal/url.js:346:5)|\r\n|14:59:34.009|at parseUrl (/vercel/path0/node_modules/next-auth/lib/parse-url.js:11:16)|\r\n|14:59:34.009|at Object.<anonymous> (/vercel/path0/node_modules/next-auth/react/index.js:70:34)|\r\n|14:59:34.009|at Module._compile (internal/modules/cjs/loader.js:1085:14)|\r\n|14:59:34.009|at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)|\r\n|14:59:34.010|at Module.load (internal/modules/cjs/loader.js:950:32)|\r\n|14:59:34.010|at Function.Module._load (internal/modules/cjs/loader.js:790:12)|\r\n|14:59:34.010|at Module.require (internal/modules/cjs/loader.js:974:19)|\r\n|14:59:34.010|(Use `node --trace-warnings ...` to show where the warning was created)|\r\n|14:59:34.010|(node:794) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 4)|\r\n|14:59:34.010|(node:794) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.|\r\n|14:59:34.012||\r\n|14:59:34.012|> Build error occurred|\r\n|14:59:34.015|TypeError [ERR_INVALID_URL]: Invalid URL: web-platform-react-3ga20uy39-arlyon.vercel.app|\r\n|14:59:34.016|at new NodeError (internal/errors.js:322:7)|\r\n|14:59:34.016|at onParseError (internal/url.js:270:9)|\r\n|14:59:34.017|at new URL (internal/url.js:346:5)|\r\n|14:59:34.017|at parseUrl (/vercel/path0/node_modules/next-auth/lib/parse-url.js:11:16)|\r\n|14:59:34.017|at Object.<anonymous> (/vercel/path0/node_modules/next-auth/react/index.js:70:34)|\r\n|14:59:34.017|at Module._compile (internal/modules/cjs/loader.js:1085:14)|\r\n|14:59:34.018|at Object.Module._extensions..js (internal/modules/cjs/loader.js:1114:10)|\r\n|14:59:34.019|at Module.load (internal/modules/cjs/loader.js:950:32)|\r\n|14:59:34.019|at Function.Module._load (internal/modules/cjs/loader.js:790:12)|\r\n|14:59:34.019|at Module.require (internal/modules/cjs/loader.js:974:19) {|\r\n|14:59:34.019|type: 'NodeError',|\r\n|14:59:34.019|input: 'web-platform-react-3ga20uy39-arlyon.vercel.app',|\r\n|14:59:34.020|code: 'ERR_INVALID_URL'|\r\n|14:59:34.020|}|\r\n|14:59:34.100|error Command failed with exit code 1.|\r\n|14:59:34.100|info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.|\r\n|14:59:34.122|Error: Command \"yarn run build\" exited with 1|\r\n\r\nSpecifically `TypeError [ERR_INVALID_URL]: Invalid URL: web-platform-react-3ga20uy39-arlyon.vercel.app`\r\n\r\nWhere is this coming from, why is this url not prefixed with the scheme, and what can I do about it? Local builds and the dev server work no problem.\r\n\r\nthanks,\r\n\r\nAlex\r\n"}
{"sentences": "How to use dynamic imports in hybrid amp page", "description": "We recently started converting some components as to be dynamically imported in our platform. It seems like on the pages that are also AMP, the dynamic imported components do not render. I was wondering if anyone else had this issue and how can we resolve this while still keeping the dynamic imports."}
{"sentences": "NextJS bandwidth usage on Vercel looks inflated", "description": "Has anyone else noticed that the bandwidth reported in Vercel's usage tab is much higher than the bandwidth actually transferred to the client's web browser?\r\n\r\nWhen I test the site myself with Chrome developer tools open, then view a page or two on my Vercel hosted site, the bandwidth number in Vercel's \"Usage\" tab goes up *much* more than the actual kB transferred according to Chrome developer tools.\r\n\r\nIn extreme cases, I might visit a page that takes up 130kB of Bandwidth, but at the same time Vercel's usage tab goes up by 2MB. \r\n\r\nI've tested this multiple times and it always happens. I currently host my development site on an actual domain on Vercel, and there is no one visiting it except me, so I know this can not be explained by someone else visiting the site at the same time."}
{"sentences": "ISR: incorrect behavior or concept misunderstanding", "description": "Hey guys! I've faced an issue with ISR mechanism.\r\nI've found a scenario at which my pages are not rebuilding and I'm not sure on which side is a problem.\r\nI have pages with slugs (e.g. articles), so my getStaticPaths() function looks like:\r\n```\r\nexport async function getStaticPaths() {\r\n\tconst articlesSlugs = await getSlugs();\r\n\treturn {\r\n\t\tpaths: articlesSlugs,\r\n\t\tfallback: 'blocking'\r\n\t};\r\n}\r\n```\r\nand my getStaticProps function looks like:\r\n```\r\nexport async function getStaticProps(context) {\r\n\tconst {params: {slug}} = context;\r\n\tconst pageData = await articlesDetailApi.get(slug);\r\n\tconst errorCode = pageData?.errorCode;\r\n\tif (errorCode || isEmpty(pageData)) {\r\n\t\treturn {\r\n\t\t\tnotFound: true\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tstore: {\r\n\t\t\t\tarticlesDetail: {\r\n\t\t\t\t\t[slug]: articlesDetail\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t},\r\n\t\trevalidate: 10\r\n\t};\r\n}\r\n```\r\nThe scenario which ends up with unexpected behavior is following:\r\n1. I create an article with slug \"test\". ALL FINE: I check this page on site and successfully get it\r\n2. I edit this article and change the slug to \"test-new\". ALL FINE: \"test-new\" returns the article, \"test\" returns 404\r\n3. I create a new article with slug \"test\", which was previously occupied. ERROR: I always get 404 on this slug, ISR not triggering for this page. Only full rebuild fixing this issue "}
{"sentences": "getInitialProps does not pass props to component", "description": "I have 1 page like this\r\n```\r\nconst Index = (props) => {\r\n  return <Layout page='home'>\r\n    {console.log(222, props)}\r\n    <Head>\r\n      {...}\r\n    </Head>\r\n    <Homepage clips={props.clips} />\r\n  </Layout>;\r\n}\r\n\r\nIndex.getInitialProps = async () => {\r\n  const res = await fetch(\r\n    `...`\r\n  )\r\n\r\n  const json = await res.json();\r\n  console.log(111, json);\r\n  return {\r\n    clips: json\r\n  }\r\n}\r\n\r\nexport default Index\r\n```\r\nAnd this is what I got from server log\r\n```\r\n111 [ { _id: '5f65f382a98ecd003d5ca53e',\r\n    ...' } ]\r\n222 {}\r\n```\r\n---\r\nNextJS version `9.1.5`\r\nThis was working well for me til I restructure project and have docker for the deployment.\r\n\r\nAnyone has an idea?"}
{"sentences": "Problem with router and revalidate", "description": "Hi!\r\n\r\nDid anyone experience troubles with `router.asPath` when used in the page that has `revalidate` set up in `getStaticProps`?\r\n\r\nSo what I do is a simple check:\r\n```typescript\r\nconst isCurrent = router.asPath === item.href;\r\n\r\n<Link\r\n  key={router.asPath}\r\n  href={item.href}\r\n>\r\n  <a\r\n    className={classNames(\r\n      isCurrent\r\n        ? \"border-indigo-500 text-gray-900\"\r\n        : \"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700\",\r\n      \"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium\"\r\n    )}\r\n    aria-current={isCurrent ? \"page\" : undefined}\r\n  >\r\n    {item.name}\r\n  </a>\r\n</Link>\r\n```\r\n\r\nThe issue is that for some reason the style that should be generated in case of `isCurrent = true`, is not applied. And that happens only if I have `revalidate: 60` set.\r\n\r\nIf I unset the revalidate, then style is as expected always.\r\n\r\nIt seems that there is some magic by vercels/nextjs SSG. I receive HTML with correct style within first 60seconds, but if I refresh after those 60sec, then HTML contains wrong styles as if `isCurrent` is false.\r\n\r\nOn client-side I see that React is comprehending correctly and isCurrent is set to true, but for some reason it doesn't override what was sent by backend, probably because of some magic optimisations done by `nextjs/vercel`.\r\n\r\nYou can see the problem here: https://www.mekleauto.lv/\r\nIf you switch to `Par Projektu` and back to `Pieejamie auto` then you will see that only then `Pieejamie auto` will be highlighted as selected."}
{"sentences": "Nx + next.js setup deployment on Vercel fails", "description": "Hello everyone, I have a weird issue with my Vercel deployments.\r\nBasically, I have an NX, next.js and Prisma setup running on Vercel.\r\nUp till today, I was able to build and deploy just fine.\r\nHowever, today builds started failing with this error:\r\n`npx: installed 0 in 2.848s`\r\nMy build command is `prisma generate && npx nx build project --prod`.\r\nPrisma is successfully installed and the client is generated.\r\n```\r\nPrisma schema loaded from prisma/schema.prisma\r\n--\r\n01:56:29.420 |  \r\n01:56:29.420 | ✔ Generated Prisma Client (3.5.0) to ./node_modules/@prisma/client in 152ms\r\n01:56:29.420 | You can now start using Prisma Client in your code. Reference: https://pris.ly/d/client\r\n01:56:29.420 | ```\r\n01:56:29.420 | import { PrismaClient } from '@prisma/client'\r\n01:56:29.420 | const prisma = new PrismaClient()\r\n01:56:29.421 | ```\r\n01:56:32.508 | npx: installed 0 in 2.848s\r\n01:56:32.509 | command not found: nx\r\n01:56:32.531 | Error: Command \"prisma generate && npx nx build project --prod\" exited with 1\r\n```\r\nThis is all working properly locally, but I've already spend a couple of hours on figuring out why it doesnt work in Vercel and couldn't figure it out. I've also tried creating an entirely new branch and building in it, but still stumble upon the same issue."}
{"sentences": "Using css modules on client-side rendered pages when incrementally adopting next.js", "description": "I'm attempting to incrementally convert a fairly large web app from CSR to SSR using next.js. I've converted a few pages so far, and am using a catchall page to render the rest of the pages using CSR. I'm still using react-router for routing on the CSR pages.\r\n\r\nSome of the CSR pages are using css modules, but the css seems to be missing on those pages. I understand that next.js is supposed to automatically support css modules out of the box, but is there something extra I need to do to get them to work on the pages which are still client-side rendered during incremental adoption?"}
{"sentences": "Dynamic and Static routes with next.js", "description": "Hello,\r\n\r\nI had a quick question about file based routing. Curious how to set it up for certain conditions. For example if I had a path such as `/foo/bar` that would map to `/foo/[id].js` in my file based router. \r\n\r\nIs it possible to have `/foo/baz` match `/foo/baz.js` and not have it match `/foo/[id].js. I tested it locally and it works, but want to make sure this is the appropriate way of handling it?"}
{"sentences": "Is it acceptable to name index.jsx page as export function called [Index]", "description": "When creating `index.jsx` on pages on NextJS.\r\n\r\nIs it fine if I named it Index also, even in other pages, as long as they are in different folder names?\r\n\r\nFor e.g.\r\npages/random/index.jsx\r\npages/dog/index.jsx\r\n\r\nCan their file function name is called `Index` rather than Random / Dog in their corresponding page name?\r\n```\r\nexport default function Index() {\r\n\r\n\treturn (\r\n\t\t// Code here\r\n\t)\r\n}\r\n```"}
{"sentences": "Error on Tutorial Setup", "description": "Newbie (literally) to Next.js issue. Walking through the tutorial and I'm getting the following error when I run any of the following commands:\r\n\r\n```\r\nnpx create-next-app nextjs-blog --use-npm --example \"https://github.com/vercel/next-learn/tree/master/basics/learn-starter\"\r\nnpm init next-app nextjs-blog --example \"https://github.com/vercel/next-learn-starter/tree/master/learn-starter\"\r\nnpm init next-app nextjs-blog\r\n```\r\n\r\nRunning any of those gives me the error:\r\n\r\n```\r\nnpm ERR! code ERR_INVALID_ARG_TYPE\r\nnpm ERR! The \"to\" argument must be of type string. Received null\r\n```\r\n\r\nI have run these commands using Git Bash, as well as within VSCode (I'm using Windows 11). Node version is 17.1.0"}
{"sentences": "Is there a way to rewrite url for files inside the public directory", "description": "I have an application where I'm hosting static Storybook files inside the public folder. Currently, I'm just redirecting it to something like \r\n\r\n```\r\n<Link href=\"/docs/index.html\"><a>Docs</a></Link>\r\n```\r\n\r\n and it's working fine, though I'd like the users to see\r\n\r\n```http://localhost:3000/docs``` \r\n\r\ninstead of \r\n\r\n```http://localhost:3000/docs/index.html```. \r\n\r\nIs there a way I can achieve this with v10.0.1?"}
{"sentences": "Identifying client/server in getServerSideProps", "description": "I need to run an expensive fetch in `getServerSideProps`. I need to only run it when it is called server-side.\r\n\r\nThe only solution I've seen is the hacky \"look for `/.next` in the `req.url` value\" to determine it is a client-side call.\r\nI don't particularly like this hack, since it feels like something the NextJS team would change at anytime (?)...\r\n\r\nSo I have investigated the request headers. And it seems like the following headers differ between server- and client-side calls:\r\n\r\n```\r\nsec-fetch-dest // \"document\" for server-side, \"empty\" for client-side\r\nsec-fetch-mode // \"navigate\" for server-side, \"cors\" for client-side\r\nsec-fetch-user // \"?1\" for server-side, undefined for client-side\r\n``` \r\n\r\nNow my idea is to strictly require all three server-side values to ensure it is a server-side call, e.g.:\r\n\r\n```\r\nconst isServerSide = secFetchDest === \"document\" && secFetchMode === \"navigate\" && secFetchUser === \"?1\"\r\n```\r\n\r\nDoes anyone have any insight into what would be the most stable solution for differing between client- and server-side requests in `getServerSideProps`?\r\n\r\nSidenote: I would prefer using getServerSideProps over getInitialProps, (1) due to it being the preferred NextJS method, and (2) it containing a very nice `redirect` option."}
{"sentences": "Question about middleware", "description": "Am I correct that middleware runs on the client? I am unable to access server-side stuff like `fs` and I'm wondering if there is a way to make it run on the server and have similar execution behavior to `getServerSideProps`."}
{"sentences": "Adding class to html before interactive", "description": "I'd like to add class before the site is interactive by using `<Script strategy=\"beforeInteractive\" src=\"/script.js\"/>`, but I couldn't add class to `html` tag, but instead, I could add class to `body` tag.\r\n\r\nSo the code is\r\n`_app.tsx`\r\n```ts\r\nexport default function MyApp({ Component, pageProps }: AppProps) {\r\n    return <>\r\n        <Script strategy=\"beforeInteractive\" src=\"/scripts/darkMode.js\"/>\r\n        <Component {...pageProps} />\r\n    </>\r\n}\r\n```\r\n\r\nand `darkMode.js`\r\n```js\r\ndocument.documentElement.classList.add(\"dark\");\r\n```\r\n\r\nThese are not working as I expect, just `document.body.classList.add(\"dark\");` can work."}
{"sentences": "Should I versioning `tsbuildinfo`?", "description": "Hey peps.\r\n\r\nI notice that after migrating to NextJS 12, my TS Config got a new config called `incremental` and that generates a `tsconfig.tsbuildinfo` files at root level.\r\n\r\nIf I understood correctly from TypeScript docs, it's meant to make the compilation faster and can be deleted safely.\r\n\r\nIn that sense, we don't have to version it, right? I was wondering if we track that the production build would be even faster but I'm not sure.\r\n\r\nAny ways, silly question but I couldn't find any resources on that (for NextJS ofc).\r\n\r\n### Resources\r\n- https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-4.html#faster-subsequent-builds-with-the---incremental-flag"}
{"sentences": "Next/image component from 3rd party library throws next.config.js error", "description": "We developed a lib to pair our headless CMS with Next.js. This lib also contains a next/image component to additionally handle our cms' payload.\r\n\r\n```typescript\r\ntype SomeImageProps = Omit<ImageProps, ExcludedTypes> & {\r\n    imageFile: ImageFile;\r\n    className?: string;\r\n};\r\n\r\nexport const SomeNextImage: React.FC<SomeImageProps> = ({\r\n    imageFile,\r\n    className,\r\n    ...nextImageProps\r\n}) => {\r\n\r\n    ...\r\n\r\n    return isBitmapImage(imageFile) ? (\r\n        <Image\r\n            className={className}\r\n            src={imageFile.imageUrl}\r\n            width={imageFile.width}\r\n            height={imageFile.height}\r\n            {...nextImageProps}\r\n        />\r\n    ) : (\r\n        ...\r\n    );\r\n};\r\n```\r\nThe issue is, that trying to use this component by importing it from `node_modules`, the following error will be thrown:\r\n\r\n> Error: Invalid src prop (...) on next/image, hostname \"...\" is not configured under images in your next.config.js\r\n\r\nThe error makes sense if you haven't added the hostname to your config, but we have. Directly using `next/image` works just fine.\r\n\r\nHence it seems like our lib doesn't has access to `next.config.js` or doesn't know where it's located. What's the best way to solve this issue? "}
{"sentences": "rewrites will render twice", "description": "I'm trying the [example project](https://github.com/mui-org/material-ui/tree/master/examples/nextjs) of `material-ui`, and if I add this code to my `next.config.js`, the page will render twice. I just visit `/about`, not `/`, it still render twice (check by adding a console.log in `about.js`), and if I remove the `rewites` in `next.config.js`, it will just render once like normal :\r\n\r\n```\r\nmodule.exports = {\r\n    async rewrites() {\r\n        return [\r\n            {\r\n                source: '/',\r\n                destination: '/about',\r\n            },\r\n        ]\r\n    }\r\n}\r\n\r\n```"}
{"sentences": "deploying Tailwind with Next.js to Vercel not worked", "description": "Repo here: https://github.com/rikusen0335/miso-host\r\n\r\nI tried few way and deployed this but Tailwind still not working. Did I something wrong with this?\r\n\r\nEdit: Progressions: I confirmed that production build isn't work too"}
{"sentences": "newbie help with getStaticProps", "description": "Hi all,\r\n\r\nWas hoping someone might be able to give me some advice on an issue I have with my first next.js site build.\r\n\r\nI have a collection of mdx files in a directory \"/projects\" ...\r\n\r\nIn my index.js I use getStaticProps to return a projects object, which I then pass into a component `<ProjectList projects={projects}  />` which then maps over the projects and  outputs a link to each project via a [slug].js template.\r\n\r\nThe issue I'm having is I would like to be able to output the full set of projects again in the same fashion as in my index.js from within my [slug].js, which is already using getStaticProps to provide data to the single (slug) template. I'm having some difficulty working out the best way to integrate these two tasks, and essentially also map out all my projects from within the [slug].js template as I do in index.js...\r\n\r\nHopefully showing some code is more clear than I can explain here... \r\n\r\nIndex.js:\r\n\r\n```javascript\r\n\r\nimport fs from 'fs'\r\nimport path from 'path'\r\nimport matter from 'gray-matter'\r\n\r\nimport ProjectList from '../components/project-list'\r\nimport IndexTitle from '../components/index-title'\r\nimport Footer from '../components/footer'\r\n\r\n\r\nconst index = ({ projects }) => (\r\n    <>\r\n      <IndexTitle />\r\n      <ProjectList projects={projects.filter((project) => project.frontMatter.featured === true)} />\r\n      <Footer />\r\n    </>\r\n);\r\n\r\n\r\n\r\n\r\nconst getStaticProps = async () => {\r\n  const files = fs.readdirSync(path.join('projects'))\r\n  const projects = files.map(filename => {\r\n    const markdownWithMeta = fs.readFileSync(path.join('projects', filename), 'utf-8')\r\n    const { data: frontMatter } = matter(markdownWithMeta)\r\n    return {\r\n      frontMatter,\r\n      slug: filename.split('.')[0]\r\n    }\r\n  })\r\n  return {\r\n    props: {\r\n      projects\r\n    }\r\n  }\r\n}\r\n\r\nexport {getStaticProps};\r\nexport default index;\r\n```\r\n\r\n\r\n\r\n[slug].js\r\n\r\n```javascript\r\nimport { serialize } from 'next-mdx-remote/serialize'\r\nimport { MDXRemote } from 'next-mdx-remote'\r\nimport fs from 'fs'\r\nimport path from 'path'\r\nimport matter from 'gray-matter'\r\nimport ProjectText from '../../components/project-text'\r\nimport ImageFull from '../../components/image-full'\r\nimport ProjectMeta from '../../components/project-meta'\r\nimport Footer from '../../components/footer'\r\n\r\nconst components = { ProjectText, ImageFull, ProjectMeta  }\r\n\r\nconst ProjectPage = ({ frontMatter, mdxSource }) => {\r\n  return (\r\n      <div>  \r\n          <ImageFull url={frontMatter.heroUrl} priority={true} />\r\n          <MDXRemote {...mdxSource} components={components} />\r\n          <ProjectMeta frontMatter={frontMatter} />\r\n          <Footer />\r\n      </div>\r\n  )\r\n}\r\n\r\nconst getStaticPaths = async () => {\r\n  const files = fs.readdirSync(path.join('projects'))\r\n\r\n  const paths = files.map(filename => ({\r\n    params: {\r\n      slug: filename.replace('.mdx', '')\r\n    }\r\n  }))\r\n\r\n  return {\r\n    paths,\r\n    fallback: false\r\n  }\r\n}\r\n\r\nconst getStaticProps = async ({ params: { slug } }) => {\r\n  const markdownWithMeta = fs.readFileSync(path.join('projects',slug + '.mdx'), 'utf-8')\r\n\r\n  const { data: frontMatter, content } = matter(markdownWithMeta)\r\n  const mdxSource = await serialize(content)\r\n\r\n  return {\r\n    props: {\r\n      frontMatter,\r\n      slug,\r\n      mdxSource\r\n    }\r\n  }\r\n}\r\n\r\nexport { getStaticProps, getStaticPaths }\r\nexport default ProjectPage\r\n```\r\n\r\nSo ideally I'm looking for how I can achieve these two tasks using the same getStaticProps on my [slug].js template and then include my `<ProjectList />` component to display all the projects within [slug].js\r\n\r\nAny advice greatly appreciated.\r\n\r\nThanks! "}
{"sentences": "iSSG build cache is not purged on deploy", "description": "I'm using Vercel and Nextjs iSSG build, after deleting one page from repository it remains accessible from custom domain. From localhost i'm getting 404 on this page, what is correct. From documentation i understood that redeploying should purge cache but it doesn't..\r\n\r\nDomain is in cloudflare i added it to Vercel without Proxy, purging cache from Cloudflare doesn't help\r\n\r\n```js\r\ngetStaticProps() {\r\n  return {\r\n    props: {\r\n           ...\r\n    },\r\n    revalidate: 60 * 3,\r\n  };\r\n}\r\n```\r\n\r\n<img width=\"1083\" alt=\"Screenshot 2021-11-08 at 14 34 12\" src=\"https://user-images.githubusercontent.com/88837148/140743813-b34b4ff5-675a-4247-9176-8a4f2e9ca1eb.png\">\r\n<img width=\"802\" alt=\"Screenshot 2021-11-08 at 14 34 19\" src=\"https://user-images.githubusercontent.com/88837148/140743996-8e7df8b1-5ad6-4a6a-a98d-c2685163dd3c.png\">\r\n<img width=\"447\" alt=\"Screenshot 2021-11-08 at 14 55 08\" src=\"https://user-images.githubusercontent.com/88837148/140745823-21531d33-347a-4e72-b8f2-ac6c493d90dc.png\">\r\n\r\n"}
{"sentences": "Returning notFound in getServerSideProps causes an error.", "description": "Hi. I'm using Next.js 9.5.5 and love to develop with it so far.\r\n\r\nWhen I try to return { notFound: true } in getServerSideProps, it causes an error like below.\r\n![image](https://user-images.githubusercontent.com/712762/100986510-a1243700-3590-11eb-9386-8deb67299eaf.png)\r\n\r\nBut the [API reference (9.3 and up)](https://nextjs.org/docs/basic-features/data-fetching#getserversideprops-server-side-rendering) says it's possible to return `notFound` or `redirect` as a return object. \r\n![image](https://user-images.githubusercontent.com/712762/100986380-76d27980-3590-11eb-8c83-ed3de35a9a25.png)\r\n\r\nDid I miss something?"}
{"sentences": "How to reference global css class name from css module?", "description": "Hi all, I am using UI framework and I want to override default css class of component from this framework.\r\ne.g. I want to write scss module for my customized button and override internal button element\r\nwhich has global class name `lib-button-label`:\r\n```scss\r\n.myButton { // I will assign this class name to component\r\n  .lib-button-label { // this is class name of internal component element\r\n    background: red;\r\n  }\r\n}\r\n```\r\nBut next.js generates css with both `myButton` and `lib-button-label` class names appended by some suffixes to make them scoped.\r\nIs there any syntax to prevent nextjs do this for particular class name?\r\nsomething like this\r\n```scss\r\n// declare lib-button-label class as global so it will be left as is\r\n@global .lib-button-label;\r\n.myButton {\r\n  .lib-button-label { \r\n    background: red;\r\n  }\r\n}\r\n```\r\n"}
{"sentences": "NextJS 11 to 12 Upgrade dependency Warnings", "description": "Attempting to upgrade from Next@11.1.1 to Next@12. I'm receiving npm warnings on some dependencies. Any help in resolving this would be appreciated. Below is the package.json and the warning output:\r\n```\r\n \"dependencies\": {\r\n    \"@contentful/rich-text-react-renderer\": \"^15.2.0\",\r\n    \"@react-icons/all-files\": \"^4.1.0\",\r\n    \"classnames\": \"^2.3.1\",\r\n    \"contentful\": \"^8.3.6\",\r\n    \"contentful-management\": \"^7.24.0\",\r\n    \"cors\": \"^2.8.5\",\r\n    \"country-state-picker\": \"^1.1.5\",\r\n    \"dayjs\": \"^1.10.7\",\r\n    \"html2canvas\": \"^1.3.2\",\r\n    \"nanoid\": \"^3.1.28\",\r\n    \"next\": \"^11.1.2\",\r\n    \"ramda\": \"^0.27.1\",\r\n    \"react\": \"^17.0.2\",\r\n    \"react-content-loader\": \"^6.0.3\",\r\n    \"react-dom\": \"^17.0.2\",\r\n    \"react-hook-form\": \"^7.16.2\",\r\n    \"react-slideshow-image\": \"^3.4.7\",\r\n    \"sharp\": \"^0.29.2\",\r\n    \"shopify-buy\": \"^2.11.0\",\r\n    \"tailwindcss\": \"^2.1.2\",\r\n    \"validator\": \"^13.6.0\",\r\n    \"zustand\": \"^3.5.7\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@testing-library/dom\": \"^7.31.0\",\r\n    \"@testing-library/jest-dom\": \"^5.12.0\",\r\n    \"@testing-library/react\": \"^11.2.7\",\r\n    \"@testing-library/user-event\": \"^13.1.9\",\r\n    \"@types/jest\": \"^26.0.23\",\r\n    \"@types/node\": \"^15.6.1\",\r\n    \"@types/react\": \"^17.0.9\",\r\n    \"@types/react-dom\": \"^17.0.5\",\r\n    \"@types/shopify-buy\": \"^2.10.8\",\r\n    \"@types/validator\": \"^13.6.3\",\r\n    \"autoprefixer\": \"^10.2.5\",\r\n    \"babel-jest\": \"^27.0.1\",\r\n    \"jest\": \"^27.0.1\",\r\n    \"postcss\": \"^8.3.0\",\r\n    \"stylelint\": \"^13.13.1\",\r\n    \"stylelint-config-standard\": \"^22.0.0\",\r\n    \"typescript\": \"^4.2.4\"\r\n  },\r\n  \"engines\": {\r\n    \"npm\": \"^7.20\"\r\n  }\r\n```\r\nand the console warnings output:\r\n```\r\nnpm WARN ERESOLVE overriding peer dependency\r\nnpm WARN While resolving: react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN Found: react@17.0.2\r\nnpm WARN node_modules/react\r\nnpm WARN   peer react@\"^16.8.6 || ^17.0.0\" from @contentful/rich-text-react-renderer@15.5.1\r\nnpm WARN   node_modules/@contentful/rich-text-react-renderer\r\nnpm WARN     @contentful/rich-text-react-renderer@\"^15.5.1\" from the root project\r\nnpm WARN   12 more (@react-icons/all-files, @testing-library/react, ...)\r\nnpm WARN\r\nnpm WARN Could not resolve dependency:\r\nnpm WARN peer react@\"0.0.0-experimental-3c4c1c470-20211021\" from react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN node_modules/react-server-dom-webpack\r\nnpm WARN   react-server-dom-webpack@\"0.0.0-experimental-3c4c1c470-20211021\" from next@12.0.1\r\nnpm WARN   node_modules/next\r\nnpm WARN\r\nnpm WARN Conflicting peer dependency: react@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN node_modules/react\r\nnpm WARN   peer react@\"0.0.0-experimental-3c4c1c470-20211021\" from react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN   node_modules/react-server-dom-webpack\r\nnpm WARN     react-server-dom-webpack@\"0.0.0-experimental-3c4c1c470-20211021\" from next@12.0.1\r\nnpm WARN     node_modules/next\r\nnpm WARN ERESOLVE overriding peer dependency\r\nnpm WARN While resolving: react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN Found: react-dom@17.0.2\r\nnpm WARN node_modules/react-dom\r\nnpm WARN   peer react-dom@\"^16.8.6 || ^17.0.0\" from @contentful/rich-text-react-renderer@15.5.1\r\nnpm WARN   node_modules/@contentful/rich-text-react-renderer\r\nnpm WARN     @contentful/rich-text-react-renderer@\"^15.5.1\" from the root project\r\nnpm WARN   5 more (@testing-library/react, react-slideshow-image, ...)\r\nnpm WARN\r\nnpm WARN Could not resolve dependency:\r\nnpm WARN peer react-dom@\"0.0.0-experimental-3c4c1c470-20211021\" from react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN node_modules/react-server-dom-webpack\r\nnpm WARN   react-server-dom-webpack@\"0.0.0-experimental-3c4c1c470-20211021\" from next@12.0.1\r\nnpm WARN   node_modules/next\r\nnpm WARN\r\nnpm WARN Conflicting peer dependency: react-dom@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN node_modules/react-dom\r\nnpm WARN   peer react-dom@\"0.0.0-experimental-3c4c1c470-20211021\" from react-server-dom-webpack@0.0.0-experimental-3c4c1c470-20211021\r\nnpm WARN   node_modules/react-server-dom-webpack\r\nnpm WARN     react-server-dom-webpack@\"0.0.0-experimental-3c4c1c470-20211021\" from next@12.0.1\r\nnpm WARN     node_modules/next\r\nnpm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated\r\nnpm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated\r\nnpm WARN deprecated fsevents@1.2.13: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2.\r\nnpm WARN deprecated chokidar@2.1.8: Chokidar 2 will break on node v14+. Upgrade to chokidar 3 with 15x less dependencies.\r\nnpm WARN deprecated querystring@0.2.0: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.\r\n```"}
{"sentences": "Should a pure Server Component page have no JavaScript?", "description": "After reading the introduction to Server Components, specifically this paragraph:\r\n\r\n> With Server Components, there's zero client-side JavaScript needed, making page rendering faster\r\n\r\nI got the impression that a pure Server Component page should load no JavaScript. But after trying the demo and adding a page that was completely static, it still loaded JavaScript in the production build.\r\n\r\nIs this something that is still to be done, or is there something I have not understood correctly?"}
{"sentences": "How to enable babel.config.js during yarn dev", "description": "Trying to find a error/bug in next, I've followed the instructions for a **local mono repo example app** from here:\r\n\r\nhttps://github.com/vercel/next.js/blob/canary/contributing.md#develop-inside-the-monorepo\r\n\r\nIt seems that when I run **yarn next-with-deps ./next-example** and navigating to the index, the compilation step is not loading my custom **babel.config.js**\r\n\r\n# babel.config.js\r\n```\r\nmodule.exports = {\r\n  presets: [\"next/babel\"],\r\n  ignore: [\r\n    (fn) => {\r\n      console.log(fn);\r\n      if (fn) {\r\n        return fn.indexOf(\"pdfkit.standalone.js\") !== -1;\r\n      }\r\n      return false;\r\n    }\r\n  ]\r\n};\r\n\r\nconsole.log('test');\r\n```\r\n\r\n\r\n<img width=\"1349\" alt=\"Captura de Pantalla 2021-11-05 a la(s) 09 04 56\" src=\"https://user-images.githubusercontent.com/517228/140507973-de1cc854-0d61-44ad-9f1f-1ea29fd2d043.png\">\r\n\r\nOn start, the message \"using babel.config.js\" appears, also  \"test\" message showing on console. BUT the file `pdfkit.standalone.js` is not being ignored\r\n\r\n\r\nAny advice?\r\n"}
{"sentences": "Unable to configure nextjs to run with nginx server in docker", "description": "I am trying to setup nginx server in my dockerized nextjs app. The main `Dockerfile` & `docker-compose.yml` files live in project root while the nginx files live in `nginx/default.conf` and `nginx/Dockerfile`. \r\n\r\nWhen I run docker compose, the nginx server exits with the message `nginx: [emerg] host not found in upstream \"nextjs:3000\" in /etc/nginx/conf.d/default.conf:4`. \r\n\r\nHere are how my files look (code uploaded as an image to reduce length. Can upload as text if required):\r\n\r\n![nextjs-docker](https://user-images.githubusercontent.com/32391506/140492803-1881d75a-720b-4040-b652-3891de930cdb.png)\r\n- LEFT: `Dockerfile`\r\n- MIDDLE: `nginx/default.conf`\r\n- RIGHT-TOP: `docker-compose.yml`\r\n- RIGHT-BOTTOM: `nginx/Dockerfile`\r\n\r\nThe nextjs server runs fine on `localhost:3000`. Here are some resources I referred to\r\n- https://hkc7180.medium.com/nextjs-with-nginx-on-ec2-by-docker-compose-7558c838e0a4\r\n- https://steveholgado.com/nginx-for-nextjs/\r\n- https://github.com/vercel/next.js/tree/canary/examples/with-docker\r\n\r\nThis is quite new to me and I am unable to figure out how to forward nginx server for the nextjs frontend. How do I fix this?\r\nAny help is much appreciated. Thank you for your time."}
{"sentences": "Next/Image supported formats", "description": "Which all formats does next/image support. All I could find from the docs is that the image component optimizes the image in webp/avif wherever possible or serve it in the original format."}
{"sentences": "Env variable is undefined in next/image src", "description": "I have an environment variable (injected with dotenv)\r\n`NEXT_PUBLIC_UDATA_ROOT=https://udata.wayt.dev.travel`\r\n_that is the root where I store some files uploaded by users_.\r\n\r\nSo in a component, that renders the Image, I do:\r\n\r\n```tsx\r\n// ...\r\n\r\nconsole.info(Process.env.NEXT_PUBLIC_UDATA_ROOT);\r\nconst imgSrc = Process.env.NEXT_PUBLIC_UDATA_ROOT + '/path/to/image.jpg'\r\n\r\nreturn <Image\r\n  src={imgSrc}\r\n  objectFit=\"contain\"\r\n\r\n  // sizes have been calculated before\r\n  height={sizes.h}\r\n  width={sizes.w}\r\n/>\r\n\r\n//...\r\n```\r\n\r\nWell, the console properly logs \r\n```\r\nhttps://udata.wayt.dev.travel\r\n```\r\nbut the img is rendered with src=`\"undefined/path/to/image.jpg\"`\r\n\r\nI don't really understand how to solve this :/"}
{"sentences": "Module not found: Can't resolve 'fs'", "description": "## My code\r\n\r\n```js\r\nimport fs from \"fs\";\r\nimport matter from \"gray-matter\";\r\nimport path from \"path\";\r\nimport yaml from \"js-yaml\";\r\n\r\nconst postsDirectory = path.join(process.cwd(), \"content/posts\");\r\n\r\nexport type PostContent = {\r\n  readonly date: string;\r\n  readonly title: string;\r\n  readonly slug: string;\r\n  readonly desc: string;\r\n  readonly tags?: string[];\r\n  readonly fullPath: string;\r\n};\r\n\r\nlet postCache: PostContent[];\r\n\r\nexport function fetchPostContent(): PostContent[] {\r\n  if (postCache) {\r\n    return postCache;\r\n  }\r\n  // Get file names under /posts\r\n  const fileNames = fs.readdirSync(postsDirectory);\r\n  const allPostsData = fileNames\r\n    .filter((it) => it.endsWith(\".mdx\"))\r\n    .map((fileName) => {\r\n      // Read markdown file as string\r\n      const fullPath = path.join(postsDirectory, fileName);\r\n      const fileContents = fs.readFileSync(fullPath, \"utf8\");\r\n\r\n      // Use gray-matter to parse the post metadata section\r\n      const matterResult = matter(fileContents, {\r\n        engines: {\r\n          yaml: (s) => yaml.load(s, { schema: yaml.JSON_SCHEMA }) as object,\r\n        },\r\n      });\r\n      const matterData = matterResult.data as {\r\n        date: string;\r\n        title: string;\r\n        tags: string[];\r\n        desc: string;\r\n        slug: string;\r\n        fullPath: string,\r\n      };\r\n      matterData.fullPath = fullPath;\r\n\r\n      const slug = fileName.replace(/\\.mdx$/, \"\");\r\n\r\n      // Validate slug string\r\n      if (matterData.slug !== slug) {\r\n        throw new Error(\r\n          \"slug field not match with the path of its content source\"\r\n        );\r\n      }\r\n\r\n      return matterData;\r\n    });\r\n  // Sort posts by date\r\n  postCache = allPostsData.sort((a, b) => {\r\n    if (a.date < b.date) {\r\n      return 1;\r\n    } else {\r\n      return -1;\r\n    }\r\n  });\r\n  return postCache;\r\n}\r\n\r\nexport function countPosts(tag?: string): number {\r\n  return fetchPostContent().filter(\r\n    (it) => !tag || (it.tags && it.tags.includes(tag))\r\n  ).length;\r\n}\r\n\r\nexport function listPostContent(\r\n  page: number,\r\n  limit: number,\r\n  tag?: string\r\n): PostContent[] {\r\n  return fetchPostContent()\r\n    .filter((it) => !tag || (it.tags && it.tags.includes(tag)))\r\n    .slice((page - 1) * limit, page * limit);\r\n}\r\n```\r\n\r\n## Error\r\n\r\n```yaml\r\nerror - ./src/lib/posts.ts:1:0\r\nModule not found: Can't resolve 'fs'\r\n> 1 | import fs from \"fs\";\r\n  2 | import matter from \"gray-matter\";\r\n  3 | import path from \"path\";\r\n  4 | import yaml from \"js-yaml\";\r\n```\r\n\r\n## package.json\r\n\r\n```json\r\n{\r\n  \"name\": \"my-app\",\r\n  \"version\": \"0.1.1\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"export\": \"next build && next export -o ./dist\",\r\n    \"test\": \"jest\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@mapbox/rehype-prism\": \"^0.6.0\",\r\n    \"@svgr/webpack\": \"^5.5.0\",\r\n    \"@types/js-yaml\": \"^4.0.0\",\r\n    \"date-fns\": \"^2.19.0\",\r\n    \"gray-matter\": \"^4.0.2\",\r\n    \"js-yaml\": \"^4.0.0\",\r\n    \"next\": \"10.1.2\",\r\n    \"next-mdx-remote\": \"^2.1.3\",\r\n    \"normalize.css\": \"^8.0.1\",\r\n    \"react\": \"17.0.2\",\r\n    \"react-dom\": \"17.0.2\",\r\n    \"react-instagram-embed\": \"^2.0.0\",\r\n    \"react-schemaorg\": \"^1.3.1\",\r\n    \"react-twitter-embed\": \"^3.0.3\",\r\n    \"react-youtube\": \"^7.13.1\",\r\n    \"schema-dts\": \"^0.8.2\",\r\n    \"webpack\": \"^5.61.0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@types/jest\": \"^26.0.22\",\r\n    \"@types/node\": \"^14.14.37\",\r\n    \"@types/react\": \"^17.0.3\",\r\n    \"autoprefixer\": \"^10.4.0\",\r\n    \"jest\": \"^26.6.3\",\r\n    \"postcss\": \"^8.3.11\",\r\n    \"tailwindcss\": \"^2.2.19\",\r\n    \"ts-jest\": \"^26.5.4\",\r\n    \"typescript\": \"^4.2.3\",\r\n    \"yaml-loader\": \"^0.6.0\"\r\n  }\r\n}\r\n\r\n```\r\n\r\nHow can I solve this? 🙏🙏"}
{"sentences": "What will be the baseURL for api endpoints in Ngnix server for my nextjs app?", "description": "I have a nextjs app in which baseURL for development was localhost:3000 but I don't know what to set as a baseURL in production? Should it be the server address?"}
{"sentences": "Is there an SWC equivalent to `defaultLoaders.babel` passed to custom webpack config?", "description": "Is there an SWC equivalent to `defaultLoaders.babel` which is passed to a custom webpack config in `next.config.mjs`?"}
{"sentences": "NextJS 11 to 12 Upgrade dependency Warnings pt. 2", "description": "![image](https://user-images.githubusercontent.com/81380764/139137881-5382589e-6469-430f-bbe2-5c8812a9c3f0.png)\r\n\r\nIt's normal??"}
{"sentences": "Using next-bundle-analyzer with ESM and next.config.mjs", "description": "Has anyone used `next-bundle-analyzer` in next.config.mjs with ES modules enabled?\r\n\r\nnext-bundle-analyzer instruct to use the following setup:\r\n```\r\nconst withBundleAnalyzer = require('@next/bundle-analyzer')({\r\n    enabled: process.env.ANALYZE === 'true',\r\n})\r\nmodule.exports = withBundleAnalyzer({})\r\n```\r\n\r\nI tried changing it to this to use ES modules but ti doesn't work:\r\n\r\n```\r\nimport withBundleAnalyzer from '@next/bundle-analyzer';\r\n\r\nconst bundleAnalyzer = withBundleAnalyzer({\r\n\tenabled: process.env.ANALYZE === 'true',\r\n})\r\n\r\nconst nextConfig = {\r\n  webpackDevMiddleware: (config) => {\r\n    config.watchOptions = {\r\n      poll: 1000,\r\n      aggregateTimeout: 300,\r\n    };\r\n    return config;\r\n  },\r\n  poweredByHeader: false,\r\n  images: {\r\n    domains: [\r\n      'imagedomain.com',\r\n      'imagedomain2.com',\r\n    ],\r\n  },\r\n  // replacing Terser with SWC for minifying JavaScript\r\n  swcMinify: true,\r\n};\r\n\r\nexport function bundleAnalyzer(nextConfig)\r\n```\r\n\r\nThe current error I'm getting says `Failed to load next.config.mjs. SyntaxError: Unexpected end of input`\r\n\r\n"}
{"sentences": "Set next export directory from next.config", "description": "Is this even possible? I can see from the docs you can set the build directory from the config file, but from what I can see the export dir is only settable from the command line using the -o flag.\n\nReason for me asking is that I really need to set my export dir to an environment variable, and doing this from an npm script is long winded."}
{"sentences": "Can't seem to get some libraries (sanitize-html) working in IE", "description": "Hi,\r\nFew months ago we updated next 10 and enabled webpack 5 support. We also updated `react-int` which required use of `sanitize-html` and it seems that broke our builds for IE 11. I've tried to add `sanitize-html` along with `escape-string-regexp` to `transpile-modules` to make sure it's IE compatible, but it still creates a weird build. Right now it crashes because of a syntax error which seems to come from `postcss`, but adding that into `transpile-modules` does nothing.\r\n\r\nAlso looking into the resulting build, there is a bunch of arrow functions and other suff, that hasn't been there before. Is it possible webpack 5 somehow breaks the IE compatibility?\r\n\r\nWe tried different things:\r\n - Upgrade to next 11 and upgrade `transpile-modules`\r\n - Explicitly add `IE 11` into browserslist\r\n - Explicitly specify `IE 11` in `babel-env` configuration\r\n - Modify webpack configuration to exclude arrow functions and other things: https://webpack.js.org/configuration/output/#outputenvironment\r\n - Recreate [empty repo](https://github.com/tomaskallup/next-browserslist-not-working) with newest typescript template and replicate the problem\r\n\r\nReproduction:\r\nI've create a simple replication repo, which just has next typescript template & sanitize-html installed and used client-side.\r\nYou can clone the repo https://github.com/tomaskallup/next-browserslist-not-working\r\nRun `yarn build` follwed by `yarn start`\r\nAnd open the page in IE 11"}
{"sentences": "Next Js Static Hosting with Firebase", "description": "Hi,\r\n\r\nI have created website using _Next js_ (`next export`) and deployed on _Firebase_ but I am facing few issues 😞 \r\n\r\n**With SPA option enabled through Firebase CLI**\r\n \r\n\r\n- Users are getting `/` page even they are made initial request to other routes.\r\n\r\n> eg-: `/docs` -> `/` <br/>  `/contact` -> `/` <br/> This issue is happening only in _first/initial_ request only\r\n\r\n**Without SPA options enabled through Firebase CLI**\r\n\r\n- Users are getting 404 page even though they are made their initial valid request :(\r\n\r\n> eg-: `/docs` -> 404 Page <br/>  `/contact` -> 404 Page <br/> This issue is happening only in _first/initial_ request only\r\n---\r\n_Thanks in advance & Extremely Sorry if I made any mistakes_"}
{"sentences": "Firebase Static Hosting Issue", "description": "Hi,\r\n\r\nI have created website using _Next js_ (`next export`) and deployed on _Firebase_ but I am facing few issues 😞 \r\n\r\n**With SPA option enabled through Firebase CLI**\r\n \r\n\r\n- Users are getting `/` page even they are made initial request to other routes.\r\n\r\n> eg-: `/docs` -> `/` <br/>  `/contact` -> `/` <br/> This issue is happening only in _first/initial_ request only\r\n\r\n**Without SPA options enabled through Firebase CLI**\r\n\r\n- Users are getting 404 page even though they are made their initial valid request :(\r\n\r\n> eg-: `/docs` -> 404 Page <br/>  `/contact` -> 404 Page <br/> This issue is happening only in _first/initial_ request only\r\n---\r\n_Thanks in advance & Extremely Sorry if I made any mistakes_\r\n\r\n_Originally posted by @SanjaiyanUnofficial in https://github.com/vercel/next.js/discussions/30197_"}
{"sentences": "Is there a way to parse html in getStaticProps?", "description": "After some research, I found the following method.  \r\n[javascript - How to use DOMParser in next.js? - Stack Overflow](https://stackoverflow.com/questions/67915232/how-to-use-domparser-in-next-js)\r\n\r\nWhen I tried to use [node-html-parser](https://www.npmjs.com/package/node-html-parser) in ```getStaticProps```, I got the following error message.\r\n\r\n```\r\nServer Error\r\nTypeError: (0 , node_html_parser__WEBPACK_IMPORTED_MODULE_18__.default) is not a function\r\n\r\nconst converter = new QuillDeltaToHtmlConverter(body, config);\r\nconst articleBody = converter.convert();\r\nconst html = parse(articleBody);\r\n                  ▲\r\nconsole.log(html);\r\n```\r\n\r\nIs there a way to parse html in ```getStaticProps```? \r\n\r\n---\r\n\r\nThe purpose is to give an id attribute to a specific html tag in order to create a toc (table of contens).\r\n\r\n```typescript\r\nconst converter = new QuillDeltaToHtmlConverter(body);\r\nconst articleBody = converter.convert(); // \"<div><h2>foo</h2><h3>bar<h3><p>baz</p></div>\"\r\nconst html = parse(articleBody);\r\nconst headings = [...html.window.document.querySelectorAll(\"h2\")];\r\nheadings.forEach((elm, index) => {\r\n  elm.id = `chapter-${index}`;\r\n})\r\n...\r\n```"}
{"sentences": "Constantly getting disconnect", "description": "I am having this issue which is after I ran `npm run dev` then after some time I edited my code then it will suddenly disconnect. Does anyone know how to solve this?\r\n\r\n![error](https://user-images.githubusercontent.com/64187129/126890163-0f836dcb-a092-4b69-92c8-463e53beb6fa.png)\r\n\r\n"}
{"sentences": "How can i use external scripts in nextjs?", "description": "I have tried to follow the documentation which suggests using `Script` tag from `next/script` but it's not working.\r\n\r\nThis is my implementation in `index.js`\r\n\r\n```is\r\nimport Script from \"next/script\"\r\n\r\nexport default function Home() {\r\nreturn(\r\n<>\r\n...\r\n<Script\r\n        src='https://some.external.site/external.min.js'\r\n      />\r\n</>\r\n)\r\n}"}
{"sentences": "Is there a tracing tool available for nextjs?", "description": "What I am trying to do is find out how much time does it take for each function to run. The idea is to find out which things are making the app slower. "}
{"sentences": "Fast refresh isn't working in custom express server with typescript.", "description": "I'm using nextjs with my custom express server in typescript. But I'm facing a bunch of problems.\r\n\r\n1. After editing anything, it shows `compiled successfully`, but it's not refreshing the page. I need to manually refresh the page to see changes. \r\n2. It's adding a style \r\n```html\r\n<style data-next-hide-fouc=\"true\">body{display:none}</style>\r\n```\r\nWhich isn't removing. \r\n3. CSS import aren't working, only inline/internal CSS are working + adding link tag inside Head component also working.\r\n\r\nBut everything works fine in production mode.\r\n\r\nI've found that many other peoples also had this issue, but I'm not finding a proper solution.\r\n[#10285](https://github.com/vercel/next.js/issues/10285)\r\nOne solution is by adding `body{display:block;}` in _document.tsx which only solves display none issue but no CSS modules are loading.\r\n\r\nI've tried to remove all middlewares, removing all express routes but still it's not working."}
{"sentences": "Middleware error using exact code given in conf", "description": "I am testing out middleware using the exact code they used in the nextjs conf, but it is giving several errors, any idea whats up?\r\n\r\n```ts\r\nimport type { NextFetchEvent } from 'next/server'\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function middleware(event: NextFetchEvent) {\r\n  // Grab the user's location, or use US for the default\r\n  const country = event.request.geo?.country?.toLowerCase() || 'us'\r\n  // Rewrite to static, cached page for each locale\r\n  return new NextResponse(NextResponse.rewrite(`/edge/${country}`));\r\n}\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/35779365/138923845-6db7c931-db94-4b4f-bd92-8cdc5c85fa55.png)\r\n"}
{"sentences": "TypeError: Cannot read property 'pathname' of null (production system down)", "description": "Hello,\r\nThe production system is down after a recent deployment yesterday, although the same code works at the dev website.\r\n\r\nCould anybody please tell me what might the issue be here? \r\nI couldn't find anything online.\r\n\r\nUPDATE: commenting out this part from _document does actually solve the problem, but why?\r\n\r\n```\r\n<Link href={`/search`} prefetch={false}>\r\n                <a\r\n                    className=\"d-inline-block text-center\"\r\n                    style={{ textDecoration: 'none', color: darkColor }}\r\n                >\r\n                    <Search\r\n                        width=\"23px\"\r\n                        height=\"23px\"\r\n                        color={darkColor}\r\n                        style={{ display: 'block', margin: '0 auto' }}\r\n                    />\r\n                    <div className=\"icon-lbl\">\r\n                        <span>search</span>\r\n                    </div>\r\n                </a>\r\n            </Link>\r\n```\r\n\r\n```\r\n\r\nweb-app_1  | TypeError: Cannot read property 'pathname' of null\r\nweb-app_1  |     at Link (webpack-internal:///./node_modules/next/dist/client/link.js:159:14)\r\nweb-app_1  |     at processChild (/usr/src/app/node_modules/react-dom/cjs/react-dom-server.node.development.js:3043:14)\r\nweb-app_1  |     at resolve (/usr/src/app/node_modules/react-dom/cjs/react-dom-server.node.development.js:2960:5)\r\nweb-app_1  |     at ReactDOMServerRenderer.render (/usr/src/app/node_modules/react-dom/cjs/react-dom-server.node.development.js:3435:22)\r\nweb-app_1  |     at ReactDOMServerRenderer.read (/usr/src/app/node_modules/react-dom/cjs/react-dom-server.node.development.js:3373:29)\r\nweb-app_1  |     at renderToStaticMarkup (/usr/src/app/node_modules/react-dom/cjs/react-dom-server.node.development.js:4004:27)\r\nweb-app_1  |     at renderDocument (/usr/src/app/node_modules/next/dist/next-server/server/render.js:3:594)\r\nweb-app_1  |     at renderToHTML (/usr/src/app/node_modules/next/dist/next-server/server/render.js:47:72)\r\nweb-app_1  |     at runMicrotasks (<anonymous>)\r\nweb-app_1  |     at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\nweb-app_1  |     at async /usr/src/app/node_modules/next/dist/next-server/server/next-server.js:71:285\r\nweb-app_1  |     at async /usr/src/app/node_modules/next/dist/next-server/server/next-server.js:70:142\r\nweb-app_1  |     at async DevServer.renderToHTMLWithComponents (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:92:300)\r\nweb-app_1  |     at async DevServer.renderToHTML (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:93:255)\r\nweb-app_1  |     at async DevServer.renderToHTML (/usr/src/app/node_modules/next/dist/server/next-dev-server.js:30:578)\r\nweb-app_1  |     at async DevServer.render (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:50:236)\r\nweb-app_1  |     at async Object.fn (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:35:306)\r\nweb-app_1  |     at async Router.execute (/usr/src/app/node_modules/next/dist/next-server/server/router.js:38:67)\r\nweb-app_1  |     at async DevServer.run (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:44:494)\r\nweb-app_1  |     at async DevServer.handleRequest (/usr/src/app/node_modules/next/dist/next-server/server/next-server.js:13:101)\r\n```\r\n\r\n"}
{"sentences": "error eslint when I create a new project next", "description": "Hello\r\nI'm having eslint issues when I run the command yarn create next-app, the error below occurs\r\n![erro](https://user-images.githubusercontent.com/54441280/137643989-01759bfe-50e8-4736-be8c-b19d0b15e635.png)\r\n\r\nhow can i resolve this error?\r\n\r\n\r\n"}
{"sentences": "Will ISR push the latest version if there has been no change?", "description": "I'm trying to implement feature toggles in my Next.js solution, and part of the challenge is working out how to reflect the change when a toggle is switched on or off.\r\n\r\nIs there a way of making ISR conditional, so it only re-renders if there is a change...or would it just do that by default? i.e. if the page revalidates every 5 minutes, and there has been no toggle change, would it diff the cached and new page, and dispose of the new page if nothing is different?"}
{"sentences": "Can't run `next lint` because ESLint can't be found", "description": "I'm trying to run the default NextJS linter [as described here](https://nextjs.org/docs/basic-features/eslint), but the system is having trouble finding ESLint, even though it's installed.\r\n\r\nAfter running `npm run lint`, I got the following error:\r\n```\r\nerror - ESLint must be installed: yarn add --dev eslint\r\n```\r\n\r\nSo I run `yarn add --dev eslint` and confirm that the packages install correctly, and are added to package.json. When I try `yarn lint`, I'm prompted to configure ESLint. I answer a couple questions, and the config file is created (.eslintrc.json). So far so good!\r\n\r\nWhen I run `yarn lint` or `npm run lint` again, however, I get that same error as before I installed:\r\n\r\n```\r\nerror - ESLint must be installed: yarn add --dev eslint\r\n```\r\n\r\nAny idea why that package can't be found even though it's installed and I was able to configure it?"}
{"sentences": "Fetching data for PR build on Vercel", "description": "How do you load data in PR branches?\r\n\r\nThe code we attempted to use to make this work:\r\n\r\n```ts\r\nexport function getBaseUrl(): string {\r\n  if (!process.env.NEXT_PUBLIC_VERCEL_URL) return 'http://localhost:3000';\r\n\r\n  return `https://${process.env.NEXT_PUBLIC_VERCEL_URL}`;\r\n}\r\n\r\n// and then:\r\nexport async function getStaticProps(context: Context) {\r\n  await fetch(`${getBaseUrl()}/api/posts`);\r\n}\r\n```\r\n\r\nBut then we get an error during build.\r\n\r\nThe specific error I get when using the above approach is:\r\n\r\n> FetchError: invalid json response body at https://vercel.com/login?next=%2Fdeployments%2Fmysite-xyz.vercel.app%3Fhost%3Dxyz.vercel.app%26redirect%3D1%26section%3D reason: Unexpected token < in JSON at position 0\r\n\r\nFeel like this is a super common use case but I can't find any info on it."}
{"sentences": "Fast refresh fails in Google Chrome.", "description": "### What version of Next.js are you using?\n\n11.1.2\n\n### What version of Node.js are you using?\n\n16.9.1 (also fails with 14.18.1)\n\n### What browser are you using?\n\nChrome\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\nn/a\n\n### Describe the Bug\n\nThe HMR (or fast refresh?) is freezing and failing in Chrome with the following error:\r\n\r\n```js\r\nworkbox-7288c796.js:1 Uncaught (in promise) no-response: no-response :: [{\"url\":\"http://localhost:3000/_next/webpack-hmr?page=whatever\"}]\r\n    at Object.D (http://localhost:3000/workbox-7288c796.js:1:22102)\r\n    at async Object.v (http://localhost:3000/workbox-7288c796.js:1:7595)\r\n```\r\n\r\nThe tab appears to freeze and be unable to load, even on refresh.\r\n\r\nIf I kill the dev server, I get the following errors:\r\n\r\n![image](https://user-images.githubusercontent.com/23072548/138076230-23e47f37-85f3-4734-a06c-3fab1c7bd9c7.png)\r\n\r\n![image](https://user-images.githubusercontent.com/23072548/138076263-07352977-848b-4167-8c21-a88bbdab0140.png)\r\n\r\nThis fails on a new project (e.g. from `yarn create next-app`) as well as older projects, back to `next: 9.5.2`, which makes me wonder if it isn't an issue in Chrome. I have not encountered this bug in Safari.\n\n### Expected Behavior\n\nI would expect HMR / fast refresh to work as normal in Chrome.\n\n### To Reproduce\n\n- Create a new Next.js project\r\n- Yarn dev\r\n- Make changes that would prompt a refresh"}
{"sentences": "next app is being served from only build", "description": "Hi there, I've a next app. When I do a `yarn start/next start` there, it throws me an error with `Could not find a production build`. But after building the app, it only serves that built project, I am not getting any live interaction on browser whenever I make a change to my code.\r\n\r\n## Updated:\r\nI think this was my mistake. I've to run `yarn dev` instead of `yarn start`."}
{"sentences": "Do we have a way to access prefetch data when hovering over links?", "description": "Do we have a way to access prefetch data when hovering over links?\r\nfor example: when I hover to a link next.js prefetch to `/_next/data/D1vs16ncRHFStJyZUL4gH/game/1.json`\r\nI want to get the data from the above link to show a popup or preview."}
{"sentences": "Is it expected that building a project runs the actual code?", "description": "**What I would expect**: Building the project should not run the code.\r\n**What I am seeing**: It does run the code.\r\n\r\nReproduction here: https://github.com/Karuhanga/next-js-run-at-build-issue.\r\n[This](https://github.com/Karuhanga/next-js-run-at-build-issue/blob/594a1a9f0165e498b2697a4523eb7723e717b46d/pages/index.tsx?_pjax=%23repo-content-pjax-container#L6) is the cause of the failure.\r\n\r\nA similar repro with other TS projects does not so this."}
{"sentences": "How to set custom header from Server set value", "description": "I need to set 'deviceId' data in response Header from iOS set Header. Successfully test set static custom header. \r\nMy question: Is it possible to dynamically set custom header's `value` field?\r\n\r\nnext.config.js\r\n```\r\nmodule.exports = {\r\n  async headers() {\r\n    return [\r\n      {\r\n        source: '/:path*',\r\n        headers: [\r\n          {\r\n            key: 'deviceId',\r\n            value: 'deviceId_from_app' // --> Data from App's response header\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n}\r\n```"}
{"sentences": "Preview mode not working in production", "description": "I have tested preview mode locally and everything works fine. However, in production for some reason the cookies are not being set.\r\n\r\nIn production, the site is served over HTTPS, but the connection from the load balancer to the Next server is not over HTTPS, is that a problem?\r\n\r\nAnother note, when I curl my preview API endpoint `/api/preview/activate`, I get the Set-Cookie headers back.\r\n\r\n```\r\nset-cookie: __prerender_bypass=5b870eaf3a8e3870d9bfb89a95bda077; Max-Age=900; Path=/; HttpOnly; Secure; SameSite=None\r\nset-cookie: __next_preview_data=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoiMGFkMDg3MmZiNzM2ZTBlMGIzNzAzMDA1MTUzMTZjNjUzZTVhOWQ2ZjcwYjMwZDRlMTI0NmFlZWU1YzMwNDc1MDFmMGM4MWZmNzA3OWZkOGIwZjUwMzJlMjgxZTEyODI4NzRhMjRmYmU2MDRmZTgwYWU3NzMwNzA0MDZiNDA0NDQ3ZWRkMzIyNjQ5MDYzZTUyYWEzZTRlMzA3NWNiOGY5ZWY1MTUzMjMwMDljOTBhNzQ2YTM4MzgzM2RhMjVjYTI3MDI0YSIsImlhdCI6MTU4OTQ5MDk5MiwiZXhwIjoxNTg5NDkxODkyfQ.Pp3KQaP1bffTp7pJUSElrHCcCeWbt8zdOORZwb0IweY; Max-Age=900; Path=/; HttpOnly; Secure; SameSite=None\r\n```\r\n\r\n```js\r\nconst url = require('url');\r\n\r\nexport default (req, res) => {\r\n  const params = url.parse(req.url, true).query;\r\n  res.setPreviewData(\r\n    {},\r\n    {\r\n      maxAge: 60 * 15, // The preview mode cookies expire in 15 minutes\r\n    }\r\n  );\r\n  res.writeHead(307, { Location: params.redirectUri });\r\n  res.end();\r\n  res.finished = true;\r\n};\r\n\r\n```\r\n\r\nIt is entirely possible I have a fundamental misunderstanding of cookies. Any advice would be appreciated, I've been staring at this for hours."}
{"sentences": "next build is hanging on DigitalOcean Ubuntu server (timeout)", "description": "I have a barebones NextJS app I'm trying to deploy to a DigitalOcean droplet, but when I run `npm run build`, the process hangs at the \"Creating an optimized production build\" step. After several minutes, I get this error:\r\n\r\n```\r\nwarn  - Restarted collecting page data for /_app because it took more than 60 seconds\r\nwarn  - See more info here https://nextjs.org/docs/messages/static-page-generation-timeout\r\nwarn  - Restarted collecting page data for /about because it took more than 60 seconds\r\n(node:2165737) UnhandledPromiseRejectionWarning: Error: Collecting page data for /_app is still timing out after 2 attempts. See more info here https://nextjs.org/docs/messages/page-data-collection-timeout\r\n    at onRestart (/var/www/tes-site/node_modules/next/dist/build/index.js:444:31)\r\n    at Worker1.hasCustomGetInitialProps (/var/www/tes-site/node_modules/next/dist/lib/worker.js:49:40)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n(Use `node --trace-warnings ...` to show where the warning was created)\r\n(node:2165737) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)\r\n(node:2165737) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\r\n\r\n> Build error occurred\r\nError: Collecting page data for /about is still timing out after 2 attempts. See more info here https://nextjs.org/docs/messages/page-data-collection-timeout\r\n    at onRestart (/var/www/tes-site/node_modules/next/dist/build/index.js:444:31)\r\n    at Worker1.isPageStatic (/var/www/tes-site/node_modules/next/dist/lib/worker.js:49:40)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n    at async Span.traceAsyncFn (/var/www/tes-site/node_modules/next/dist/telemetry/trace/trace.js:60:20)\r\n    at async /var/www/tes-site/node_modules/next/dist/build/index.js:506:48\r\n    at async Span.traceAsyncFn (/var/www/tes-site/node_modules/next/dist/telemetry/trace/trace.js:60:20)\r\n    at async Promise.all (index 1)\r\n    at async /var/www/tes-site/node_modules/next/dist/build/index.js:491:13\r\n    at async Span.traceAsyncFn (/var/www/tes-site/node_modules/next/dist/telemetry/trace/trace.js:60:20)\r\n    at async /var/www/tes-site/node_modules/next/dist/build/index.js:468:127\r\n    at async Span.traceAsyncFn (/var/www/tes-site/node_modules/next/dist/telemetry/trace/trace.js:60:20)\r\n    at async Object.build [as default] (/var/www/tes-site/node_modules/next/dist/build/index.js:77:25)\r\ninfo  - Collecting page data .npm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! @ build: `next build`\r\nnpm ERR! Exit status 1\r\nnpm ERR!\r\nnpm ERR! Failed at the @ build script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n```\r\n\r\n**Some facts**\r\n- I can successfully run `npm run build` locally—it only takes a couple seconds to complete\r\n- `npm run dev` successfully runs on the server\r\n- NextJS 11.1.2 (locally and on DigitalOcean droplet)\r\n- Node 14.15.1 (locally and on DigitalOcean droplet)\r\n- DigitalOcean Droplet: Ubuntu/nginx\r\n\r\nThe docs linked to in the error ([Static page generation timeout](https://nextjs.org/docs/messages/static-page-generation-timeout) and [Page data collection timeout](https://nextjs.org/docs/messages/static-page-generation-timeout)) suggest the following fixes:\r\n- **Make sure that there is no infinite loop during execution**: This is basically the vanilla NextJS install, so I'm guessing there are no infinite loops!\r\n- **Make sure all Promises in `getStaticPaths/getStaticProps` resolve or reject correctly**: I'm not using either of those at the moment\r\n- **Avoid very long timeouts for network requests**: not sure if this applies?\r\n- **Increase the timeout by changing the `experimental.staticPageGenerationTimeout` configuration option**: I haven't done this yet, as it only takes seconds to complete the entire build locally, and the server is timing out after 60 seconds for a single page—seems like the timeout length is long enough, so I assume something else is afoot.\r\n\r\nAnything else I can try to get that process to complete? What other info would be helpful?"}
{"sentences": "What are the folders required to run on production", "description": "I am wondering if only .next folder is required to run at production or the src, public, .... etc. folders are needed too. If so other folders are needed other than .next can any one suggest me a better way for reducing my docker image size"}
{"sentences": "npx create-next-app@latest does not install because of eslint", "description": "When I run `npx create-next-app@latest` the installation stops because of an eslint version mismatch. It claims `eslint@8.0.0` is required \"from the root project\" but `eslint-config-next` seems to require `eslint@\"^7.23.0\"`.\r\n\r\n```bash\r\n➜ npx create-next-app@latest\r\nNeed to install the following packages:\r\n  create-next-app@latest\r\nOk to proceed? (y) y\r\n✔ What is your project named? … my-app\r\nCreating a new Next.js app in /Users/angelozehr/projects/my-app.\r\n\r\nUsing npm.\r\n\r\nInstalling dependencies:\r\n- react\r\n- react-dom\r\n- next\r\n\r\nnpm WARN deprecated querystring@0.2.1: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.\r\nnpm WARN deprecated querystring@0.2.0: The querystring API is considered Legacy. new code should use the URLSearchParams API instead.\r\n\r\nadded 324 packages, and audited 324 packages in 19s\r\n\r\n52 packages are looking for funding\r\n  run `npm fund` for details\r\n\r\nfound 0 vulnerabilities\r\n\r\nInstalling devDependencies:\r\n- eslint\r\n- eslint-config-next\r\n\r\nnpm ERR! code ERESOLVE\r\nnpm ERR! ERESOLVE unable to resolve dependency tree\r\nnpm ERR!\r\nnpm ERR! While resolving: my-app@0.1.0\r\nnpm ERR! Found: eslint@8.0.0\r\nnpm ERR! node_modules/eslint\r\nnpm ERR!   dev eslint@\"*\" from the root project\r\nnpm ERR!\r\nnpm ERR! Could not resolve dependency:\r\nnpm ERR! peer eslint@\"^7.23.0\" from eslint-config-next@11.1.2\r\nnpm ERR! node_modules/eslint-config-next\r\nnpm ERR!   dev eslint-config-next@\"*\" from the root project\r\nnpm ERR!\r\nnpm ERR! Fix the upstream dependency conflict, or retry\r\nnpm ERR! this command with --force, or --legacy-peer-deps\r\nnpm ERR! to accept an incorrect (and potentially broken) dependency resolution.\r\nnpm ERR!\r\nnpm ERR! See /Users/angelozehr/.npm/eresolve-report.txt for a full report.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /Users/angelozehr/.npm/_logs/2021-10-13T11_27_10_298Z-debug.log\r\n\r\nAborting installation.\r\n  npm install --save-exact --save-dev eslint eslint-config-next has failed.\r\n```"}
{"sentences": "Dev overlay doesn't work in Chrome. Works in other browsers", "description": "We have a strange issue in one of our projects (private repository) with the next.js dev overlay in case of errors. In this particular project the dev error overlay does not show in Chrome (not showing in incognito either, disabled all extensions), but does show in Firefox and Safari for example.  \r\nI have not been able to reproduce it with a fresh next.js repository. The dev error overlay shows just fine in all browsers (including Chrome) with a fresh from scratch project, so I'm not sure what else can there be. Is there something specific we could try or test? \r\n![devoverlay2](https://user-images.githubusercontent.com/19775351/129175078-1f67f036-eac7-41b4-802e-fd62f18ea80d.png)\r\n"}
{"sentences": "Build production fail Error: resolve-url-loader: CSS error", "description": "Warning: You have enabled experimental feature(s).\r\nExperimental features are not covered by semver, and may cause unexpected or broken application behavior. Use them at your own risk.\r\n\r\n> Using external babel configuration\r\nCreating an optimized production build\r\n\r\nFailed to compile.\r\n\r\n./static/scss/main.scss\r\nError: resolve-url-loader: CSS error\r\n  source-map information is not available at url() declaration (found orphan CR, try removeCR option)\r\n\r\n\r\n> Build error occurred\r\nError: > Build failed because of webpack errors\r\n    at build (fe-codebase\\node_modules\\next\\dist\\build\\index.js:13:900)\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n\r\n\r\n\r\n____next.config.js\r\n\r\nmodule.exports = withConfig(\r\n    withPlugins(\r\n        [[withBundleAnalyzer], withPwaManifest, withOffline],\r\n        nextConfig\r\n    )\r\n);\r\n\r\nHow to config in file __ next.config.js ?\r\nremoveCR : false\r\n\r\n\r\nThanks :(\r\n\r\n"}
{"sentences": "Slug getting index on google", "description": "### What version of Next.js are you using?\n\n11.0.1\n\n### What version of Node.js are you using?\n\n16.9.1\n\n### What browser are you using?\n\nEdge\n\n### What operating system are you using?\n\nmacOS\n\n### How are you deploying your application?\n\nnext build\n\n### Describe the Bug\n\nSlug getting indexed\r\n![image](https://user-images.githubusercontent.com/40042573/135266823-31b818ea-15b8-410f-b3e2-8f436adc50b9.png)\r\n\n\n### Expected Behavior\n\nGenerated pages should be indexed\n\n### To Reproduce\n\ngoogle 'daba blog'"}
{"sentences": "Redirects: a “*” throws “Error parsing `/fr/blog/*`”", "description": "### What version of Next.js are you using?\n\n11.0.0\n\n### What version of Node.js are you using?\n\nI don't know\n\n### What browser are you using?\n\nFirefox\n\n### What operating system are you using?\n\nLinux Ubuntu 20.04\n\n### How are you deploying your application?\n\nVercel\n\n### Describe the Bug\n\nI followed this part of the documentation: https://github.com/vercel/next.js/blob/canary/docs/api-reference/next.config.js/redirects.md?plain=1#L59\r\n\r\nI wrote this:\r\n\r\n```js\r\n      {\r\n        source: '/fr/blog/*',\r\n        destination: 'https://blog.example.com',\r\n        permanent: true,\r\n      },\r\n```\r\n\r\nThe deployment on Vercel threw an error:\r\n\r\n> 13:17:28.215 | Error parsing `/fr/blog/*` https://nextjs.org/docs/messages/invalid-route-source\r\n\r\nI rewrote the fist line and it worked:\r\n\r\n```js\r\n      {\r\n        source: '/fr/blog/(.*)',\r\n        destination: 'https://blog.example.com',\r\n        permanent: true,\r\n      },\r\n```\n\n### Expected Behavior\n\nThe redirect should catch all the requests that start with `/fr/blog/` and redirect the users.\r\n\r\nI think the documentation should be updated.\n\n### To Reproduce\n\nI'm not a front developer so I'm not sure it will be enough, but this file `next.config.js` should fail:\r\n\r\n```js\r\nmodule.exports = {\r\n  async redirects() {\r\n    return [\r\n      {\r\n        source: '/fr/blog/(.*)',\r\n        destination: 'https://blog.example.com',\r\n        permanent: true,\r\n      },\r\n    ]\r\n  },\r\n}\r\n```"}
{"sentences": "api redirect works with form action but not fetch.", "description": "Hi, I'm having this redirect issue with Stripe. But I've tried coming up with the simplest example to not waste anyone's time:\r\n\r\nLet's say I create a blank next app, and make api/hello redirect to google:\r\n``` ts\r\n// api/hello.ts\r\nimport type { NextApiRequest, NextApiResponse } from 'next';\r\n\r\nexport default function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  res.redirect(303, \"https://www.google.com\");\r\n}\r\n```\r\nThe redirect works if I call the api from the index page like this :\r\n``` tsx\r\n// index.tsx\r\n//...\r\n<form action=\"/api/hello\" method=\"GET\">\r\n  <button type=\"submit\" role=\"link\">Click me</button>\r\n</form>\r\n```\r\nBut not with fetch:\r\n``` tsx\r\n// index.tsx\r\nconst handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\r\n  e.preventDefault();\r\n  await fetch(\"/api/hello\");\r\n}\r\n//...\r\n<form onSubmit={handleSubmit}>\r\n  <button type=\"submit\" role=\"link\">Click me</button>\r\n</form>\r\n```\r\nWith the latter, I get a cors error:\r\n```\r\nCross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://www.google.com/. \r\n```\r\nI've tried playing with the headers and using cors following the \"next-api-routes-cors\" example without success.\r\nAny help would be much appreciated 🙏."}
{"sentences": "How to avoid caching with getServerSideProps", "description": "Hi.\r\n\r\nI deployed my next.js app to Heroku and I use getServerSideProps to get my data from a custom CMS API but when the content is updated or newly created the front page doesn't show updated content. It only becomes visible after a while like an hour or more. How can I avoid or configure this problem?\r\n\r\nNote: I am using `apolloClient.query` inside of getServerSideProps but I don't know how this is relevant to the current situation.\r\n\r\nThank you."}
{"sentences": "Removing SSP code from browser bundle", "description": "Hi all!\r\n\r\nI'm trying to understand the behaviour of removing server-side code from browser bundle, as I can see \r\nhttps://github.com/vercel/next.js/blob/5544adc481f8821567e947a6e6d51d9d68ebd367/packages/next/build/babel/plugins/next-ssg-transform.ts#L13-L17\r\nin babel plugin there is remove  export name declaration.\r\nhttps://github.com/vercel/next.js/blob/5544adc481f8821567e947a6e6d51d9d68ebd367/packages/next/build/babel/plugins/next-ssg-transform.ts#L248-L262\r\n\r\nThere is also a note about client-side bundle optimization \r\nhttps://nextjs.org/docs/basic-features/data-fetching#getserversideprops-server-side-rendering\r\n> Note: You can import modules in top-level scope for use in getServerSideProps. Imports used in getServerSideProps will not be bundled for the client-side.\r\n \r\n**The question:**\r\nWhat if I have some sort of wrapper for ssp function? Will it be also removed due to tree shaking?\r\n```ts\r\nimport { createPagePipe } from 'config/pageConfig'; // this module has a lot of server-specific code\r\nexport const getServerSideProps = createPagePipe({ ... });\r\n```"}
{"sentences": "Use the image component with IMGIX web proxy source.", "description": "Hey all. \r\nSo I'm building a tool to view NFTs in a gallery, and the images are all coming from unknown sources. I have a web proxy IMGIX source where I can proxy all images through IMGIX, but It doesn't seem to work well with the `<Image>` component. \r\n\r\nI have to sign the URL when creating it and the nextjs image component modifies the URL after the signature is generated. Is there any way to achieve this without creating a custom loader?"}
{"sentences": "Error: getaddrinfo ENOTFOUND when calling docker container from server-side methods during BUILD TIME", "description": "Hi! I'm building a boilerplate full-stack project. Its a monorepository which includes three docker services:\r\n- ui (Next.js)\r\n- api (Nest.js)\r\n- nginx\r\n\r\nIn ui (Next.js) service I created a separate endpoints for client-side and server-side to perform a data-fetching from api (Nest.js) service. On the client-side i'm calling nnn-docker.com/api (which is my localhost specified in /etc/hosts) and for api calls from server-side, like getStaticProps function, application using docker container endpoint: http://api:4200. Runtime config specified in [next.config.js](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/ui/next.config.js) file. And my [axios api client](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/ui/src/services/ApiService/constants/settings.ts) using this variables according to current execution environment.\r\n\r\nSo, in development mode everything is good and my endpoints works fine for client-side requests using useEffect and for server-side using getServerSideProps. But if I creating production `make deploy` build it fails with following error: \r\n\r\n```\r\n> Build error occurred\r\nError: getaddrinfo ENOTFOUND api\r\n    at GetAddrInfoReqWrap.onlookup [as oncomplete] (dns.js:69:26) {\r\n  type: 'Error',\r\n  config: {\r\n    url: '/articles',\r\n    method: 'get',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n      'User-Agent': 'axios/0.21.4'\r\n    },\r\n    baseURL: 'http://api:4200',\r\n    transformRequest: [ null ],\r\n    transformResponse: [ null ],\r\n    timeout: 0,\r\n    xsrfCookieName: 'XSRF-TOKEN',\r\n    xsrfHeaderName: 'X-XSRF-TOKEN',\r\n    maxContentLength: -1,\r\n    maxBodyLength: -1,\r\n    transitional: {\r\n      silentJSONParsing: true,\r\n      forcedJSONParsing: true,\r\n      clarifyTimeoutError: false\r\n    }\r\n  },\r\n  code: 'ENOTFOUND'\r\n}\r\nnpm ERR! code ELIFECYCLE\r\nnpm ERR! errno 1\r\nnpm ERR! ui@0.1.0 build: next build\r\nnpm ERR! Exit status 1\r\nnpm ERR! \r\nnpm ERR! Failed at the ui@0.1.0 build script.\r\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /root/.npm/_logs/2021-09-27T12_24_36_998Z-debug.log\r\nThe command '/bin/sh -c npm run build' returned a non-zero code: 1\r\nERROR: Service 'ui' failed to build : Build failed\r\nmake: *** [Makefile:3: deploy] Error 1\r\n```\r\n\r\nI want my deployed application would be working in docker too and I cant understand why production build cant access my docker container as it does in development mode.\r\nI read all relative discussions and still not resolve this issue.\r\n\r\n\r\n[docker-compose.yml](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/docker-compose.yml)\r\n[docker-compose-dev.yml](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/docker-compose.dev.yml)\r\n[nginx.conf](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/nginx/nginx.conf)\r\n[Makefile](https://github.com/unsxxndxrk/next-nest-nginx-docker/blob/master/Makefile)\r\n\r\nFull project link with my current code: https://github.com/unsxxndxrk/next-nest-nginx-docker"}
{"sentences": "E-commerce solutions", "description": "I wish to start a new e-commerce project. \r\nHere is a list of all e-commerce solution I know, feel free to list more of theme it will help me choose, and maybe help some others\r\n\r\nShopify Demo: https://shopify.vercel.store\r\nSwell Demo: https://swell.vercel.store\r\nBigCommerce Demo: https://bigcommerce.vercel.store\r\nVendure Demo: https://vendure.vercel.store\r\nSaleor Demo: https://saleor.vercel.store\r\nStrapi Demo: https://strapi-starter-next-ecommerce.vercel.app\r\nButtercms Demo: https://ecommerce-with-buttercms-and-snipcart.vercel.app\r\n\r\nIf you have any recommendations between these or other solutions, I take it. I am currently looking for something with a compete and intuitive dashboard like BigCommerce but with more flexibility, since with BC you cannot change the API."}
{"sentences": "Bulk 301 Redirect", "description": "I have a situation where almost 50,000 (**50K**) old URLs need a `301` permanent redirect. This is to make sure that the old URLs which are indexed by Search Engines, does not throw a 404 when the website is crawled after the next release. \r\n\r\n**The plan:** Create a mapping file (`JSON`) which will read like this\r\n\r\n`{\"oldUrl_1\":\"newUrl_1\", \"oldUrl_2\":\"newUrl_2\", ...};`\r\n\r\nI can think of 5 ways by which we can achieve this redirect by **reading** a JSON file.\r\n\r\n1. Using a REST client like `axios` \r\n2. Using require() \r\n3. Using import()\r\n4. Using `fs.readFile` (Sync) or `fs.readFileAsync` (Async)\r\n5. Using `npm` packages like https://www.npmjs.com/package/readjson\r\n\r\nPlease suggest the way forward. I am planning to use `fs.readFile`\r\n\r\nNote: Any of the above solutions will be called only **once** to move the file contents to a JSON Object (variable/memory) when we do an `npm start`. That means, when a URL hits the browser, no check will be done against the `JSON` file. The URL redirect will happen after checking the presence of old URL in the `JSON` Object (variable). \r\n\r\n"}
{"sentences": "Webpack fails to compile TypeScript in monorepo - Unexpected Token", "description": "Hi there! I've just opened a thread about the issues I'm having around type checking path aliases in a monorepo (https://github.com/vercel/next.js/discussions/29399). On the thread I indicate that I've worked around the issue by turning type checking off for now.\r\n\r\nAfter I do that, I then get *another* issue here:\r\n\r\n```\r\n../components/src/atoms/button/button.tsx\r\nModule parse failed: Unexpected token (3:12)\r\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\r\n| import { useTheme } from \"@emotion/react\";\r\n| import styled from \"@emotion/styled\";\r\n> import type { FC, MouseEvent } from \"react\";\r\n| \r\n| export interface ButtonProps {\r\n```\r\n\r\nNow this is confusing for me because the only things I can see in that file that webpack might need a special loader for is\r\n\r\n* TypeScript\r\n* React (JSX)\r\n\r\nI was under the impression that Next handles all of this with babel under the hood. Its perhaps worth noting that the file being transpiled here is part of a separate package within the same monorepo. Here is my config\r\n\r\n`babel.config.js`\r\n```JavaScript\r\nconst path = require(\"path\");\r\nconst findWorkspaceRoot = require(\"find-yarn-workspace-root\");\r\nconst workspaceRoot = findWorkspaceRoot(__dirname);\r\n\r\nmodule.exports = {\r\n  plugins: [\r\n    [\"@babel/plugin-proposal-decorators\", { legacy: true }],\r\n    [\r\n      \"babel-plugin-root-import\",\r\n      {\r\n        functions: [\"jest.mock\"],\r\n        root: (sourcePath) => {\r\n          const parts = path.relative(workspaceRoot, sourcePath).split(\"/\");\r\n          return path.resolve(workspaceRoot, \"packages\", parts[1]);\r\n        },\r\n        rootPathPrefix: \"@/\",\r\n        rootPathSuffix: \"./src\",\r\n      }\r\n    ]\r\n  ],\r\n  presets: [\"next/babel\"],\r\n};\r\n```\r\n\r\n`next.config.js`\r\n```JavaScript\r\nconst GenerateAwsLambda = require(\"next-aws-lambda-webpack-plugin\");\r\nconst withImages = require(\"next-images\");\r\n\r\nmodule.exports = withImages({\r\n  pageExtensions: [\"page.tsx\", \"page.ts\", \"page.jsx\", \"page.js\"],\r\n  target: \"serverless\",\r\n  productionBrowserSourceMaps: true,\r\n  typescript: {\r\n    ignoreBuildErrors: true,\r\n  },\r\n  webpack: (config, nextConfig) => {\r\n    config.plugins.push(new GenerateAwsLambda(nextConfig));\r\n    if (!nextConfig.isServer) {\r\n      config.resolve.fallback.fs = false;\r\n    }\r\n    return config;\r\n  },\r\n  images: {\r\n    disableStaticImages: true,\r\n    loader: \"custom\",\r\n  },\r\n});\r\n```\r\n\r\nIf anyone has any suggestions, it would be more than appreciated."}
{"sentences": "React does not recognize the  disablePlaceholder prop on a DOM element.", "description": "### What version of Next.js are you using?\n\n11.1.0\n\n### What version of Node.js are you using?\n\nv14.17.3\n\n### What browser are you using?\n\nchrome\n\n### What operating system are you using?\n\nwindows\n\n### How are you deploying your application?\n\naws,docker\n\n### Describe the Bug\n\nWarning: React does not recognize the `disablePlaceholder` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `disableplaceholder` instead. If you accidentally passed it from a parent component, remove it from the DOM element.\r\n\n\n### Expected Behavior\n\nRun image tag without showing warning\n\n### To Reproduce\n\n<Image\r\n            src={image2}\r\n            alt={picture}\r\n            width={88}\r\n            height={88}\r\n            //placeholder=\"blur\"\r\n            unoptimized={true}\r\n            disablePlaceholder={true}\r\n           />\r\nThis are the properties i used for image tag\r\nDo i need to add any properties?\r\nI  have a question, this  disablePlaceholder attribute will disable the placeholder?"}
{"sentences": "YAMLException when running yarn lint on next.js v11", "description": "Hello -\r\nI'm trying to run yarn lint (yarn next lint) on my next.js project, and I'm getting the following error:\r\n`YAMLException: missed comma between flow collection entries at line 31, column 5:\r\n        \"linters\": {\r\n        ^\r\nerror Command failed with exit code 1.`\r\n\r\nI've tried removing and recloning the repo, and I'm still getting this error. I'm not sure where this error is coming from, as it's not appearing on my coworkers code. Do you guys have any ideas? "}
{"sentences": "How to disable lazy load in Image Component ?", "description": "Is there any way to do that ?? \r\nThanks."}
{"sentences": "onClick events not fire in root page in production", "description": "onClick events not fire in root page in production only but in environment  works fine ,can i get help"}
{"sentences": "Why cant I fetch data from my api?", "description": "I am trying to map through data, an array in my backend from the frontend. However, when I tried fetching it from the frontend I got an empty object (logging it to the console). Can you spare me your keen eye again please - here is my code:\r\n\r\n```\r\nimport React from \"react\";\r\nfunction DataContent({ portfolios }) {\r\n  console.log({ portfolios });\r\n  return (\r\n    <div>\r\n      {/* Logo cloud */}\r\n          <div className=\"mt-6 grid grid-cols-1 gap-4 md:grid-cols-3 lg:grid-cols-3\">\r\n            {portfolios?.map((portfolio) => (\r\n              <div\r\n                key={portfolio.title}\r\n                className=\"col-span-1 flex justify-center md:col-span-2 lg:col-span-1 bg-gray-200  cursor-pointer rounded-lg flex-wrap\"\r\n                style={{ backgroundColor: portfolio.bgColor }}\r\n              >\r\n                <div className=\"col-span-1 w-80 m-auto flex justify-center items-center pt-3 md:col-span-2 md:col-start-2 cursor-pointer lg:col-span-1 flex-wrap rounded-lg h-40 \">\r\n                  <a href={portfolio?.url}>\r\n                    <img\r\n                      className=\" w-32 rounded-xl object-contain\"\r\n                      src={portfolio?.image}\r\n                      alt={portfolio?.title}\r\n                    />\r\n                  </a>\r\n                </div>\r\n                <p\r\n                  className=\"block mt-3 p-4 text-center font-semibold\"\r\n                  style={{ color: portfolio.color }}\r\n                >\r\n                  {portfolio.description}\r\n                </p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n  );\r\n}\r\nexport async function getServerSideProps() {\r\n  const portfolios = await fetch(`/api/portfolios`).then((res) => res.json());\r\n  return {\r\n    props: {\r\n      portfolios,\r\n    },\r\n  };\r\n}\r\nexport default DataContent;\r\n```"}
{"sentences": "Config React app route to run Next.js app", "description": "Hi,\r\nI already have a react app, I want to make a particular route in react app as a separate next.js app for SEO.\r\n\r\nplease can you tell me how to do or where to start from"}
{"sentences": "Weird behavior for custom hooks in components within \"pages\"", "description": "I am unable to run the returned function from custom hook for page components within the \"pages\" folder.\r\n\r\nI have a component under `pages` folder that uses a custom hooks:\r\n``` TSX\r\n// ./pages/somepage.tsx\r\nimport useCustomHook from '.....'  <-- notice default import\r\n\r\nconst SomePage = () => {\r\n  const foo = useCustomHook()\r\n\r\n  foo() <-- ERROR: foo is not a function\r\n\r\n  ....\r\n}\r\n```\r\n\r\n``` TSX\r\n// useCustomHook implementation\r\nconst useCustomHook = () => {\r\n  return () => console.log('foo')\r\n}\r\n\r\nexport default useCustomHook;\r\n```\r\n\r\nThis results in an error where the compiler says \"foo\" is not a function. By logging out \"foo\", I see it's identified as a \"React.element\".\r\n\r\nNow, if I change the default exports for `useCustomHook` to named exports\r\n\r\n``` TSX\r\nexport const useCustomHook = () => {\r\n  return () => console.log('foo')\r\n}\r\n```\r\n\r\nand Imported like\r\n\r\n```TSX\r\n// ./pages/somepage.tsx\r\nimport {useCustomHook} from '....'\r\n\r\n```\r\n\r\nThis would work. \r\n\r\nMy question is WHY? \r\nI suspect is how Next.js parses files under the pages folder and converts all returns into a react component. \r\nEven when my custom hook is deeply in other folders, this statement remains true and I am still not able to call the returned function of any custom hook.\r\n\r\nIf you could share some insights that would be great. Also, what is the best practice here?\r\n\r\n\r\nPS. I would also like to know what \"magic\" is Next.js doing for the pages folder, there seems to be lack of documentation on the internet.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"}
{"sentences": "Why does Dev slowly strangle my machines RAM?", "description": "Hey Next Community.\r\n\r\nI am trying to answer a question, work out if it's a bug or something of my own creation!\r\n\r\nWe have a rather chunky web app that uses Typescript, GraphQL (hosted as a Next API route which uses Apollo Server and Prisma), NextAuth, and Material UI. In the last few weeks our developer experience has filled us all with dread, as we slowly watch our machines get strangled. I have tried to peer into the internals to see where the memory is going, and have found a few things that indicate the problem - now I just need a solution\r\n\r\n<img width=\"1744\" alt=\"Screenshot 2021-09-15 at 12 59 40\" src=\"https://user-images.githubusercontent.com/181611/133436488-644d51cc-6c79-464b-b3dd-16037997c574.png\">\r\n\r\nThe above shows the issue. What we are seeing are duplicate strings for the same compile files being held onto (they don't get GC-ed). I've marked the image above with the blue `Page` - this is the code for the actual page I am looking at, and this does get collected. The yellow 'App' - this is the code for our `_app.tsx` which provides a lot of contexts, particularly for the client side GraphQL client. The green 'GQL' - this is the code for our `api/graphql` server (this also has a habit of multiplying but this didn't happen in this particular instance). Finally the red 'auth' - this is the code for our `api/[nextauth]` routes.\r\n\r\nSo I can see clearly that we are not loosing previous compilations of these files and the server is holding onto them for some reason, which leads me to two questions:\r\n\r\na) Why aren't they being trashed\r\nb) Why are they being recompiled (the Auth/App and GraphQL files very rarely change).\r\n\r\nAny help would mean the world to me\r\n\r\nDarren"}
{"sentences": "How to fix the burger menu when switching pages in next js", "description": "The bottom line is that on React.js such a menu works as it should, namely, open the burger menu, select a page, click on the link in the menu and the page content changes, but the menu remains. This proves that React.js only changed the page content and didn't touch the burger combo menu.\r\n\r\nAbout Next.js. There, with similar actions, the menu is removed and as if the page is reloaded. It happens quickly and it's cool, but it doesn't even give the impression that this is a spa.\r\n\r\nThe question is, can I somehow implement this or maybe I made a mistake somewhere, please look at the code and help in solving it.\r\n\r\n**Layout.js**\r\n```javascript\r\nimport React from 'react'\r\nimport Header from '../components/includes/Header'\r\nimport Footer from '../components/includes/Footer'\r\nimport Head from 'next/head'\r\n\r\nconst Layout = ({ children, title = 'ValeShops' }) => {\r\n  \r\n  return (\r\n    <React.Fragment>\r\n      <Head>\r\n        <title>{title} | ValeShops</title>\r\n      </Head>\r\n      <Header />\r\n      <main>\r\n        <section>\r\n          { children }\r\n        </section>\r\n      </main>\r\n      <Footer />\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default Layout\r\n```\r\n\r\n**Header.js**\r\n```javascript\r\nimport Link from 'next/link'\r\nimport Search from '../UI/Search'\r\nimport Humburger from '../UI/Humburger'\r\n\r\n const Header = () => {\r\n\r\n  return (\r\n    <>\r\n      <section>\r\n        <div className='header'>\r\n          <div className='header__column--left'>\r\n            <div className='header__logo'>\r\n              <Link href={'/'}>\r\n                <a>\r\n                  <span></span>\r\n                </a>\r\n              </Link>\r\n            </div>\r\n            <Search \r\n              className='search__field'\r\n            />\r\n            <ul className='navigation'>\r\n              <li>Top-10 Deals</li>\r\n              <li>\r\n                <Link href={'/stores'}>\r\n                  <a>All stores</a>\r\n                </Link>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n          <ul className='navigation header__column--right'>\r\n            <li>\r\n              <Link href={'/login'}>\r\n                <a>Login</a>\r\n              </Link>\r\n            </li>\r\n            <li>\r\n              <select>\r\n                <option value=\"\">English</option>\r\n                <option value=\"\">English</option>\r\n                <option value=\"\">English</option>\r\n              </select>\r\n            </li>\r\n            <li>\r\n              <select>\r\n                <option value=\"\">Country</option>\r\n                <option value=\"\">Country</option>\r\n                <option value=\"\">Country</option>\r\n              </select>\r\n            </li>\r\n            <li>\r\n              <Humburger />\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </section>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Header;\r\n```\r\n\r\n**Humburger.js**\r\n```javascript\r\nimport React, { Component } from 'react'\r\nimport Menu from './Menu'\r\n\r\nexport class Humburger extends Component {\r\n\r\n  state = {\r\n    status: false\r\n  }\r\n\r\n  isOpenMenu = event => {\r\n    this.setState({\r\n      status: !this.state.status\r\n    })\r\n  }\r\n\r\n  render() {\r\n    const cls = ['humburger']\r\n\r\n    if(this.state.status) {\r\n      cls.push('open');\r\n    }\r\n    \r\n    return (\r\n      <>\r\n        <div \r\n          className={cls.join(' ')}\r\n          onClick={this.isOpenMenu}\r\n        >\r\n          <span className='humburger-t'></span>\r\n          <span className='humburger-c'></span>\r\n          <span className='humburger-b'></span>\r\n        </div>\r\n        <Menu \r\n          isOpen={this.state.status}\r\n        />\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Humburger\r\n```\r\n\r\n**Menu.js**\r\n```javascript\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/router'\r\n\r\nconst Menu = props => {\r\n\r\n  const cls = ['humburger__menu']\r\n\r\n  if(props.isOpen) {\r\n    cls.push('open')\r\n  }\r\n\r\n  const router = useRouter();\r\n\r\n  return (\r\n    <>\r\n      <div className={cls.join(' ')}>\r\n        <ul>\r\n          <li>\r\n            <Link href={'/how-it-works'}>\r\n              <a>How it works</a>\r\n            </Link>\r\n          </li>\r\n          <li>\r\n            <Link href={'/news'}>\r\n              <a>News</a>\r\n            </Link>\r\n          </li>\r\n          <li>\r\n            <Link href={'/about'}>\r\n              <a>About</a>\r\n            </Link>\r\n          </li>\r\n          <li>\r\n            <Link href={'/user-agreement'}>\r\n              <a>User Agreement</a>\r\n            </Link>\r\n          </li>\r\n          <li>\r\n            <Link href={'/privacy-policy'}>\r\n              <a>Privacy Policy</a>\r\n            </Link>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Menu\r\n```\r\n\r\nAll pages by type Home\r\n**Home.js**\r\n```javascript\r\nimport Layout from \"../components/Layout\"\r\n\r\nconst Home = () => {\r\n  return (\r\n    <Layout\r\n      title='Home'\r\n    >\r\n      <div className='home'>\r\n        <h1>Home</h1>\r\n      </div>\r\n    </Layout>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```"}
{"sentences": "GetServerSideProps with locale", "description": "I have a page with `getServerSideProps` that returns different content based on id param and `locale`, the content gets updated when the id changes but not when I request the page with `Link` to switch between locales. is this normal behavior? and if yes any tip on how I can get it to work as needed."}
{"sentences": "getStaticProps slug param returning favicon.ico", "description": "Hello, I have this application where I'm building something similar to Linktree.\r\n\r\nWhen I enter in a /user/page/[slug], I want to get the slug of the page I have just entered, so I send this slug to my API (using AXIOS), and fetch every link bond to this page.\r\n\r\nTo get the slug, I am using getStaticProps, since I need this data before it's loaded.\r\n\r\nBut there is an unexpected/strange behavior going on (I am new to next.js, sorry if it is a dumb problem).\r\n\r\nLet's say I enter in /user/page/example. When I console.log(params.slug), it prints \"example\", which is correct, then sends a GET request and fetches all of the \"example\" page links.\r\n\r\nUntil this part it is working as expected, but then, shortly thereafter, for some reason, console.log() prints again - and it prints \"favicon.ico\", as if it was my page slug. And then, it tries to fetch a page with \"favicon.ico\" url, and obviously doesn't find any page with this slug. This behavior repeats one last time.\r\n\r\nIn summary: I get page slug, send to API, it returns what I want, but then shortly thereafter my slug is turned into \"favicon.ico\" for unknown reasons, it sends it to API once again - as if it was my page slug, which it isn't -, and now, evidently, my request is wrong. And it repeats one more time. So, 1. correctly get slug (should stop here), 2. incorrectly get \"favicon.ico\" as slug, 3. incorrectly get \"favicon.ico\" (not sure why it happens again) and then it stops.\r\n\r\nOnly place \"favicon.ico\" is located is in the <Head> tag:\r\n\r\n```\r\n// _document.tsx\r\n\r\nimport Document, { Html, Head, Main, NextScript } from 'next/document';\r\n\r\nexport default class MyDocument extends Document {\r\n    render() {\r\n        return (\r\n            <Html>\r\n                <Head>\r\n                    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" />\r\n                    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap\" rel=\"stylesheet\" />\r\n                    <link rel=\"shortcut icon\" href=\"favicon.ico\" />\r\n                </Head>\r\n                <body>\r\n                    <Main />\r\n                    <NextScript />\r\n                </body>\r\n            </Html>\r\n        );\r\n    }\r\n}\r\n```\r\n\r\nAnd here is my getStaticProps call:\r\n\r\n```\r\n// /pages/user/page/[slug].tsx\r\n\r\nexport const getStaticProps: GetStaticProps = async ({ params }) => {\r\n    let slug = '';\r\n    let links = {};\r\n    let page = {};\r\n\r\n    try {\r\n        slug = Array.isArray(params.slug) ? params.slug[0] : params.slug\r\n\r\n        const response = await api.get('links', {\r\n            params: {\r\n                page_url: slug\r\n            }\r\n        });\r\n\r\n        const links = response.data.map(link => {\r\n            return {\r\n                title: link.title,\r\n                description: link.description,\r\n                url: link.url,\r\n                updatedAt: new Date(link.updated_at).toLocaleDateString('pt-BR', {\r\n                    day: '2-digit',\r\n                    month: 'long',\r\n                    year: 'numeric'\r\n                })\r\n            }\r\n        });\r\n    } catch (err) {\r\n        console.log(err.response)\r\n    }\r\n\r\n    return {\r\n        props: {\r\n            slug,\r\n            links,\r\n            page\r\n        },\r\n        revalidate: 60 * 30,    // 30 minutes\r\n    }\r\n}\r\n```\r\n\r\nThanks in advance."}
{"sentences": "Having trouble Importing Third Party NPM/JS libraries (animejs, granimjs)", "description": "I'm using:\r\nNext: 11.1.2\r\nReact: 17.0.2\r\nTypescript: 4.4.2\r\nSo I've tried the dynamic import and the original way to import with javascript\r\n\r\nThe regular way I've tried: [Regular Way](https://github.com/vercel/next.js/issues/28399)\r\n\r\nI assume animejs and granimjs just don't have react ways of inserting into framework so that's why I thought the regular way would have worked\r\n![image](https://user-images.githubusercontent.com/13072183/132949811-d9ed4f48-2ffe-4dc6-aa45-9c3f88ac3b50.png)\r\n![image](https://user-images.githubusercontent.com/13072183/132949834-55540d12-a27d-4cc5-8a92-6c48f56c2532.png)\r\n\r\nI also notice if I console.log(anime)\r\n\r\nThere's some type errors inside the import\r\n![image](https://user-images.githubusercontent.com/13072183/132949884-85a36019-aa0f-49cb-98df-4d5ea9f0196d.png)\r\n\r\n\r\n\r\nI just can't seem to get my js libraries to import at all (excuse me if I'm just missing something completely new nextjs)\r\n\r\nLet me know if anyone can help 👍 sorry if I'm just not understanding the framework correctly\r\n"}
{"sentences": "Cannot use autofocus?", "description": "# Bug report\r\n\r\nI cannot use autofocus by using next.js\r\n\r\n## Describe the bug\r\n\r\nI want the page to autofocus on an input element when it loads, but it doesn't work\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior, please provide code snippets or a repository:\r\n\r\n1. `npx create-next-app app`\r\n2. `cd app`\r\n3. `yarn dev`\r\n4. write code\r\n\r\n```html\r\n<input type=\"text\" autoFocus />\r\n```\r\n5. access `localhost:3000` and watch the input\r\n\r\n## Expected behavior\r\n\r\nAutofoucs input when page was loaded.\r\n\r\n## Screenshots\r\n\r\n<img width=\"1147\" alt=\"cap1\" src=\"https://user-images.githubusercontent.com/17094072/93649245-7e30bf00-fa46-11ea-9755-1782d4943043.png\">\r\n<img width=\"1136\" alt=\"cap2\" src=\"https://user-images.githubusercontent.com/17094072/93649251-838e0980-fa46-11ea-9746-38e67ad8b5b3.png\">\r\n\r\n## System information\r\n\r\n- OS: macOS 10.15.6\r\n- Browser chrome 85.0.4183.102\r\n\r\n```json\r\n  \"dependencies\": {\r\n    \"next\": \"9.5.3\",\r\n    \"react\": \"16.13.1\",\r\n    \"react-dom\": \"16.13.1\"\r\n  }\r\n```\r\n\r\n- node.js v14.7.0\r\n"}
{"sentences": "CSS transform translateX behaving differently when in NextJS app (Mobile)", "description": "I've got an animation on the page which slides the new component in from the right to the center of the screen. It works fine until I switch on the chrome device emulator and select a mobile device (IPhone X). The `translateX(X%)` should take the component off the screen initially but for some reason, NextJS zooms out to fit everything on the screen causing the animation to be off. It works fine if the `translateX` value is a negative value but any positive value causes the screen to zoom out. Any help would be much appreciated!\r\n\r\ncodepen without nextJS: https://codepen.io/jl00161/full/MWKKKwy\r\nthe code for the nextJS project: https://github.com/luujam2/next-animation\r\nlink to the same example with nextJS: https://next-animation.now.sh/"}
{"sentences": "next/script package with custom document", "description": "### What version of Next.js are you using?\r\n\r\n11.1.2\r\n\r\n### What version of Node.js are you using?\r\n\r\n14.17.0\r\n\r\n### What browser are you using?\r\n\r\nChrome\r\n\r\n### What operating system are you using?\r\n\r\nmacOS\r\n\r\n### How are you deploying your application?\r\n\r\nnext start\r\n\r\n### Describe the Bug\r\n\r\nNo way to use `next/script` optimization package inside custom `_document.js`\r\n\r\n### Expected Behavior\r\n\r\nExpected to initialize once metric scripts inside custom '_document.js' file.\r\n\r\n### To Reproduce\r\n\r\nTry to add any script with `next/script` inside `_document.js`"}
{"sentences": "Link to `/tags/react` from under `/tutorials/intro-to-react` using `href` of `Link`?", "description": "I have a page under `/tags/[tag].tsx` which is used in `/tutorials/[slug].tsx`\r\n\r\nI want to link to it from `/tutorials/[slug].tsx` like:\r\n\r\n```tsx\r\n<Link href={`tags/${tag}`}>\r\n```\r\n\r\nHowever, I get the url like `/tutorials/tags/react`\r\n\r\nHow can I make sure it is just `/tags/react`?"}
{"sentences": "NextJs11 + Emotion11 + Typescript You have tried to stringify object returned from `css` function.", "description": "Hey,\r\n\r\nI am trying to get NextJs + Emotion 11 + Typescript working but having some issues.  Think it's a configuration issue, and I wasn't sure if to put it at emotion or NextJS but decided this may be best place to get some guidance.\r\n\r\n I have created a repo based on the `with-typescript-app` and I have installed the following packages\r\n\r\n```\r\n  \"dependencies\": {\r\n    \"@emotion/react\": \"^11.4.1\",\r\n    \"@emotion/styled\": \"^11.3.0\",\r\n    \"next\": \"latest\",\r\n    \"react\": \"^17.0.2\",\r\n    \"react-dom\": \"^17.0.2\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@emotion/babel-plugin\": \"^11.3.0\",\r\n    \"@types/node\": \"^12.12.21\",\r\n    \"@types/react\": \"^17.0.2\",\r\n    \"@types/react-dom\": \"^17.0.1\",\r\n    \"tslib\": \"^2.3.1\",\r\n    \"typescript\": \"^4.4.2\"\r\n  }\r\n```\r\n\r\nI have setup a .babel.config.js plugin as per the emotion documentation as the following\r\n\r\n```\r\n module.exports = function(api) {\r\n  const isServer = api.caller((caller) => caller?.isServer)\r\n  const isCallerDevelopment = api.caller((caller) => caller?.isDev)\r\n\r\n  const presets = [\r\n    [\r\n      'next/babel',\r\n      {\r\n        'preset-react': {\r\n          runtime: 'automatic',\r\n          importSource: '@emotion/react',\r\n        },\r\n      },\r\n    ],\r\n  ]\r\n\r\n  const env = {\r\n    production: {\r\n      plugins: ['transform-remove-console'],\r\n    },\r\n    development: {\r\n      compact: false,\r\n    },\r\n  }\r\n\r\n  const plugins = [\r\n    [\r\n      '@emotion',\r\n      {\r\n        // sourceMap is on by default but source maps are dead code eliminated in production\r\n        sourceMap: false,\r\n        cssPropOptimization: false,\r\n      },\r\n    ],\r\n  ]\r\n\r\n  return { presets, env, plugins }\r\n}\r\n\r\n```\r\n\r\nIn the `about.tsx` file I am passing a custom css prop called `navCss` which will provide some css on the `Layout.tsx` in the css prop. When I visit the page at `http://localhost:3000/about` my css is not taking affect and in the console I can see the following message in the nav css prop\r\n\r\n`You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).`\r\n\r\nIt seems it required the `jsxImportSource @emotion/react` but I don't want to add this to every file. So from searching around if I add the following `\"jsxImportSource\": \"@emotion/react\",` in my `tsconfig.json` it should work but to no avail. \r\n\r\nI must be doing something wrong but I can't figure out what, thanks ahead of time for the support.\r\n\r\nHere is the code:\r\n[with-typescript-app.zip](https://github.com/vercel/next.js/files/7110692/with-typescript-app.zip)\r\n\r\n- Download zip file\r\n- `npm i`\r\n- `npm run dev`\r\n- visit http://localhost:3000/about\r\n\r\n"}
{"sentences": "Handle Multiple API calls in getStaticProps", "description": "I am creating dynamic route **/mutual-funds/[fund]**. For each mutual fund I have to perform 15 API calls to create a page for that mutual fund. For SEO optimization I am trying to generate static pages for some mutual funds and remaining will be generating with Incremental Static Regeneration. But due to asynchronous API calls I think site building is taking long time. On an average for one mutual fund static page generation time is 15 seconds (From Vercel Deployment).\r\n\r\nHow can I call these APIs simultaneously?\r\n\r\nPlease see below code for reference.\r\n\r\n`export async function getStaticPaths() {\r\n    const slugsList = await fetch(`http://localhost:8000/slugslist`)\r\n    const slugsListResult = await slugsList.json()\r\n    const slugs = slugsListResult[\"slugs\"]\r\n  \r\n    return {\r\n      fallback: \"blocking\",\r\n      paths: slugs.slice(0, 11),\r\n    }\r\n}\r\n  \r\n  export async function getStaticProps(context) {\r\n    const fund = context.params.fund;\r\n  \r\n    try {\r\n      const avggReturnsRes = await fetch(\r\n        `http://localhost:8000/avggaut/?name=${fund}`\r\n      );\r\n      var avggReturnsResult = await avggReturnsRes.json();\r\n    } catch (error) {\r\n      var avggReturnsResult = {};\r\n    }\r\n  \r\n    try {\r\n      const navPlotRes = await fetch(\r\n        `http://localhost:8000/navplot/?name=${fund}`\r\n      );\r\n      var navPlotResult = await navPlotRes.json();\r\n    } catch (error) {\r\n      var navPlotResult = {};\r\n    }\r\n  \r\n    try {\r\n      const aumYearRes = await fetch(\r\n        `http://localhost:8000/aumyearly?name=${fund}`\r\n      );\r\n      var aumYearResult = await aumYearRes.json();\r\n    } catch (error) {\r\n      var aumYearResult = {};\r\n    }\r\n    try {\r\n      const fundInfoRes = await fetch(\r\n        `http://localhost:8000/funddetails?name=${fund}`\r\n      );\r\n      var fundInfoResult = await fundInfoRes.json();\r\n    } catch (error) {\r\n      var fundInfoResult = {};\r\n    }\r\n    try {\r\n      const fundInfoExtraRes = await fetch(\r\n        `http://localhost:8000/fundinformation?name=${fund}`\r\n      );\r\n      var fundInfoExtraResult = await fundInfoExtraRes.json();\r\n    } catch (error) {\r\n      var fundInfoExtraResult = {};\r\n    }\r\n    try {\r\n      const stocksRes = await fetch(\r\n        `http://localhost:8000/stocks?name=${fund}`\r\n      );\r\n      var stocksResult = await stocksRes.json();\r\n    } catch (error) {\r\n      var stocksResult = {};\r\n    }\r\n    try {\r\n      const fundInfoVRRes = await fetch(\r\n        `http://localhost:8000/fundvr?name=${fund}`\r\n      );\r\n      var fundInfoVRResult = await fundInfoVRRes.json();\r\n    } catch (error) {\r\n      var fundInfoVRResult = {};\r\n    }\r\n    try {\r\n      const yearlyyReturnsRes = await fetch(\r\n        `http://localhost:8000/yearlyyauto/?name=${fund}`\r\n      );\r\n      var yearlyyReturnsResult = await yearlyyReturnsRes.json();\r\n    } catch (error) {\r\n      var yearlyyReturnsResult = {};\r\n    }\r\n    try {\r\n      const peerCompareRes = await fetch(\r\n        `http://localhost:8000/avgpeer?name=${fund}`\r\n      );\r\n      var peerCompareResult = await peerCompareRes.json();\r\n    } catch (error) {\r\n      var peerCompareResult = {};\r\n    }\r\n    try {\r\n      const rollingYearlyRes = await fetch(\r\n        `http://localhost:8000/rolyear?name=${fund}`\r\n      );\r\n      var rollingYearlyResult = await rollingYearlyRes.json();\r\n    } catch (error) {\r\n      var rollingYearlyResult = {};\r\n    }\r\n    try {\r\n      const allRollingRes = await fetch(\r\n        `http://localhost:8000/allrolling/?name=${fund}`\r\n      );\r\n      var allRollingResult = await allRollingRes.json();\r\n    } catch (error) {\r\n      var allRollingResult = {};\r\n    }\r\n    try {\r\n      const regDirRes = await fetch(\r\n        `http://localhost:8000/regdir/?name=${fund}`\r\n      );\r\n      var regDirResult = await regDirRes.json();\r\n    } catch (error) {\r\n      var regDirResult = {};\r\n    }\r\n    try {\r\n      const bestWorstRes = await fetch(\r\n        `http://localhost:8000/bestworst?name=${fund}`\r\n      );\r\n      var bestWorstResult = await bestWorstRes.json();\r\n    } catch (error) {\r\n      var bestWorstResult = {};\r\n    }\r\n    try {\r\n      const benchmark = \"Select\";\r\n      const riskParammsRes = await fetch(\r\n        `http://localhost:8000/riskparamm/?name=${fund}&benchmark=${benchmark}`\r\n      );\r\n      var riskParammsResult = await riskParammsRes.json();\r\n    } catch (error) {\r\n      var riskParammsResult = {};\r\n    }\r\n  \r\n  \r\n  \r\n    return {\r\n      props: {\r\n        fund: fund,\r\n        titleFund: fund,\r\n        avggReturnsResult: avggReturnsResult,\r\n        navPlotResult: navPlotResult,\r\n        aumYearResult: aumYearResult,\r\n        fundInfoResult: fundInfoResult,\r\n        fundInfoExtraResult: fundInfoExtraResult,\r\n        stocksResult: stocksResult,\r\n        fundInfoVRResult: fundInfoVRResult,\r\n        yearlyyReturnsResult: yearlyyReturnsResult,\r\n        peerCompareResult: peerCompareResult,\r\n        rollingYearlyResult: rollingYearlyResult,\r\n        allRollingResult: allRollingResult,\r\n        regDirResult: regDirResult,\r\n        bestWorstResult: bestWorstResult,\r\n        riskParammsResult: riskParammsResult,\r\n        \r\n      },\r\n      revalidate: 60,\r\n    };\r\n}`"}
{"sentences": "Client side hydration not working in production mode", "description": "Hello!\r\n\r\nI'm working through a project to upgrade an existing code base to the latest version of NextJS (9.5.1). I'm now running into an issue where client side hydration is not working correctly. We use a custom server implementation and most of our pages are SSR'd. When running in production mode with a page that is SSR'd\r\n* getServerSideProps is correctly called and the page is partially rendered with the correct information\r\n* Event listeners are not being attached to buttons. Clicking them does nothing.\r\n* we have an async componentDidMount method on our _app.ts wrapper that doesn't get called.\r\n* We have a carousel component that should be rendering a `ul` of `li` for each image fetched in getServerSideProps. No `li` elements are rendered to the dom\r\n\r\nWhen i turn on dev mode, all these problems disappear and the page works correctly. I'm very confused how dev mode works differently and why these issues only appear when i turn it off. Any insight would be greatly appreciated.\r\n"}
{"sentences": "issue templates not working", "description": "The issue templates are currently broken. I'm unable to open a new issue over the website UI.\r\n\r\n\r\nhttps://user-images.githubusercontent.com/12292047/115307575-b1b50280-a169-11eb-9019-7b1972d23dbe.mp4\r\n\r\n\r\n\r\nIn the meantime https://github.com/vercel/next.js/issues/new works.\r\n"}
{"sentences": "Stop build from JS", "description": "Is there a way to stop a build purposefully? \r\ne.g. I check a boolean value on a fetched data and decide that if it's false I want to stop and fail the build?"}
{"sentences": "next build, error when trying to ignore already bundled file", "description": "Having this already working before, I don't know what has changed that now I get an error from babel.\r\n\r\nI'm trying to use `pdfkit.standalone.js` from https://pdfkit.org in my next app.\r\n\r\nThe setup is minimal and is here to reproduce my build error:\r\n\r\nhttps://github.com/jacargentina/next-test\r\n\r\n1. git clone\r\n2. yarn install\r\n3. next build\r\n\r\nThen the error is this:\r\n\r\n<img width=\"1101\" alt=\"Captura de Pantalla 2021-08-24 a la(s) 10 26 55\" src=\"https://user-images.githubusercontent.com/517228/130625210-c6368791-81f9-4a03-8284-434847d1c3e4.png\">\r\n\r\nAny advice on how to solve this? Cheers!"}
{"sentences": "Use different _app and _document for certain pages", "description": "Hi,\r\n\r\nI want to use wkhtltopdf to generate PDFs of the certain pages. I can not use the current pages as the source because the design requirement of the PDFs is different. Hence I want to create a different design which does not use the current _app and _document files."}
{"sentences": "How to provide multiple sources to Next Image component", "description": "I'm pretty sure what I ask is not yet possible but I open this discussion to be sure I won't open a feature request which is already implemented. \r\n\r\nI would like to give the Image component multiple src just like in a native html srcset attribute in order to display different images ( not just cropped ) depending on the viewport. For example a Ubuntu logo on desktop, a MacOS one on tablet and a Windows on phone."}
{"sentences": "Generate sitemap for static site with dynamic routes", "description": "Hey all, \r\n\r\nI'm trying to build a sitemap for my static site generated by Next.js. \r\n\r\nI currently don't explicitly define a `exportPathMap`, because I want to rely on the functionality of the CLI `build` and `export` commands to automatically read my `/pages` directory and build all my pages. \r\n\r\nThis functionality is really helpful because I have two dynamic routes that use `getStaticPaths`, which the CLI uses to determine all the pages that should be built. \r\n\r\nWhen I run `build`, I get this output:\r\n\r\n![image](https://user-images.githubusercontent.com/3893054/80850272-096cfd80-8be9-11ea-949c-08a6c5bee352.png)\r\n\r\nI've seen several tutorials/plugins on how to generate sitemaps for Next.js sites, like [this](https://dev.to/embiem/auto-generate-sitemapxml-in-nextjs-2nh1), [this](https://github.com/IlusionDev/nextjs-sitemap-generator), and [this](https://medium.com/anna-coding/how-to-generate-sitemap-xml-with-next-js-build-in-server-and-typescript-b0449a8b0fb8), but the solutions either:\r\n\r\n- Require a server (dealbreaker since I'm trying to export a static site)\r\n- Do a simple traversal of the `/pages` directory to get all routes (doesn't work for me since I'm using dynamic routes)\r\n- Require an explicit `exportPathMap` that includes _every page_. \r\n\r\nIs there any way to hook into some API (private or public) that will let me just get all the pages in my site. I basically just want to programmatically generate the data seen in the screenshot above. Then, I can use that to generate my sitemap with a script post `build` and `export` using that data. \r\n\r\nI would really appreciate any help or pointers here. Thank you!\r\n\r\n "}
{"sentences": "How to generate static sitemap and rss of a static blog", "description": "Recently I migrate my blog to Next.js and first of all I want to say how amazing is the new SSG methods! Now my blog is fully static!\r\n\r\nHowever, I want to generate also the sitemap and rss based in my markdown files. But I achived only with `getServerSideProps`... \r\n\r\nIs there some way to achive this using `getStaticProps`?"}
